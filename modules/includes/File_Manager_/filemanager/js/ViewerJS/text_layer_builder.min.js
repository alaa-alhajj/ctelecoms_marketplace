
"use strict";var FIND_SCROLL_OFFSET_TOP=-50;var FIND_SCROLL_OFFSET_LEFT=-400;var MAX_TEXT_DIVS_TO_RENDER=100000;var RENDER_DELAY=200;var NonWhitespaceRegexp=/\S/;function isAllWhitespace(a){return !NonWhitespaceRegexp.test(a)}var TextLayerBuilder=(function TextLayerBuilderClosure(){function a(i){this.textLayerDiv=i.textLayerDiv;this.layoutDone=false;this.divContentDone=false;this.pageIdx=i.pageIndex;this.matches=[];this.lastScrollSource=i.lastScrollSource||null;this.viewport=i.viewport;this.isViewerInPresentationMode=i.isViewerInPresentationMode;this.textDivs=[];this.findController=i.findController||null}a.prototype={renderLayer:function b(){var q=document.createDocumentFragment();var s=this.textDivs;var j=s.length;var l=document.createElement("canvas");var w=l.getContext("2d");if(j>MAX_TEXT_DIVS_TO_RENDER){return}var n;var t;for(var p=0;p<j;p++){var o=s[p];if(o.dataset.isWhitespace!==undefined){continue}var x=o.style.fontSize;var r=o.style.fontFamily;if(x!==n||r!==t){w.font=x+" "+r;n=x;t=r}var k=w.measureText(o.textContent).width;if(k>0){q.appendChild(o);var m;if(o.dataset.canvasWidth!==undefined){var u=o.dataset.canvasWidth/k;m="scaleX("+u+")"}else{m=""}var v=o.dataset.angle;if(v){m="rotate("+v+"deg) "+m}if(m){CustomStyle.setProp("transform",o,m)}}}this.textLayerDiv.appendChild(q);this.renderingDone=true;this.updateMatches()},setupRenderLayoutTimer:function g(){var i=this;var j=(this.lastScrollSource===null?0:this.lastScrollSource.lastScroll);if(Date.now()-j>RENDER_DELAY){this.renderLayer()}else{if(this.renderTimer){clearTimeout(this.renderTimer)}this.renderTimer=setTimeout(function(){i.setupRenderLayoutTimer()},RENDER_DELAY)}},appendText:function f(p,r){var i=r[p.fontName];var m=document.createElement("div");this.textDivs.push(m);if(isAllWhitespace(p.str)){m.dataset.isWhitespace=true;return}var n=PDFJS.Util.transform(this.viewport.transform,p.transform);var l=Math.atan2(n[1],n[0]);if(i.vertical){l+=Math.PI/2}var j=Math.sqrt((n[2]*n[2])+(n[3]*n[3]));var q=j;if(i.ascent){q=i.ascent*q}else{if(i.descent){q=(1+i.descent)*q}}var k;var o;if(l===0){k=n[4];o=n[5]-q}else{k=n[4]+(q*Math.sin(l));o=n[5]-(q*Math.cos(l))}m.style.left=k+"px";m.style.top=o+"px";m.style.fontSize=j+"px";m.style.fontFamily=i.fontFamily;m.textContent=p.str;if(PDFJS.pdfBug){m.dataset.fontName=p.fontName}if(l!==0){m.dataset.angle=l*(180/Math.PI)}if(m.textContent.length>1){if(i.vertical){m.dataset.canvasWidth=p.height*this.viewport.scale}else{m.dataset.canvasWidth=p.width*this.viewport.scale}}},setTextContent:function e(m){this.textContent=m;var l=m.items;for(var k=0,j=l.length;k<j;k++){this.appendText(l[k],m.styles)}this.divContentDone=true;this.setupRenderLayoutTimer()},convertMatches:function h(q){var o=0;var s=0;var j=this.textContent.items;var n=j.length-1;var l=(this.findController===null?0:this.findController.state.query.length);var t=[];for(var k=0,r=q.length;k<r;k++){var u=q[k];while(o!==n&&u>=(s+j[o].str.length)){s+=j[o].str.length;o++}if(o===j.length){console.error("Could not find a matching mapping")}var p={begin:{divIdx:o,offset:u-s}};u+=l;while(o!==n&&u>(s+j[o].str.length)){s+=j[o].str.length;o++}p.end={divIdx:o,offset:u-s};t.push(p)}return t},renderMatches:function c(j){if(j.length===0){return}var x=this.textContent.items;var s=this.textDivs;var k=null;var u=(this.findController===null?false:(this.pageIdx===this.findController.selected.pageIdx));var y=(this.findController===null?-1:this.findController.selected.matchIdx);var z=(this.findController===null?false:this.findController.state.highlightAll);var C={divIdx:-1,offset:undefined};function B(D,i){var E=D.divIdx;s[E].textContent="";m(E,0,D.offset,i)}function m(I,D,i,F){var J=s[I];var H=x[I].str.substring(D,i);var G=document.createTextNode(H);if(F){var E=document.createElement("span");E.className=F;E.appendChild(G);J.appendChild(E);return}J.appendChild(G)}var v=y,t=v+1;if(z){v=0;t=j.length}else{if(!u){return}}for(var w=v;w<t;w++){var n=j[w];var A=n.begin;var l=n.end;var p=(u&&w===y);var r=(p?" selected":"");if(p&&!this.isViewerInPresentationMode){scrollIntoView(s[A.divIdx],{top:FIND_SCROLL_OFFSET_TOP,left:FIND_SCROLL_OFFSET_LEFT})}if(!k||A.divIdx!==k.divIdx){if(k!==null){m(k.divIdx,k.offset,C.offset)}B(A)}else{m(k.divIdx,k.offset,A.offset)}if(A.divIdx===l.divIdx){m(A.divIdx,A.offset,l.offset,"highlight"+r)}else{m(A.divIdx,A.offset,C.offset,"highlight begin"+r);for(var q=A.divIdx+1,o=l.divIdx;q<o;q++){s[q].className="highlight middle"+r}B(l,"highlight end"+r)}k=l}if(k){m(k.divIdx,k.offset,C.offset)}},updateMatches:function d(){if(!this.renderingDone){return}var q=this.matches;var t=this.textDivs;var k=this.textContent.items;var u=-1;for(var p=0,s=q.length;p<s;p++){var r=q[p];var m=Math.max(u,r.begin.divIdx);for(var l=m,o=r.end.divIdx;l<=o;l++){var j=t[l];j.textContent=k[l].str;j.className=""}u=r.end.divIdx+1}if(this.findController===null||!this.findController.active){return}this.matches=this.convertMatches(this.findController===null?[]:(this.findController.pageMatches[this.pageIdx]||[]));this.renderMatches(this.matches)}};return a})();