
/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2015
 * @version 4.1.8
 *
 * File input styled for Bootstrap 3.0 that utilizes HTML5 File Input's advanced 
 * features including the FileReader API. 
 * 
 * The plugin drastically enhances the HTML file input to preview multiple files on the client before
 * upload. In addition it provides the ability to preview content of images, text, videos, audio, html, 
 * flash and other objects. It also offers the ability to upload and delete files using AJAX, and add 
 * files in batches (i.e. preview, append, or remove before upload).
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
(function(B){String.prototype.repl=function(W,V){return this.split(W).join(V)};var j=function(V){var X=document.createElement("div"),W;X.innerHTML="<!--[if IE "+V+"]><i></i><![endif]-->";W=(X.getElementsByTagName("i").length===1);document.body.appendChild(X);X.parentNode.removeChild(X);return W},m={data:{},init:function(W){var V=W.initialPreview,X=W.id;if(V.length>0&&!u(V)){V=V.split(W.initialPreviewDelimiter)}m.data[X]={content:V,config:W.initialPreviewConfig,tags:W.initialPreviewThumbTags,delimiter:W.initialPreviewDelimiter,template:W.previewGenericTemplate,msg:W.msgSelected,initId:W.previewInitId,footer:W.getLayoutTemplate("footer"),isDelete:W.initialPreviewShowDelete,caption:W.initialCaption,actions:function(Y,ad,ac,aa,ab,Z){return W.renderFileActions(Y,ad,ac,aa,ab,Z)}}},fetch:function(V){return m.data[V].content.filter(function(W){return W!==undefined})},count:function(V){return !!m.data[V]&&!!m.data[V].content?m.fetch(V).length:0},get:function(ab,Y,W){var aa="init_"+Y,Z=m.data[ab],V=Z.initId+"-"+aa,X;W=W===undefined?true:W;if(Z.content[Y]===undefined){return""}X=Z.template.repl("{previewId}",V).repl("{frameClass}"," file-preview-initial").repl("{fileindex}",aa).repl("{content}",Z.content[Y]).repl("{footer}",m.footer(ab,Y,W));if(Z.tags.length&&Z.tags[Y]){X=d(X,Z.tags[Y])}return X},add:function(aa,Y,X,V){var Z=B.extend(true,{},m.data[aa]),W;if(!u(Y)){Y=Y.split(Z.delimiter)}if(V){W=Z.content.push(Y)-1;Z.config[W]=X}else{W=Y.length;Z.content=Y;Z.config=X}m.data[aa]=Z;return W},set:function(ab,Z,X,W,V){var aa=B.extend(true,{},m.data[ab]),Y;if(!u(Z)){Z=Z.split(aa.delimiter)}if(V){for(Y=0;Y<Z.length;Y++){aa.content.push(Z[Y])}for(Y=0;Y<X.length;Y++){aa.config.push(X[Y])}for(Y=0;Y<W.length;Y++){aa.tags.push(W[Y])}}else{aa.content=Z;aa.config=X;aa.tags=W}m.data[ab]=aa},unset:function(X,W){var V=m.count(X);if(!V){return}if(V===1){m.data[X].content=[];m.data[X].config=[];return}m.data[X].content[W]=undefined;m.data[X].config[W]=undefined},out:function(aa){var Y="",Z=m.data[aa],W,V=m.count(aa);if(V===0){return{content:"",caption:""}}for(var X=0;X<V;X++){Y+=m.get(aa,X)}W=Z.msg.repl("{n}",V);return{content:Y,caption:W}},footer:function(W,ac,af){var ab=m.data[W];af=af===undefined?true:af;if(ab.config.length===0||o(ab.config[ac])){return""}var Y=ab.config[ac],ag=F("caption",Y)?Y.caption:"",X=F("width",Y)?Y.width:"auto",V=F("url",Y)?Y.url:false,ae=F("key",Y)?Y.key:null,aa=(V===false)&&af,Z=ab.isDelete?ab.actions(false,true,aa,V,ae,ac):"",ad=ab.footer.repl("{actions}",Z);return ad.repl("{caption}",ag).repl("{width}",X).repl("{indicator}","").repl("{indicatorTitle}","")}},i=".file-preview-frame:not(.file-preview-initial)",O=function(V,W){W=W||0;if(typeof V==="number"){return V}if(typeof V==="string"){V=parseFloat(V)}return isNaN(V)?W:V},t=function(){return window.File&&window.FileReader},R=function(){var V=document.createElement("div");return !j(9)&&(V.draggable!==undefined||(V.ondragstart!==undefined&&V.ondrop!==undefined))},v=function(){return t&&window.FormData},l=function(W,V){W.removeClass(V).addClass(V)},z='style="width:{width};height:{height};"',A='      <param name="controller" value="true" />\n      <param name="allowFullScreen" value="true" />\n      <param name="allowScriptAccess" value="always" />\n      <param name="autoPlay" value="false" />\n      <param name="autoStart" value="false" />\n      <param name="quality" value="high" />\n',g='<div class="file-preview-other">\n       {previewFileIcon}\n   </div>',H={removeIcon:'<i class="glyphicon glyphicon-trash text-danger"></i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"></i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign file-icon-large text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."},c='{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   </div>\n</div>',b='{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',x='<div class="file-preview {class}">\n    <div class="close fileinput-remove">&times;</div>\n    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',p='<span class="glyphicon glyphicon-file kv-caption-icon"></span>',M='<div tabindex="-1" class="form-control file-caption {class}">\n   <span class="file-caption-ellipsis">&hellip;</span>\n   <div class="file-caption-name"></div>\n</div>',T='<div id="{id}" class="modal fade">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        <h3 class="modal-title">Detailed Preview <small>{title}</small></h3>\n      </div>\n      <div class="modal-body">\n        <textarea class="form-control" style="font-family:Monaco,Consolas,monospace; height: {height}px;" readonly>{body}</textarea>\n      </div>\n    </div>\n  </div>\n</div>',s='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {percent}%\n     </div>\n</div>',U='<div class="file-thumbnail-footer">\n    <div class="file-caption-name">{caption}</div>\n    {actions}\n</div>',K='<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload}{delete}{other}    </div>\n    <div class="file-upload-indicator" tabindex="-1" title="{indicatorTitle}">{indicator}</div>\n    <div class="clearfix"></div>\n</div>',w='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}"{dataUrl}{dataKey}>{removeIcon}</button>\n',n='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">   {uploadIcon}\n</button>\n',h='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   {content}\n   {footer}\n</div>\n',E='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n    <object data="{data}" type="{type}" width="{width}" height="{height}">\n       '+g+"\n    </object>\n   {footer}\n</div>",J='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <img src="{data}" class="file-preview-image" title="{caption}" alt="{caption}" '+z+">\n   {footer}\n</div>\n",D='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <div class="file-preview-text" title="{caption}" '+z+">\n       {data}\n   </div>\n   {footer}\n</div>",I='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+z+'>\n   <video width="{width}" height="{height}" controls>\n       <source src="{data}" type="{type}">\n       '+g+"\n   </video>\n   {footer}\n</div>\n",e='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+z+'>\n   <audio controls>\n       <source src="{data}" type="{type}">\n       '+g+"\n   </audio>\n   {footer}\n</div>",f='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+z+'>\n   <object type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+A+"       "+g+"\n   </object>\n   {footer}\n</div>\n",y='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+z+'>\n   <object data="{data}" type="{type}" width="{width}" height="{height}">\n       <param name="movie" value="{caption}" />\n'+A+"         "+g+"\n   </object>\n   {footer}\n</div>",C='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+z+">\n   "+g+"\n   {footer}\n</div>",a={main1:c,main2:b,preview:x,icon:p,caption:M,modal:T,progress:s,footer:U,actions:K,actionDelete:w,actionUpload:n},L={generic:h,html:E,image:J,text:D,video:I,audio:e,flash:f,object:y,other:C},N=["image","html","text","video","audio","flash","object"],S={image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"160px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},P={image:function(W,V){return(W!==undefined)?W.match("image.*"):V.match(/\.(gif|png|jpe?g)$/i)},html:function(W,V){return(W!==undefined)?W==="text/html":V.match(/\.(htm|html)$/i)},text:function(W,V){return(W!==undefined&&W.match("text.*"))||V.match(/\.(txt|md|csv|nfo|php|ini)$/i)},video:function(W,V){return(W!==undefined&&W.match(/\.video\/(ogg|mp4|webm)$/i))||V.match(/\.(og?|mp4|webm)$/i)},audio:function(W,V){return(W!==undefined&&W.match(/\.audio\/(ogg|mp3|wav)$/i))||V.match(/\.(ogg|mp3|wav)$/i)},flash:function(W,V){return(W!==undefined&&W==="application/x-shockwave-flash")||V.match(/\.(swf)$/i)},object:function(){return true},other:function(){return true}},o=function(W,V){return W===null||W===undefined||W.length===0||(V&&B.trim(W)==="")},u=function(V){return Array.isArray(V)||Object.prototype.toString.call(V)==="[object Array]"},F=function(W,V){return(typeof V==="object"&&W in V)},G=function(V,X,W){return(o(V)||o(V[X]))?W:B(V[X])},r=function(){return Math.round(new Date().getTime()+(Math.random()*100))},q=function(V){return String(V).repl("&","&amp;").repl('"',"&quot;").repl("'","&#39;").repl("<","&lt;").repl(">","&gt;")},d=function(X,W){var V=X;W=W||{};B.each(W,function(Y,Z){if(typeof Z==="function"){Z=Z()}V=V.repl(Y,Z)});return V},Q=window.URL||window.webkitURL,k=function(W,V){this.$element=B(W);if(t()||j(9)){this.init(V);this.listen()}else{this.$element.removeClass("file-loading")}};k.prototype={constructor:k,init:function(W){var V=this,Y=V.$element,X;B.each(W,function(Z,aa){if(Z==="maxFileCount"||Z==="maxFileSize"){V[Z]=O(aa)}V[Z]=aa});V.fileInputCleared=false;V.fileBatchCompleted=true;if(o(V.allowedPreviewTypes)){V.allowedPreviewTypes=N}V.uploadFileAttr=!o(Y.attr("name"))?Y.attr("name"):"file_data";V.reader=null;V.formdata={};V.isIE9=j(9);V.isIE10=j(10);V.filestack=[];V.ajaxRequests=[];V.isError=false;V.uploadAborted=false;V.dropZoneEnabled=R()&&V.dropZoneEnabled;V.isDisabled=V.$element.attr("disabled")||V.$element.attr("readonly");V.isUploadable=v&&!o(V.uploadUrl);V.slug=typeof W.slugCallback==="function"?W.slugCallback:V.slugDefault;V.mainTemplate=V.showCaption?V.getLayoutTemplate("main1"):V.getLayoutTemplate("main2");V.captionTemplate=V.getLayoutTemplate("caption");V.previewGenericTemplate=V.getPreviewTemplate("generic");if(o(V.$element.attr("id"))){V.$element.attr("id",r())}if(V.$container===undefined){V.$container=V.createContainer()}else{V.refreshContainer()}V.$progress=V.$container.find(".kv-upload-progress");V.$btnUpload=V.$container.find(".kv-fileinput-upload");V.$captionContainer=G(W,"elCaptionContainer",V.$container.find(".file-caption"));V.$caption=G(W,"elCaptionText",V.$container.find(".file-caption-name"));V.$previewContainer=G(W,"elPreviewContainer",V.$container.find(".file-preview"));V.$preview=G(W,"elPreviewImage",V.$container.find(".file-preview-thumbnails"));V.$previewStatus=G(W,"elPreviewStatus",V.$container.find(".file-preview-status"));V.$errorContainer=G(W,"elErrorContainer",V.$previewContainer.find(".kv-fileinput-error"));if(!o(V.msgErrorClass)){l(V.$errorContainer,V.msgErrorClass)}V.$errorContainer.hide();V.fileActionSettings=B.extend(H,W.fileActionSettings);V.previewInitId="preview-"+r();V.id=V.$element.attr("id");m.init(V);V.initPreview(true);V.initPreviewDeletes();V.options=W;V.setFileDropZoneTitle();V.uploadCount=0;V.uploadPercent=0;V.$element.removeClass("file-loading");X=V.getLayoutTemplate("progress");V.progressTemplate=X.replace("{class}",V.progressClass);V.progressCompleteTemplate=X.replace("{class}",V.progressCompleteClass);V.setEllipsis()},parseError:function(Y,Z,ab){var W=this,X=B.trim(Z+""),V=X.slice(-1)==="."?"":".",aa=B(Y.responseText).text();if(W.showAjaxErrorDetails){aa=B.trim(aa.replace(/\n\s*\n/g,"\n"));aa=aa.length>0?"<pre>"+aa+"</pre>":"";X+=V+aa}else{X+=V}return ab?"<b>"+ab+": </b>"+Y:X},raise:function(X,Z){var V=this,Y=B.Event(X),W;if(Z!==undefined){V.$element.trigger(Y,Z)}else{V.$element.trigger(Y)}W=Y.result||false;if(!W){return}switch(X){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":break;default:V.uploadAborted=W;break}},getLayoutTemplate:function(W){var V=this,X=F(W,V.layoutTemplates)?V.layoutTemplates[W]:a[W];if(o(V.customLayoutTags)){return X}return d(X,V.customLayoutTags)},getPreviewTemplate:function(W){var V=this,X=F(W,V.previewTemplates)?V.previewTemplates[W]:L[W];X=X.repl("{previewFileIcon}",V.previewFileIcon);if(o(V.customPreviewTags)){return X}return d(X,V.customPreviewTags)},getOutData:function(X,W,Y){var V=this;X=X||{};W=W||{};Y=Y||V.filestack.slice(0)||{};return{form:V.formdata,files:Y,extra:V.getExtraData(),response:W,reader:V.reader,jqXHR:X}},setEllipsis:function(){var W=this,X=W.$captionContainer,Y=W.$caption,V=Y.clone().css("height","auto").hide();X.parent().before(V);X.removeClass("kv-has-ellipsis");if(V.outerWidth()>Y.outerWidth()){X.addClass("kv-has-ellipsis")}V.remove()},listen:function(){var W=this,X=W.$element,Y=W.$captionContainer,Z=W.$btnFile,V=X.closest("form");X.on("change",B.proxy(W.change,W));B(window).on("resize",function(){W.setEllipsis()});Z.off("click").on("click",function(){W.raise("filebrowse");if(W.isError&&!W.isUploadable){W.clear()}Y.focus()});V.off("reset").on("reset",B.proxy(W.reset,W));W.$container.off("click").on("click",".fileinput-remove:not([disabled])",B.proxy(W.clear,W)).on("click",".fileinput-cancel",B.proxy(W.cancel,W));if(W.isUploadable&&W.dropZoneEnabled&&W.showPreview){W.initDragDrop()}if(!W.isUploadable){V.on("submit",B.proxy(W.submitForm,W))}W.$container.find(".kv-fileinput-upload").off("click").on("click",function(aa){if(!W.isUploadable){return}aa.preventDefault();if(!B(this).hasClass("disabled")&&o(B(this).attr("disabled"))){W.upload()}})},submitForm:function(){var V=this,W=V.$element,X=W.get(0).files;if(X&&X.length<V.minFileCount&&V.minFileCount>0){V.noFilesError({});return false}return !V.abort({})},abort:function(X){var V=this,W;if(V.uploadAborted&&typeof V.uploadAborted==="object"&&V.uploadAborted.message!==undefined){if(V.uploadAborted.data!==undefined){W=V.getOutData({},V.uploadAborted.data)}else{W=V.getOutData()}W=B.extend(W,X);V.showUploadError(V.uploadAborted.message,W,"filecustomerror");return true}return false},noFilesError:function(Z){var W=this,X=W.minFileCount>1?W.filePlural:W.fileSingle,Y=W.msgFilesTooLess.repl("{n}",W.minFileCount).repl("{files}",X),V=W.$errorContainer;V.html(Y);W.isError=true;W.updateFileDetails(0);V.fadeIn(800);W.raise("fileerror",[Z]);W.clearFileInput();l(W.$container,"has-error")},setProgress:function(Y){var V=this,X=Math.min(Y,100),W=X<100?V.progressTemplate:V.progressCompleteTemplate;V.$progress.html(W.repl("{percent}",X))},upload:function(){var X=this,W=X.getFileStack().length,ab={},Z,aa,V,Y=!B.isEmptyObject(X.getExtraData());if(W<X.minFileCount&&X.minFileCount>0){X.noFilesError(ab);return}if(!X.isUploadable||X.isDisabled||(W===0&&!Y)){return}X.resetUpload();X.$progress.removeClass("hide");X.uploadCount=0;X.uploadPercent=0;X.lock();X.setProgress(0);if(W===0&&Y){X.uploadExtraOnly();return}V=X.filestack.length;X.hasInitData=false;if(X.uploadAsync&&X.showPreview){aa=X.getOutData();X.raise("filebatchpreupload",[aa]);X.fileBatchCompleted=false;X.uploadCache={content:[],config:[],tags:[],append:true};for(Z=0;Z<V;Z+=1){if(X.filestack[Z]!==undefined){X.uploadSingle(Z,X.filestack,true)}}return}X.uploadBatch()},lock:function(){var V=this;V.resetErrors();V.disable();if(V.showRemove){l(V.$container.find(".fileinput-remove"),"hide")}if(V.showCancel){V.$container.find(".fileinput-cancel").removeClass("hide")}V.raise("filelock",[V.filestack,V.getExtraData()])},unlock:function(W){var V=this;if(W===undefined){W=true}V.enable();if(V.showCancel){l(V.$container.find(".fileinput-cancel"),"hide")}if(V.showRemove){V.$container.find(".fileinput-remove").removeClass("hide")}if(W){V.resetFileStack()}V.raise("fileunlock",[V.filestack,V.getExtraData()])},resetFileStack:function(){var V=this,W=0,X=[];V.$preview.find(i).each(function(){var aa=B(this),Z=aa.attr("data-fileindex"),Y=V.filestack[Z];if(Z===-1){return}if(Y!==undefined){X[W]=Y;aa.attr({id:V.previewInitId+"-"+W,"data-fileindex":W});W+=1}else{aa.attr({id:"uploaded-"+r(),"data-fileindex":"-1"})}});V.filestack=X},refresh:function(W){var V=this,X=V.$element,Y,Z=(arguments.length)?B.extend(V.options,W):V.options;X.off();V.init(Z);Y=V.$container.find(".file-drop-zone");Y.off("dragenter dragover drop");B(document).off("dragenter dragover drop");V.listen();V.setFileDropZoneTitle()},initDragDrop:function(){var V=this,W=V.$container.find(".file-drop-zone");W.off("dragenter dragover drop");B(document).off("dragenter dragover drop");W.on("dragenter dragover",function(X){X.stopPropagation();X.preventDefault();if(V.isDisabled){return}l(B(this),"highlighted")});W.on("dragleave",function(X){X.stopPropagation();X.preventDefault();if(V.isDisabled){return}B(this).removeClass("highlighted")});W.on("drop",function(X){X.preventDefault();if(V.isDisabled){return}V.change(X,"dragdrop");B(this).removeClass("highlighted")});B(document).on("dragenter dragover drop",function(X){X.stopPropagation();X.preventDefault()})},setFileDropZoneTitle:function(){var V=this,W=V.$container.find(".file-drop-zone");W.find("."+V.dropZoneTitleClass).remove();if(!V.isUploadable||!V.showPreview||W.length===0||V.getFileStack().length>0||!V.dropZoneEnabled){return}if(W.find(".file-preview-frame").length===0){W.prepend('<div class="'+V.dropZoneTitleClass+'">'+V.dropZoneTitle+"</div>")}V.$container.removeClass("file-input-new");l(V.$container,"file-input-ajax-new")},initFileActions:function(){var V=this;V.$preview.find(".kv-file-remove").each(function(){var X=B(this),Y=X.closest(".file-preview-frame"),Z=Y.attr("data-fileindex"),aa,W;X.off("click").on("click",function(){Y.fadeOut("slow",function(){V.filestack[Z]=undefined;V.clearObjects(Y);Y.remove();var ad=V.getFileStack(),ab=ad.length,ac=m.count(V.id);V.clearFileInput();if(ab===0&&ac===0){V.reset()}else{aa=ac+ab;W=aa>1?V.msgSelected.repl("{n}",aa):ad[0].name;V.setCaption(W)}})})});V.$preview.find(".kv-file-upload").each(function(){var W=B(this);W.off("click").on("click",function(){var X=W.closest(".file-preview-frame"),Y=X.attr("data-fileindex");V.uploadSingle(Y,V.filestack,false)})})},renderFileFooter:function(W,aa){var V=this,Y=V.fileActionSettings,ab,X,Z=V.getLayoutTemplate("footer");if(V.isUploadable){ab=Z.repl("{actions}",V.renderFileActions(true,true,false,false,false,false));X=ab.repl("{caption}",W).repl("{width}",aa).repl("{indicator}",Y.indicatorNew).repl("{indicatorTitle}",Y.indicatorNewTitle)}else{X=Z.repl("{actions}","").repl("{caption}",W).repl("{width}",aa).repl("{indicator}","").repl("{indicatorTitle}","")}X=d(X,V.previewThumbTags);return X},renderFileActions:function(Y,V,ac,X,ai,af){if(!Y&&!V){return""}var aj=this,ab=X===false?"":' data-url="'+X+'"',Z=ai===false?"":' data-key="'+ai+'"',ad=aj.getLayoutTemplate("actionDelete"),ae="",ah=aj.getLayoutTemplate("actions"),W=aj.otherActionButtons.repl("{dataKey}",Z),aa=aj.fileActionSettings,ag=ac?aa.removeClass+" disabled":aa.removeClass;ad=ad.repl("{removeClass}",ag).repl("{removeIcon}",aa.removeIcon).repl("{removeTitle}",aa.removeTitle).repl("{dataUrl}",ab).repl("{dataKey}",Z);if(Y){ae=aj.getLayoutTemplate("actionUpload").repl("{uploadClass}",aa.uploadClass).repl("{uploadIcon}",aa.uploadIcon).repl("{uploadTitle}",aa.uploadTitle)}return ah.repl("{delete}",ad).repl("{upload}",ae).repl("{other}",W)},initPreview:function(Y){var V=this,X,W;if(!m.count(V.id)){V.$preview.html("");V.setCaption("");return}W=m.out(V.id);X=Y&&V.initialCaption?V.initialCaption:W.caption;V.$preview.html(W.content);V.setCaption(X);if(!o(W.content)){V.$container.removeClass("file-input-new")}},initPreviewDeletes:function(){var W=this,V=W.deleteExtraData||{},X=function(){if(W.$preview.find(".kv-file-remove").length===0){W.reset()}};W.$preview.find(".kv-file-remove").each(function(){var ah=B(this),aa=ah.closest(".file-preview-frame"),Y=m.data[W.id],ag,ab,ad,af=ah.data("url")||W.deleteUrl,Z=ah.data("key"),ac,ae={id:ah.attr("id"),key:Z,extra:ad};if(typeof ad==="function"){ad=ad()}if(af===undefined||Z===undefined){return}ac=B.extend({url:af,type:"DELETE",dataType:"json",data:B.extend({key:Z},ad),beforeSend:function(ai){l(aa,"file-uploading");l(ah,"disabled");W.raise("filepredelete",[Z,ai,ad])},success:function(aj,ak,ai){ag=parseInt(aa.data("fileindex").replace("init_",""));ab=o(Y.config)&&o(Y.config[ag])?null:Y.config[ag];ad=o(ab)||o(ab.extra)?V:ab.extra;if(aj===undefined||aj.error===undefined){m.unset(W.id,ag);W.raise("filedeleted",[Z,ai,ad])}else{ae.jqXHR=ai;ae.response=aj;W.showError(aj.error,ae,"filedeleteerror");aa.removeClass("file-uploading");ah.removeClass("disabled");X();return}aa.removeClass("file-uploading").addClass("file-deleted");aa.fadeOut("slow",function(){W.clearObjects(aa);aa.remove();X();if(!m.count(W.id)&&W.getFileStack().length===0){W.reset()}})},error:function(aj,al,ak){var ai=W.parseError(aj,ak);ae.jqXHR=aj;ae.response={};W.showError(ai,ae,"filedeleteerror");aa.removeClass("file-uploading");X()}},W.ajaxDeleteSettings);ah.off("click").on("click",function(){B.ajax(ac)})})},clearObjects:function(V){V.find("video audio").each(function(){this.pause();B(this).remove()});V.find("img object div").each(function(){B(this).remove()})},clearFileInput:function(){var X=this,Y=X.$element,Z,V,W;if(o(Y.val())){return}if(X.isIE9||X.isIE10){Z=Y.closest("form");V=B(document.createElement("form"));W=B(document.createElement("div"));Y.before(W);if(Z.length){Z.after(V)}else{W.after(V)}V.append(Y).trigger("reset");W.before(Y).remove();V.remove()}else{Y.val("")}X.fileInputCleared=true},resetUpload:function(){var V=this;V.uploadCache={content:[],config:[],tags:[],append:true};V.uploadCount=0;V.uploadPercent=0;V.$btnUpload.removeAttr("disabled");V.setProgress(0);l(V.$progress,"hide");V.resetErrors(false);V.uploadAborted=false;V.ajaxRequests=[]},cancel:function(){var W=this,Y=W.ajaxRequests,V=Y.length,X;if(V>0){for(X=0;X<V;X+=1){Y[X].abort()}}W.$preview.find(i).each(function(){var aa=B(this),Z=aa.attr("data-fileindex");aa.removeClass("file-uploading");if(W.filestack[Z]!==undefined){aa.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled");aa.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")}W.unlock()})},clear:function(){var V=this,W;V.$btnUpload.removeAttr("disabled");V.resetUpload();V.filestack=[];V.clearFileInput();V.resetErrors(true);V.raise("fileclear");if(!V.overwriteInitial&&m.count(V.id)){V.showFileIcon();V.resetPreview();V.setEllipsis();V.initPreviewDeletes();V.$container.removeClass("file-input-new")}else{V.$preview.find(i).each(function(){V.clearObjects(B(this))});V.$preview.html("");W=(!V.overwriteInitial&&V.initialCaption.length>0)?V.initialCaption:"";V.$caption.html(W);V.setEllipsis();V.$caption.attr("title","");l(V.$container,"file-input-new")}if(V.$container.find(".file-preview-frame").length===0){V.initialCaption="";V.$caption.html("");V.setEllipsis();V.$captionContainer.find(".kv-caption-icon").hide()}V.hideFileIcon();V.raise("filecleared");V.$captionContainer.focus();V.setFileDropZoneTitle()},resetPreview:function(){var V=this,W;if(m.count(V.id)){W=m.out(V.id);V.$preview.html(W.content);V.setCaption(W.caption)}else{V.$preview.html("");V.$caption.html("")}},reset:function(){var V=this;V.clear();V.resetPreview();V.setEllipsis();V.$container.find(".fileinput-filename").text("");V.raise("filereset");if(V.initialPreview.length>0){V.$container.removeClass("file-input-new")}V.setFileDropZoneTitle();V.filestack=[];V.formdata={}},disable:function(){var V=this;V.isDisabled=true;V.raise("filedisabled");V.$element.attr("disabled","disabled");V.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled");V.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").attr("disabled",true);V.initDragDrop()},enable:function(){var V=this;V.isDisabled=false;V.raise("fileenabled");V.$element.removeAttr("disabled");V.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled");V.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").removeAttr("disabled");V.initDragDrop()},getExtraData:function(){var V=this,W=V.uploadExtraData;if(typeof V.uploadExtraData==="function"){W=V.uploadExtraData()}return W},uploadExtra:function(){var V=this,W=V.getExtraData();if(W.length===0){return}B.each(W,function(X,Y){V.formdata.append(X,Y)})},initXhr:function(X,W){var V=this;if(X.upload){X.upload.addEventListener("progress",function(aa){var ab=0,Y=aa.loaded||aa.position,Z=aa.total;if(aa.lengthComputable){ab=Math.ceil(Y/Z*W)}V.uploadPercent=Math.max(ab,V.uploadPercent);V.setProgress(V.uploadPercent)},false)}return X},ajaxSubmit:function(X,Z,aa,W){var V=this,Y;V.uploadExtra();Y=B.extend({xhr:function(){var ab=B.ajaxSettings.xhr();return V.initXhr(ab,98)},url:V.uploadUrl,type:"POST",dataType:"json",data:V.formdata,cache:false,processData:false,contentType:false,beforeSend:X,success:Z,complete:aa,error:W},V.ajaxSettings);V.ajaxRequests.push(B.ajax(Y))},initUploadSuccess:function(Y,ae,V){var ac=this,W,Z,aa,af,ab,X,ad;if(typeof Y!=="object"||B.isEmptyObject(Y)){return}if(Y.initialPreview!==undefined&&Y.initialPreview.length>0){ac.hasInitData=true;ab=Y.initialPreview||[];X=Y.initialPreviewConfig||[];ad=Y.initialPreviewThumbTags||[];W=Y.append===undefined||Y.append?true:false;ac.overwriteInitial=false;if(ae!==undefined&&!!V){aa=m.add(ac.id,ab,X[0],ad[0],W);Z=m.get(ac.id,aa,false);af=B(Z).hide();ae.after(af).fadeOut("slow",function(){af.fadeIn("slow").css("display:inline-block");ac.initPreviewDeletes()})}else{if(V){ac.uploadCache.content.push(ab[0]);ac.uploadCache.config.push(X[0]);ac.uploadCache.tags.push(ad[0]);ac.uploadCache.append=W}else{m.set(ac.id,ab,X,ad,W);ac.initPreview();ac.initPreviewDeletes()}}}},uploadSingle:function(am,ab,aa){var aj=this,at=aj.getFileStack().length,ah=new FormData(),ar,W=aj.previewInitId+"-"+am,af=B("#"+W+":not(.file-preview-initial)"),X,al,ag=af.find(".kv-file-upload"),aq=af.find(".kv-file-remove"),ak=af.find(".file-upload-indicator"),ap=aj.fileActionSettings,Z=aj.filestack.length>0||!B.isEmptyObject(aj.uploadExtraData),V,ae,ai,ac,ad,Y,ao,an={id:W,index:am};aj.formdata=ah;if(at===0||!Z||ag.hasClass("disabled")||aj.abort(an)){return}al=function(){var au=aj.$preview.find(i+".file-uploading");if(au.length>0&&aj.fileBatchCompleted){return}m.set(aj.id,aj.uploadCache.content,aj.uploadCache.config,aj.uploadCache.tags,aj.uploadCache.append);if(aj.hasInitData){aj.initPreview();aj.initPreviewDeletes()}aj.setProgress(100);aj.unlock();aj.clearFileInput();aj.raise("filebatchuploadcomplete",[aj.filestack,aj.getExtraData()]);aj.fileBatchCompleted=true};V=function(au,av){ak.html(ap[au]);ak.attr("title",ap[av])};ae=function(){if(!aa||at===0||aj.uploadPercent>=100){return}aj.uploadCount+=1;X=80+Math.ceil(aj.uploadCount*20/at);aj.uploadPercent=Math.max(X,aj.uploadPercent);aj.setProgress(aj.uploadPercent);aj.initPreviewDeletes()};ai=function(){ag.removeAttr("disabled");aq.removeAttr("disabled");af.removeClass("file-uploading")};ac=function(au){ar=aj.getOutData(au);V("indicatorLoading","indicatorLoadingTitle");l(af,"file-uploading");ag.attr("disabled",true);aq.attr("disabled",true);if(!aa){aj.lock()}aj.raise("filepreupload",[ar,W,am]);an=B.extend(an,ar);if(aj.abort(an)){au.abort();aj.setProgress(100)}};ad=function(av,aw,au){ar=aj.getOutData(au,av);an=B.extend(an,ar);setTimeout(function(){if(av.error===undefined){V("indicatorSuccess","indicatorSuccessTitle");ag.hide();aq.hide();aj.filestack[am]=undefined;aj.raise("fileuploaded",[ar,W,am]);aj.initUploadSuccess(av,af,aa);if(!aa){aj.resetFileStack()}}else{V("indicatorError","indicatorErrorTitle");aj.showUploadError(av.error,an)}},100)};Y=function(){setTimeout(function(){ae();ai();if(!aa){aj.unlock(false)}else{setTimeout(function(){al()},500)}},100)};ao=function(av,ax,aw){var au=aj.parseError(av,aw,(aa?ab[am].name:null));V("indicatorError","indicatorErrorTitle");an=B.extend(an,aj.getOutData(av));aj.showUploadError(au,an)};ah.append(aj.uploadFileAttr,ab[am]);ah.append("file_id",am);aj.ajaxSubmit(ac,ad,Y,ao)},uploadBatch:function(){var ah=this,V=ah.filestack,af=V.length,Y,X=ah.filestack.length>0||!B.isEmptyObject(ah.uploadExtraData),W,Z,ad,ac,ag,ab,ae,aa={};ah.formdata=new FormData();if(af===0||!X||ah.abort(aa)){return}Y=ah.fileActionSettings;W=function(ai,aj,al){var ak=B("#"+ah.previewInitId+"-"+ai).find(".file-upload-indicator");ak.html(Y[aj]);ak.attr("title",Y[al])};ad=function(aj){var al=B("#"+ah.previewInitId+"-"+aj+":not(.file-preview-initial)"),ai=al.find(".kv-file-upload"),ak=al.find(".kv-file-delete");al.removeClass("file-uploading");ai.removeAttr("disabled");ak.removeAttr("disabled")};Z=function(){B.each(V,function(ai,aj){ah.filestack[ai]=undefined});ah.clearFileInput()};ac=function(ai){ah.lock();var aj=ah.getOutData(ai);if(ah.showPreview){ah.$preview.find(i).each(function(){var am=B(this),ak=am.find(".kv-file-upload"),al=am.find(".kv-file-remove");l(am,"file-uploading");ak.attr("disabled",true);al.attr("disabled",true)})}ah.raise("filebatchpreupload",[aj]);if(ah.abort(aj)){ai.abort()}};ag=function(ak,am,aj){var al=ah.getOutData(aj,ak),ai=o(ak.errorkeys)?[]:ak.errorkeys;if(ak.error===undefined||o(ak.error)){ah.raise("filebatchuploadsuccess",[al]);Z();if(ah.showPreview){ah.$preview.find(".kv-file-upload").hide();ah.$preview.find(".kv-file-remove").hide();ah.$preview.find(i).each(function(){var ao=B(this),an=ao.attr("data-fileindex");W(an,"indicatorSuccess","indicatorSuccessTitle");ad(an)});ah.initUploadSuccess(ak)}else{ah.reset()}}else{if(ah.showPreview){ah.$preview.find(i).each(function(){var ao=B(this),an=parseInt(ao.attr("data-fileindex"),10);ad(an);if(ai.length===0){W(an,"indicatorError","indicatorErrorTitle");return}if(B.inArray(an,ai)!==-1){W(an,"indicatorError","indicatorErrorTitle")}else{ao.find(".kv-file-upload").hide();ao.find(".kv-file-remove").hide();W(an,"indicatorSuccess","indicatorSuccessTitle");ah.filestack[an]=undefined}});ah.initUploadSuccess(ak)}ah.showUploadError(ak.error,al,"filebatchuploaderror")}};ab=function(){ah.setProgress(100);ah.unlock();ah.raise("filebatchuploadcomplete",[ah.filestack,ah.getExtraData()]);ah.clearFileInput()};ae=function(aj,am,al){var ak=ah.getOutData(aj),ai=ah.parseError(aj,al);ah.showUploadError(ai,ak,"filebatchuploaderror");ah.uploadFileCount=af-1;if(!ah.showPreview){return}ah.$preview.find(i).each(function(){var ao=B(this),an=ao.attr("data-fileindex");ao.removeClass("file-uploading");if(ah.filestack[an]!==undefined){W(an,"indicatorError","indicatorErrorTitle")}});ah.$preview.find(i).removeClass("file-uploading");ah.$preview.find(i+" .kv-file-upload").removeAttr("disabled");ah.$preview.find(i+" .kv-file-delete").removeAttr("disabled")};B.each(V,function(ai,aj){if(!o(V[ai])){ah.formdata.append(ah.uploadFileAttr,aj)}});ah.ajaxSubmit(ac,ag,ab,ae)},uploadExtraOnly:function(){var W=this,Z={},X,Y,aa,V;W.formdata=new FormData();if(W.abort(Z)){return}X=function(ab){W.lock();var ac=W.getOutData(ab);W.raise("filebatchpreupload",[ac]);W.setProgress(50);Z.data=ac;Z.xhr=ab;if(W.abort(Z)){ab.abort();W.setProgress(100)}};Y=function(ac,ae,ab){var ad=W.getOutData(ab,ac);if(ac.error===undefined||o(ac.error)){W.raise("filebatchuploadsuccess",[ad]);W.clearFileInput();W.initUploadSuccess(ac)}else{W.showUploadError(ac.error,ad,"filebatchuploaderror")}};aa=function(){W.setProgress(100);W.unlock();W.raise("filebatchuploadcomplete",[W.filestack,W.getExtraData()]);W.clearFileInput()};V=function(ac,af,ae){var ad=W.getOutData(ac),ab=W.parseError(ac,ae);Z.data=ad;W.showUploadError(ab,ad,"filebatchuploaderror")};W.ajaxSubmit(X,Y,aa,V)},hideFileIcon:function(){if(this.overwriteInitial){this.$captionContainer.find(".kv-caption-icon").hide()}},showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},resetErrors:function(X){var W=this,V=W.$errorContainer;W.isError=false;W.$container.removeClass("has-error");V.html("");if(X){V.fadeOut("slow")}else{V.hide()}},showFolderError:function(X){var W=this,V=W.$errorContainer;if(!X){return}V.html(W.msgFoldersNotAllowed.repl("{n}",X));V.fadeIn(800);l(W.$container,"has-error");W.raise("filefoldererror",[X])},showUploadError:function(aa,Z,Y){var W=this,V=W.$errorContainer,X=Y||"fileuploaderror";if(V.find("ul").length===0){V.html("<ul><li>"+aa+"</li></ul>")}else{V.find("ul").append("<li>"+aa+"</li>")}V.fadeIn(800);W.raise(X,[Z]);l(W.$container,"has-error");return true},showError:function(aa,Z,Y){var W=this,V=W.$errorContainer,X=Y||"fileerror";Z=Z||{};Z.reader=W.reader;V.html(aa);V.fadeIn(800);W.raise(X,[Z]);if(!W.isUploadable){W.clearFileInput()}l(W.$container,"has-error");W.$btnUpload.attr("disabled",true);return true},errorHandler:function(V,X){var W=this,Y=V.target.error;switch(Y.code){case Y.NOT_FOUND_ERR:W.showError(W.msgFileNotFound.repl("{name}",X));break;case Y.SECURITY_ERR:W.showError(W.msgFileSecured.repl("{name}",X));break;case Y.NOT_READABLE_ERR:W.showError(W.msgFileNotReadable.repl("{name}",X));break;case Y.ABORT_ERR:W.showError(W.msgFilePreviewAborted.repl("{name}",X));break;default:W.showError(W.msgFilePreviewError.repl("{name}",X))}},parseFileType:function(Y){var W=this,aa,Z,V,X;for(X=0;X<N.length;X+=1){V=N[X];aa=F(V,W.fileTypeSettings)?W.fileTypeSettings[V]:P[V];Z=aa(Y.type,Y.name)?V:"";if(!o(Z)){return Z}}return"other"},previewDefault:function(Z,ab,ad){if(!this.showPreview){return}var af=this,aa=Q.createObjectURL(Z),V=B("#"+ab),X=af.previewSettings.other,ac=af.renderFileFooter(Z.name,X.width),Y=af.getPreviewTemplate("other"),W=ab.slice(ab.lastIndexOf("-")+1),ae="";if(ad===true){ae=" btn disabled";ac+='<div class="file-other-error text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i></div>'}af.$preview.append("\n"+Y.repl("{previewId}",ab).repl("{frameClass}",ae).repl("{fileindex}",W).repl("{caption}",af.slug(Z.name)).repl("{width}",X.width).repl("{height}",X.height).repl("{type}",Z.type).repl("{data}",aa).repl("{footer}",ac));V.on("load",function(){Q.revokeObjectURL(V.attr("data"))})},previewFile:function(an,aj,Y,aq){if(!this.showPreview){return}var af=this,aa=af.parseFileType(an),am=af.slug(an.name),ak,ao,ad=af.allowedPreviewTypes,X=af.allowedPreviewMimeTypes,V=af.getPreviewTemplate(aa),ap=F(aa,af.previewSettings)?af.previewSettings[aa]:S[aa],ac=parseInt(af.wrapTextLength,10),W=af.wrapIndicator,ag=ad.indexOf(aa)>=0,ai,ae,Z=o(X)||(!o(X)&&F(an.type,X)),ah=af.renderFileFooter(am,ap.width),al="",ab=Y.slice(Y.lastIndexOf("-")+1);if(ag&&Z){if(aa==="text"){ao=q(aj.target.result);Q.revokeObjectURL(aq);if(ao.length>ac){ai="text-"+r();ae=window.innerHeight*0.75;al=af.getLayoutTemplate("modal").repl("{id}",ai).repl("{title}",am).repl("{height}",ae).repl("{body}",ao);W=W.repl("{title}",am).repl("{dialog}","$('#"+ai+"').modal('show')");ao=ao.substring(0,(ac-1))+W}ak=V.repl("{previewId}",Y).repl("{caption}",am).repl("{frameClass}","").repl("{type}",an.type).repl("{width}",ap.width).repl("{height}",ap.height).repl("{data}",ao).repl("{footer}",ah).repl("{fileindex}",ab)+al}else{ak=V.repl("{previewId}",Y).repl("{caption}",am).repl("{frameClass}","").repl("{type}",an.type).repl("{data}",aq).repl("{width}",ap.width).repl("{height}",ap.height).repl("{footer}",ah).repl("{fileindex}",ab)}af.$preview.append("\n"+ak);af.autoSizeImage(Y)}else{af.previewDefault(an,Y)}},slugDefault:function(V){return o(V)?"":V.split(/(\\|\/)/g).pop().replace(/[^\w\-.\\\/ ]+/g,"")},getFileStack:function(){var V=this;return V.filestack.filter(function(W){return W!==undefined})},readFiles:function(V){this.reader=new FileReader();var ai=this,aj=ai.$element,ab=ai.$preview,ad=ai.reader,ag=ai.$previewContainer,ah=ai.$previewStatus,ae=ai.msgLoading,X=ai.msgProgress,ac=ai.previewInitId,W=V.length,aa=ai.fileTypeSettings,Y=ai.filestack.length,Z=function(ap,am,ak,al){var ao=B.extend(ai.getOutData({},{},V),{id:ak,index:al}),an={id:ak,index:al,file:am,files:V};ai.previewDefault(am,ak,true);return ai.isUploadable?ai.showUploadError(ap,ao):ai.showError(ap,an)};function af(ay){if(o(aj.attr("multiple"))){W=1}if(ay>=W){if(ai.isUploadable&&ai.filestack.length>0){ai.raise("filebatchselected",[ai.getFileStack()])}else{ai.raise("filebatchselected",[V])}ag.removeClass("loading");ah.html("");return}var av=Y+ay,al=ac+"-"+av,au,aB=V[ay],az=ai.slug(aB.name),at=(aB.size||0)/1000,ao,am="",aq=Q.createObjectURL(aB),aC=0,ax,ap,aD,aA,ak=ai.allowedFileTypes,aw=o(ak)?"":ak.join(", "),ar=ai.allowedFileExtensions,an=o(ar)?"":ar.join(", ");if(!o(ar)){am=new RegExp("\\.("+ar.join("|")+")$","i")}at=at.toFixed(2);if(ai.maxFileSize>0&&at>ai.maxFileSize){ap=ai.msgSizeTooLarge.repl("{name}",az).repl("{size}",at).repl("{maxSize}",ai.maxFileSize);ai.isError=Z(ap,aB,al,ay);return}if(!o(ak)&&u(ak)){for(ax=0;ax<ak.length;ax+=1){aD=ak[ax];ao=aa[aD];aA=(ao!==undefined&&ao(aB.type,az));aC+=o(aA)?0:aA.length}if(aC===0){ap=ai.msgInvalidFileType.repl("{name}",az).repl("{types}",aw);ai.isError=Z(ap,aB,al,ay);return}}if(aC===0&&!o(ar)&&u(ar)&&!o(am)){aA=az.match(am);aC+=o(aA)?0:aA.length;if(aC===0){ap=ai.msgInvalidFileExtension.repl("{name}",az).repl("{extensions}",an);ai.isError=Z(ap,aB,al,ay);return}}if(!ai.showPreview){ai.filestack.push(aB);setTimeout(af(ay+1),100);ai.raise("fileloaded",[aB,al,ay,ad]);return}if(ab.length>0&&FileReader!==undefined){ah.html(ae.repl("{index}",ay+1).repl("{files}",W));ag.addClass("loading");ad.onerror=function(aE){ai.errorHandler(aE,az)};ad.onload=function(aE){ai.previewFile(aB,aE,al,aq);ai.initFileActions()};ad.onloadend=function(){ap=X.repl("{index}",ay+1).repl("{files}",W).repl("{percent}",50).repl("{name}",az);setTimeout(function(){ah.html(ap);Q.revokeObjectURL(aq)},100);setTimeout(function(){af(ay+1);ai.updateFileDetails(W)},100);ai.raise("fileloaded",[aB,al,ay,ad])};ad.onprogress=function(aG){if(aG.lengthComputable){var aF=(aG.loaded/aG.total)*100,aE=Math.ceil(aF);ap=X.repl("{index}",ay+1).repl("{files}",W).repl("{percent}",aE).repl("{name}",az);setTimeout(function(){ah.html(ap)},100)}};au=F("text",aa)?aa.text:P.text;if(au(aB.type,az)){ad.readAsText(aB,ai.textEncoding)}else{ad.readAsArrayBuffer(aB)}}else{ai.previewDefault(aB,al);setTimeout(function(){af(ay+1);ai.updateFileDetails(W)},100);ai.raise("fileloaded",[aB,al,ay,ad])}ai.filestack.push(aB)}af(0);ai.updateFileDetails(W,false)},updateFileDetails:function(W){var ad=this,aa=ad.msgSelected,ae=ad.$element,Z=ad.getFileStack(),V=ae.val()||(Z.length&&Z[0].name)||"",ac=ad.slug(V),X=ad.isUploadable?Z.length:W,ab=m.count(ad.id)+X,Y=X>1?aa.repl("{n}",ab):ac;if(ad.isError){ad.$previewContainer.removeClass("loading");ad.$previewStatus.html("");ad.$captionContainer.find(".kv-caption-icon").hide()}else{ad.showFileIcon()}ad.setCaption(Y,ad.isError);ad.$container.removeClass("file-input-new file-input-ajax-new");if(arguments.length===1){ad.raise("fileselect",[W,ac])}if(m.count(ad.id)){ad.initPreviewDeletes()}},change:function(aj){var ac=this,al=ac.$element;if(!ac.isUploadable&&o(al.val())&&ac.fileInputCleared){ac.fileInputCleared=false;return}ac.fileInputCleared=false;var aa,W,am,ab=ac.$preview,Y=arguments.length>1,X=Y?aj.originalEvent.dataTransfer.files:al.get(0).files,Z=o(al.attr("multiple")),af=0,ah,ad,ag=0,ai=ac.filestack.length,V=ac.isUploadable,ak=function(an,aq,ao,ap){var at=B.extend(ac.getOutData({},{},X),{id:ao,index:ap}),ar={id:ao,index:ap,file:aq,files:X};return ac.isUploadable?ac.showUploadError(an,at):ac.showError(an,ar)};ac.reader=null;ac.resetUpload();ac.hideFileIcon();if(ac.isUploadable){ac.$container.find(".file-drop-zone ."+ac.dropZoneTitleClass).remove()}if(Y){aa=[];while(X[af]){ah=X[af];if(!ah.type&&ah.size%4096===0){ag++}else{aa.push(ah)}af++}}else{if(aj.target.files===undefined){aa=aj.target&&aj.target.value?[{name:aj.target.value.replace(/^.+\\/,"")}]:[]}else{aa=aj.target.files}}if(o(aa)||aa.length===0){if(!V){ac.clear()}ac.showFolderError(ag);ac.raise("fileselectnone");return}ac.resetErrors();if(!V||(Z&&ai>0)){if(!ac.overwriteInitial&&m.count(ac.id)){var ae=m.out(ac.id);ab.html(ae.content);ac.setCaption(ae.caption);ac.initPreviewDeletes()}else{ab.html("")}if(Z&&ai>0){ac.filestack=[]}}am=ac.isUploadable?ac.getFileStack().length+aa.length:aa.length;if(ac.maxFileCount>0&&am>ac.maxFileCount){W=ac.msgFilesTooMany.repl("{m}",ac.maxFileCount).repl("{n}",am);ac.isError=ak(W,null,null,null);ac.$captionContainer.find(".kv-caption-icon").hide();ac.$caption.html(ac.msgValidationError);ac.setEllipsis();ac.$container.removeClass("file-input-new file-input-ajax-new");return}if(!ac.isIE9){ac.readFiles(aa)}else{ac.updateFileDetails(1)}ac.showFolderError(ag)},autoSizeImage:function(X){var Y=this,ab=Y.$preview,ac=ab.find("#"+X),Z=ac.find("img"),W,V,aa;if(!Z.length){return}Z.on("load",function(){W=ac.width();V=ab.width();if(W>V){Z.css("width","100%");ac.css("width","97%")}aa=Z.closest(".file-preview-frame").find(".file-caption-name");if(aa.length){aa.width(Z.width());aa.attr("title",aa.text())}Y.raise("fileimageloaded",X)})},setCaption:function(Z,X){var V=this,Y=X||false,aa,W;if(o(Z)||V.$caption.length===0){return}if(Y){aa=B("<div>"+V.msgValidationError+"</div>").text();W='<span class="'+V.msgValidationErrorClass+'">'+V.msgValidationErrorIcon+aa+"</span>"}else{aa=B("<div>"+Z+"</div>").text();W=aa+V.getLayoutTemplate("icon")}V.$caption.html(W);V.$caption.attr("title",aa);V.$captionContainer.find(".file-caption-ellipsis").attr("title",aa);V.setEllipsis()},initBrowse:function(W){var V=this;V.$btnFile=W.find(".btn-file");V.$btnFile.append(V.$element)},createContainer:function(){var V=this,W=B(document.createElement("span")).attr({"class":"file-input file-input-new"}).html(V.renderMain());V.$element.before(W);V.initBrowse(W);return W},refreshContainer:function(){var V=this,W=V.$container;W.before(V.$element);W.html(V.renderMain());V.initBrowse(W)},renderMain:function(){var W=this,Y=(W.isUploadable&&W.dropZoneEnabled)?" file-drop-zone":"",Z=W.showPreview?W.getLayoutTemplate("preview").repl("{class}",W.previewClass).repl("{dropClass}",Y):"",X=W.isDisabled?W.captionClass+" file-caption-disabled":W.captionClass,V=W.captionTemplate.repl("{class}",X+" kv-fileinput-caption");return W.mainTemplate.repl("{class}",W.mainClass).repl("{preview}",Z).repl("{caption}",V).repl("{upload}",W.renderUpload()).repl("{remove}",W.renderRemove()).repl("{cancel}",W.renderCancel()).repl("{browse}",W.renderBrowse())},renderBrowse:function(){var W=this,X=W.browseClass+" btn-file",V="";if(W.isDisabled){V=" disabled "}return'<div class="'+X+'"'+V+"> "+W.browseIcon+W.browseLabel+" </div>"},renderRemove:function(){var W=this,X=W.removeClass+" fileinput-remove fileinput-remove-button",V="";if(!W.showRemove){return""}if(W.isDisabled){V=" disabled "}return'<button type="button" title="'+W.removeTitle+'" class="'+X+'"'+V+">"+W.removeIcon+W.removeLabel+"</button>"},renderCancel:function(){var V=this,W=V.cancelClass+" fileinput-cancel fileinput-cancel-button";if(!V.showCancel){return""}return'<button type="button" title="'+V.cancelTitle+'" class="hide '+W+'">'+V.cancelIcon+V.cancelLabel+"</button>"},renderUpload:function(){var W=this,X=W.uploadClass+" kv-fileinput-upload fileinput-upload-button",Y="",V="";if(!W.showUpload){return""}if(W.isDisabled){V=" disabled "}if(!W.isUploadable||W.isDisabled){Y='<button type="submit" title="'+W.uploadTitle+'"class="'+X+'"'+V+">"+W.uploadIcon+W.uploadLabel+"</button>"}else{Y='<a href="'+W.uploadUrl+'" title="'+W.uploadTitle+'" class="'+X+'"'+V+">"+W.uploadIcon+W.uploadLabel+"</a>"}return Y}};B.fn.fileinput=function(W){if(!t()&&!j(9)){return}var V=Array.apply(null,arguments);V.shift();return this.each(function(){var Z=B(this),Y=Z.data("fileinput"),X=typeof W==="object"&&W;if(!Y){Y=new k(this,B.extend({},B.fn.fileinput.defaults,X,B(this).data()));Z.data("fileinput",Y)}if(typeof W==="string"){Y[W].apply(Y,V)}})};B.fn.fileinput.defaults={showCaption:true,showPreview:true,showRemove:true,showUpload:true,showCancel:true,mainClass:"",previewClass:"",captionClass:"",mainTemplate:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:true,deleteUrl:"",deleteExtraData:{},overwriteInitial:true,layoutTemplates:a,previewTemplates:L,allowedPreviewTypes:N,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,customLayoutTags:{},customPreviewTags:{},previewSettings:S,fileTypeSettings:P,previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',browseIcon:'<i class="glyphicon glyphicon-folder-open"></i> &nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i> ',removeClass:"btn btn-default",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i> ',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"></i> ',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:true,uploadExtraData:{},maxFileSize:0,minFileCount:0,maxFileCount:0,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",previewFileType:"image",wrapTextLength:250,wrapIndicator:' <span class="wrap-indicator" title="{title}" onclick="{dialog}">[&hellip;]</span>',elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,slugCallback:null,dropZoneEnabled:true,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:true};B.fn.fileinput.locales={};B.fn.fileinput.locales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>. Please retry your upload!',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload. Please retry your upload!",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>. Please retry your upload!",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgValidationError:"File Upload Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} files selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",dropZoneTitle:"Drag & drop files here &hellip;"};B.extend(B.fn.fileinput.defaults,B.fn.fileinput.locales.en);B.fn.fileinput.Constructor=k;B(document).ready(function(){var W=B("input.file[type=file]"),V=W.attr("type")?W.length:0;if(V>0){W.fileinput()}})})(window.jQuery);