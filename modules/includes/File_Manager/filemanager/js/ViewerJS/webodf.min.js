
var webodf_version="0.5.5";function Runtime(){}Runtime.prototype.getVariable=function(a){};Runtime.prototype.toJson=function(a){};Runtime.prototype.fromJson=function(a){};Runtime.prototype.byteArrayFromString=function(b,a){};Runtime.prototype.byteArrayToString=function(b,a){};Runtime.prototype.read=function(e,c,b,g){};Runtime.prototype.readFile=function(d,c,b){};Runtime.prototype.readFileSync=function(b,a){};Runtime.prototype.loadXML=function(b,a){};Runtime.prototype.writeFile=function(d,c,b){};Runtime.prototype.deleteFile=function(b,a){};Runtime.prototype.log=function(b,a){};Runtime.prototype.setTimeout=function(b,a){};Runtime.prototype.clearTimeout=function(a){};Runtime.prototype.libraryPaths=function(){};Runtime.prototype.currentDirectory=function(){};Runtime.prototype.setCurrentDirectory=function(a){};Runtime.prototype.type=function(){};Runtime.prototype.getDOMImplementation=function(){};Runtime.prototype.parseXML=function(a){};Runtime.prototype.exit=function(a){};Runtime.prototype.getWindow=function(){};Runtime.prototype.requestAnimationFrame=function(a){};Runtime.prototype.cancelAnimationFrame=function(a){};Runtime.prototype.assert=function(b,a){};var IS_COMPILED_CODE=!0;Runtime.byteArrayToString=function(h,g){function e(k){var l="",j,f=k.length;for(j=0;j<f;j+=1){l+=String.fromCharCode(k[j]&255)}return l}function i(u){var q="",t,k=u.length,n=[],f,s,o,j;for(t=0;t<k;t+=1){f=u[t],128>f?n.push(f):(t+=1,s=u[t],194<=f&&224>f?n.push((f&31)<<6|s&63):(t+=1,o=u[t],224<=f&&240>f?n.push((f&15)<<12|(s&63)<<6|o&63):(t+=1,j=u[t],240<=f&&245>f&&(f=(f&7)<<18|(s&63)<<12|(o&63)<<6|j&63,f-=65536,n.push((f>>10)+55296,(f&1023)+56320))))),1000<=n.length&&(q+=String.fromCharCode.apply(null,n),n.length=0)}return q+String.fromCharCode.apply(null,n)}var c;"utf8"===g?c=i(h):("binary"!==g&&this.log("Unsupported encoding: "+g),c=e(h));return c};Runtime.getVariable=function(f){try{return eval(f)}catch(k){}};Runtime.toJson=function(a){return JSON.stringify(a)};Runtime.fromJson=function(a){return JSON.parse(a)};Runtime.getFunctionName=function(a){return void 0===a.name?(a=/function\s+(\w+)/.exec(a))&&a[1]:a.name};Runtime.assert=function(b,a){if(!b){throw this.log("alert","ASSERTION FAILED:\n"+a),Error(a)}};function BrowserRuntime(l){function i(b){var k=b.length,m,h,f=0;for(m=0;m<k;m+=1){h=b.charCodeAt(m),f+=1+(128<h)+(2048<h),55040<h&&57344>h&&(f+=1,m+=1)}return f}function r(b,m,n){var k=b.length,h,f;m=new Uint8Array(new ArrayBuffer(m));n?(m[0]=239,m[1]=187,m[2]=191,f=3):f=0;for(n=0;n<k;n+=1){h=b.charCodeAt(n),128>h?(m[f]=h,f+=1):2048>h?(m[f]=192|h>>>6,m[f+1]=128|h&63,f+=2):55040>=h||57344<=h?(m[f]=224|h>>>12&15,m[f+1]=128|h>>>6&63,m[f+2]=128|h&63,f+=3):(n+=1,h=(h-55296<<10|b.charCodeAt(n)-56320)+65536,m[f]=240|h>>>18&7,m[f+1]=128|h>>>12&63,m[f+2]=128|h>>>6&63,m[f+3]=128|h&63,f+=4)}return m}function o(h){var b=h.length,k=new Uint8Array(new ArrayBuffer(b)),f;for(f=0;f<b;f+=1){k[f]=h.charCodeAt(f)&255}return k}function p(k,b){var m,h,f;void 0!==b?f=k:b=k;l?(h=l.ownerDocument,f&&(m=h.createElement("span"),m.className=f,m.appendChild(h.createTextNode(f)),l.appendChild(m),l.appendChild(h.createTextNode(" "))),m=h.createElement("span"),0<b.length&&"<"===b[0]?m.innerHTML=b:m.appendChild(h.createTextNode(b)),l.appendChild(m),l.appendChild(h.createElement("br"))):console&&console.log(b);g.enableAlerts&&"alert"===f&&alert(b)}function j(a,d,k){if(0!==k.status||k.responseText){if(200===k.status||0===k.status){if(k.response&&"string"!==typeof k.response){"binary"===d?(k=k.response,k=new Uint8Array(k)):k=String(k.response)}else{if("binary"===d){if(null!==k.responseBody&&"undefined"!==String(typeof VBArray)){k=(new VBArray(k.responseBody)).toArray();var h=k.length;d=new Uint8Array(new ArrayBuffer(h));for(a=0;a<h;a+=1){d[a]=k[a]}k=d}else{(a=k.getResponseHeader("Content-Length"))&&(a=parseInt(a,10));if(a&&a!==k.responseText.length){r:{h=k.responseText;d=!1;var f=i(h);if("number"===typeof a){if(a!==f&&a!==f+3){h=void 0;break r}d=f+3===a;f=a}h=r(h,f,d)}}void 0===h&&(h=o(k.responseText));k=h}}else{k=k.responseText}}k={err:null,data:k}}else{k={err:k.responseText||k.statusText,data:null}}}else{k={err:"File "+a+" is empty.",data:null}}return k}function e(b,h,k){var f=new XMLHttpRequest;f.open("GET",b,k);f.overrideMimeType&&("binary"!==h?f.overrideMimeType("text/plain; charset="+h):f.overrideMimeType("text/plain; charset=x-user-defined"));return f}function c(b,k,m){var h=e(b,k,!0);h.onreadystatechange=function(){var a;4===h.readyState&&(a=j(b,k,h),m(a.err,a.data))};try{h.send(null)}catch(f){m(f.message,null)}}var g=this;this.byteArrayFromString=function(a,d){var f;"utf8"===d?f=r(a,i(a),!1):("binary"!==d&&g.log("unknown encoding: "+d),f=o(a));return f};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=c;this.read=function(b,h,k,f){c(b,"binary",function(n,m){var d=null;if(m){if("string"===typeof m){throw"This should not happen."}d=m.subarray(h,h+k)}f(n,d)})};this.readFileSync=function(b,k){var m=e(b,k,!1),h;try{m.send(null);h=j(b,k,m);if(h.err){throw h.err}if(null===h.data){throw"No data read from "+b+"."}}catch(f){throw f}return h.data};this.writeFile=function(b,m,n){var k=new XMLHttpRequest,h;k.open("PUT",b,!0);k.onreadystatechange=function(){4===k.readyState&&(0!==k.status||k.responseText?200<=k.status&&300>k.status||0===k.status?n(null):n("Status "+String(k.status)+": "+k.responseText||k.statusText):n("File "+b+" is empty."))};h=m.buffer&&!k.sendAsBinary?m.buffer:g.byteArrayToString(m,"binary");try{k.sendAsBinary?k.sendAsBinary(h):k.send(h)}catch(f){g.log("HUH? "+f+" "+m),n(f.message)}};this.deleteFile=function(b,f){var h=new XMLHttpRequest;h.open("DELETE",b,!0);h.onreadystatechange=function(){4===h.readyState&&(200>h.status&&300<=h.status?f(h.responseText):f(null))};h.send(null)};this.loadXML=function(b,h){var k=new XMLHttpRequest;k.open("GET",b,!0);k.overrideMimeType&&k.overrideMimeType("text/xml");k.onreadystatechange=function(){4===k.readyState&&(0!==k.status||k.responseText?200===k.status||0===k.status?h(null,k.responseXML):h(k.responseText,null):h("File "+b+" is empty.",null))};try{k.send(null)}catch(f){h(f.message,null)}};this.log=p;this.enableAlerts=!0;this.assert=Runtime.assert;this.setTimeout=function(f,b){return setTimeout(function(){f()},b)};this.clearTimeout=function(a){clearTimeout(a)};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(){};this.currentDirectory=function(){return""};this.type=function(){return"BrowserRuntime"};this.getDOMImplementation=function(){return window.document.implementation};this.parseXML=function(a){return(new DOMParser).parseFromString(a,"text/xml")};this.exit=function(a){p("Calling exit with code "+String(a)+", but exit() is not implemented.")};this.getWindow=function(){return window};this.requestAnimationFrame=function(f){var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,h=0;if(b){b.bind(window),h=b(f)}else{return setTimeout(f,15)}return h};this.cancelAnimationFrame=function(f){var b=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;b?(b.bind(window),b(f)):clearTimeout(f)}}function NodeJSRuntime(){function l(k){var h=k.length,f,n=new Uint8Array(new ArrayBuffer(h));for(f=0;f<h;f+=1){n[f]=k[f]}return n}function g(b,d,h){function f(k,a){if(k){return h(k,null)}if(!a){return h("No data for "+b+".",null)}if("string"===typeof a){return h(k,a)}h(k,l(a))}b=c.resolve(i,b);"binary"!==d?m.readFile(b,d,f):m.readFile(b,null,f)}var e=this,m=require("fs"),c=require("path"),i="",o,j;this.byteArrayFromString=function(h,q){var f=new Buffer(h,q),r,n=f.length,k=new Uint8Array(new ArrayBuffer(n));for(r=0;r<n;r+=1){k[r]=f[r]}return k};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=g;this.loadXML=function(f,a){g(f,"utf-8",function(b,d){if(b){return a(b,null)}if(!d){return a("No data for "+f+".",null)}a(null,e.parseXML(d))})};this.writeFile=function(b,d,f){d=new Buffer(d);b=c.resolve(i,b);m.writeFile(b,d,"binary",function(a){f(a||null)})};this.deleteFile=function(b,d){b=c.resolve(i,b);m.unlink(b,d)};this.read=function(b,d,h,f){b=c.resolve(i,b);m.open(b,"r+",666,function(n,k){if(n){f(n,null)}else{var a=new Buffer(h);m.read(k,a,0,h,d,function(p){m.close(k);f(p,l(a))})}})};this.readFileSync=function(f,d){var h;h=m.readFileSync(f,"binary"===d?null:d);if(null===h){throw"File "+f+" could not be read."}"binary"===d&&(h=l(h));return h};this.log=function(h,k){var f;void 0!==k?f=h:k=h;"alert"===f&&process.stderr.write("\n!!!!! ALERT !!!!!\n");process.stderr.write(k+"\n");"alert"===f&&process.stderr.write("!!!!! ALERT !!!!!\n")};this.assert=Runtime.assert;this.setTimeout=function(b,f){return setTimeout(function(){b()},f)};this.clearTimeout=function(b){clearTimeout(b)};this.libraryPaths=function(){return[__dirname]};this.setCurrentDirectory=function(b){i=b};this.currentDirectory=function(){return i};this.type=function(){return"NodeJSRuntime"};this.getDOMImplementation=function(){return j};this.parseXML=function(b){return o.parseFromString(b,"text/xml")};this.exit=process.exit;this.getWindow=function(){return null};this.requestAnimationFrame=function(b){return setTimeout(b,15)};this.cancelAnimationFrame=function(b){clearTimeout(b)};o=new (require("xmldom").DOMParser);j=e.parseXML("<a/>").implementation}function RhinoRuntime(){var j=this,g={},e=g.javax.xml.parsers.DocumentBuilderFactory.newInstance(),l,c,i="";e.setValidating(!1);e.setNamespaceAware(!0);e.setExpandEntityReferences(!1);e.setSchema(null);c=g.org.xml.sax.EntityResolver({resolveEntity:function(h,k){var f=new g.java.io.FileReader(k);return new g.org.xml.sax.InputSource(f)}});l=e.newDocumentBuilder();l.setEntityResolver(c);this.byteArrayFromString=function(k,o){var f,m=k.length,n=new Uint8Array(new ArrayBuffer(m));for(f=0;f<m;f+=1){n[f]=k.charCodeAt(f)&255}return n};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.loadXML=function(k,d){var m=new g.java.io.File(k),f=null;try{f=l.parse(m)}catch(n){return print(n),d(n,null)}d(null,f)};this.readFile=function(k,n,f){i&&(k=i+"/"+k);var h=new g.java.io.File(k),m="binary"===n?"latin1":n;h.isFile()?((k=readFile(k,m))&&"binary"===n&&(k=j.byteArrayFromString(k,"binary")),f(null,k)):f(k+" is not a file.",null)};this.writeFile=function(k,n,f){i&&(k=i+"/"+k);k=new g.java.io.FileOutputStream(k);var h,m=n.length;for(h=0;h<m;h+=1){k.write(n[h])}k.close();f(null)};this.deleteFile=function(k,m){i&&(k=i+"/"+k);var f=new g.java.io.File(k),h=k+Math.random(),h=new g.java.io.File(h);f.rename(h)?(h.deleteOnExit(),m(null)):m("Could not delete "+k)};this.read=function(k,n,f,h){i&&(k=i+"/"+k);var m;m=k;var o="binary";(new g.java.io.File(m)).isFile()?("binary"===o&&(o="latin1"),m=readFile(m,o)):m=null;m?h(null,this.byteArrayFromString(m.substring(n,n+f),"binary")):h("Cannot read "+k,null)};this.readFileSync=function(h,k){if(!k){return""}var f=readFile(h,k);if(null===f){throw"File could not be read."}return f};this.log=function(h,k){var f;void 0!==k?f=h:k=h;"alert"===f&&print("\n!!!!! ALERT !!!!!");print(k);"alert"===f&&print("!!!!! ALERT !!!!!")};this.assert=Runtime.assert;this.setTimeout=function(b){b();return 0};this.clearTimeout=function(){};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(b){i=b};this.currentDirectory=function(){return i};this.type=function(){return"RhinoRuntime"};this.getDOMImplementation=function(){return l.getDOMImplementation()};this.parseXML=function(b){b=new g.java.io.StringReader(b);b=new g.org.xml.sax.InputSource(b);return l.parse(b)};this.exit=quit;this.getWindow=function(){return null};this.requestAnimationFrame=function(b){b();return 0};this.cancelAnimationFrame=function(){}}Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime(window.document.getElementById("logoutput")):"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),core={},gui={},xmldom={},odf={},ops={},webodf={};(function(){webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source"})();(function(){function f(a,d,b){var h=a+"/manifest.json",c,e;runtime.log("Loading manifest: "+h);try{c=runtime.readFileSync(h,"utf-8")}catch(p){if(b){runtime.log("No loadable manifest found.")}else{throw console.log(String(p)),p}return}b=JSON.parse(c);for(e in b){b.hasOwnProperty(e)&&(d[e]={dir:a,deps:b[e]})}}function k(a,d,b){function h(g){if(!p[g]&&!b(g)){if(e[g]){throw"Circular dependency detected for "+g+"."}e[g]=!0;if(!d[g]){throw"Missing dependency information for class "+g+"."}var a=d[g],q=a.deps,n,f=q.length;for(n=0;n<f;n+=1){h(q[n])}e[g]=!1;p[g]=!0;c.push(a.dir+"/"+g.replace(".","/")+".js")}}var c=[],e={},p={};a.forEach(h);return c}function a(a,d){return d+("\n//# sourceURL="+a)}function d(d){var b,h;for(b=0;b<d.length;b+=1){h=runtime.readFileSync(d[b],"utf-8"),h=a(d[b],h),eval(h)}}function b(a){a=a.split(".");var d,b=n,h=a.length;for(d=0;d<h;d+=1){if(!b.hasOwnProperty(a[d])){return !1}b=b[a[d]]}return !0}var h,n={core:core,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=function(a,n){if(IS_COMPILED_CODE||0===a.length){return n&&n()}var l;if(!(l=h)){l=[];var r=runtime.libraryPaths(),c;runtime.currentDirectory()&&-1===r.indexOf(runtime.currentDirectory())&&f(runtime.currentDirectory(),l,!0);for(c=0;c<r.length;c+=1){f(r[c],l)}}h=l;a=k(a,h,b);if(0===a.length){return n&&n()}if("BrowserRuntime"===runtime.type()&&n){l=a;r=document.currentScript||document.documentElement.lastChild;c=document.createDocumentFragment();var e,p;for(p=0;p<l.length;p+=1){e=document.createElement("script"),e.type="text/javascript",e.charset="utf-8",e.async=!1,e.setAttribute("src",l[p]),c.appendChild(e)}n&&(e.onload=n);r.parentNode.insertBefore(c,r)}else{d(a),n&&n()}};runtime.loadClass=function(a,d){runtime.loadClasses([a],d)}})();(function(){var a=function(b){return b};runtime.getTranslator=function(){return a};runtime.setTranslator=function(b){a=b};runtime.tr=function(c){var b=a(c);return b&&"string"===String(typeof b)?b:c}})();(function(f){function k(a){if(a.length){var d=a[0];runtime.readFile(d,"utf8",function(b,h){function n(){var a;(a=eval(f))&&runtime.exit(a)}var q="",q=d.lastIndexOf("/"),f=h,q=-1!==q?d.substring(0,q):".";runtime.setCurrentDirectory(q);b?(runtime.log(b),runtime.exit(1)):null===f?(runtime.log("No code found for "+d),runtime.exit(1)):n.apply(null,a)})}}f=f?Array.prototype.slice.call(f):[];"NodeJSRuntime"===runtime.type()?k(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?k(f):k(f.slice(1))})("undefined"!==String(typeof arguments)&&arguments);(function(){core.Async=function(){return{forEach:function(j,g,e){function l(a){m!==i&&(a?(m=i,e(a)):(m+=1,m===i&&e(null)))}var c,i=j.length,m=0;for(c=0;c<i;c+=1){g(j[c],l)}},destroyAll:function(d,c){function b(e,a){if(a){c(a)}else{if(e<d.length){d[e](function(f){b(e+1,f)})}else{c()}}}b(0,void 0)}}}()})();function makeBase64(){function I(f){var a,d=f.length,b=new Uint8Array(new ArrayBuffer(d));for(a=0;a<d;a+=1){b[a]=f.charCodeAt(a)&255}return b}function F(k){var d,h="",f,b=k.length-2;for(f=0;f<b;f+=3){d=k[f]<<16|k[f+1]<<8|k[f+2],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>>18],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>>12&63],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>>6&63],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d&63]}f===b+1?(d=k[f]<<4,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>>6],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d&63],h+="=="):f===b&&(d=k[f]<<10|k[f+1]<<2,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>>12],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>>6&63],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d&63],h+="=");return h}function N(n){n=n.replace(/[^A-Za-z0-9+\/]+/g,"");var l=n.length,k=new Uint8Array(new ArrayBuffer(3*l)),g=n.length%4,m=0,f,h;for(f=0;f<l;f+=4){h=(H[n.charAt(f)]||0)<<18|(H[n.charAt(f+1)]||0)<<12|(H[n.charAt(f+2)]||0)<<6|(H[n.charAt(f+3)]||0),k[m]=h>>16,k[m+1]=h>>8&255,k[m+2]=h&255,m+=3}l=3*l-[0,0,2,1][g];return k.subarray(0,l)}function K(m){var f,k,h=m.length,b=0,l=new Uint8Array(new ArrayBuffer(3*h));for(f=0;f<h;f+=1){k=m[f],128>k?l[b++]=k:(2048>k?l[b++]=192|k>>>6:(l[b++]=224|k>>>12&15,l[b++]=128|k>>>6&63),l[b++]=128|k&63)}return l.subarray(0,b)}function M(s){var m,q,n,k,r=s.length,f=new Uint8Array(new ArrayBuffer(r)),l=0;for(m=0;m<r;m+=1){q=s[m],128>q?f[l++]=q:(m+=1,n=s[m],224>q?f[l++]=(q&31)<<6|n&63:(m+=1,k=s[m],f[l++]=(q&15)<<12|(n&63)<<6|k&63))}return f.subarray(0,l)}function G(a){return F(I(a))}function C(a){return String.fromCharCode.apply(String,N(a))}function A(a){return M(I(a))}function D(a){a=M(a);for(var d="",b=0;b<a.length;){d+=String.fromCharCode.apply(String,a.subarray(b,b+45000)),b+=45000}return d}function E(k,q,m){var l,h,n,f="";for(n=q;n<m;n+=1){q=k.charCodeAt(n)&255,128>q?f+=String.fromCharCode(q):(n+=1,l=k.charCodeAt(n)&255,224>q?f+=String.fromCharCode((q&31)<<6|l&63):(n+=1,h=k.charCodeAt(n)&255,f+=String.fromCharCode((q&15)<<12|(l&63)<<6|h&63)))}return f}function z(d,k){function h(){var a=b+100000;a>d.length&&(a=d.length);f+=E(d,b,a);b=a;a=b===d.length;k(f,a)&&!a&&runtime.setTimeout(h,0)}var f="",b=0;100000>d.length?k(E(d,0,d.length),!0):("string"!==typeof d&&(d=d.slice()),h())}function L(a){return K(I(a))}function J(a){return String.fromCharCode.apply(String,K(a))}function B(a){return String.fromCharCode.apply(String,K(I(a)))}var H=function(a){var f={},d,b;d=0;for(b=a.length;d<b;d+=1){f[a.charAt(d)]=d}return f}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),j,u,i=runtime.getWindow(),o,w;i&&i.btoa?(o=i.btoa,j=function(a){return o(B(a))}):(o=G,j=function(a){return F(L(a))});i&&i.atob?(w=i.atob,u=function(a){a=w(a);return E(a,0,a.length)}):(w=C,u=function(a){return D(N(a))});core.Base64=function(){this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=F;this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=N;this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=K;this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=M;this.convertUTF8StringToBase64=G;this.convertBase64ToUTF8String=C;this.convertUTF8StringToUTF16Array=A;this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=D;this.convertUTF8StringToUTF16String=z;this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=L;this.convertUTF16ArrayToUTF8String=J;this.convertUTF16StringToUTF8String=B;this.convertUTF16StringToBase64=j;this.convertBase64ToUTF16String=u;this.fromBase64=C;this.toBase64=G;this.atob=w;this.btoa=o;this.utob=B;this.btou=z;this.encode=j;this.encodeURI=function(a){return j(a).replace(/[+\/]/g,function(b){return"+"===b?"-":"_"}).replace(/\\=+$/,"")};this.decode=function(a){return u(a.replace(/[\-_]/g,function(b){return"-"===b?"+":"/"}))};return this};return core.Base64}core.Base64=makeBase64();core.ByteArray=function(a){this.pos=0;this.data=a;this.readUInt32LE=function(){this.pos+=4;var c=this.data,b=this.pos;return c[--b]<<24|c[--b]<<16|c[--b]<<8|c[--b]};this.readUInt16LE=function(){this.pos+=2;var c=this.data,b=this.pos;return c[--b]<<8|c[--b]}};core.ByteArrayWriter=function(j){function g(b){b>c-l&&(c=Math.max(2*c,l+b),b=new Uint8Array(new ArrayBuffer(c)),b.set(i),i=b)}var e=this,l=0,c=1024,i=new Uint8Array(new ArrayBuffer(c));this.appendByteArrayWriter=function(a){e.appendByteArray(a.getByteArray())};this.appendByteArray=function(f){var d=f.length;g(d);i.set(f,l);l+=d};this.appendArray=function(f){var d=f.length;g(d);i.set(f,l);l+=d};this.appendUInt16LE=function(a){e.appendArray([a&255,a>>8&255])};this.appendUInt32LE=function(a){e.appendArray([a&255,a>>8&255,a>>16&255,a>>24&255])};this.appendString=function(a){e.appendByteArray(runtime.byteArrayFromString(a,j))};this.getLength=function(){return l};this.getByteArray=function(){var b=new Uint8Array(new ArrayBuffer(l));b.set(i.subarray(0,l));return b}};core.CSSUnits=function(){var b=this,a={"in":1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(e,f,c){return e*a[c]/a[f]};this.convertMeasure=function(e,g){var c,f;e&&g&&(c=parseFloat(e),f=e.replace(c.toString(),""),c=b.convert(c,f,g));return c};this.getUnits=function(c){return c.substr(c.length-2,c.length)}};(function(){function d(){var n,p,j,m,e,i,g,a,o;void 0===b&&(p=(n=runtime.getWindow())&&n.document,i=p.documentElement,g=p.body,b={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},p&&(m=p.createElement("div"),m.style.position="absolute",m.style.left="-99999px",m.style.transform="scale(2)",m.style["-webkit-transform"]="scale(2)",e=p.createElement("div"),m.appendChild(e),g.appendChild(m),n=p.createRange(),n.selectNode(e),b.rangeBCRIgnoresElementBCR=0===n.getClientRects().length,e.appendChild(p.createTextNode("Rect transform test")),p=e.getBoundingClientRect(),j=n.getBoundingClientRect(),b.unscaledRangeClientRects=2<Math.abs(p.height-j.height),m.style.transform="",m.style["-webkit-transform"]="",p=i.style.overflow,j=g.style.overflow,a=g.style.height,o=g.scrollTop,i.style.overflow="visible",g.style.overflow="visible",g.style.height="200%",g.scrollTop=g.scrollHeight,b.elementBCRIgnoresBodyScroll=n.getBoundingClientRect().top!==e.getBoundingClientRect().top,g.scrollTop=o,g.style.height=a,g.style.overflow=j,i.style.overflow=p,n.detach(),g.removeChild(m),n=Object.keys(b).map(function(f){return f+":"+String(b[f])}).join(", "),runtime.log("Detected browser quirks - "+n)));return b}function c(f,e,g){for(f=f?f.firstElementChild:null;f;){if(f.localName===g&&f.namespaceURI===e){return f}f=f.nextElementSibling}return null}var b;core.DomUtilsImpl=function(){function u(m,a){for(var h=0,l;m.parentNode!==a;){runtime.assert(null!==m.parentNode,"parent is null"),m=m.parentNode}for(l=a.firstChild;l!==m;){h+=1,l=l.nextSibling}return h}function t(e,a){return 0>=e.compareBoundaryPoints(Range.START_TO_START,a)&&0<=e.compareBoundaryPoints(Range.END_TO_END,a)}function o(e,a){return 0>=e.compareBoundaryPoints(Range.END_TO_START,a)&&0<=e.compareBoundaryPoints(Range.START_TO_END,a)}function i(l,a){var h=null;l.nodeType===Node.TEXT_NODE&&(0===l.length?(l.parentNode.removeChild(l),a.nodeType===Node.TEXT_NODE&&(h=a)):(a.nodeType===Node.TEXT_NODE&&(l.appendData(a.data),a.parentNode.removeChild(a)),h=l));return h}function g(e){for(var a=e.parentNode;e.firstChild;){a.insertBefore(e.firstChild,e)}a.removeChild(e);return a}function j(q,l){for(var m=q.parentNode,h=q.firstChild,n;h;){n=h.nextSibling,j(h,l),h=n}m&&l(q)&&g(q);return m}function k(e,a){return e===a||Boolean(e.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function f(e,a){return d().unscaledRangeClientRects?e:e/a}function s(l,a,h){Object.keys(a).forEach(function(m){var r=m.split(":"),e=r[1],n=h(r[0]),r=a[m],q=typeof r;"object"===q?Object.keys(r).length&&(m=n?l.getElementsByTagNameNS(n,e)[0]||l.ownerDocument.createElementNS(n,m):l.getElementsByTagName(e)[0]||l.ownerDocument.createElement(m),l.appendChild(m),s(m,r,h)):n&&(runtime.assert("number"===q||"string"===q,"attempting to map unsupported type '"+q+"' (key: "+m+")"),l.setAttributeNS(n,m,String(r)))})}var p=null;this.splitBoundaries=function(r){var m,q=[],a,l,n;if(r.startContainer.nodeType===Node.TEXT_NODE||r.endContainer.nodeType===Node.TEXT_NODE){a=r.endContainer;l=r.endContainer.nodeType!==Node.TEXT_NODE?r.endOffset===r.endContainer.childNodes.length:!1;n=r.endOffset;m=r.endContainer;if(n<m.childNodes.length){for(m=m.childNodes.item(n),n=0;m.firstChild;){m=m.firstChild}}else{for(;m.lastChild;){m=m.lastChild,n=m.nodeType===Node.TEXT_NODE?m.textContent.length:m.childNodes.length}}m===a&&(a=null);r.setEnd(m,n);n=r.endContainer;0!==r.endOffset&&n.nodeType===Node.TEXT_NODE&&(m=n,r.endOffset!==m.length&&(q.push(m.splitText(r.endOffset)),q.push(m)));n=r.startContainer;0!==r.startOffset&&n.nodeType===Node.TEXT_NODE&&(m=n,r.startOffset!==m.length&&(n=m.splitText(r.startOffset),q.push(m),q.push(n),r.setStart(n,0)));if(null!==a){for(n=r.endContainer;n.parentNode&&n.parentNode!==a;){n=n.parentNode}l=l?a.childNodes.length:u(n,a);r.setEnd(a,l)}}return q};this.containsRange=t;this.rangesIntersect=o;this.rangeIntersection=function(l,a){var h;o(l,a)&&(h=l.cloneRange(),-1===l.compareBoundaryPoints(Range.START_TO_START,a)&&h.setStart(a.startContainer,a.startOffset),1===l.compareBoundaryPoints(Range.END_TO_END,a)&&h.setEnd(a.endContainer,a.endOffset));return h};this.getNodesInRange=function(w,q,r){var m=[],v=w.commonAncestorContainer,v=v.nodeType===Node.TEXT_NODE?v.parentNode:v;r=w.startContainer.ownerDocument.createTreeWalker(v,r,q,!1);var l,n;w.endContainer.childNodes[w.endOffset-1]?(l=w.endContainer.childNodes[w.endOffset-1],n=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(l=w.endContainer,n=Node.DOCUMENT_POSITION_PRECEDING);w.startContainer.childNodes[w.startOffset]?(w=w.startContainer.childNodes[w.startOffset],r.currentNode=w):w.startOffset===(w.startContainer.nodeType===Node.TEXT_NODE?w.startContainer.length:w.startContainer.childNodes.length)?(w=w.startContainer,r.currentNode=w,r.lastChild(),w=r.nextNode()):(w=w.startContainer,r.currentNode=w);if(w){w=r.currentNode;if(w!==v){for(w=w.parentNode;w&&w!==v;){q(w)===NodeFilter.FILTER_REJECT&&(r.currentNode=w),w=w.parentNode}}w=r.currentNode;switch(q(w)){case NodeFilter.FILTER_REJECT:for(w=r.nextSibling();!w&&r.parentNode();){w=r.nextSibling()}break;case NodeFilter.FILTER_SKIP:w=r.nextNode()}for(;w;){q=l.compareDocumentPosition(w);if(0!==q&&0===(q&n)){break}m.push(w);w=r.nextNode()}}return m};this.normalizeTextNodes=function(a){a&&a.nextSibling&&(a=i(a,a.nextSibling));a&&a.previousSibling&&i(a.previousSibling,a)};this.rangeContainsNode=function(q,l){var m=l.ownerDocument.createRange(),h=l.ownerDocument.createRange(),n;m.setStart(q.startContainer,q.startOffset);m.setEnd(q.endContainer,q.endOffset);h.selectNodeContents(l);n=t(m,h);m.detach();h.detach();return n};this.mergeIntoParent=g;this.removeUnwantedNodes=j;this.getElementsByTagNameNS=function(n,l,m){var h=[];n=n.getElementsByTagNameNS(l,m);h.length=m=n.length;for(l=0;l<m;l+=1){h[l]=n.item(l)}return h};this.getElementsByTagName=function(r,m){var n=[],l,q,h;l=r.getElementsByTagName(m);n.length=h=l.length;for(q=0;q<h;q+=1){n[q]=l.item(q)}return n};this.containsNode=function(e,a){return e===a||e.contains(a)};this.comparePoints=function(q,m,n,a){if(q===n){return a-m}var l=q.compareDocumentPosition(n);2===l?l=-1:4===l?l=1:10===l?(m=u(q,n),l=m<a?1:-1):(a=u(n,q),l=a<m?-1:1);return l};this.adaptRangeDifferenceToZoomLevel=f;this.translateRect=function(l,a,h){return{top:f(l.top-a.top,h),left:f(l.left-a.left,h),bottom:f(l.bottom-a.top,h),right:f(l.right-a.left,h),width:f(l.width,h),height:f(l.height,h)}};this.getBoundingClientRect=function(n){var l=n.ownerDocument,h=d(),m=l.body;if((!1===h.unscaledRangeClientRects||h.rangeBCRIgnoresElementBCR)&&n.nodeType===Node.ELEMENT_NODE){return n=n.getBoundingClientRect(),h.elementBCRIgnoresBodyScroll?{left:n.left+m.scrollLeft,right:n.right+m.scrollLeft,top:n.top+m.scrollTop,bottom:n.bottom+m.scrollTop,width:n.width,height:n.height}:n}var e;p?e=p:p=e=l.createRange();h=e;h.selectNode(n);return h.getBoundingClientRect()};this.mapKeyValObjOntoNode=function(l,a,h){Object.keys(a).forEach(function(m){var q=m.split(":"),e=q[1],q=h(q[0]),n=a[m];q?(e=l.getElementsByTagNameNS(q,e)[0],e||(e=l.ownerDocument.createElementNS(q,m),l.appendChild(e)),e.textContent=n):runtime.log("Key ignored: "+m)})};this.removeKeyElementsFromNode=function(l,a,h){a.forEach(function(m){var e=m.split(":"),n=e[1];(e=h(e[0]))?(n=l.getElementsByTagNameNS(e,n)[0])?n.parentNode.removeChild(n):runtime.log("Element for "+m+" not found."):runtime.log("Property Name ignored: "+m)})};this.getKeyValRepresentationOfNode=function(q,l){for(var m={},h=q.firstElementChild,n;h;){if(n=l(h.namespaceURI)){m[n+":"+h.localName]=h.textContent}h=h.nextElementSibling}return m};this.mapObjOntoNode=s;this.cloneEvent=function(e){var a=Object.create(null);Object.keys(e).forEach(function(h){a[h]=e[h]});a.prototype=e.constructor.prototype;return a};this.getDirectChild=c;(function(l){var a,h;h=runtime.getWindow();null!==h&&(a=h.navigator.appVersion.toLowerCase(),h=-1===a.indexOf("chrome")&&(-1!==a.indexOf("applewebkit")||-1!==a.indexOf("safari")),a=-1!==a.indexOf("msie")||-1!==a.indexOf("trident"),h||a)&&(l.containsNode=k)})(this)};core.DomUtils=new core.DomUtilsImpl})();core.Cursor=function(s,o){function v(a){a.parentNode&&(e.push(a.previousSibling),e.push(a.nextSibling),a.parentNode.removeChild(a))}function t(h,f,b){if(f.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(f),"putCursorIntoTextNode: invalid container");var d=f.parentNode;runtime.assert(Boolean(d),"putCursorIntoTextNode: container without parent");runtime.assert(0<=b&&b<=f.length,"putCursorIntoTextNode: offset is out of bounds");0===b?d.insertBefore(h,f):(b!==f.length&&f.splitText(b),d.insertBefore(h,f.nextSibling))}else{f.nodeType===Node.ELEMENT_NODE&&f.insertBefore(h,f.childNodes.item(b))}e.push(h.previousSibling);e.push(h.nextSibling)}var u=s.createElementNS("urn:webodf:names:cursor","cursor"),p=s.createElementNS("urn:webodf:names:cursor","anchor"),g,e=[],i=s.createRange(),j,c=core.DomUtils;this.getNode=function(){return u};this.getAnchorNode=function(){return p.parentNode?p:u};this.getSelectedRange=function(){j?(i.setStartBefore(u),i.collapse(!0)):(i.setStartAfter(g?p:u),i.setEndBefore(g?u:p));return i};this.setSelectedRange=function(b,a){i&&i!==b&&i.detach();i=b;g=!1!==a;(j=b.collapsed)?(v(p),v(u),t(u,b.startContainer,b.startOffset)):(v(p),v(u),t(g?u:p,b.endContainer,b.endOffset),t(g?p:u,b.startContainer,b.startOffset));e.forEach(c.normalizeTextNodes);e.length=0};this.hasForwardSelection=function(){return g};this.remove=function(){v(u);e.forEach(c.normalizeTextNodes);e.length=0};u.setAttributeNS("urn:webodf:names:cursor","memberId",o);p.setAttributeNS("urn:webodf:names:cursor","memberId",o)};core.Destroyable=function(){};core.Destroyable.prototype.destroy=function(a){};core.EventSource=function(){};core.EventSource.prototype.subscribe=function(b,a){};core.EventSource.prototype.unsubscribe=function(b,a){};core.EventNotifier=function(d){function c(a){runtime.assert(!b.hasOwnProperty(a),'Duplicated event ids: "'+a+'" registered more than once.');b[a]=[]}var b={};this.emit=function(i,a){var e,g;runtime.assert(b.hasOwnProperty(i),'unknown event fired "'+i+'"');g=b[i];for(e=0;e<g.length;e+=1){g[e](a)}};this.subscribe=function(e,a){runtime.assert(b.hasOwnProperty(e),'tried to subscribe to unknown event "'+e+'"');b[e].push(a)};this.unsubscribe=function(f,a){var e;runtime.assert(b.hasOwnProperty(f),'tried to unsubscribe from unknown event "'+f+'"');e=b[f].indexOf(a);runtime.assert(-1!==e,'tried to unsubscribe unknown callback from event "'+f+'"');-1!==e&&b[f].splice(e,1)};this.register=c;d&&d.forEach(c)};core.ScheduledTask=function(l,i,r){function o(){e&&(r(j),e=!1)}function p(){o();l.apply(void 0,c);c=null}var j,e=!1,c=[],g=!1;this.trigger=function(){runtime.assert(!1===g,"Can't trigger destroyed ScheduledTask instance");c=Array.prototype.slice.call(arguments);e||(e=!0,j=i(p))};this.triggerImmediate=function(){runtime.assert(!1===g,"Can't trigger destroyed ScheduledTask instance");c=Array.prototype.slice.call(arguments);p()};this.processRequests=function(){e&&p()};this.cancel=o;this.restart=function(){runtime.assert(!1===g,"Can't trigger destroyed ScheduledTask instance");o();e=!0;j=i(p)};this.destroy=function(b){o();g=!0;b()}};(function(){var a;core.Task={};core.Task.SUPPRESS_MANUAL_PROCESSING=!1;core.Task.processTasks=function(){core.Task.SUPPRESS_MANUAL_PROCESSING||a.performRedraw()};core.Task.createRedrawTask=function(b){return new core.ScheduledTask(b,a.requestRedrawTask,a.cancelRedrawTask)};core.Task.createTimeoutTask=function(c,b){return new core.ScheduledTask(c,function(e){return runtime.setTimeout(e,b)},runtime.clearTimeout)};a=new function(){var b={};this.requestRedrawTask=function(c){var e=runtime.requestAnimationFrame(function(){c();delete b[e]});b[e]=c;return e};this.performRedraw=function(){Object.keys(b).forEach(function(c){b[c]();runtime.cancelAnimationFrame(parseInt(c,10))});b={}};this.cancelRedrawTask=function(c){runtime.cancelAnimationFrame(c);delete b[c]}}})();core.EventSubscriptions=function(){function j(k,a,f){k.subscribe(a,f);e.push({eventSource:k,eventid:a,callback:f})}function g(){var a=[];e.forEach(function(b){b.eventSource.unsubscribe(b.eventid,b.callback)});e.length=0;Object.keys(c).forEach(function(b){c[b].forEach(function(d){a.push(d.task.destroy)});delete c[b]});core.Async.destroyAll(a,function(){});l=new core.EventNotifier}var e=[],l=new core.EventNotifier,c={},i=0;this.addSubscription=j;this.addFrameSubscription=function(d,m,f){var b,h,o,n;c.hasOwnProperty(m)||(c[m]=[]);o=c[m];for(n=0;n<o.length;n+=1){if(o[n].eventSource===d){b=o[n];break}}b||(h="s"+i,i+=1,l.register(h),b={frameEventId:h,eventSource:d,task:core.Task.createRedrawTask(function(){l.emit(h,void 0)})},o.push(b),j(d,m,b.task.trigger));l.subscribe(b.frameEventId,f)};this.unsubscribeAll=g;this.destroy=function(b){g();b()}};core.LazyProperty=function(d){var c,b=!1;this.value=function(){b||(c=d(),b=!0);return c};this.reset=function(){b=!1}};core.LoopWatchDog=function(e,c){var b=Date.now(),g=0;this.check=function(){var a;if(e&&(a=Date.now(),a-b>e)){throw runtime.log("alert","watchdog timeout"),"timeout!"}if(0<c&&(g+=1,g>c)){throw runtime.log("alert","watchdog loop overflow"),"loop overflow"}}};core.NodeFilterChain=function(d){var c=NodeFilter.FILTER_REJECT,b=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(e){var a;for(a=0;a<d.length;a+=1){if(d[a].acceptNode(e)===c){return c}}return b}};core.PositionIterator=function(A,w,G,C){function E(){this.acceptNode=function(a){return !a||a.nodeType===o&&0===a.length?H:F}}function y(a){this.acceptNode=function(b){return !b||b.nodeType===o&&0===b.length?H:a.acceptNode(b)}}function s(){var c=i.currentNode,b=c.nodeType;D=b===o?c.length-1:b===z?1:0}function j(){if(null===i.previousSibling()){if(!i.parentNode()||i.currentNode===A){return i.firstChild(),!1}D=0}else{s()}return !0}function u(){var c=i.currentNode,b;b=B(c);if(c!==A){for(c=c.parentNode;c&&c!==A;){B(c)===H&&(i.currentNode=c,b=H),c=c.parentNode}}b===H?(D=i.currentNode.nodeType===o?c.length:1,c=v.nextPosition()):c=b===F?!0:v.nextPosition();c&&runtime.assert(B(i.currentNode)===F,"moveToAcceptedNode did not result in walker being on an accepted node");return c}var v=this,i,D,B,o=Node.TEXT_NODE,z=Node.ELEMENT_NODE,F=NodeFilter.FILTER_ACCEPT,H=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var c=i.currentNode,b=c.nodeType;if(c===A){return !1}if(0===D&&b===z){null===i.firstChild()&&(D=1)}else{if(b===o&&D+1<c.length){D+=1}else{if(null!==i.nextSibling()){D=0}else{if(i.parentNode()){D=1}else{return !1}}}}return !0};this.previousPosition=function(){var a=!0,b=i.currentNode;0===D?a=j():b.nodeType===o?D-=1:null!==i.lastChild()?s():b===A?a=!1:D=0;return a};this.previousNode=j;this.container=function(){var a=i.currentNode,b=a.nodeType;0===D&&b!==o&&(a=a.parentNode);return a};this.rightNode=function(){var b=i.currentNode,c=b.nodeType;if(c===o&&D===b.length){for(b=b.nextSibling;b&&B(b)!==F;){b=b.nextSibling}}else{c===z&&1===D&&(b=null)}return b};this.leftNode=function(){var b=i.currentNode;if(0===D){for(b=b.previousSibling;b&&B(b)!==F;){b=b.previousSibling}}else{if(b.nodeType===z){for(b=b.lastChild;b&&B(b)!==F;){b=b.previousSibling}}}return b};this.getCurrentNode=function(){return i.currentNode};this.unfilteredDomOffset=function(){if(i.currentNode.nodeType===o){return D}for(var a=0,b=i.currentNode,b=1===D?b.lastChild:b.previousSibling;b;){a+=1,b=b.previousSibling}return a};this.getPreviousSibling=function(){var b=i.currentNode,a=i.previousSibling();i.currentNode=b;return a};this.getNextSibling=function(){var b=i.currentNode,a=i.nextSibling();i.currentNode=b;return a};this.setPositionBeforeElement=function(a){runtime.assert(Boolean(a),"setPositionBeforeElement called without element");i.currentNode=a;D=0;return u()};this.setUnfilteredPosition=function(a,b){runtime.assert(Boolean(a),"PositionIterator.setUnfilteredPosition called without container");i.currentNode=a;a.nodeType===o?(D=b,runtime.assert(b<=a.length,"Error in setPosition: "+b+" > "+a.length),runtime.assert(0<=b,"Error in setPosition: "+b+" < 0"),b===a.length&&(i.nextSibling()?D=0:i.parentNode()?D=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid."))):b<a.childNodes.length?(i.currentNode=a.childNodes.item(b),D=0):D=1;return u()};this.moveToEnd=function(){i.currentNode=A;D=1};this.moveToEndOfNode=function(a){a.nodeType===o?v.setUnfilteredPosition(a,a.length):(i.currentNode=a,D=1)};this.isBeforeNode=function(){return 0===D};this.getNodeFilter=function(){return B};B=(G?new y(G):new E).acceptNode;B.acceptNode=B;w=w||NodeFilter.SHOW_ALL;runtime.assert(A.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes");i=A.ownerDocument.createTreeWalker(A,w,B,C);D=0;null===i.firstChild()&&(D=1)};core.PositionFilter=function(){};core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3};core.PositionFilter.prototype.acceptPosition=function(a){};core.PositionFilterChain=function(){var d=[],c=core.PositionFilter.FilterResult.FILTER_ACCEPT,b=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(e){var a;for(a=0;a<d.length;a+=1){if(d[a].acceptPosition(e)===b){return b}}return c};this.addFilter=function(e){d.push(e)}};(function(){core.RawInflate=function(){var a;(function(b){a=b()})(function(){return function b(j,c,e){function i(h,d){if(!c[h]){if(!j[h]){throw Error("Cannot find module '"+h+"'")}var f=c[h]={exports:{}};j[h][0].call(f.exports,function(l){var k=j[h][1][l];return i(k?k:l)},f,f.exports,b,j,c,e)}return c[h].exports}for(var g=0;g<e.length;g++){i(e[g])}return i}({1:[function(x,u,w){function o(h,f){var d=new j(f);d.push(h,!0);if(d.err){throw d.msg}return d.result}var s=x("./zlib/inflate.js"),i=x("./utils/common"),k=x("./utils/strings"),n=x("./zlib/constants"),g=x("./zlib/messages"),v=x("./zlib/zstream"),t=x("./zlib/gzheader"),j=function(d){var c=this.options=i.assign({chunkSize:16384,windowBits:0,to:""},d||{});c.raw&&0<=c.windowBits&&16>c.windowBits&&(c.windowBits=-c.windowBits,0===c.windowBits&&(c.windowBits=-15));!(0<=c.windowBits&&16>c.windowBits)||d&&d.windowBits||(c.windowBits+=32);15<c.windowBits&&48>c.windowBits&&0===(c.windowBits&15)&&(c.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new v;this.strm.avail_out=0;d=s.inflateInit2(this.strm,c.windowBits);if(d!==n.Z_OK){throw Error(g[d])}this.header=new t;s.inflateGetHeader(this.strm,this.header)};j.prototype.push=function(B,q){var D=this.strm,y=this.options.chunkSize,C,l,m,f,A;if(this.ended){return !1}l=q===~~q?q:!0===q?n.Z_FINISH:n.Z_NO_FLUSH;D.input="string"===typeof B?k.binstring2buf(B):B;D.next_in=0;D.avail_in=D.input.length;do{0===D.avail_out&&(D.output=new i.Buf8(y),D.next_out=0,D.avail_out=y);C=s.inflate(D,n.Z_NO_FLUSH);if(C!==n.Z_STREAM_END&&C!==n.Z_OK){return this.onEnd(C),this.ended=!0,!1}if(D.next_out&&(0===D.avail_out||C===n.Z_STREAM_END||0===D.avail_in&&l===n.Z_FINISH)){if("string"===this.options.to){m=k.utf8border(D.output,D.next_out),f=D.next_out-m,A=k.buf2string(D.output,m),D.next_out=f,D.avail_out=y-f,f&&i.arraySet(D.output,D.output,m,f,0),this.onData(A)}else{this.onData(i.shrinkBuf(D.output,D.next_out))}}}while((0<D.avail_in||0===D.avail_out)&&C!==n.Z_STREAM_END);C===n.Z_STREAM_END&&(l=n.Z_FINISH);return l===n.Z_FINISH?(C=s.inflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===n.Z_OK):!0};j.prototype.onData=function(d){this.chunks.push(d)};j.prototype.onEnd=function(d){d===n.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):i.flattenChunks(this.chunks));this.chunks=[];this.err=d;this.msg=this.strm.msg};w.Inflate=j;w.inflate=o;w.inflateRaw=function(e,d){d=d||{};d.raw=!0;return o(e,d)};w.ungzip=o},{"./utils/common":2,"./utils/strings":3,"./zlib/constants":5,"./zlib/gzheader":7,"./zlib/inflate.js":9,"./zlib/messages":11,"./zlib/zstream":12}],2:[function(e,j,c){e="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Int32Array;c.assign=function(k){for(var m=Array.prototype.slice.call(arguments,1);m.length;){var f=m.shift();if(f){if("object"!==typeof f){throw new TypeError(f+"must be non-object")}for(var l in f){f.hasOwnProperty(l)&&(k[l]=f[l])}}}return k};c.shrinkBuf=function(f,h){if(f.length===h){return f}if(f.subarray){return f.subarray(0,h)}f.length=h;return f};var g={arraySet:function(k,n,f,l,o){if(n.subarray&&k.subarray){k.set(n.subarray(f,f+l),o)}else{for(var m=0;m<l;m++){k[o+m]=n[f+m]}}},flattenChunks:function(k){var n,f,l,o,m;n=l=0;for(f=k.length;n<f;n++){l+=k[n].length}m=new Uint8Array(l);n=l=0;for(f=k.length;n<f;n++){o=k[n],m.set(o,l),l+=o.length}return m}},i={arraySet:function(k,n,f,l,o){for(var m=0;m<l;m++){k[o+m]=n[f+m]}},flattenChunks:function(d){return[].concat.apply([],d)}};c.setTyped=function(d){d?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,g)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,i))};c.setTyped(e)},{}],3:[function(t,o,s){function k(m,f){if(65537>f&&(m.subarray&&i||!m.subarray&&g)){return String.fromCharCode.apply(null,n.shrinkBuf(m,f))}for(var h="",l=0;l<f;l++){h+=String.fromCharCode(m[l])}return h}var n=t("./common"),g=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch(j){g=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){i=!1}var p=new n.Buf8(256);for(t=0;256>t;t++){p[t]=252<=t?6:248<=t?5:240<=t?4:224<=t?3:192<=t?2:1}p[254]=p[254]=1;s.string2buf=function(y){var l,v,x,f,m,w=y.length,u=0;for(f=0;f<w;f++){v=y.charCodeAt(f),55296===(v&64512)&&f+1<w&&(x=y.charCodeAt(f+1),56320===(x&64512)&&(v=65536+(v-55296<<10)+(x-56320),f++)),u+=128>v?1:2048>v?2:65536>v?3:4}l=new n.Buf8(u);for(f=m=0;m<u;f++){v=y.charCodeAt(f),55296===(v&64512)&&f+1<w&&(x=y.charCodeAt(f+1),56320===(x&64512)&&(v=65536+(v-55296<<10)+(x-56320),f++)),128>v?l[m++]=v:(2048>v?l[m++]=192|v>>>6:(65536>v?l[m++]=224|v>>>12:(l[m++]=240|v>>>18,l[m++]=128|v>>>12&63),l[m++]=128|v>>>6&63),l[m++]=128|v&63)}return l};s.buf2binstring=function(d){return k(d,d.length)};s.binstring2buf=function(m){for(var f=new n.Buf8(m.length),h=0,l=f.length;h<l;h++){f[h]=m.charCodeAt(h)}return f};s.buf2string=function(m,y){var v,c,x,w,u=y||m.length,h=Array(2*u);for(v=c=0;v<u;){if(x=m[v++],128>x){h[c++]=x}else{if(w=p[x],4<w){h[c++]=65533,v+=w-1}else{for(x&=2===w?31:3===w?15:7;1<w&&v<u;){x=x<<6|m[v++]&63,w--}1<w?h[c++]=65533:65536>x?h[c++]=x:(x-=65536,h[c++]=55296|x>>10&1023,h[c++]=56320|x&1023)}}}return k(h,c)};s.utf8border=function(c,h){var f;h=h||c.length;h>c.length&&(h=c.length);for(f=h-1;0<=f&&128===(c[f]&192);){f--}return 0>f||0===f?h:f+p[c[f]]>h?f:h}},{"./common":2}],4:[function(e,f,c){f.exports=function(i,m,g,k){var h=i&65535|0;i=i>>>16&65535|0;for(var j=0;0!==g;){j=2000<g?2000:g;g-=j;do{h=h+m[k++]|0,i=i+h|0}while(--j);h%=65521;i%=65521}return h|i<<16|0}},{}],5:[function(e,f,c){f.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],6:[function(e,g,c){var f=function(){for(var j,l=[],i=0;256>i;i++){j=i;for(var k=0;8>k;k++){j=j&1?3988292384^j>>>1:j>>>1}l[i]=j}return l}();g.exports=function(i,k,h,j){h=j+h;for(i^=-1;j<h;j++){i=i>>>8^f[(i^k[j])&255]}return i^-1}},{}],7:[function(e,f,c){f.exports=function(){this.os=this.xflags=this.time=this.text=0;this.extra=null;this.extra_len=0;this.comment=this.name="";this.hcrc=0;this.done=!1}},{}],8:[function(e,f,c){f.exports=function(Z,W){var Y,U,S,P,X,V,R,T,n,J,k,E,M,q,F,j,o,O,L,m,h,i,B,Q;Y=Z.state;U=Z.next_in;B=Z.input;S=U+(Z.avail_in-5);P=Z.next_out;Q=Z.output;X=P-(W-Z.avail_out);V=P+(Z.avail_out-257);R=Y.dmax;T=Y.wsize;n=Y.whave;J=Y.wnext;k=Y.window;E=Y.hold;M=Y.bits;q=Y.lencode;F=Y.distcode;j=(1<<Y.lenbits)-1;o=(1<<Y.distbits)-1;Z:do{Y:for(15>M&&(E+=B[U++]<<M,M+=8,E+=B[U++]<<M,M+=8),O=q[E&j];;){L=O>>>24;E>>>=L;M-=L;L=O>>>16&255;if(0===L){Q[P++]=O&65535}else{if(L&16){m=O&65535;if(L&=15){M<L&&(E+=B[U++]<<M,M+=8),m+=E&(1<<L)-1,E>>>=L,M-=L}15>M&&(E+=B[U++]<<M,M+=8,E+=B[U++]<<M,M+=8);O=F[E&o];X:for(;;){L=O>>>24;E>>>=L;M-=L;L=O>>>16&255;if(L&16){O&=65535;L&=15;M<L&&(E+=B[U++]<<M,M+=8,M<L&&(E+=B[U++]<<M,M+=8));O+=E&(1<<L)-1;if(O>R){Z.msg="invalid distance too far back";Y.mode=30;break Z}E>>>=L;M-=L;L=P-X;if(O>L){L=O-L;if(L>n&&Y.sane){Z.msg="invalid distance too far back";Y.mode=30;break Z}h=0;i=k;if(0===J){if(h+=T-L,L<m){m-=L;do{Q[P++]=k[h++]}while(--L);h=P-O;i=Q}}else{if(J<L){if(h+=T+J-L,L-=J,L<m){m-=L;do{Q[P++]=k[h++]}while(--L);h=0;if(J<m){L=J;m-=L;do{Q[P++]=k[h++]}while(--L);h=P-O;i=Q}}}else{if(h+=J-L,L<m){m-=L;do{Q[P++]=k[h++]}while(--L);h=P-O;i=Q}}}for(;2<m;){Q[P++]=i[h++],Q[P++]=i[h++],Q[P++]=i[h++],m-=3}m&&(Q[P++]=i[h++],1<m&&(Q[P++]=i[h++]))}else{h=P-O;do{Q[P++]=Q[h++],Q[P++]=Q[h++],Q[P++]=Q[h++],m-=3}while(2<m);m&&(Q[P++]=Q[h++],1<m&&(Q[P++]=Q[h++]))}}else{if(0===(L&64)){O=F[(O&65535)+(E&(1<<L)-1)];continue X}else{Z.msg="invalid distance code";Y.mode=30;break Z}}break}}else{if(0===(L&64)){O=q[(O&65535)+(E&(1<<L)-1)];continue Y}else{L&32?Y.mode=12:(Z.msg="invalid literal/length code",Y.mode=30);break Z}}}break}}while(U<S&&P<V);m=M>>3;U-=m;M-=m<<3;Z.next_in=U;Z.next_out=P;Z.avail_in=U<S?5+(S-U):5-(U-S);Z.avail_out=P<V?257+(V-P):257-(P-V);Y.hold=E&(1<<M)-1;Y.bits=M}},{}],9:[function(R,O,Q){function M(d){return(d>>>24&255)+(d>>>8&65280)+((d&65280)<<8)+((d&255)<<24)}function I(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.total=this.check=this.dmax=this.flags=0;this.head=null;this.wnext=this.whave=this.wsize=this.wbits=0;this.window=null;this.extra=this.offset=this.length=this.bits=this.hold=0;this.distcode=this.lencode=null;this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0;this.next=null;this.lens=new P.Buf16(320);this.work=new P.Buf16(288);this.distdyn=this.lendyn=null;this.was=this.back=this.sane=0}function F(c){var d;if(!c||!c.state){return i}d=c.state;c.total_in=c.total_out=d.total=0;c.msg="";d.wrap&&(c.adler=d.wrap&1);d.mode=A;d.last=0;d.havedict=0;d.dmax=32768;d.head=null;d.hold=0;d.bits=0;d.lencode=d.lendyn=new P.Buf32(D);d.distcode=d.distdyn=new P.Buf32(o);d.sane=1;d.back=-1;return C}function J(e){var d;if(!e||!e.state){return i}d=e.state;d.wsize=0;d.whave=0;d.wnext=0;return F(e)}function K(m,d){var f,l;if(!m||!m.state){return i}l=m.state;0>d?(f=0,d=-d):(f=(d>>4)+1,48>d&&(d&=15));if(d&&(8>d||15<d)){return i}null!==l.window&&l.wbits!==d&&(l.window=null);l.wrap=f;l.wbits=d;return J(m)}function E(f,d){var e;if(!f){return i}e=new I;f.state=e;e.window=null;e=K(f,d);e!==C&&(f.state=null);return e}var P=R("../utils/common"),N=R("./adler32"),G=R("./crc32"),L=R("./inffast"),j=R("./inftrees"),C=0,i=-2,A=1,D=852,o=592,B=!0,h,k;Q.inflateReset=J;Q.inflateReset2=K;Q.inflateResetKeep=F;Q.inflateInit=function(d){return E(d,15)};Q.inflateInit2=E;Q.inflate=function(af,ad){var ae,U,x,z,Y,ac,aa,ab,T,y,v,S,t,g;S=0;var W,f,u,c,H,e=new P.Buf8(4),p=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!af||!af.state||!af.output||!af.input&&0!==af.avail_in){return i}ae=af.state;12===ae.mode&&(ae.mode=13);Y=af.next_out;x=af.output;aa=af.avail_out;z=af.next_in;U=af.input;ac=af.avail_in;ab=ae.hold;T=ae.bits;y=ac;v=aa;H=C;af:for(;;){switch(ae.mode){case A:if(0===ae.wrap){ae.mode=13;break}for(;16>T;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}if(ae.wrap&2&&35615===ab){ae.check=0;e[0]=ab&255;e[1]=ab>>>8&255;ae.check=G(ae.check,e,2,0);T=ab=0;ae.mode=2;break}ae.flags=0;ae.head&&(ae.head.done=!1);if(!(ae.wrap&1)||(((ab&255)<<8)+(ab>>8))%31){af.msg="incorrect header check";ae.mode=30;break}if(8!==(ab&15)){af.msg="unknown compression method";ae.mode=30;break}ab>>>=4;T-=4;t=(ab&15)+8;if(0===ae.wbits){ae.wbits=t}else{if(t>ae.wbits){af.msg="invalid window size";ae.mode=30;break}}ae.dmax=1<<t;af.adler=ae.check=1;ae.mode=ab&512?10:12;T=ab=0;break;case 2:for(;16>T;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ae.flags=ab;if(8!==(ae.flags&255)){af.msg="unknown compression method";ae.mode=30;break}if(ae.flags&57344){af.msg="unknown header flags set";ae.mode=30;break}ae.head&&(ae.head.text=ab>>8&1);ae.flags&512&&(e[0]=ab&255,e[1]=ab>>>8&255,ae.check=G(ae.check,e,2,0));T=ab=0;ae.mode=3;case 3:for(;32>T;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ae.head&&(ae.head.time=ab);ae.flags&512&&(e[0]=ab&255,e[1]=ab>>>8&255,e[2]=ab>>>16&255,e[3]=ab>>>24&255,ae.check=G(ae.check,e,4,0));T=ab=0;ae.mode=4;case 4:for(;16>T;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ae.head&&(ae.head.xflags=ab&255,ae.head.os=ab>>8);ae.flags&512&&(e[0]=ab&255,e[1]=ab>>>8&255,ae.check=G(ae.check,e,2,0));T=ab=0;ae.mode=5;case 5:if(ae.flags&1024){for(;16>T;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ae.length=ab;ae.head&&(ae.head.extra_len=ab);ae.flags&512&&(e[0]=ab&255,e[1]=ab>>>8&255,ae.check=G(ae.check,e,2,0));T=ab=0}else{ae.head&&(ae.head.extra=null)}ae.mode=6;case 6:if(ae.flags&1024&&(S=ae.length,S>ac&&(S=ac),S&&(ae.head&&(t=ae.head.extra_len-ae.length,ae.head.extra||(ae.head.extra=Array(ae.head.extra_len)),P.arraySet(ae.head.extra,U,z,S,t)),ae.flags&512&&(ae.check=G(ae.check,U,S,z)),ac-=S,z+=S,ae.length-=S),ae.length)){break af}ae.length=0;ae.mode=7;case 7:if(ae.flags&2048){if(0===ac){break af}S=0;do{t=U[z+S++],ae.head&&t&&65536>ae.length&&(ae.head.name+=String.fromCharCode(t))}while(t&&S<ac);ae.flags&512&&(ae.check=G(ae.check,U,S,z));ac-=S;z+=S;if(t){break af}}else{ae.head&&(ae.head.name=null)}ae.length=0;ae.mode=8;case 8:if(ae.flags&4096){if(0===ac){break af}S=0;do{t=U[z+S++],ae.head&&t&&65536>ae.length&&(ae.head.comment+=String.fromCharCode(t))}while(t&&S<ac);ae.flags&512&&(ae.check=G(ae.check,U,S,z));ac-=S;z+=S;if(t){break af}}else{ae.head&&(ae.head.comment=null)}ae.mode=9;case 9:if(ae.flags&512){for(;16>T;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}if(ab!==(ae.check&65535)){af.msg="header crc mismatch";ae.mode=30;break}T=ab=0}ae.head&&(ae.head.hcrc=ae.flags>>9&1,ae.head.done=!0);af.adler=ae.check=0;ae.mode=12;break;case 10:for(;32>T;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}af.adler=ae.check=M(ab);T=ab=0;ae.mode=11;case 11:if(0===ae.havedict){return af.next_out=Y,af.avail_out=aa,af.next_in=z,af.avail_in=ac,ae.hold=ab,ae.bits=T,2}af.adler=ae.check=1;ae.mode=12;case 12:if(5===ad||6===ad){break af}case 13:if(ae.last){ab>>>=T&7;T-=T&7;ae.mode=27;break}for(;3>T;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ae.last=ab&1;ab>>>=1;T-=1;switch(ab&3){case 0:ae.mode=14;break;case 1:S=ae;if(B){t=void 0;h=new P.Buf32(512);k=new P.Buf32(32);for(t=0;144>t;){S.lens[t++]=8}for(;256>t;){S.lens[t++]=9}for(;280>t;){S.lens[t++]=7}for(;288>t;){S.lens[t++]=8}j(1,S.lens,0,288,h,0,S.work,{bits:9});for(t=0;32>t;){S.lens[t++]=5}j(2,S.lens,0,32,k,0,S.work,{bits:5});B=!1}S.lencode=h;S.lenbits=9;S.distcode=k;S.distbits=5;ae.mode=20;if(6===ad){ab>>>=2;T-=2;break af}break;case 2:ae.mode=17;break;case 3:af.msg="invalid block type",ae.mode=30}ab>>>=2;T-=2;break;case 14:ab>>>=T&7;for(T-=T&7;32>T;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}if((ab&65535)!==(ab>>>16^65535)){af.msg="invalid stored block lengths";ae.mode=30;break}ae.length=ab&65535;T=ab=0;ae.mode=15;if(6===ad){break af}case 15:ae.mode=16;case 16:if(S=ae.length){S>ac&&(S=ac);S>aa&&(S=aa);if(0===S){break af}P.arraySet(x,U,z,S,Y);ac-=S;z+=S;aa-=S;Y+=S;ae.length-=S;break}ae.mode=12;break;case 17:for(;14>T;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ae.nlen=(ab&31)+257;ab>>>=5;T-=5;ae.ndist=(ab&31)+1;ab>>>=5;T-=5;ae.ncode=(ab&15)+4;ab>>>=4;T-=4;if(286<ae.nlen||30<ae.ndist){af.msg="too many length or distance symbols";ae.mode=30;break}ae.have=0;ae.mode=18;case 18:for(;ae.have<ae.ncode;){for(;3>T;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ae.lens[p[ae.have++]]=ab&7;ab>>>=3;T-=3}for(;19>ae.have;){ae.lens[p[ae.have++]]=0}ae.lencode=ae.lendyn;ae.lenbits=7;S={bits:ae.lenbits};H=j(0,ae.lens,0,19,ae.lencode,0,ae.work,S);ae.lenbits=S.bits;if(H){af.msg="invalid code lengths set";ae.mode=30;break}ae.have=0;ae.mode=19;case 19:for(;ae.have<ae.nlen+ae.ndist;){for(;;){S=ae.lencode[ab&(1<<ae.lenbits)-1];W=S>>>24;f=S>>>16&255;u=S&65535;if(W<=T){break}if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}if(16>u){ab>>>=W,T-=W,ae.lens[ae.have++]=u}else{if(16===u){for(S=W+2;T<S;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ab>>>=W;T-=W;if(0===ae.have){af.msg="invalid bit length repeat";ae.mode=30;break}t=ae.lens[ae.have-1];S=3+(ab&3);ab>>>=2;T-=2}else{if(17===u){for(S=W+3;T<S;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ab>>>=W;T-=W;t=0;S=3+(ab&7);ab>>>=3;T-=3}else{for(S=W+7;T<S;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ab>>>=W;T-=W;t=0;S=11+(ab&127);ab>>>=7;T-=7}}if(ae.have+S>ae.nlen+ae.ndist){af.msg="invalid bit length repeat";ae.mode=30;break}for(;S--;){ae.lens[ae.have++]=t}}}if(30===ae.mode){break}if(0===ae.lens[256]){af.msg="invalid code -- missing end-of-block";ae.mode=30;break}ae.lenbits=9;S={bits:ae.lenbits};H=j(1,ae.lens,0,ae.nlen,ae.lencode,0,ae.work,S);ae.lenbits=S.bits;if(H){af.msg="invalid literal/lengths set";ae.mode=30;break}ae.distbits=6;ae.distcode=ae.distdyn;S={bits:ae.distbits};H=j(2,ae.lens,ae.nlen,ae.ndist,ae.distcode,0,ae.work,S);ae.distbits=S.bits;if(H){af.msg="invalid distances set";ae.mode=30;break}ae.mode=20;if(6===ad){break af}case 20:ae.mode=21;case 21:if(6<=ac&&258<=aa){af.next_out=Y;af.avail_out=aa;af.next_in=z;af.avail_in=ac;ae.hold=ab;ae.bits=T;L(af,v);Y=af.next_out;x=af.output;aa=af.avail_out;z=af.next_in;U=af.input;ac=af.avail_in;ab=ae.hold;T=ae.bits;12===ae.mode&&(ae.back=-1);break}for(ae.back=0;;){S=ae.lencode[ab&(1<<ae.lenbits)-1];W=S>>>24;f=S>>>16&255;u=S&65535;if(W<=T){break}if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}if(f&&0===(f&240)){t=W;g=f;for(c=u;;){S=ae.lencode[c+((ab&(1<<t+g)-1)>>t)];W=S>>>24;f=S>>>16&255;u=S&65535;if(t+W<=T){break}if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ab>>>=t;T-=t;ae.back+=t}ab>>>=W;T-=W;ae.back+=W;ae.length=u;if(0===f){ae.mode=26;break}if(f&32){ae.back=-1;ae.mode=12;break}if(f&64){af.msg="invalid literal/length code";ae.mode=30;break}ae.extra=f&15;ae.mode=22;case 22:if(ae.extra){for(S=ae.extra;T<S;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ae.length+=ab&(1<<ae.extra)-1;ab>>>=ae.extra;T-=ae.extra;ae.back+=ae.extra}ae.was=ae.length;ae.mode=23;case 23:for(;;){S=ae.distcode[ab&(1<<ae.distbits)-1];W=S>>>24;f=S>>>16&255;u=S&65535;if(W<=T){break}if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}if(0===(f&240)){t=W;g=f;for(c=u;;){S=ae.distcode[c+((ab&(1<<t+g)-1)>>t)];W=S>>>24;f=S>>>16&255;u=S&65535;if(t+W<=T){break}if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ab>>>=t;T-=t;ae.back+=t}ab>>>=W;T-=W;ae.back+=W;if(f&64){af.msg="invalid distance code";ae.mode=30;break}ae.offset=u;ae.extra=f&15;ae.mode=24;case 24:if(ae.extra){for(S=ae.extra;T<S;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}ae.offset+=ab&(1<<ae.extra)-1;ab>>>=ae.extra;T-=ae.extra;ae.back+=ae.extra}if(ae.offset>ae.dmax){af.msg="invalid distance too far back";ae.mode=30;break}ae.mode=25;case 25:if(0===aa){break af}S=v-aa;if(ae.offset>S){S=ae.offset-S;if(S>ae.whave&&ae.sane){af.msg="invalid distance too far back";ae.mode=30;break}S>ae.wnext?(S-=ae.wnext,t=ae.wsize-S):t=ae.wnext-S;S>ae.length&&(S=ae.length);g=ae.window}else{g=x,t=Y-ae.offset,S=ae.length}S>aa&&(S=aa);aa-=S;ae.length-=S;do{x[Y++]=g[t++]}while(--S);0===ae.length&&(ae.mode=21);break;case 26:if(0===aa){break af}x[Y++]=ae.length;aa--;ae.mode=21;break;case 27:if(ae.wrap){for(;32>T;){if(0===ac){break af}ac--;ab|=U[z++]<<T;T+=8}v-=aa;af.total_out+=v;ae.total+=v;v&&(af.adler=ae.check=ae.flags?G(ae.check,x,v,Y-v):N(ae.check,x,v,Y-v));v=aa;if((ae.flags?ab:M(ab))!==ae.check){af.msg="incorrect data check";ae.mode=30;break}T=ab=0}ae.mode=28;case 28:if(ae.wrap&&ae.flags){for(;32>T;){if(0===ac){break af}ac--;ab+=U[z++]<<T;T+=8}if(ab!==(ae.total&4294967295)){af.msg="incorrect length check";ae.mode=30;break}T=ab=0}ae.mode=29;case 29:H=1;break af;case 30:H=-3;break af;case 31:return -4;default:return i}}af.next_out=Y;af.avail_out=aa;af.next_in=z;af.avail_in=ac;ae.hold=ab;ae.bits=T;if(ae.wsize||v!==af.avail_out&&30>ae.mode&&(27>ae.mode||4!==ad)){U=af.output,z=af.next_out,Y=v-af.avail_out,aa=af.state,null===aa.window&&(aa.wsize=1<<aa.wbits,aa.wnext=0,aa.whave=0,aa.window=new P.Buf8(aa.wsize)),Y>=aa.wsize?(P.arraySet(aa.window,U,z-aa.wsize,aa.wsize,0),aa.wnext=0,aa.whave=aa.wsize):(ac=aa.wsize-aa.wnext,ac>Y&&(ac=Y),P.arraySet(aa.window,U,z-Y,ac,aa.wnext),(Y-=ac)?(P.arraySet(aa.window,U,z-Y,Y,0),aa.wnext=Y,aa.whave=aa.wsize):(aa.wnext+=ac,aa.wnext===aa.wsize&&(aa.wnext=0),aa.whave<aa.wsize&&(aa.whave+=ac)))}y-=af.avail_in;v-=af.avail_out;af.total_in+=y;af.total_out+=v;ae.total+=v;ae.wrap&&v&&(af.adler=ae.check=ae.flags?G(ae.check,x,v,af.next_out-v):N(ae.check,x,v,af.next_out-v));af.data_type=ae.bits+(ae.last?64:0)+(12===ae.mode?128:0)+(20===ae.mode||15===ae.mode?256:0);(0===y&&0===v||4===ad)&&H===C&&(H=-5);return H};Q.inflateEnd=function(d){if(!d||!d.state){return i}var e=d.state;e.window&&(e.window=null);d.state=null;return C};Q.inflateGetHeader=function(e,f){var d;if(!e||!e.state){return i}d=e.state;if(0===(d.wrap&2)){return i}d.head=f;f.done=!1;return C};Q.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":2,"./adler32":4,"./crc32":6,"./inffast":8,"./inftrees":10}],10:[function(h,k,e){var j=h("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],g=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];k.exports=function(an,al,am,ak,aj,S,ad,O){for(var Z=O.bits,ae=0,W=0,ab=0,L=0,V=0,ag=0,af=0,R=0,r=0,F=0,X,ai,f=null,m=0,M,l=new j.Buf16(16),ag=new j.Buf16(16),ao=null,q=0,ac,p,n,ae=0;15>=ae;ae++){l[ae]=0}for(W=0;W<ak;W++){l[al[am+W]]++}V=Z;for(L=15;1<=L&&0===l[L];L--){}V>L&&(V=L);if(0===L){return aj[S++]=20971520,aj[S++]=20971520,O.bits=1,0}for(ab=1;ab<L&&0===l[ab];ab++){}V<ab&&(V=ab);for(ae=R=1;15>=ae;ae++){if(R<<=1,R-=l[ae],0>R){return -1}}if(0<R&&(0===an||1!==L)){return -1}ag[1]=0;for(ae=1;15>ae;ae++){ag[ae+1]=ag[ae]+l[ae]}for(W=0;W<ak;W++){0!==al[am+W]&&(ad[ag[al[am+W]]++]=W)}switch(an){case 0:f=ao=ad;M=19;break;case 1:f=o;m-=257;ao=i;q-=257;M=256;break;default:f=c,ao=g,M=-1}W=F=0;ae=ab;Z=S;ag=V;af=0;ai=-1;r=1<<V;ak=r-1;if(1===an&&852<r||2===an&&592<r){return 1}for(var ah=0;;){ah++;ac=ae-af;ad[W]<M?(p=0,n=ad[W]):ad[W]>M?(p=ao[q+ad[W]],n=f[m+ad[W]]):(p=96,n=0);R=1<<ae-af;ab=X=1<<ag;do{X-=R,aj[Z+(F>>af)+X]=ac<<24|p<<16|n|0}while(0!==X);for(R=1<<ae-1;F&R;){R>>=1}0!==R?(F&=R-1,F+=R):F=0;W++;if(0===--l[ae]){if(ae===L){break}ae=al[am+ad[W]]}if(ae>V&&(F&ak)!==ai){0===af&&(af=V);Z+=ab;ag=ae-af;for(R=1<<ag;ag+af<L;){R-=l[ag+af];if(0>=R){break}ag++;R<<=1}r+=1<<ag;if(1===an&&852<r||2===an&&592<r){return 1}ai=F&ak;aj[ai]=V<<24|ag<<16|Z-S|0}}0!==F&&(aj[Z+F]=ae-af<<24|4194304);O.bits=V;return 0}},{"../utils/common":2}],11:[function(e,f,c){f.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],12:[function(e,f,c){f.exports=function(){this.input=null;this.total_in=this.avail_in=this.next_in=0;this.output=null;this.total_out=this.avail_out=this.next_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}},{}]},{},[1])(1)});return{inflate:function(c,b){return a.inflateRaw(c)}}}()})();core.StepDirection={PREVIOUS:1,NEXT:2};core.StepIterator=function(w,u){function B(){z=null;j=x=void 0}function y(){void 0===j&&(j=w.acceptPosition(u)===t);return j}function A(d,a){B();return u.setUnfilteredPosition(d,a)}function v(){z||(z=u.container());return z}function o(){void 0===x&&(x=u.unfilteredDomOffset());return x}function i(){for(B();u.nextPosition();){if(B(),y()){return !0}}return !1}function s(){for(B();u.previousPosition();){if(B(),y()){return !0}}return !1}var t=core.PositionFilter.FilterResult.FILTER_ACCEPT,g=core.StepDirection.NEXT,z,x,j;this.isStep=y;this.setPosition=A;this.container=v;this.offset=o;this.nextStep=i;this.previousStep=s;this.advanceStep=function(b){return b===g?i():s()};this.roundToClosestStep=function(){var b,f,d=y();d||(b=v(),f=o(),d=s(),d||(A(b,f),d=i()));return d};this.roundToPreviousStep=function(){var b=y();b||(b=s());return b};this.roundToNextStep=function(){var b=y();b||(b=i());return b};this.leftNode=function(){return u.leftNode()};this.snapshot=function(){return new core.StepIterator.StepSnapshot(v(),o())};this.restore=function(b){A(b.container,b.offset)}};core.StepIterator.StepSnapshot=function(b,a){this.container=b;this.offset=a};core.UnitTest=function(){};core.UnitTest.prototype.setUp=function(){};core.UnitTest.prototype.tearDown=function(){};core.UnitTest.prototype.description=function(){};core.UnitTest.prototype.tests=function(){};core.UnitTest.prototype.asyncTests=function(){};core.UnitTest.provideTestAreaDiv=function(){var b=runtime.getWindow().document,a=b.getElementById("testarea");runtime.assert(!a,'Unclean test environment, found a div with id "testarea".');a=b.createElement("div");a.setAttribute("id","testarea");b.body.appendChild(a);return a};core.UnitTest.cleanupTestAreaDiv=function(){var b=runtime.getWindow().document,a=b.getElementById("testarea");runtime.assert(!!a&&a.parentNode===b.body,'Test environment broken, found no div with id "testarea" below body.');b.body.removeChild(a)};core.UnitTest.createXmlDocument=function(e,c,b){var g="<?xml version='1.0' encoding='UTF-8'?>",g=g+("<"+e);Object.keys(b).forEach(function(a){g+=" xmlns:"+a+'="'+b[a]+'"'});g+=">";g+=c;g+="</"+e+">";return runtime.parseXML(g)};core.UnitTest.createOdtDocument=function(b,a){return core.UnitTest.createXmlDocument("office:document",b,a)};core.UnitTestLogger=function(){var h=[],g=0,e=0,i="",c="";this.startTest=function(a,b){h=[];g=0;i=a;c=b;e=Date.now()};this.endTest=function(){var a=Date.now();return{description:c,suite:[i,c],success:0===g,log:h,time:a-e}};this.debug=function(b){h.push({category:"debug",message:b})};this.fail=function(b){g+=1;h.push({category:"fail",message:b})};this.pass=function(b){h.push({category:"pass",message:b})}};core.UnitTestRunner=function(f,k){function a(a){l+=1;e?k.debug(a):k.fail(a)}function d(c,b){var e;try{if(c.length!==b.length){return a("array of length "+c.length+" should be "+b.length+" long"),!1}for(e=0;e<c.length;e+=1){if(c[e]!==b[e]){return a(c[e]+" should be "+b[e]+" at array index "+e),!1}}}catch(d){return !1}return !0}function b(c,g,e){var d=c.attributes,f=d.length,h,l,m;for(h=0;h<f;h+=1){if(l=d.item(h),"xmlns"!==l.prefix&&"urn:webodf:names:steps"!==l.namespaceURI){m=g.getAttributeNS(l.namespaceURI,l.localName);if(!g.hasAttributeNS(l.namespaceURI,l.localName)){return a("Attribute "+l.localName+" with value "+l.value+" was not present"),!1}if(m!==l.value){return a("Attribute "+l.localName+" was "+m+" should be "+l.value),!1}}}return e?!0:b(g,c,!0)}function h(c,g){var e,d;e=c.nodeType;d=g.nodeType;if(e!==d){return a("Nodetype '"+e+"' should be '"+d+"'"),!1}if(e===Node.TEXT_NODE){if(c.data===g.data){return !0}a("Textnode data '"+c.data+"' should be '"+g.data+"'");return !1}runtime.assert(e===Node.ELEMENT_NODE,"Only textnodes and elements supported.");if(c.namespaceURI!==g.namespaceURI){return a("namespace '"+c.namespaceURI+"' should be '"+g.namespaceURI+"'"),!1}if(c.localName!==g.localName){return a("localName '"+c.localName+"' should be '"+g.localName+"'"),!1}if(!b(c,g,!1)){return !1}e=c.firstChild;for(d=g.firstChild;e;){if(!d){return a("Nodetype '"+e.nodeType+"' is unexpected here."),!1}if(!h(e,d)){return !1}e=e.nextSibling;d=d.nextSibling}return d?(a("Nodetype '"+d.nodeType+"' is missing here."),!1):!0}function n(a,b,e){if(0===b){return a===b&&1/a===1/b}if(a===b){return !0}if(null===a||null===b){return !1}if("number"===typeof b&&isNaN(b)){return"number"===typeof a&&isNaN(a)}if("number"===typeof b&&"number"===typeof a){if(a===b){return !0}void 0===e&&(e=0.0001);runtime.assert("number"===typeof e,"Absolute tolerance not given as number.");runtime.assert(0<=e,"Absolute tolerance should be given as positive number, was "+e);a=Math.abs(a-b);return a<=e}return Object.prototype.toString.call(b)===Object.prototype.toString.call([])?d(a,b):"object"===typeof b&&"object"===typeof a?b.constructor===Element||b.constructor===Node?h(a,b):c(a,b):!1}function q(a){if(0===a&&0>1/a){return"-0"}if("object"===typeof a){try{return JSON.stringify(a)}catch(c){}}return String(a)}function m(c,b,e,d){"string"===typeof b&&"string"===typeof e||k.debug("WARN: shouldBe() expects string arguments");var f,h;try{h=eval(b)}catch(l){f=l}c=eval(e);f?a(b+" should be "+c+". Threw exception "+f):n(h,c,d)?k.pass(b+" is "+e):String(typeof h)===String(typeof c)?a(b+" should be "+q(c)+". Was "+q(h)+"."):a(b+" should be "+c+" (of type "+typeof c+"). Was "+h+" (of type "+typeof h+").")}var l=0,r,c,e=!1;this.resourcePrefix=function(){return f};this.beginExpectFail=function(){r=l;e=!0};this.endExpectFail=function(){var a=r===l;e=!1;l=r;a&&(l+=1,k.fail("Expected at least one failed test, but none registered."))};c=function(c,b){var e=Object.keys(c),f=Object.keys(b);e.sort();f.sort();return d(e,f)&&Object.keys(c).every(function(e){var d=c[e],f=b[e];return n(d,f)?!0:(a(d+" should be "+f+" for key "+e),!1)})};this.areNodesEqual=h;this.shouldBeNull=function(a,c){m(a,c,"null")};this.shouldBeNonNull=function(c,b){var e,d;try{d=eval(b)}catch(f){e=f}e?a(b+" should be non-null. Threw exception "+e):null!==d?k.pass(b+" is non-null."):a(b+" should be non-null. Was "+d)};this.shouldBe=m;this.testFailed=a;this.countFailedTests=function(){return l};this.name=function(a){var c,b,e=[],d=a.length;e.length=d;for(c=0;c<d;c+=1){b=Runtime.getFunctionName(a[c])||"";if(""===b){throw"Found a function without a name."}e[c]={f:a[c],name:b}}return e}};core.UnitTester=function(){function j(f,d){return"<span style='color:blue;cursor:pointer' onclick='"+d+"'>"+f.replace(/</g,"&lt;")+"</span>"}function g(a){e.reporter&&e.reporter(a)}var e=this,l=0,c=new core.UnitTestLogger,i={},m="BrowserRuntime"===runtime.type();this.resourcePrefix="";this.reporter=function(h){var f,k;m?runtime.log("<span>Running "+j(h.description,'runTest("'+h.suite[0]+'","'+h.description+'")')+"</span>"):runtime.log("Running "+h.description);if(!h.success){for(f=0;f<h.log.length;f+=1){k=h.log[f],runtime.log(k.category,k.message)}}};this.runTests=function(b,f,h){function a(r){function t(){s&&n.endExpectFail();g(c.endTest());d.tearDown();k[v]=D===n.countFailedTests();a(r.slice(1))}var v,s;if(0===r.length){i[o]=k,l+=n.countFailedTests(),f()}else{if(C=r[0].f,v=r[0].name,s=!0===r[0].expectFail,D=n.countFailedTests(),h.length&&-1===h.indexOf(v)){a(r.slice(1))}else{d.setUp();c.startTest(o,v);s&&n.beginExpectFail();try{C(t)}catch(p){n.testFailed("Unexpected exception encountered: "+p.toString()+"\n"+p.stack),t()}}}}var o=Runtime.getFunctionName(b)||"",n=new core.UnitTestRunner(e.resourcePrefix,c),d=new b(n),k={},z,C,u,B,D;if(i.hasOwnProperty(o)){runtime.log("Test "+o+" has already run.")}else{m?runtime.log("<span>Running "+j(o,'runSuite("'+o+'");')+": "+d.description()+"</span>"):runtime.log("Running "+o+": "+d.description());u=d.tests();for(z=0;z<u.length;z+=1){if(C=u[z].f,b=u[z].name,B=!0===u[z].expectFail,!h.length||-1!==h.indexOf(b)){D=n.countFailedTests();d.setUp();c.startTest(o,b);B&&n.beginExpectFail();try{C()}catch(A){n.testFailed("Unexpected exception encountered: "+A.toString()+"\n"+A.stack)}B&&n.endExpectFail();g(c.endTest());d.tearDown();k[b]=D===n.countFailedTests()}}a(d.asyncTests())}};this.failedTestsCount=function(){return l};this.results=function(){return i}};core.Utils=function(){function a(c,b){if(b&&Array.isArray(b)){c=c||[];if(!Array.isArray(c)){throw"Destination is not an array."}c=c.concat(b.map(function(d){return a(null,d)}))}else{if(b&&"object"===typeof b){c=c||{};if("object"!==typeof c){throw"Destination is not an object."}Object.keys(b).forEach(function(e){c[e]=a(c[e],b[e])})}else{c=b}}return c}this.hashString=function(g){var e=0,h,c;h=0;for(c=g.length;h<c;h+=1){e=(e<<5)-e+g.charCodeAt(h),e|=0}return e};this.mergeObjects=function(c,b){Object.keys(b).forEach(function(e){c[e]=a(c[e],b[e])});return c}};core.Zip=function(K,H){function P(e,f,d){j?d(null,j.subarray(e,e+f)):d("File data not loaded",null)}function M(h){var n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918000,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],f,l,k=h.length,m=0,m=0;f=-1;for(l=0;l<k;l+=1){m=(f^h[l])&255,m=n[m],f=f>>>8^m}return f^-1}function O(b){return new Date((b>>25&127)+1980,(b>>21&15)-1,b>>16&31,b>>11&15,b>>5&63,(b&31)<<1)}function I(b){var d=b.getFullYear();return 1980>d?0:d-1980<<25|b.getMonth()+1<<21|b.getDate()<<16|b.getHours()<<11|b.getMinutes()<<5|b.getSeconds()>>1}function E(x,v){var s,w,b,t,q,n,k,a=this;this.load=function(c){if(null!==a.data){c(null,a.data)}else{var d=q+34+w+b+256;d+k>z&&(d=z-k);P(k,d,function(h,y){if(h||null===y){c(h,y)}else{h:{var l=y,Q=new core.ByteArray(l),r=Q.readUInt32LE(),f;if(67324752!==r){c("File entry signature is wrong."+r.toString()+" "+l.length.toString(),null)}else{Q.pos+=22;r=Q.readUInt16LE();f=Q.readUInt16LE();Q.pos+=r+f;if(t){l=l.subarray(Q.pos,Q.pos+q);if(q!==l.length){c("The amount of compressed bytes read was "+l.length.toString()+" instead of "+q.toString()+" for "+a.filename+" in "+x+".",null);break h}l=u(l,n)}else{l=l.subarray(Q.pos,Q.pos+n)}n!==l.length?c("The amount of bytes read was "+l.length.toString()+" instead of "+n.toString()+" for "+a.filename+" in "+x+".",null):(a.data=l,c(null,l))}}}})}};this.set=function(f,h,d,g){a.filename=f;a.data=h;a.compressed=d;a.date=g};this.error=null;v&&(s=v.readUInt32LE(),33639248!==s?this.error="Central directory entry has wrong signature at position "+(v.pos-4).toString()+' for file "'+x+'": '+v.data.length.toString():(v.pos+=6,t=v.readUInt16LE(),this.date=O(v.readUInt32LE()),v.readUInt32LE(),q=v.readUInt32LE(),n=v.readUInt32LE(),w=v.readUInt16LE(),b=v.readUInt16LE(),s=v.readUInt16LE(),v.pos+=8,k=v.readUInt32LE(),this.filename=runtime.byteArrayToString(v.data.subarray(v.pos,v.pos+w),"utf8"),this.data=null,v.pos+=w+b+s))}function C(h,a){if(22!==h.length){a("Central directory length should be 22.",A)}else{var f=new core.ByteArray(h),g;g=f.readUInt32LE();101010256!==g?a("Central directory signature is wrong: "+g.toString(),A):(g=f.readUInt16LE(),0!==g?a("Zip files with non-zero disk numbers are not supported.",A):(g=f.readUInt16LE(),0!==g?a("Zip files with non-zero disk numbers are not supported.",A):(g=f.readUInt16LE(),i=f.readUInt16LE(),g!==i?a("Number of entries is inconsistent.",A):(g=f.readUInt32LE(),f=f.readUInt16LE(),f=z-22-g,P(f,z-f,function(b,n){if(b||null===n){a(b,A)}else{b:{var l=new core.ByteArray(n),m,k;J=[];for(m=0;m<i;m+=1){k=new E(K,l);if(k.error){a(k.error,A);break b}J[J.length]=k}a(null,A)}}})))))}}function F(g,l){var f=null,h,k;for(k=0;k<J.length;k+=1){if(h=J[k],h.filename===g){f=h;break}}f?f.data?l(null,f.data):f.load(l):l(g+" not found.",null)}function G(e){var f=new core.ByteArrayWriter("utf8"),d=0;f.appendArray([80,75,3,4,20,0,0,0,0,0]);e.data&&(d=e.data.length);f.appendUInt32LE(I(e.date));f.appendUInt32LE(e.data?M(e.data):0);f.appendUInt32LE(d);f.appendUInt32LE(d);f.appendUInt16LE(e.filename.length);f.appendUInt16LE(0);f.appendString(e.filename);e.data&&f.appendByteArray(e.data);return f}function B(f,h){var d=new core.ByteArrayWriter("utf8"),g=0;d.appendArray([80,75,1,2,20,0,20,0,0,0,0,0]);f.data&&(g=f.data.length);d.appendUInt32LE(I(f.date));d.appendUInt32LE(f.data?M(f.data):0);d.appendUInt32LE(g);d.appendUInt32LE(g);d.appendUInt16LE(f.filename.length);d.appendArray([0,0,0,0,0,0,0,0,0,0,0,0]);d.appendUInt32LE(h);d.appendString(f.filename);return d}function N(d,c){if(d===J.length){c(null)}else{var f=J[d];null!==f.data?N(d+1,c):f.load(function(a){a?c(a):N(d+1,c)})}}function L(d,c){N(0,function(k){if(k){c(k)}else{var g,h,b=new core.ByteArrayWriter("utf8"),a=[0];for(g=0;g<J.length;g+=1){b.appendByteArrayWriter(G(J[g])),a.push(b.getLength())}k=b.getLength();for(g=0;g<J.length;g+=1){h=J[g],b.appendByteArrayWriter(B(h,a[g]))}g=b.getLength()-k;b.appendArray([80,75,5,6,0,0,0,0]);b.appendUInt16LE(J.length);b.appendUInt16LE(J.length);b.appendUInt32LE(g);b.appendUInt32LE(k);b.appendArray([0,0]);d(b.getByteArray())}})}function D(b,d){L(function(a){runtime.writeFile(b,a,function(c){c||(j=a,z=j.length);d(c)})},d)}var J,j,z,i,u=core.RawInflate.inflate,A=this,o=new core.Base64;this.load=F;this.save=function(g,m,f,k){var l,h;for(l=0;l<J.length;l+=1){if(h=J[l],h.filename===g){h.set(g,m,f,k);return}}h=new E(K);h.set(g,m,f,k);J.push(h)};this.remove=function(e){var f,d;for(f=0;f<J.length;f+=1){if(d=J[f],d.filename===e){return J.splice(f,1),!0}}return !1};this.write=function(b){D(K,b)};this.writeAs=D;this.createByteArray=L;this.loadContentXmlAsFragments=function(b,d){A.loadAsString(b,function(e,c){if(e){return d.rootElementReady(e)}d.rootElementReady(null,c,!0)})};this.loadAsString=function(b,d){F(b,function(f,c){if(f||null===c){return d(f,null)}var g=runtime.byteArrayToString(c,"utf8");d(null,g)})};this.loadAsDOM=function(b,d){A.loadAsString(b,function(f,c){if(f||null===c){d(f,null)}else{var g=(new DOMParser).parseFromString(c,"text/xml");d(null,g)}})};this.loadAsDataURL=function(e,f,d){F(e,function(b,h){if(b||!h){return d(b,null)}var c=0,k;f||(f=80===h[1]&&78===h[2]&&71===h[3]?"image/png":255===h[0]&&216===h[1]&&255===h[2]?"image/jpeg":71===h[0]&&73===h[1]&&70===h[2]?"image/gif":"");for(k="data:"+f+";base64,";c<h.length;){k+=o.convertUTF8ArrayToBase64(h.subarray(c,Math.min(c+45000,h.length))),c+=45000}d(null,k)})};this.getEntries=function(){return J.slice()};z=-1;null===H?J=[]:runtime.readFile(K,"binary",function(d,a){"string"===typeof a&&(d="file was read as a string. Should be Uint8Array.");d||!a||0===a.length?H("File '"+K+"' cannot be read. Err: "+(d||"[none]"),A):(j=a,z=j.length,P(z-22,22,function(b,e){b||null===e?H(b,A):C(e,H)}))})};core.SimpleClientRect=null;gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}};gui.SessionConstraints=function(){function d(a){c.hasOwnProperty(a)||(c[a]=!1,b.register(a))}var c={},b=new core.EventNotifier;this.registerConstraint=d;this.subscribe=function(e,a){d(e);b.subscribe(e,a)};this.unsubscribe=function(e,a){b.unsubscribe(e,a)};this.setState=function(e,a){runtime.assert(!0===c.hasOwnProperty(e),"No such constraint");c[e]!==a&&(c[e]=a,b.emit(e,a))};this.getState=function(e){runtime.assert(!0===c.hasOwnProperty(e),"No such constraint");return c[e]}};gui.BlacklistNamespaceNodeFilter=function(e){var c={},b=NodeFilter.FILTER_REJECT,g=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(a){return !a||c.hasOwnProperty(a.namespaceURI)?b:g};(function(){e.forEach(function(d){c[d]=!0})})()};odf.Namespaces={namespaceMap:{config:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",math:"http://www.w3.org/1998/Math/MathML",meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xforms:"http://www.w3.org/2002/xforms",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},configns:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",mathns:"http://www.w3.org/1998/Math/MathML",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xformsns:"http://www.w3.org/2002/xforms",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"};(function(){var d=odf.Namespaces.namespaceMap,c=odf.Namespaces.prefixMap,b;for(b in d){d.hasOwnProperty(b)&&(c[d[b]]=b)}})();odf.Namespaces.forEachPrefix=function(d){var c=odf.Namespaces.namespaceMap,b;for(b in c){c.hasOwnProperty(b)&&d(b,c[b])}};odf.Namespaces.lookupNamespaceURI=function(b){var a=null;odf.Namespaces.namespaceMap.hasOwnProperty(b)&&(a=odf.Namespaces.namespaceMap[b]);return a};odf.Namespaces.lookupPrefix=function(b){var a=odf.Namespaces.prefixMap;return a.hasOwnProperty(b)?a[b]:null};odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI;(function(){odf.OdfSchemaImpl=function(){var b=[["config:config-item","uncategorized"],["form:item","object"],["form:option","uncategorized"],["math:math","field"],["meta:user-defined","uncategorized"],["number:currency-symbol","uncategorized"],["number:embedded-text","uncategorized"],["number:text","uncategorized"],["presentation:date-time-decl","uncategorized"],["presentation:footer-decl","uncategorized"],["presentation:header-decl","uncategorized"],["svg:desc","text"],["svg:title","text"],["table:desc","uncategorized"],["table:title","uncategorized"],["text:a","text"],["text:author-initials","field"],["text:author-name","field"],["text:bibliography-mark","field"],["text:bookmark-ref","field"],["text:chapter","field"],["text:character-count","field"],["text:conditional-text","field"],["text:creation-date","field"],["text:creation-time","field"],["text:creator","field"],["text:database-display","field"],["text:database-name","field"],["text:database-row-number","field"],["text:date","field"],["text:dde-connection","field"],["text:description","field"],["text:editing-cycles","field"],["text:editing-duration","field"],["text:execute-macro","uncategorized"],["text:expression","uncategorized"],["text:file-name","field"],["text:h","text"],["text:hidden-paragraph","text"],["text:hidden-text","text"],["text:image-count","field"],["text:index-entry-span","uncategorized"],["text:index-title-template","uncategorized"],["text:initial-creator","field"],["text:keywords","field"],["text:linenumbering-separator","style"],["text:measure","uncategorized"],["text:meta","uncategorized"],["text:meta-field","uncategorized"],["text:modification-date","field"],["text:modification-time","field"],["text:note-citation","field"],["text:note-continuation-notice-backward","style"],["text:note-continuation-notice-forward","style"],["text:note-ref","field"],["text:object-count","field"],["text:p","text"],["text:page-continuation","uncategorized"],["text:page-count","field"],["text:page-number","field"],["text:page-variable-get","field"],["text:page-variable-set","field"],["text:paragraph-count","field"],["text:placeholder","field"],["text:print-date","field"],["text:print-time","field"],["text:printed-by","field"],["text:reference-ref","field"],["text:ruby-base","text"],["text:ruby-text","text"],["text:script","text"],["text:sender-city","field"],["text:sender-company","field"],["text:sender-country","field"],["text:sender-email","field"],["text:sender-fax","field"],["text:sender-firstname","field"],["text:sender-initials","field"],["text:sender-lastname","field"],["text:sender-phone-private","field"],["text:sender-phone-work","field"],["text:sender-position","field"],["text:sender-postal-code","field"],["text:sender-state-or-province","field"],["text:sender-street","field"],["text:sender-title","field"],["text:sequence","uncategorized"],["text:sequence-ref","uncategorized"],["text:sheet-name","uncategorized"],["text:span","text"],["text:subject","field"],["text:table-count","field"],["text:table-formula","deprecated"],["text:template-name","uncategorized"],["text:text-input","field"],["text:time","field"],["text:title","field"],["text:user-defined","field"],["text:user-field-get","field"],["text:user-field-input","field"],["text:variable-get","field"],["text:variable-input","field"],["text:variable-set","field"],["text:word-count","field"],["xforms:model","uncategorized"]],a={};this.isTextContainer=function(c,e){return"text"===a[c+":"+e]};this.isField=function(c,e){return"field"===a[c+":"+e]};this.getFields=function(){return b.filter(function(c){return"field"===c[1]}).map(function(c){return c[0]})};(function(){b.forEach(function(e){var h=e[1],c=e[0].split(":");e=c[0];var c=c[1],g=odf.Namespaces.lookupNamespaceURI(e);g?a[g+":"+c]=h:runtime.log("DEBUG: OdfSchema - unknown prefix '"+e+"'")})})()};odf.OdfSchema=new odf.OdfSchemaImpl})();odf.OdfUtilsImpl=function(){function ap(b){return"image"===(b&&b.localName)&&b.namespaceURI===o}function am(b){return null!==b&&b.nodeType===Node.ELEMENT_NODE&&"frame"===b.localName&&b.namespaceURI===o&&"as-char"===b.getAttributeNS(i,"anchor-type")}function av(b){var d;(d="annotation"===(b&&b.localName)&&b.namespaceURI===odf.Namespaces.officens)||(d="div"===(b&&b.localName)&&"annotationWrapper"===b.className);return d}function ar(b){return"a"===(b&&b.localName)&&b.namespaceURI===i}function au(b){var d=b&&b.localName;return("p"===d||"h"===d)&&b.namespaceURI===i}function an(b,d){for(b&&void 0!==d&&!au(b)&&b.childNodes.item(d)&&(b=b.childNodes.item(d));b&&!au(b);){b=b.parentNode}return b}function aj(b,d){for(;b&&b!==d;){if(b.namespaceURI===odf.Namespaces.officens&&"annotation"===b.localName){return b}b=b.parentNode}return null}function ah(b){return/^[ \t\r\n]+$/.test(b)}function ak(b){if(null===b||b.nodeType!==Node.ELEMENT_NODE){return !1}var d=b.localName;return B.isTextContainer(b.namespaceURI,d)||"span"===d&&"webodf-annotationHighlight"===b.className}function al(b){return null===b||b.nodeType!==Node.ELEMENT_NODE?!1:B.isField(b.namespaceURI,b.localName)}function ag(e){var f=e&&e.localName,d=!1;f&&(e=e.namespaceURI,e===i&&(d="s"===f||"tab"===f||"line-break"===f));return d}function at(a){return ag(a)||al(a)||am(a)||av(a)}function aq(e){var f=e&&e.localName,d=!1;f&&(e=e.namespaceURI,e===i&&(d="s"===f));return d}function ai(b){return -1!==W.indexOf(b.namespaceURI)}function ao(b){if(ag(b)||al(b)){return !1}if(ak(b.parentNode)&&b.nodeType===Node.TEXT_NODE){return 0===b.textContent.length}for(b=b.firstChild;b;){if(ai(b)||!ao(b)){return !1}b=b.nextSibling}return !0}function aa(b){for(;null!==b.firstChild&&ak(b);){b=b.firstChild}return b}function ae(b){for(;null!==b.lastChild&&ak(b);){b=b.lastChild}return b}function Z(b){for(;!au(b)&&null===b.previousSibling;){b=b.parentNode}return au(b)?null:ae(b.previousSibling)}function ac(b){for(;!au(b)&&null===b.nextSibling;){b=b.parentNode}return au(b)?null:aa(b.nextSibling)}function af(d){for(var c=!1;d;){if(d.nodeType===Node.TEXT_NODE){if(0===d.length){d=Z(d)}else{return !ah(d.data.substr(d.length-1,1))}}else{at(d)?(c=!1===aq(d),d=null):d=Z(d)}}return c}function ab(d){var c=!1,f;for(d=d&&aa(d);d;){f=d.nodeType===Node.TEXT_NODE?d.length:0;if(0<f&&!ah(d.data)){c=!0;break}if(at(d)){c=!0;break}d=ac(d)}return c}function ad(b,d){return ah(b.data.substr(d))?!ab(ac(b)):!1}function X(d,c){var h=d.data,f;if(!ah(h[c])||at(d.parentNode)){return !1}0<c?ah(h[c-1])||(f=!0):af(Z(d))&&(f=!0);return !0===f?ad(d,c)?!1:!0:!1}function O(b){return(b=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(b))?{value:parseFloat(b[1]),unit:b[3]}:null}function S(b){return(b=O(b))&&(0>b.value||"%"===b.unit)?null:b}function R(b){return(b=O(b))&&"%"!==b.unit?null:b}function M(b){switch(b.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return !1;case odf.Namespaces.textns:switch(b.localName){case"note-body":case"ruby-text":return !1}break;case odf.Namespaces.officens:switch(b.localName){case"annotation":case"binary-data":case"event-listeners":return !1}break;default:switch(b.localName){case"cursor":case"editinfo":return !1}}return !0}function E(b,d){for(;0<d.length&&!j.rangeContainsNode(b,d[0]);){d.shift()}for(;0<d.length&&!j.rangeContainsNode(b,d[d.length-1]);){d.pop()}}function F(a,f,c){var h;h=j.getNodesInRange(a,function(d){var g=NodeFilter.FILTER_REJECT;if(ag(d.parentNode)||al(d.parentNode)||av(d)){g=NodeFilter.FILTER_REJECT}else{if(d.nodeType===Node.TEXT_NODE){if(c||Boolean(an(d)&&(!ah(d.textContent)||X(d,0)))){g=NodeFilter.FILTER_ACCEPT}}else{if(at(d)){g=NodeFilter.FILTER_ACCEPT}else{if(M(d)||ak(d)){g=NodeFilter.FILTER_SKIP}}}}return g},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);f||E(a,h);return h}function Q(f,a,d){for(;f;){if(d(f)){a[0]!==f&&a.unshift(f);break}if(av(f)){break}f=f.parentNode}}function V(e,f){var d=e;if(f<d.childNodes.length-1){d=d.childNodes[f+1]}else{for(;!d.nextSibling;){d=d.parentNode}d=d.nextSibling}for(;d.firstChild;){d=d.firstChild}return d}var i=odf.Namespaces.textns,o=odf.Namespaces.drawns,L=odf.Namespaces.xlinkns,j=core.DomUtils,W=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,odf.Namespaces.drawns,odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns],B=odf.OdfSchema;this.isImage=ap;this.isCharacterFrame=am;this.isInlineRoot=av;this.isTextSpan=function(b){return"span"===(b&&b.localName)&&b.namespaceURI===i};this.isHyperlink=ar;this.getHyperlinkTarget=function(b){return b.getAttributeNS(L,"href")||""};this.isParagraph=au;this.getParagraphElement=an;this.getParentAnnotation=aj;this.isWithinAnnotation=function(b,d){return Boolean(aj(b,d))};this.getAnnotationCreator=function(b){return b.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0].textContent};this.isListItem=function(b){return"list-item"===(b&&b.localName)&&b.namespaceURI===i};this.isLineBreak=function(b){return"line-break"===(b&&b.localName)&&b.namespaceURI===i};this.isODFWhitespace=ah;this.isGroupingElement=ak;this.isFieldElement=al;this.isCharacterElement=ag;this.isAnchoredAsCharacterElement=at;this.isSpaceElement=aq;this.isODFNode=ai;this.hasNoODFContent=ao;this.firstChild=aa;this.lastChild=ae;this.previousNode=Z;this.nextNode=ac;this.scanLeftForNonSpace=af;this.lookLeftForCharacter=function(d){var c,f=c=0;d.nodeType===Node.TEXT_NODE&&(f=d.length);0<f?(c=d.data,c=ah(c.substr(f-1,1))?1===f?af(Z(d))?2:0:ah(c.substr(f-2,1))?0:2:1):at(d)&&(c=1);return c};this.lookRightForCharacter=function(d){var c=!1,f=0;d&&d.nodeType===Node.TEXT_NODE&&(f=d.length);0<f?c=!ah(d.data.substr(0,1)):at(d)&&(c=!0);return c};this.scanLeftForAnyCharacter=function(d){var c=!1,f;for(d=d&&ae(d);d;){f=d.nodeType===Node.TEXT_NODE?d.length:0;if(0<f&&!ah(d.data)){c=!0;break}if(at(d)){c=!0;break}d=Z(d)}return c};this.scanRightForAnyCharacter=ab;this.isTrailingWhitespace=ad;this.isSignificantWhitespace=X;this.isDowngradableSpaceElement=function(b){return aq(b)?af(Z(b))&&ab(ac(b)):!1};this.parseLength=O;this.parseNonNegativeLength=S;this.parseFoFontSize=function(b){var d;d=(d=O(b))&&(0>=d.value||"%"===d.unit)?null:d;return d||R(b)};this.parseFoLineHeight=function(b){return S(b)||R(b)};this.isTextContentContainingNode=M;this.getTextNodes=function(e,f){var d;d=j.getNodesInRange(e,function(b){var g=NodeFilter.FILTER_REJECT;b.nodeType===Node.TEXT_NODE?Boolean(an(b)&&(!ah(b.textContent)||X(b,0)))&&(g=NodeFilter.FILTER_ACCEPT):M(b)&&(g=NodeFilter.FILTER_SKIP);return g},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);f||E(e,d);return d};this.getTextElements=F;this.getParagraphElements=function(b){var d;d=j.getNodesInRange(b,function(e){var f=NodeFilter.FILTER_REJECT;if(au(e)){f=NodeFilter.FILTER_ACCEPT}else{if(M(e)||ak(e)){f=NodeFilter.FILTER_SKIP}}return f},NodeFilter.SHOW_ELEMENT);Q(b.startContainer,d,au);return d};this.getImageElements=function(b){var d;d=j.getNodesInRange(b,function(e){var f=NodeFilter.FILTER_SKIP;ap(e)&&(f=NodeFilter.FILTER_ACCEPT);return f},NodeFilter.SHOW_ELEMENT);Q(b.startContainer,d,ap);return d};this.getHyperlinkElements=function(b){var f=[],d=b.cloneRange();b.collapsed&&b.endContainer.nodeType===Node.ELEMENT_NODE&&(b=V(b.endContainer,b.endOffset),b.nodeType===Node.TEXT_NODE&&d.setEnd(b,1));F(d,!0,!1).forEach(function(c){for(c=c.parentNode;!au(c);){if(ar(c)&&-1===f.indexOf(c)){f.push(c);break}c=c.parentNode}});d.detach();return f};this.getNormalizedFontFamilyName=function(b){/^(["'])(?:.|[\n\r])*?\1$/.test(b)||(b=b.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,"$1"),/[ \t\r\n\f]/.test(b)&&(b="'"+b.replace(/[ \t\r\n\f]+/g," ")+"'"));return b}};odf.OdfUtils=new odf.OdfUtilsImpl;gui.OdfTextBodyNodeFilter=function(){var h=odf.OdfUtils,g=Node.TEXT_NODE,e=NodeFilter.FILTER_REJECT,i=NodeFilter.FILTER_ACCEPT,c=odf.Namespaces.textns;this.acceptNode=function(a){if(a.nodeType===g){if(!h.isGroupingElement(a.parentNode)){return e}}else{if(a.namespaceURI===c&&"tracked-changes"===a.localName){return e}}return i}};xmldom.LSSerializerFilter=function(){};xmldom.LSSerializerFilter.prototype.acceptNode=function(a){};odf.OdfNodeFilter=function(){this.acceptNode=function(a){return"http://www.w3.org/1999/xhtml"===a.namespaceURI?NodeFilter.FILTER_SKIP:a.namespaceURI&&a.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}};xmldom.XPathIterator=function(){};xmldom.XPathIterator.prototype.next=function(){};xmldom.XPathIterator.prototype.reset=function(){};function createXPathSingleton(){function p(f,h,d){return -1!==f&&(f<h||-1===h)&&(f<d||-1===d)}function j(F){for(var D=[],E=0,B=F.length,A;E<B;){var y=F,v=B,l=D,f="",x=[],G=y.indexOf("[",E),J=y.indexOf("/",E),C=y.indexOf("=",E);p(J,G,C)?(f=y.substring(E,J),E=J+1):p(G,J,C)?(f=y.substring(E,G),E=i(y,G,x)):p(C,J,G)?(f=y.substring(E,C),E=C):(f=y.substring(E,v),E=v);l.push({location:f,predicates:x});if(E<B&&"="===F[E]){A=F.substring(E+1,B);if(2<A.length&&("'"===A[0]||'"'===A[0])){A=A.slice(1,A.length-1)}else{try{A=parseInt(A,10)}catch(I){}}E=B}}return{steps:D,value:A}}function t(){var b=null,d=!1;this.setNode=function(a){b=a};this.reset=function(){d=!1};this.next=function(){var a=d?null:b;d=!0;return a}}function r(f,h,d){this.reset=function(){f.reset()};this.next=function(){for(var a=f.next();a;){a.nodeType===Node.ELEMENT_NODE&&(a=a.getAttributeNodeNS(h,d));if(a){break}a=f.next()}return a}}function s(h,l){var f=h.next(),k=null;this.reset=function(){h.reset();f=h.next();k=null};this.next=function(){for(;f;){if(k){if(l&&k.firstChild){k=k.firstChild}else{for(;!k.nextSibling&&k!==f;){k=k.parentNode}k===f?f=h.next():k=k.nextSibling}}else{do{(k=f.firstChild)||(f=h.next())}while(f&&!k)}if(k&&k.nodeType===Node.ELEMENT_NODE){return k}}return null}}function o(b,d){this.reset=function(){b.reset()};this.next=function(){for(var a=b.next();a&&!d(a);){a=b.next()}return a}}function e(h,f,l){f=f.split(":",2);var m=l(f[0]),k=f[1];return new o(h,function(b){return b.localName===k&&b.namespaceURI===m})}function c(a,n,l){var m=new t,h=g(m,n,l),k=n.value;return void 0===k?new o(a,function(b){m.setNode(b);h.reset();return null!==h.next()}):new o(a,function(b){m.setNode(b);h.reset();return(b=h.next())?b.nodeValue===k:!1})}var g,i;i=function(k,h,n){for(var q=h,l=k.length,m=0;q<l;){"]"===k[q]?(m-=1,0>=m&&n.push(j(k.substring(h,q)))):"["===k[q]&&(0>=m&&(h=q+1),m+=1),q+=1}return q};g=function(d,u,q){var n,m,k,b;for(n=0;n<u.steps.length;n+=1){k=u.steps[n];m=k.location;if(""===m){d=new s(d,!1)}else{if("@"===m[0]){m=m.substr(1).split(":",2);b=q(m[0]);if(!b){throw"No namespace associated with the prefix "+m[0]}d=new r(d,b,m[1])}else{"."!==m&&(d=new s(d,!1),-1!==m.indexOf(":")&&(d=e(d,m,q)))}}for(m=0;m<k.predicates.length;m+=1){b=k.predicates[m],d=c(d,b,q)}}return d};return{getODFElementsWithXPath:function(a,n,l){var m=a.ownerDocument,h=[],k=null;if(m&&"function"===typeof m.evaluate){for(l=m.evaluate(n,a,l,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),k=l.iterateNext();null!==k;){k.nodeType===Node.ELEMENT_NODE&&h.push(k),k=l.iterateNext()}}else{h=new t;h.setNode(a);a=j(n);h=g(h,a,l);a=[];for(l=h.next();l;){a.push(l),l=h.next()}h=a}return h}}}xmldom.XPath=createXPathSingleton();odf.StyleInfo=function(){function U(k,f){var s,q,r,m,n,l=0;if(s=K[k.localName]){if(r=s[k.namespaceURI]){l=r.length}}for(s=0;s<l;s+=1){q=r[s],m=q.ns,n=q.localname,(q=k.getAttributeNS(m,n))&&k.setAttributeNS(m,i[m]+n,f+q)}for(r=k.firstElementChild;r;){U(r,f),r=r.nextElementSibling}}function R(k,h){var s,q,r,l,m,n=0;if(s=K[k.localName]){if(r=s[k.namespaceURI]){n=r.length}}for(s=0;s<n;s+=1){if(q=r[s],l=q.ns,m=q.localname,q=k.getAttributeNS(l,m)){q=q.replace(h,""),k.setAttributeNS(l,i[l]+m,q)}}for(r=k.firstElementChild;r;){R(r,h),r=r.nextElementSibling}}function Z(k,h){var s,q,r,l,m,n=0;if(s=K[k.localName]){if(r=s[k.namespaceURI]){n=r.length}}for(s=0;s<n;s+=1){if(l=r[s],q=l.ns,m=l.localname,q=k.getAttributeNS(q,m)){h=h||{},l=l.keyname,h.hasOwnProperty(l)?h[l][q]=1:(m={},m[q]=1,h[l]=m)}}return h}function W(a,h){var f,d;Z(a,h);for(f=a.firstChild;f;){f.nodeType===Node.ELEMENT_NODE&&(d=f,W(d,h)),f=f.nextSibling}}function Y(e,d,f){this.key=e;this.name=d;this.family=f;this.requires={}}function S(b,l,h){var k=b+'"'+l,f=h[k];f||(f=h[k]=new Y(k,b,l));return f}function O(u,t,s){var q,r,m,n,h,k=0;q=u.getAttributeNS(J,"name");n=u.getAttributeNS(J,"family");q&&n&&(t=S(q,n,s));if(t){if(q=K[u.localName]){if(m=q[u.namespaceURI]){k=m.length}}for(q=0;q<k;q+=1){if(n=m[q],r=n.ns,h=n.localname,r=u.getAttributeNS(r,h)){n=n.keyname,n=S(r,n,s),t.requires[n.key]=n}}}for(u=u.firstElementChild;u;){O(u,t,s),u=u.nextElementSibling}return s}function M(e,d){var f=d[e.family];f||(f=d[e.family]={});f[e.name]=1;Object.keys(e.requires).forEach(function(a){M(e.requires[a],d)})}function P(e,d){var f=O(e,null,{});Object.keys(f).forEach(function(b){b=f[b];var c=d[b.family];c&&c.hasOwnProperty(b.name)&&M(b,d)})}function Q(h,f){function n(a){(a=k.getAttributeNS(J,a))&&(h[a]=!0)}var l=["font-name","font-name-asian","font-name-complex"],m,k;for(m=f&&f.firstElementChild;m;){k=m,l.forEach(n),Q(h,k),m=m.nextElementSibling}}function L(h,f){function n(b){var c=k.getAttributeNS(J,b);c&&f.hasOwnProperty(c)&&k.setAttributeNS(J,"style:"+b,f[c])}var l=["font-name","font-name-asian","font-name-complex"],m,k;for(m=h&&h.firstElementChild;m;){k=m,l.forEach(n),L(k,f),m=m.nextElementSibling}}var X=odf.Namespaces.chartns,V=odf.Namespaces.dbns,N=odf.Namespaces.dr3dns,T=odf.Namespaces.drawns,o=odf.Namespaces.formns,G=odf.Namespaces.numberns,j=odf.Namespaces.officens,E=odf.Namespaces.presentationns,J=odf.Namespaces.stylens,B=odf.Namespaces.tablens,F=odf.Namespaces.textns,i={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:","urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:","urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},A={text:[{ens:J,en:"tab-stop",ans:J,a:"leader-text-style"},{ens:J,en:"drop-cap",ans:J,a:"style-name"},{ens:F,en:"notes-configuration",ans:F,a:"citation-body-style-name"},{ens:F,en:"notes-configuration",ans:F,a:"citation-style-name"},{ens:F,en:"a",ans:F,a:"style-name"},{ens:F,en:"alphabetical-index",ans:F,a:"style-name"},{ens:F,en:"linenumbering-configuration",ans:F,a:"style-name"},{ens:F,en:"list-level-style-number",ans:F,a:"style-name"},{ens:F,en:"ruby-text",ans:F,a:"style-name"},{ens:F,en:"span",ans:F,a:"style-name"},{ens:F,en:"a",ans:F,a:"visited-style-name"},{ens:J,en:"text-properties",ans:J,a:"text-line-through-text-style"},{ens:F,en:"alphabetical-index-source",ans:F,a:"main-entry-style-name"},{ens:F,en:"index-entry-bibliography",ans:F,a:"style-name"},{ens:F,en:"index-entry-chapter",ans:F,a:"style-name"},{ens:F,en:"index-entry-link-end",ans:F,a:"style-name"},{ens:F,en:"index-entry-link-start",ans:F,a:"style-name"},{ens:F,en:"index-entry-page-number",ans:F,a:"style-name"},{ens:F,en:"index-entry-span",ans:F,a:"style-name"},{ens:F,en:"index-entry-tab-stop",ans:F,a:"style-name"},{ens:F,en:"index-entry-text",ans:F,a:"style-name"},{ens:F,en:"index-title-template",ans:F,a:"style-name"},{ens:F,en:"list-level-style-bullet",ans:F,a:"style-name"},{ens:F,en:"outline-level-style",ans:F,a:"style-name"}],paragraph:[{ens:T,en:"caption",ans:T,a:"text-style-name"},{ens:T,en:"circle",ans:T,a:"text-style-name"},{ens:T,en:"connector",ans:T,a:"text-style-name"},{ens:T,en:"control",ans:T,a:"text-style-name"},{ens:T,en:"custom-shape",ans:T,a:"text-style-name"},{ens:T,en:"ellipse",ans:T,a:"text-style-name"},{ens:T,en:"frame",ans:T,a:"text-style-name"},{ens:T,en:"line",ans:T,a:"text-style-name"},{ens:T,en:"measure",ans:T,a:"text-style-name"},{ens:T,en:"path",ans:T,a:"text-style-name"},{ens:T,en:"polygon",ans:T,a:"text-style-name"},{ens:T,en:"polyline",ans:T,a:"text-style-name"},{ens:T,en:"rect",ans:T,a:"text-style-name"},{ens:T,en:"regular-polygon",ans:T,a:"text-style-name"},{ens:j,en:"annotation",ans:T,a:"text-style-name"},{ens:o,en:"column",ans:o,a:"text-style-name"},{ens:J,en:"style",ans:J,a:"next-style-name"},{ens:B,en:"body",ans:B,a:"paragraph-style-name"},{ens:B,en:"even-columns",ans:B,a:"paragraph-style-name"},{ens:B,en:"even-rows",ans:B,a:"paragraph-style-name"},{ens:B,en:"first-column",ans:B,a:"paragraph-style-name"},{ens:B,en:"first-row",ans:B,a:"paragraph-style-name"},{ens:B,en:"last-column",ans:B,a:"paragraph-style-name"},{ens:B,en:"last-row",ans:B,a:"paragraph-style-name"},{ens:B,en:"odd-columns",ans:B,a:"paragraph-style-name"},{ens:B,en:"odd-rows",ans:B,a:"paragraph-style-name"},{ens:F,en:"notes-configuration",ans:F,a:"default-style-name"},{ens:F,en:"alphabetical-index-entry-template",ans:F,a:"style-name"},{ens:F,en:"bibliography-entry-template",ans:F,a:"style-name"},{ens:F,en:"h",ans:F,a:"style-name"},{ens:F,en:"illustration-index-entry-template",ans:F,a:"style-name"},{ens:F,en:"index-source-style",ans:F,a:"style-name"},{ens:F,en:"object-index-entry-template",ans:F,a:"style-name"},{ens:F,en:"p",ans:F,a:"style-name"},{ens:F,en:"table-index-entry-template",ans:F,a:"style-name"},{ens:F,en:"table-of-content-entry-template",ans:F,a:"style-name"},{ens:F,en:"table-index-entry-template",ans:F,a:"style-name"},{ens:F,en:"user-index-entry-template",ans:F,a:"style-name"},{ens:J,en:"page-layout-properties",ans:J,a:"register-truth-ref-style-name"}],chart:[{ens:X,en:"axis",ans:X,a:"style-name"},{ens:X,en:"chart",ans:X,a:"style-name"},{ens:X,en:"data-label",ans:X,a:"style-name"},{ens:X,en:"data-point",ans:X,a:"style-name"},{ens:X,en:"equation",ans:X,a:"style-name"},{ens:X,en:"error-indicator",ans:X,a:"style-name"},{ens:X,en:"floor",ans:X,a:"style-name"},{ens:X,en:"footer",ans:X,a:"style-name"},{ens:X,en:"grid",ans:X,a:"style-name"},{ens:X,en:"legend",ans:X,a:"style-name"},{ens:X,en:"mean-value",ans:X,a:"style-name"},{ens:X,en:"plot-area",ans:X,a:"style-name"},{ens:X,en:"regression-curve",ans:X,a:"style-name"},{ens:X,en:"series",ans:X,a:"style-name"},{ens:X,en:"stock-gain-marker",ans:X,a:"style-name"},{ens:X,en:"stock-loss-marker",ans:X,a:"style-name"},{ens:X,en:"stock-range-line",ans:X,a:"style-name"},{ens:X,en:"subtitle",ans:X,a:"style-name"},{ens:X,en:"title",ans:X,a:"style-name"},{ens:X,en:"wall",ans:X,a:"style-name"}],section:[{ens:F,en:"alphabetical-index",ans:F,a:"style-name"},{ens:F,en:"bibliography",ans:F,a:"style-name"},{ens:F,en:"illustration-index",ans:F,a:"style-name"},{ens:F,en:"index-title",ans:F,a:"style-name"},{ens:F,en:"object-index",ans:F,a:"style-name"},{ens:F,en:"section",ans:F,a:"style-name"},{ens:F,en:"table-of-content",ans:F,a:"style-name"},{ens:F,en:"table-index",ans:F,a:"style-name"},{ens:F,en:"user-index",ans:F,a:"style-name"}],ruby:[{ens:F,en:"ruby",ans:F,a:"style-name"}],table:[{ens:V,en:"query",ans:V,a:"style-name"},{ens:V,en:"table-representation",ans:V,a:"style-name"},{ens:B,en:"background",ans:B,a:"style-name"},{ens:B,en:"table",ans:B,a:"style-name"}],"table-column":[{ens:V,en:"column",ans:V,a:"style-name"},{ens:B,en:"table-column",ans:B,a:"style-name"}],"table-row":[{ens:V,en:"query",ans:V,a:"default-row-style-name"},{ens:V,en:"table-representation",ans:V,a:"default-row-style-name"},{ens:B,en:"table-row",ans:B,a:"style-name"}],"table-cell":[{ens:V,en:"column",ans:V,a:"default-cell-style-name"},{ens:B,en:"table-column",ans:B,a:"default-cell-style-name"},{ens:B,en:"table-row",ans:B,a:"default-cell-style-name"},{ens:B,en:"body",ans:B,a:"style-name"},{ens:B,en:"covered-table-cell",ans:B,a:"style-name"},{ens:B,en:"even-columns",ans:B,a:"style-name"},{ens:B,en:"covered-table-cell",ans:B,a:"style-name"},{ens:B,en:"even-columns",ans:B,a:"style-name"},{ens:B,en:"even-rows",ans:B,a:"style-name"},{ens:B,en:"first-column",ans:B,a:"style-name"},{ens:B,en:"first-row",ans:B,a:"style-name"},{ens:B,en:"last-column",ans:B,a:"style-name"},{ens:B,en:"last-row",ans:B,a:"style-name"},{ens:B,en:"odd-columns",ans:B,a:"style-name"},{ens:B,en:"odd-rows",ans:B,a:"style-name"},{ens:B,en:"table-cell",ans:B,a:"style-name"}],graphic:[{ens:N,en:"cube",ans:T,a:"style-name"},{ens:N,en:"extrude",ans:T,a:"style-name"},{ens:N,en:"rotate",ans:T,a:"style-name"},{ens:N,en:"scene",ans:T,a:"style-name"},{ens:N,en:"sphere",ans:T,a:"style-name"},{ens:T,en:"caption",ans:T,a:"style-name"},{ens:T,en:"circle",ans:T,a:"style-name"},{ens:T,en:"connector",ans:T,a:"style-name"},{ens:T,en:"control",ans:T,a:"style-name"},{ens:T,en:"custom-shape",ans:T,a:"style-name"},{ens:T,en:"ellipse",ans:T,a:"style-name"},{ens:T,en:"frame",ans:T,a:"style-name"},{ens:T,en:"g",ans:T,a:"style-name"},{ens:T,en:"line",ans:T,a:"style-name"},{ens:T,en:"measure",ans:T,a:"style-name"},{ens:T,en:"page-thumbnail",ans:T,a:"style-name"},{ens:T,en:"path",ans:T,a:"style-name"},{ens:T,en:"polygon",ans:T,a:"style-name"},{ens:T,en:"polyline",ans:T,a:"style-name"},{ens:T,en:"rect",ans:T,a:"style-name"},{ens:T,en:"regular-polygon",ans:T,a:"style-name"},{ens:j,en:"annotation",ans:T,a:"style-name"}],presentation:[{ens:N,en:"cube",ans:E,a:"style-name"},{ens:N,en:"extrude",ans:E,a:"style-name"},{ens:N,en:"rotate",ans:E,a:"style-name"},{ens:N,en:"scene",ans:E,a:"style-name"},{ens:N,en:"sphere",ans:E,a:"style-name"},{ens:T,en:"caption",ans:E,a:"style-name"},{ens:T,en:"circle",ans:E,a:"style-name"},{ens:T,en:"connector",ans:E,a:"style-name"},{ens:T,en:"control",ans:E,a:"style-name"},{ens:T,en:"custom-shape",ans:E,a:"style-name"},{ens:T,en:"ellipse",ans:E,a:"style-name"},{ens:T,en:"frame",ans:E,a:"style-name"},{ens:T,en:"g",ans:E,a:"style-name"},{ens:T,en:"line",ans:E,a:"style-name"},{ens:T,en:"measure",ans:E,a:"style-name"},{ens:T,en:"page-thumbnail",ans:E,a:"style-name"},{ens:T,en:"path",ans:E,a:"style-name"},{ens:T,en:"polygon",ans:E,a:"style-name"},{ens:T,en:"polyline",ans:E,a:"style-name"},{ens:T,en:"rect",ans:E,a:"style-name"},{ens:T,en:"regular-polygon",ans:E,a:"style-name"},{ens:j,en:"annotation",ans:E,a:"style-name"}],"drawing-page":[{ens:T,en:"page",ans:T,a:"style-name"},{ens:E,en:"notes",ans:T,a:"style-name"},{ens:J,en:"handout-master",ans:T,a:"style-name"},{ens:J,en:"master-page",ans:T,a:"style-name"}],"list-style":[{ens:F,en:"list",ans:F,a:"style-name"},{ens:F,en:"numbered-paragraph",ans:F,a:"style-name"},{ens:F,en:"list-item",ans:F,a:"style-override"},{ens:J,en:"style",ans:J,a:"list-style-name"}],data:[{ens:J,en:"style",ans:J,a:"data-style-name"},{ens:J,en:"style",ans:J,a:"percentage-data-style-name"},{ens:E,en:"date-time-decl",ans:J,a:"data-style-name"},{ens:F,en:"creation-date",ans:J,a:"data-style-name"},{ens:F,en:"creation-time",ans:J,a:"data-style-name"},{ens:F,en:"database-display",ans:J,a:"data-style-name"},{ens:F,en:"date",ans:J,a:"data-style-name"},{ens:F,en:"editing-duration",ans:J,a:"data-style-name"},{ens:F,en:"expression",ans:J,a:"data-style-name"},{ens:F,en:"meta-field",ans:J,a:"data-style-name"},{ens:F,en:"modification-date",ans:J,a:"data-style-name"},{ens:F,en:"modification-time",ans:J,a:"data-style-name"},{ens:F,en:"print-date",ans:J,a:"data-style-name"},{ens:F,en:"print-time",ans:J,a:"data-style-name"},{ens:F,en:"table-formula",ans:J,a:"data-style-name"},{ens:F,en:"time",ans:J,a:"data-style-name"},{ens:F,en:"user-defined",ans:J,a:"data-style-name"},{ens:F,en:"user-field-get",ans:J,a:"data-style-name"},{ens:F,en:"user-field-input",ans:J,a:"data-style-name"},{ens:F,en:"variable-get",ans:J,a:"data-style-name"},{ens:F,en:"variable-input",ans:J,a:"data-style-name"},{ens:F,en:"variable-set",ans:J,a:"data-style-name"}],"page-layout":[{ens:E,en:"notes",ans:J,a:"page-layout-name"},{ens:J,en:"handout-master",ans:J,a:"page-layout-name"},{ens:J,en:"master-page",ans:J,a:"page-layout-name"}]},K,I=xmldom.XPath;this.collectUsedFontFaces=Q;this.changeFontFaceNames=L;this.UsedStyleList=function(e,d){var f={};this.uses=function(g){var c=g.localName,h=g.getAttributeNS(T,"name")||g.getAttributeNS(J,"name");g="style"===c?g.getAttributeNS(J,"family"):g.namespaceURI===G?"data":c;return(g=f[g])?0<g[h]:!1};W(e,f);d&&P(d,f)};this.getStyleName=function(g,f){var l,h,k=K[f.localName];if(k&&(k=k[f.namespaceURI])){for(h=0;h<k.length;h+=1){if(k[h].keyname===g&&(k=k[h],f.hasAttributeNS(k.ns,k.localname))){l=f.getAttributeNS(k.ns,k.localname);break}}}return l};this.hasDerivedStyles=function(f,d,h){var g=h.getAttributeNS(J,"name");h=h.getAttributeNS(J,"family");return I.getODFElementsWithXPath(f,'//style:*[@style:parent-style-name="'+g+'"][@style:family="'+h+'"]',d).length?!0:!1};this.prefixStyleNames=function(k,f,s){var q;if(k){for(q=k.firstChild;q;){if(q.nodeType===Node.ELEMENT_NODE){var r=q,n=f,m=r.getAttributeNS(T,"name"),g=void 0;m?g=T:(m=r.getAttributeNS(J,"name"))&&(g=J);g&&r.setAttributeNS(g,i[g]+"name",n+m)}q=q.nextSibling}U(k,f);s&&U(s,f)}};this.removePrefixFromStyleNames=function(k,g,s){var q=RegExp("^"+g);if(k){for(g=k.firstChild;g;){if(g.nodeType===Node.ELEMENT_NODE){var r=g,m=q,n=r.getAttributeNS(T,"name"),l=void 0;n?l=T:(n=r.getAttributeNS(J,"name"))&&(l=J);l&&(n=n.replace(m,""),r.setAttributeNS(l,i[l]+"name",n))}g=g.nextSibling}R(k,q);s&&R(s,q)}};this.determineStylesForNode=Z;K=function(){var w,v,u,s,t,q={},r,k,n,m;for(u in A){if(A.hasOwnProperty(u)){for(s=A[u],v=s.length,w=0;w<v;w+=1){t=s[w],n=t.en,m=t.ens,q.hasOwnProperty(n)?r=q[n]:q[n]=r={},r.hasOwnProperty(m)?k=r[m]:r[m]=k=[],k.push({ns:t.ans,localname:t.a,keyname:u})}}}return q}()};"function"!==typeof Object.create&&(Object.create=function(b){var a=function(){};a.prototype=b;return new a});xmldom.LSSerializer=function(){function e(j){var o=j||{},n=function(f){var d={},l;for(l in f){f.hasOwnProperty(l)&&(d[f[l]]=l)}return d}(j),k=[o],h=[n],i=0;this.push=function(){i+=1;o=k[i]=Object.create(o);n=h[i]=Object.create(n)};this.pop=function(){k.pop();h.pop();i-=1;o=k[i];n=h[i]};this.getLocalNamespaceDefinitions=function(){return n};this.getQName=function(f){var d=f.namespaceURI,m=0,l;if(!d){return f.localName}if(l=n[d]){return l+":"+f.localName}do{l||!f.prefix?(l="ns"+m,m+=1):l=f.prefix;if(o[l]===d){break}if(!o[l]){o[l]=d;n[d]=l;break}l=null}while(null===l);return l+":"+f.localName}}function c(d){return d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function b(v,s){var i="",d=g.filter?g.filter.acceptNode(s):NodeFilter.FILTER_ACCEPT,j;if(d===NodeFilter.FILTER_ACCEPT&&s.nodeType===Node.ELEMENT_NODE){v.push();j=v.getQName(s);var k,a=s.attributes,u,t,h,o="",w;k="<"+j;u=a.length;for(t=0;t<u;t+=1){h=a.item(t),"http://www.w3.org/2000/xmlns/"!==h.namespaceURI&&(w=g.filter?g.filter.acceptNode(h):NodeFilter.FILTER_ACCEPT,w===NodeFilter.FILTER_ACCEPT&&(w=v.getQName(h),h="string"===typeof h.value?c(h.value):h.value,o+=" "+(w+'="'+h+'"')))}u=v.getLocalNamespaceDefinitions();for(t in u){u.hasOwnProperty(t)&&((a=u[t])?"xmlns"!==a&&(k+=" xmlns:"+u[t]+'="'+t+'"'):k+=' xmlns="'+t+'"')}i+=k+(o+">")}if(d===NodeFilter.FILTER_ACCEPT||d===NodeFilter.FILTER_SKIP){for(d=s.firstChild;d;){i+=b(v,d),d=d.nextSibling}s.nodeValue&&(i+=c(s.nodeValue))}j&&(i+="</"+j+">",v.pop());return i}var g=this;this.filter=null;this.writeToString=function(a,f){if(!a){return""}var h=new e(f);return b(h,a)}};(function(){function r(d){var c,f=e.length;for(c=0;c<f;c+=1){if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===d.namespaceURI&&d.localName===e[c]){return c}}return -1}function o(b,k){var f=new u.UsedStyleList(b,k),h=new odf.OdfNodeFilter;this.acceptNode=function(d){var c=h.acceptNode(d);c===NodeFilter.FILTER_ACCEPT&&d.parentNode===k&&d.nodeType===Node.ELEMENT_NODE&&(c=f.uses(d)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);return c}}function v(d,c){var f=new o(d,c);this.acceptNode=function(k){var h=f.acceptNode(k);h!==NodeFilter.FILTER_ACCEPT||!k.parentNode||k.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==k.parentNode.localName&&"tab"!==k.parentNode.localName||(h=NodeFilter.FILTER_REJECT);return h}}function s(f,c){if(c){var k=r(c),l,h=f.firstChild;if(-1!==k){for(;h;){l=r(h);if(-1!==l&&l>k){break}h=h.nextSibling}f.insertBefore(c,h)}}}var u=new odf.StyleInfo,p=core.DomUtils,g=odf.Namespaces.stylens,e="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),i=Date.now()+"_webodf_",j=new core.Base64;odf.ODFElement=function(){};odf.ODFDocumentElement=function(){};odf.ODFDocumentElement.prototype=new odf.ODFElement;odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement;odf.ODFDocumentElement.prototype.fontFaceDecls=null;odf.ODFDocumentElement.prototype.manifest=null;odf.ODFDocumentElement.prototype.settings=null;odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0";odf.ODFDocumentElement.localName="document";odf.AnnotationElement=function(){};odf.OdfPart=function(f,c,k,l){var h=this;this.size=0;this.type=null;this.name=f;this.container=k;this.url=null;this.mimetype=c;this.onstatereadychange=this.document=null;this.EMPTY=0;this.LOADING=1;this.DONE=2;this.state=this.EMPTY;this.data="";this.load=function(){null!==l&&(this.mimetype=c,l.loadAsDataURL(f,c,function(m,d){m&&runtime.log(m);h.url=d;if(h.onchange){h.onchange(h)}if(h.onstatereadychange){h.onstatereadychange(h)}}))}};odf.OdfPart.prototype.load=function(){};odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+j.toBase64(this.data):null};odf.OdfContainer=function t(ax,aw){function av(q){for(var f=q.firstChild,w;f;){w=f.nextSibling,f.nodeType===Node.ELEMENT_NODE?av(f):f.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&q.removeChild(f),f=w}}function au(q){var f={},z,w,y=q.ownerDocument.createNodeIterator(q,NodeFilter.SHOW_ELEMENT,null,!1);for(q=y.nextNode();q;){"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===q.namespaceURI&&("annotation"===q.localName?(z=q.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(f.hasOwnProperty(z)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+z+"'"):f[z]=q):"annotation-end"===q.localName&&((z=q.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))?f.hasOwnProperty(z)?(w=f[z],w.annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+z+"'"):w.annotationEndElement=q):runtime.log("Warning: annotation end without an annotation start, name: '"+z+"'"):runtime.log("Warning: annotation end without a name found"))),q=y.nextNode()}}function ar(q,f){for(var w=q&&q.firstChild;w;){w.nodeType===Node.ELEMENT_NODE&&w.setAttributeNS("urn:webodf:names:scope","scope",f),w=w.nextSibling}}function an(q,f){for(var w=ad.rootElement.meta,w=w&&w.firstChild;w&&(w.namespaceURI!==q||w.localName!==f);){w=w.nextSibling}for(w=w&&w.firstChild;w&&w.nodeType!==Node.TEXT_NODE;){w=w.nextSibling}return w?w.data:null}function ap(q){var f={},w;for(q=q.firstChild;q;){q.nodeType===Node.ELEMENT_NODE&&q.namespaceURI===g&&"font-face"===q.localName&&(w=q.getAttributeNS(g,"name"),f[w]=q),q=q.nextSibling}return f}function at(q,f){var A=null,y,z,w;if(q){for(A=q.cloneNode(!0),y=A.firstElementChild;y;){z=y.nextElementSibling,(w=y.getAttributeNS("urn:webodf:names:scope","scope"))&&w!==f&&A.removeChild(y),y=z}}return A}function ao(q,C){var A,B,w,y=null,z={};if(q){for(C.forEach(function(f){u.collectUsedFontFaces(z,f)}),y=q.cloneNode(!0),A=y.firstElementChild;A;){B=A.nextElementSibling,w=A.getAttributeNS(g,"name"),z[w]||y.removeChild(A),A=B}}return y}function aq(q){var f=ad.rootElement.ownerDocument,y;if(q){av(q.documentElement);try{y=f.importNode(q.documentElement,!0)}catch(w){}}return y}function am(f){ad.state=f;if(ad.onchange){ad.onchange(ad)}if(ad.onstatereadychange){ad.onstatereadychange(ad)}}function ab(f){ak=null;ad.rootElement=f;f.fontFaceDecls=p.getDirectChild(f,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");f.styles=p.getDirectChild(f,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles");f.automaticStyles=p.getDirectChild(f,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");f.masterStyles=p.getDirectChild(f,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles");f.body=p.getDirectChild(f,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");f.meta=p.getDirectChild(f,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta");f.settings=p.getDirectChild(f,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings");f.scripts=p.getDirectChild(f,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts");au(f)}function ag(q){var z=aq(q),w=ad.rootElement,y;z&&"document-styles"===z.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===z.namespaceURI?(w.fontFaceDecls=p.getDirectChild(z,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),s(w,w.fontFaceDecls),y=p.getDirectChild(z,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),w.styles=y||q.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),s(w,w.styles),y=p.getDirectChild(z,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),w.automaticStyles=y||q.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),ar(w.automaticStyles,"document-styles"),s(w,w.automaticStyles),z=p.getDirectChild(z,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),w.masterStyles=z||q.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),s(w,w.masterStyles),u.prefixStyleNames(w.automaticStyles,i,w.masterStyles)):am(t.INVALID)}function af(N){N=aq(N);var H,E,F,y;if(N&&"document-content"===N.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===N.namespaceURI){H=ad.rootElement;F=p.getDirectChild(N,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");if(H.fontFaceDecls&&F){y=H.fontFaceDecls;var C,B,w,D,I={};E=ap(y);D=ap(F);for(F=F.firstElementChild;F;){C=F.nextElementSibling;if(F.namespaceURI===g&&"font-face"===F.localName){if(B=F.getAttributeNS(g,"name"),E.hasOwnProperty(B)){if(!F.isEqualNode(E[B])){w=B;for(var P=E,Q=D,z=0,J=void 0,J=w=w.replace(/\d+$/,"");P.hasOwnProperty(J)||Q.hasOwnProperty(J);){z+=1,J=w+z}w=J;F.setAttributeNS(g,"style:name",w);y.appendChild(F);E[w]=F;delete D[B];I[B]=w}}else{y.appendChild(F),E[B]=F,delete D[B]}}F=C}y=I}else{F&&(H.fontFaceDecls=F,s(H,F))}E=p.getDirectChild(N,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");ar(E,"document-content");y&&u.changeFontFaceNames(E,y);if(H.automaticStyles&&E){for(y=E.firstChild;y;){H.automaticStyles.appendChild(y),y=E.firstChild}}else{E&&(H.automaticStyles=E,s(H,E))}N=p.getDirectChild(N,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");if(null===N){throw"<office:body/> tag is mising."}H.body=N;s(H,H.body)}else{am(t.INVALID)}}function W(q){q=aq(q);var f;q&&"document-meta"===q.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===q.namespaceURI&&(f=ad.rootElement,f.meta=p.getDirectChild(q,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),s(f,f.meta))}function L(q){q=aq(q);var f;q&&"document-settings"===q.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===q.namespaceURI&&(f=ad.rootElement,f.settings=p.getDirectChild(q,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),s(f,f.settings))}function M(q){q=aq(q);var f;if(q&&"manifest"===q.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===q.namespaceURI){for(f=ad.rootElement,f.manifest=q,q=f.manifest.firstElementChild;q;){"file-entry"===q.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===q.namespaceURI&&(m[q.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=q.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),q=q.nextElementSibling}}}function ac(q,f,y){q=p.getElementsByTagName(q,f);var w;for(w=0;w<q.length;w+=1){f=q[w],y.hasOwnProperty(f.namespaceURI)||f.parentNode.removeChild(f)}}function ai(f){ac(f,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0});ac(f,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function b(w){var q=w.firstElementChild,D=[],B,C,y,z=w.attributes,A=z.length;for(B=0;B<A;B+=1){y=z.item(B),C=y.localName.substr(0,2).toLowerCase(),null===y.namespaceURI&&"on"===C&&D.push(y)}A=D.length;for(B=0;B<A;B+=1){w.removeAttributeNode(D[B])}for(;q;){b(q),q=q.nextElementSibling}}function k(q){var f=q.shift();f?c.loadAsDOM(f.path,function(w,y){y&&(ai(y),b(y.documentElement));f.handler(y);ad.state===t.INVALID?w?runtime.log("ERROR: Unable to load "+f.path+" - "+w):runtime.log("ERROR: Unable to load "+f.path):(w&&runtime.log("DEBUG: Unable to load "+f.path+" - "+w),k(q))}):(au(ad.rootElement),am(t.DONE))}function O(q){var f="";odf.Namespaces.forEachPrefix(function(w,y){f+=" xmlns:"+w+'="'+y+'"'});return'<?xml version="1.0" encoding="UTF-8"?><office:'+q+" "+f+' office:version="1.2">'}function h(){var q=new xmldom.LSSerializer,f=O("document-meta");q.filter=new odf.OdfNodeFilter;f+=q.writeToString(ad.rootElement.meta,odf.Namespaces.namespaceMap);return f+"</office:document-meta>"}function aj(q,f){var w=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");w.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",q);w.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:media-type",f);return w}function x(){var q=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),f=q.documentElement,y=new xmldom.LSSerializer,w;for(w in m){m.hasOwnProperty(w)&&f.appendChild(aj(w,m[w]))}y.filter=new odf.OdfNodeFilter;return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+y.writeToString(q,odf.Namespaces.namespaceMap)}function ae(){var q,B,z,A=odf.Namespaces.namespaceMap,w=new xmldom.LSSerializer,y=O("document-styles");B=at(ad.rootElement.automaticStyles,"document-styles");z=ad.rootElement.masterStyles.cloneNode(!0);q=ao(ad.rootElement.fontFaceDecls,[z,ad.rootElement.styles,B]);u.removePrefixFromStyleNames(B,i,z);w.filter=new o(z,B);y+=w.writeToString(q,A);y+=w.writeToString(ad.rootElement.styles,A);y+=w.writeToString(B,A);y+=w.writeToString(z,A);return y+"</office:document-styles>"}function n(){var f,z,w=odf.Namespaces.namespaceMap,y=new xmldom.LSSerializer,q=O("document-content");z=at(ad.rootElement.automaticStyles,"document-content");f=ao(ad.rootElement.fontFaceDecls,[z]);y.filter=new v(ad.rootElement.body,z);q+=y.writeToString(f,w);q+=y.writeToString(z,w);q+=y.writeToString(ad.rootElement.body,w);return q+"</office:document-content>"}function al(q,f){runtime.loadXML(q,function(w,y){if(w){f(w)}else{if(y){ai(y);b(y.documentElement);var z=aq(y);z&&"document"===z.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===z.namespaceURI?(ab(z),am(t.DONE)):am(t.INVALID)}else{f("No DOM was loaded.")}}})}function ah(q,f){var y;y=ad.rootElement;var w=y.meta;w||(y.meta=w=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),s(y,w));y=w;q&&p.mapKeyValObjOntoNode(y,q,odf.Namespaces.lookupNamespaceURI);f&&p.removeKeyElementsFromNode(y,f,odf.Namespaces.lookupNamespaceURI)}function d(w,q){function C(E,f){var F;f||(f=E);F=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",f);B[E]=F;B.appendChild(F)}var D=new core.Zip("",null),z="application/vnd.oasis.opendocument."+w+(!0===q?"-template":""),A=runtime.byteArrayFromString(z,"utf8"),B=ad.rootElement,y=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",w);D.save("mimetype",A,!1,new Date);C("meta");C("settings");C("scripts");C("fontFaceDecls","font-face-decls");C("styles");C("automaticStyles","automatic-styles");C("masterStyles","master-styles");C("body");B.body.appendChild(y);m["/"]=z;m["settings.xml"]="text/xml";m["meta.xml"]="text/xml";m["styles.xml"]="text/xml";m["content.xml"]="text/xml";am(t.DONE);return D}function ay(){var q,f=new Date,w="";ad.rootElement.settings&&ad.rootElement.settings.firstElementChild&&(q=new xmldom.LSSerializer,w=O("document-settings"),q.filter=new odf.OdfNodeFilter,w+=q.writeToString(ad.rootElement.settings,odf.Namespaces.namespaceMap),w+="</office:document-settings>");(q=w)?(q=runtime.byteArrayFromString(q,"utf8"),c.save("settings.xml",q,!0,f)):c.remove("settings.xml");w=runtime.getWindow();q="WebODF/"+webodf.Version;w&&(q=q+" "+w.navigator.userAgent);ah({"meta:generator":q},null);q=runtime.byteArrayFromString(h(),"utf8");c.save("meta.xml",q,!0,f);q=runtime.byteArrayFromString(ae(),"utf8");c.save("styles.xml",q,!0,f);q=runtime.byteArrayFromString(n(),"utf8");c.save("content.xml",q,!0,f);q=runtime.byteArrayFromString(x(),"utf8");c.save("META-INF/manifest.xml",q,!0,f)}function a(q,f){ay();c.writeAs(q,function(w){f(w)})}var ad=this,c,m={},ak,l="";this.onstatereadychange=aw;this.state=this.onchange=null;this.getMetadata=an;this.setRootElement=ab;this.getContentElement=function(){var f;ak||(f=ad.rootElement.body,ak=p.getDirectChild(f,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","text")||p.getDirectChild(f,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||p.getDirectChild(f,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet"));if(!ak){throw"Could not find content element in <office:body/>."}return ak};this.getDocumentType=function(){var f=ad.getContentElement();return f&&f.localName};this.isTemplate=function(){return"-template"===m["/"].substr(-9)};this.setIsTemplate=function(q){var f=m["/"],w="-template"===f.substr(-9);q!==w&&(f=q?f+"-template":f.substr(0,f.length-9),m["/"]=f,q=runtime.byteArrayFromString(f,"utf8"),c.save("mimetype",q,!1,new Date))};this.getPart=function(f){return new odf.OdfPart(f,m[f],ad,c)};this.getPartData=function(q,f){c.load(q,f)};this.setMetadata=ah;this.incrementEditingCycles=function(){var f=an(odf.Namespaces.metans,"editing-cycles"),f=f?parseInt(f,10):0;isNaN(f)&&(f=0);ah({"meta:editing-cycles":f+1},null);return f+1};this.createByteArray=function(q,f){ay();c.createByteArray(q,f)};this.saveAs=a;this.save=function(f){a(l,f)};this.getUrl=function(){return l};this.setBlob=function(q,f,w){w=j.convertBase64ToByteArray(w);c.save(q,w,!1,new Date);m.hasOwnProperty(q)&&runtime.log(q+" has been overwritten.");m[q]=f};this.removeBlob=function(q){var f=c.remove(q);runtime.assert(f,"file is not found: "+q);delete m[q]};this.state=t.LOADING;this.rootElement=function(q){var f=document.createElementNS(q.namespaceURI,q.localName),w;q=new q.Type;for(w in q){q.hasOwnProperty(w)&&(f[w]=q[w])}return f}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName});ax===odf.OdfContainer.DocumentType.TEXT?c=d("text"):ax===odf.OdfContainer.DocumentType.TEXT_TEMPLATE?c=d("text",!0):ax===odf.OdfContainer.DocumentType.PRESENTATION?c=d("presentation"):ax===odf.OdfContainer.DocumentType.PRESENTATION_TEMPLATE?c=d("presentation",!0):ax===odf.OdfContainer.DocumentType.SPREADSHEET?c=d("spreadsheet"):ax===odf.OdfContainer.DocumentType.SPREADSHEET_TEMPLATE?c=d("spreadsheet",!0):(l=ax,c=new core.Zip(l,function(q,f){c=f;q?al(l,function(w){q&&(c.error=q+"\n"+w,am(t.INVALID))}):k([{path:"styles.xml",handler:ag},{path:"content.xml",handler:af},{path:"meta.xml",handler:W},{path:"settings.xml",handler:L},{path:"META-INF/manifest.xml",handler:M}])}))};odf.OdfContainer.EMPTY=0;odf.OdfContainer.LOADING=1;odf.OdfContainer.DONE=2;odf.OdfContainer.INVALID=3;odf.OdfContainer.SAVING=4;odf.OdfContainer.MODIFIED=5;odf.OdfContainer.getContainer=function(b){return new odf.OdfContainer(b,null)}})();odf.OdfContainer.DocumentType={TEXT:1,TEXT_TEMPLATE:2,PRESENTATION:3,PRESENTATION_TEMPLATE:4,SPREADSHEET:5,SPREADSHEET_TEMPLATE:6};gui.AnnotatableCanvas=function(){};gui.AnnotatableCanvas.prototype.refreshSize=function(){};gui.AnnotatableCanvas.prototype.getZoomLevel=function(){};gui.AnnotatableCanvas.prototype.getSizer=function(){};gui.AnnotationViewManager=function(u,s,z,w){function y(f){var e=f.annotationEndElement,k=p.createRange(),h=f.getAttributeNS(odf.Namespaces.officens,"name");e&&(k.setStart(f,f.childNodes.length),k.setEnd(e,0),f=g.getTextNodes(k,!1),f.forEach(function(d){var c;d:{for(c=d.parentNode;c.namespaceURI!==odf.Namespaces.officens||"body"!==c.localName;){if(c.namespaceURI===v&&"webodf-annotationHighlight"===c.className&&c.getAttribute("annotation")===h){c=!0;break d}c=c.parentNode}c=!1}c||(c=p.createElement("span"),c.className="webodf-annotationHighlight",c.setAttribute("annotation",h),d.parentNode.replaceChild(c,d),c.appendChild(d))}));k.detach()}function t(a){var c=u.getSizer();a?(z.style.display="inline-block",c.style.paddingRight=x.getComputedStyle(z).width):(z.style.display="none",c.style.paddingRight=0);u.refreshSize()}function j(){o.sort(function(d,c){return 0!==(d.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1})}function i(){var G;for(G=0;G<o.length;G+=1){var F=o[G],D=F.parentNode,E=D.nextElementSibling,C=E.nextElementSibling,A=D.parentNode,f=0,f=o[o.indexOf(F)-1],m=void 0,F=u.getZoomLevel();D.style.left=(z.getBoundingClientRect().left-A.getBoundingClientRect().left)/F+"px";D.style.width=z.getBoundingClientRect().width/F+"px";E.style.width=parseFloat(D.style.left)-30+"px";f&&(m=f.parentNode.getBoundingClientRect(),20>=(A.getBoundingClientRect().top-m.bottom)/F?D.style.top=Math.abs(A.getBoundingClientRect().top-m.bottom)/F+20+"px":D.style.top="0px");C.style.left=E.getBoundingClientRect().width/F+"px";var E=C.style,A=C.getBoundingClientRect().left/F,f=C.getBoundingClientRect().top/F,m=D.getBoundingClientRect().left/F,B=D.getBoundingClientRect().top/F,a=0,I=0,a=m-A,a=a*a,I=B-f,I=I*I,A=Math.sqrt(a+I);E.width=A+"px";f=Math.asin((D.getBoundingClientRect().top-C.getBoundingClientRect().top)/(F*parseFloat(C.style.width)));C.style.transform="rotate("+f+"rad)";C.style.MozTransform="rotate("+f+"rad)";C.style.WebkitTransform="rotate("+f+"rad)";C.style.msTransform="rotate("+f+"rad)"}}var o=[],p=s.ownerDocument,g=odf.OdfUtils,x=runtime.getWindow(),v="http://www.w3.org/1999/xhtml";runtime.assert(Boolean(x),"Expected to be run in an environment which has a global window, like a browser.");this.rerenderAnnotations=i;this.rehighlightAnnotations=function(){o.forEach(function(b){y(b)})};this.getMinimumHeightForAnnotationPane=function(){return"none"!==z.style.display&&0<o.length?(o[o.length-1].parentNode.getBoundingClientRect().bottom-z.getBoundingClientRect().top)/u.getZoomLevel()+"px":null};this.addAnnotation=function(b){t(!0);o.push(b);j();var n=p.createElement("div"),m=p.createElement("div"),l=p.createElement("div"),h=p.createElement("div"),d;n.className="annotationWrapper";n.setAttribute("creator",g.getAnnotationCreator(b));b.parentNode.insertBefore(n,b);m.className="annotationNote";m.appendChild(b);w&&(d=p.createElement("div"),d.className="annotationRemoveButton",m.appendChild(d));l.className="annotationConnector horizontal";h.className="annotationConnector angular";n.appendChild(m);n.appendChild(l);n.appendChild(h);b.annotationEndElement&&y(b);i()};this.forgetAnnotations=function(){for(;o.length;){var f=o[0],d=o.indexOf(f),k=f.parentNode.parentNode;"div"===k.localName&&(k.parentNode.insertBefore(f,k),k.parentNode.removeChild(k));for(var f=f.getAttributeNS(odf.Namespaces.officens,"name"),f=p.querySelectorAll('span.webodf-annotationHighlight[annotation="'+f+'"]'),h=k=void 0,k=0;k<f.length;k+=1){for(h=f.item(k);h.firstChild;){h.parentNode.insertBefore(h.firstChild,h)}h.parentNode.removeChild(h)}-1!==d&&o.splice(d,1);0===o.length&&t(!1)}}};gui.Viewport=function(){};gui.Viewport.prototype.scrollIntoView=function(b,a){};gui.SingleScrollViewport=function(a){this.scrollIntoView=function(f,e){var j,c,g,l;l=a.offsetHeight-a.clientHeight;g=a.offsetWidth-a.clientWidth;var i=a.getBoundingClientRect();if(f&&i){j=i.left+5;c=i.top+5;g=i.right-(g+5);l=i.bottom-(l+5);if(e||f.top<c){a.scrollTop-=c-f.top}else{if(f.top>l||f.bottom>l){a.scrollTop=f.bottom-f.top<=l-c?a.scrollTop+(f.bottom-l):a.scrollTop+(f.top-c)}}f.left<j?a.scrollLeft-=j-f.left:f.right>g&&(a.scrollLeft=f.right-f.left<=g-j?a.scrollLeft+(f.right-g):a.scrollLeft-(j-f.left))}}};(function(){function e(i,o,s,p,d){var f,j=0,r;for(r in i){if(i.hasOwnProperty(r)){if(j===s){f=r;break}j+=1}}f?o.getPartData(i[f].href,function(m,l){if(m){runtime.log(m)}else{if(l){var h="@font-face { font-family: "+(i[f].family||f)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+g.convertUTF8ArrayToBase64(l)+') format("truetype"); }';try{p.insertRule(h,p.cssRules.length)}catch(a){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(a)+"\nRule: "+h)}}else{runtime.log("missing font data for "+i[f].href)}}e(i,o,s+1,p,d)}):d&&d()}var c=xmldom.XPath,b=odf.OdfUtils,g=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(f,k){for(var p=f.rootElement.fontFaceDecls;k.cssRules.length;){k.deleteRule(k.cssRules.length-1)}if(p){var j={},a,h,i,o;if(p){for(p=c.getODFElementsWithXPath(p,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),a=0;a<p.length;a+=1){h=p[a],i=h.getAttributeNS(odf.Namespaces.stylens,"name"),o=b.getNormalizedFontFamilyName(h.getAttributeNS(odf.Namespaces.svgns,"font-family")),h=c.getODFElementsWithXPath(h,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI),0<h.length&&(h=h[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),j[i]={href:h,family:o})}}e(j,f,0,k)}}}})();odf.Formatting=function(){function O(b){return(b=i[b])?A.mergeObjects({},b):{}}function L(){for(var f=R.rootElement.fontFaceDecls,c={},g,h,f=f&&f.firstElementChild;f;){if(g=f.getAttributeNS(N,"name")){if((h=f.getAttributeNS(H,"font-family"))||0<f.getElementsByTagNameNS(H,"font-face-uri").length){c[g]=h}}f=f.nextElementSibling}return c}function T(d){for(var c=R.rootElement.styles.firstElementChild;c;){if(c.namespaceURI===N&&"default-style"===c.localName&&c.getAttributeNS(N,"family")===d){return c}c=c.nextElementSibling}return null}function Q(g,c,l){var m,h,k;l=l||[R.rootElement.automaticStyles,R.rootElement.styles];for(k=0;k<l.length;k+=1){for(m=l[k],m=m.firstElementChild;m;){h=m.getAttributeNS(N,"name");if(m.namespaceURI===N&&"style"===m.localName&&m.getAttributeNS(N,"family")===c&&h===g||"list-style"===c&&m.namespaceURI===o&&"list-style"===m.localName&&h===g||"data"===c&&m.namespaceURI===D&&h===g){return m}m=m.nextElementSibling}}return null}function S(h){for(var g,q,m,n,k={},l=h.firstElementChild;l;){if(l.namespaceURI===N){for(m=k[l.nodeName]={},q=l.attributes,g=0;g<q.length;g+=1){n=q.item(g),m[n.name]=n.value}}l=l.nextElementSibling}q=h.attributes;for(g=0;g<q.length;g+=1){n=q.item(g),k[n.name]=n.value}return k}function M(g,f){for(var c=R.rootElement.styles,b,a={},d=g.getAttributeNS(N,"family"),k=g;k;){b=S(k),a=A.mergeObjects(b,a),k=(b=k.getAttributeNS(N,"parent-style-name"))?Q(b,d,[c]):null}if(k=T(d)){b=S(k),a=A.mergeObjects(b,a)}!1!==f&&(b=O(d),a=A.mergeObjects(b,a));return a}function I(k,e){function s(b){Object.keys(b).forEach(function(a){Object.keys(b[a]).forEach(function(c){q+="|"+a+":"+c+"|"})})}for(var r=k.nodeType===Node.TEXT_NODE?k.parentNode:k,m,n=[],q="",l=!1;r;){!l&&B.isGroupingElement(r)&&(l=!0),(m=P.determineStylesForNode(r))&&n.push(m),r=r.parentNode}l&&(n.forEach(s),e&&(e[q]=n));return l?n:void 0}function G(d){var c={orderedStyles:[],styleProperties:{}};d.forEach(function(b){Object.keys(b).forEach(function(k){var g=Object.keys(b[k])[0],h={name:g,family:k,displayName:void 0,isCommonStyle:!1},a;(a=Q(g,k))?(k=M(a),c.styleProperties=A.mergeObjects(k,c.styleProperties),h.displayName=a.getAttributeNS(N,"display-name")||void 0,h.isCommonStyle=a.parentNode===R.rootElement.styles):runtime.log("No style element found for '"+g+"' of family '"+k+"'");c.orderedStyles.push(h)})});return c}function J(f,d){var h={},g=[];d||(d={});f.forEach(function(b){I(b,h)});Object.keys(h).forEach(function(b){d[b]||(d[b]=G(h[b]));g.push(d[b])});return g}function K(d){for(var c=R.rootElement.masterStyles.firstElementChild;c&&(c.namespaceURI!==N||"master-page"!==c.localName||c.getAttributeNS(N,"name")!==d);){c=c.nextElementSibling}return c}function F(e,d){var f;e&&(f=C.convertMeasure(e,"px"));void 0===f&&d&&(f=C.convertMeasure(d,"px"));return f}var R,P=new odf.StyleInfo,H=odf.Namespaces.svgns,N=odf.Namespaces.stylens,o=odf.Namespaces.textns,D=odf.Namespaces.numberns,j=odf.Namespaces.fons,B=odf.OdfUtils,E=core.DomUtils,A=new core.Utils,C=new core.CSSUnits,i={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.getSystemDefaultStyleAttributes=O;this.setOdfContainer=function(b){R=b};this.getFontMap=L;this.getAvailableParagraphStyles=function(){for(var f=R.rootElement.styles,c,g,h=[],f=f&&f.firstElementChild;f;){"style"===f.localName&&f.namespaceURI===N&&(c=f.getAttributeNS(N,"family"),"paragraph"===c&&(c=f.getAttributeNS(N,"name"),g=f.getAttributeNS(N,"display-name")||c,c&&g&&h.push({name:c,displayName:g}))),f=f.nextElementSibling}return h};this.isStyleUsed=function(e){var c,f=R.rootElement;c=P.hasDerivedStyles(f,odf.Namespaces.lookupNamespaceURI,e);e=(new P.UsedStyleList(f.styles)).uses(e)||(new P.UsedStyleList(f.automaticStyles)).uses(e)||(new P.UsedStyleList(f.body)).uses(e);return c||e};this.getDefaultStyleElement=T;this.getStyleElement=Q;this.getStyleAttributes=S;this.getInheritedStyleAttributes=M;this.getFirstCommonParentStyleNameOrSelf=function(d){var c=R.rootElement.styles,f;if(f=Q(d,"paragraph",[R.rootElement.automaticStyles])){if(d=f.getAttributeNS(N,"parent-style-name"),!d){return null}}return(f=Q(d,"paragraph",[c]))?d:null};this.hasParagraphStyle=function(b){return Boolean(Q(b,"paragraph"))};this.getAppliedStyles=J;this.getAppliedStylesForElement=function(d,c){return J([d],c)[0]};this.updateStyle=function(f,c){var g,h;E.mapObjOntoNode(f,c,odf.Namespaces.lookupNamespaceURI);(g=(g=c["style:text-properties"])&&g["style:font-name"])&&!L().hasOwnProperty(g)&&(h=f.ownerDocument.createElementNS(N,"style:font-face"),h.setAttributeNS(N,"style:name",g),h.setAttributeNS(H,"svg:font-family",g),R.rootElement.fontFaceDecls.appendChild(h))};this.createDerivedStyleObject=function(b,h,c){var d=Q(b,h);runtime.assert(Boolean(d),"No style element found for '"+b+"' of family '"+h+"'");b=d.parentNode===R.rootElement.styles?{"style:parent-style-name":b}:S(d);b["style:family"]=h;A.mergeObjects(b,c);return b};this.getDefaultTabStopDistance=function(){for(var a=T("paragraph"),a=a&&a.firstElementChild,d;a;){a.namespaceURI===N&&"paragraph-properties"===a.localName&&(d=a.getAttributeNS(N,"tab-stop-distance")),a=a.nextElementSibling}d||(d="1.25cm");return B.parseNonNegativeLength(d)};this.getMasterPageElement=K;this.getContentSize=function(z,w){var v,u,d,s,l,c,g,r,y,U;z:{u=Q(z,w);runtime.assert("paragraph"===w||"table"===w,"styleFamily must be either paragraph or table");if(u){if(u=u.getAttributeNS(N,"master-page-name")){(v=K(u))||runtime.log("WARN: No master page definition found for "+u)}v||(v=K("Standard"));v||(v=R.rootElement.masterStyles.getElementsByTagNameNS(N,"master-page")[0])||runtime.log("WARN: Document has no master pages defined");if(v){for(u=v.getAttributeNS(N,"page-layout-name"),d=R.rootElement.automaticStyles.getElementsByTagNameNS(N,"page-layout"),s=0;s<d.length;s+=1){if(v=d.item(s),v.getAttributeNS(N,"name")===u){break z}}}}v=null}v||(v=E.getDirectChild(R.rootElement.styles,N,"default-page-layout"));(v=E.getDirectChild(v,N,"page-layout-properties"))?("landscape"===v.getAttributeNS(N,"print-orientation")?(u="29.7cm",d="21.001cm"):(u="21.001cm",d="29.7cm"),u=F(v.getAttributeNS(j,"page-width"),u),d=F(v.getAttributeNS(j,"page-height"),d),s=F(v.getAttributeNS(j,"margin")),void 0===s?(s=F(v.getAttributeNS(j,"margin-left"),"2cm"),l=F(v.getAttributeNS(j,"margin-right"),"2cm"),c=F(v.getAttributeNS(j,"margin-top"),"2cm"),g=F(v.getAttributeNS(j,"margin-bottom"),"2cm")):s=l=c=g=s,r=F(v.getAttributeNS(j,"padding")),void 0===r?(r=F(v.getAttributeNS(j,"padding-left"),"0cm"),y=F(v.getAttributeNS(j,"padding-right"),"0cm"),U=F(v.getAttributeNS(j,"padding-top"),"0cm"),v=F(v.getAttributeNS(j,"padding-bottom"),"0cm")):r=y=U=v=r):(u=F("21.001cm"),d=F("29.7cm"),s=l=c=g=s=F("2cm"),r=y=U=v=r=F("0cm"));return{width:u-s-l-r-y,height:d-c-g-U-v}}};(function(){var d=odf.Namespaces.stylens,c=odf.Namespaces.textns,b={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(e){this.derivedStyles={};this.element=e};odf.StyleTree=function(j,e){function g(l){var h,n,o,m={};if(!l){return m}for(l=l.firstElementChild;l;){if(n=l.namespaceURI!==d||"style"!==l.localName&&"default-style"!==l.localName?l.namespaceURI===c&&"list-style"===l.localName?"list":l.namespaceURI!==d||"page-layout"!==l.localName&&"default-page-layout"!==l.localName?void 0:"page":l.getAttributeNS(d,"family")){(h=l.getAttributeNS(d,"name"))||(h=""),m.hasOwnProperty(n)?o=m[n]:m[n]=o={},o[h]=l}l=l.nextElementSibling}return m}function k(l,h){if(l.hasOwnProperty(h)){return l[h]}var n=null,o=Object.keys(l),m;for(m=0;m<o.length&&!(n=k(l[o[m]].derivedStyles,h));m+=1){}return n}function i(m,l,p){var q,o,n;if(!l.hasOwnProperty(m)){return null}q=new odf.StyleTreeNode(l[m]);o=q.element.getAttributeNS(d,"parent-style-name");n=null;o&&(n=k(p,o)||i(o,l,p));n?n.derivedStyles[m]=q:p[m]=q;delete l[m];return q}function a(l,h){l&&Object.keys(l).forEach(function(m){i(m,l,h)})}var f={};this.getStyleTree=function(){return f};(function(){var h,m,l;m=g(j);l=g(e);Object.keys(b).forEach(function(n){h=f[n]={};a(m[n],h);a(l[n],h)})})()}})();(function(){function l(h,f){try{h.insertRule(f,h.cssRules.length)}catch(k){runtime.log("cannot load rule: "+f+" - "+k)}}function g(f,d){this.listCounterCount=0;this.contentRules=f;this.counterIdStack=[];this.continuedCounterIdStack=d}function e(h){function f(x,y,b,t){var v=y.namespaceURI===i&&"list"===y.localName,a=y.namespaceURI===i&&"list-item"===y.localName;if(v||a){if(v){var v=b+=1,B,z,A;t.listCounterCount+=1;a=x+"-level"+v+"-"+t.listCounterCount;y.setAttributeNS("urn:webodf:names:helper","counter-id",a);B=t.continuedCounterIdStack.shift();B||(B=a,p+=a+" 1 ",z='text|list[webodfhelper|counter-id="'+a+'"] > text|list-item:first-child > :not(text|list):first-child:before',z+="{",z+="counter-increment: "+B+" 0;",z+="}",l(h,z));for(;t.counterIdStack.length>=v;){t.counterIdStack.pop()}t.counterIdStack.push(B);A=t.contentRules[v.toString()]||"";for(z=1;z<=v;z+=1){A=A.replace(z+"webodf-listLevel",t.counterIdStack[z-1])}z='text|list[webodfhelper|counter-id="'+a+'"] > text|list-item > :not(text|list):first-child:before';z+="{";z+=A;z+="counter-increment: "+B+";";z+="}";l(h,z)}for(y=y.firstElementChild;y;){f(x,y,b,t),y=y.nextElementSibling}}else{t.continuedCounterIdStack=[]}}var n=0,p="",k={};this.createCounterRules=function(d,s,r){var q=s.getAttributeNS(o,"id"),b=[];r&&(r=r.getAttributeNS("urn:webodf:names:helper","counter-id"),b=k[r].slice(0));d=new g(d,b);q?q="Y"+q:(n+=1,q="X"+n);f(q,s,0,d);k[q+"-level1-1"]=d.counterIdStack};this.initialiseCreatedCounters=function(){var a;a="office|document{"+("counter-reset: "+p+";");a+="}";l(h,a)}}var m=odf.Namespaces.fons,c=odf.Namespaces.stylens,i=odf.Namespaces.textns,o=odf.Namespaces.xmlns,j={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function a(p){var k=f.parseLength(p);return k?h.convert(k.value,k.unit,"px"):(runtime.log("Could not parse value '"+p+"'."),0)}function b(k){return k.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function d(p,k){var q;p&&(q=p.getAttributeNS(i,"style-name"));return q===k}function n(X,V,W){V=V.getElementsByTagNameNS(i,"list");X=new e(X);var S,Q,R,E,L,v,B={},O;for(O=0;O<V.length;O+=1){if(S=V.item(O),v=S.getAttributeNS(i,"style-name")){R=S.getAttributeNS(i,"continue-numbering");E=S.getAttributeNS(i,"continue-list");(L=S.getAttributeNS(o,"id"))&&(B[L]=S);L=W[v].element.firstElementChild;for(var M=void 0,y={};L;){var M=(M=L.getAttributeNS(i,"level"))&&parseInt(M,10),s=y,t=L,F="",P=void 0,k=void 0,r=P=void 0;if("list-level-style-number"===t.localName){var x=t,F=x.getAttributeNS(c,"num-format"),P=x.getAttributeNS(c,"num-suffix")||"",k=x.getAttributeNS(c,"num-prefix")||"",q="",Z=x.getAttributeNS(i,"level"),x=x.getAttributeNS(i,"display-levels");k&&(q+='"'+b(k)+'"\n');if(j.hasOwnProperty(F)){for(Z=Z?parseInt(Z,10):1,x=x?parseInt(x,10):1;0<x;){q+=" counter("+(Z-x+1)+"webodf-listLevel,"+j[F]+")",1<x&&(q+='"."'),x-=1}}else{q=F?q+(' "'+F+'"'):q+' ""'}F="content:"+q+' "'+b(P)+'"'}else{"list-level-style-image"===t.localName?F="content: none":"list-level-style-bullet"===t.localName&&(F=t.getAttributeNS(i,"bullet-char"),F='content: "'+b(F)+'"')}if(P=t.getElementsByTagNameNS(c,"list-level-properties")[0]){k=P.getAttributeNS(i,"list-level-position-and-space-mode"),"label-alignment"===k&&((P=P.getElementsByTagNameNS(c,"list-level-label-alignment")[0])&&(r=P.getAttributeNS(i,"label-followed-by")),"space"===r&&(F+=' "\\a0"'))}s[M]="\n"+F+";\n";L=L.nextElementSibling}L=y;R&&!E&&d(Q,v)?X.createCounterRules(L,S,Q):E&&d(B[E],v)?X.createCounterRules(L,S,B[E]):X.createCounterRules(L,S);Q=S}}X.initialiseCreatedCounters()}var h=new core.CSSUnits,f=odf.OdfUtils;this.applyListStyles=function(r,u,t){var k,s;(k=u.list)&&Object.keys(k).forEach(function(F){s=k[F];for(var E=s.element.firstElementChild;E;){if(E.namespaceURI===i){for(var w=r,z=E,C='text|list[text|style-name="'+F+'"]',q=z.getAttributeNS(i,"level"),L=void 0,O=void 0,D=O=void 0,H=void 0,M=void 0,y=L=void 0,v=void 0,B=void 0,I=void 0,H=void 0,D=(O=z.getElementsByTagNameNS(c,"list-level-properties")[0])&&O.getAttributeNS(i,"list-level-position-and-space-mode"),H=O&&O.getElementsByTagNameNS(c,"list-level-label-alignment")[0],L=q=q&&parseInt(q,10);1<L;){C+=" > text|list-item > text|list",L-=1}L=O&&O.getAttributeNS(m,"text-align")||"left";switch(L){case"end":L="right";break;case"start":L="left"}"label-alignment"===D?(M=H&&H.getAttributeNS(m,"margin-left")||"0px",B=H&&H.getAttributeNS(m,"text-indent")||"0px",I=H&&H.getAttributeNS(i,"label-followed-by"),H=a(M)):(M=O&&O.getAttributeNS(i,"space-before")||"0px",y=O&&O.getAttributeNS(i,"min-label-width")||"0px",v=O&&O.getAttributeNS(i,"min-label-distance")||"0px",H=a(M)+a(y));O=C+" > text|list-item";O+="{";O+="margin-left: "+H+"px;";O+="}";l(w,O);O=C+" > text|list-item > text|list";O+="{";O+="margin-left: "+-H+"px;";O+="}";l(w,O);O=C+" > text|list-item > :not(text|list):first-child:before";O+="{";O+="text-align: "+L+";";O+="display: inline-block;";"label-alignment"===D?(O+="margin-left: "+B+";","listtab"===I&&(O+="padding-right: 0.2cm;")):(O+="min-width: "+y+";",O+="margin-left: "+(0===parseFloat(y)?"":"-")+y+";",O+="padding-right: "+v+";");O+="}";l(w,O)}E=E.nextElementSibling}});n(r,t,k)}}})();odf.LazyStyleProperties=function(d,c){var b={};this.value=function(e){var a;b.hasOwnProperty(e)?a=b[e]:(a=c[e](),void 0===a&&d&&(a=d.value(e)),b[e]=a);return a};this.reset=function(a){d=a;b={}}};odf.StyleParseUtils=function(){function b(e){var f,c;e=(e=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(e))?{value:parseFloat(e[1]),unit:e[3]}:null;c=e&&e.unit;"px"===c?f=e.value:"cm"===c?f=96*(e.value/2.54):"mm"===c?f=96*(e.value/25.4):"in"===c?f=96*e.value:"pt"===c?f=e.value/0.75:"pc"===c&&(f=16*e.value);return f}var a=odf.Namespaces.stylens;this.parseLength=b;this.parsePositiveLengthOrPercent=function(e,g,c){var f;e&&(f=parseFloat(e.substr(0,e.indexOf("%"))),isNaN(f)&&(f=void 0));var i;void 0!==f?(c&&(i=c.value(g)),f=void 0===i?void 0:f*(i/100)):f=b(e);return f};this.getPropertiesElement=function(e,f,c){for(f=c?c.nextElementSibling:f.firstElementChild;null!==f&&(f.localName!==e||f.namespaceURI!==a);){f=f.nextElementSibling}return f};this.parseAttributeList=function(c){c&&(c=c.replace(/^\s*(.*?)\s*$/g,"$1"));return c&&0<c.length?c.split(/\s+/):[]}};odf.Style2CSS=function(){function ar(k,f,q){var n=[];q=q.derivedStyles;var p;var m=ab[k],l;void 0===m?f=null:(l=f?"["+m+'|style-name="'+f+'"]':"","presentation"===m&&(m="draw",l=f?'[presentation|style-name="'+f+'"]':""),f=m+"|"+ae[k].join(l+","+m+"|")+l);null!==f&&n.push(f);for(p in q){q.hasOwnProperty(p)&&(f=ar(k,p,q[p]),n=n.concat(f))}return n}function ao(e){var d="",f="",d=null;if("default-style"===e.localName){return null}d=e.getAttributeNS(ai,"parent-style-name");f=e.getAttributeNS(ai,"family");return d=B.getODFElementsWithXPath(j,d?"//style:*[@style:name='"+d+"'][@style:family='"+f+"']":"//style:default-style[@style:family='"+f+"']",odf.Namespaces.lookupNamespaceURI)[0]}function ax(E,D){var A="",y,z,w;for(y=0;y<D.length;y+=1){if(z=D[y],w=E.getAttributeNS(z[0],z[1])){w=w.trim();if(R.hasOwnProperty(z[1])){var x=w,v=x.indexOf(" "),r=void 0;w=void 0;-1!==v?(r=x.substring(0,v),w=x.substring(v)):(r=x,w="");(r=o.parseLength(r))&&"pt"===r.unit&&0.75>r.value&&(x="0.75pt"+w);w=x}else{if(X.hasOwnProperty(z[1])){var x=E,v=z[0],r=z[1],u=o.parseLength(w),t=void 0,k=void 0,s=void 0,C=void 0,s=void 0;if(u&&"%"===u.unit){t=u.value/100;k=ao(x.parentNode);for(C="0";k;){if(s=ac.getDirectChild(k,ai,"paragraph-properties")){if(s=o.parseLength(s.getAttributeNS(v,r))){if("%"!==s.unit){C=s.value*t+s.unit;break}t*=s.value/100}}k=ao(k)}w=C}}}z[2]&&(A+=z[2]+":"+w+";")}}return A}function au(f,d,h,g){return d+d+h+h+g+g}function aw(b,h){var f=[b],g=h.derivedStyles;Object.keys(g).forEach(function(c){c=aw(c,g[c]);f=f.concat(c)});return f}function ap(g,s,q,r){function m(a,l){var f=[],h;a.forEach(function(c){k.forEach(function(d){f.push('draw|page[webodfhelper|page-style-name="'+d+'"] draw|frame[presentation|class="'+c+'"]')})});0<f.length&&(h=f.join(",")+"{visibility:"+l+";}",g.insertRule(h,g.cssRules.length))}var k=aw(s,r),n=[],b=[];["page-number","date-time","header","footer"].forEach(function(d){var c;c=q.getAttributeNS(aq,"display-"+d);"true"===c?n.push(d):"false"===c&&b.push(d)});m(n,"visible");m(b,"hidden")}function al(p,m,r,a){var q,n;if("page"===m){var s=a.element,d="",f,g;g=f="";r=ac.getDirectChild(s,ai,"page-layout-properties");var e;if(r){if(e=s.getAttributeNS(ai,"name"),d+=ax(r,F),(f=ac.getDirectChild(r,ai,"background-image"))&&(g=f.getAttributeNS(ak,"href"))&&(d=d+("background-image: url('odfkit:"+g+"');")+ax(f,ad)),"presentation"===M){for(s=(s=ac.getDirectChild(s.parentNode.parentNode,an,"master-styles"))&&s.firstElementChild;s;){s.namespaceURI===ai&&"master-page"===s.localName&&s.getAttributeNS(ai,"page-layout-name")===e&&(g=s.getAttributeNS(ai,"name"),f='draw|page[draw|master-page-name="'+g+'"] {'+d+"}",g='office|body, draw|page[draw|master-page-name="'+g+'"] {'+ax(r,L)+" }",p.insertRule(f,p.cssRules.length),p.insertRule(g,p.cssRules.length)),s=s.nextElementSibling}}else{"text"===M&&(f="office|text {"+d+"}",g="office|body {width: "+r.getAttributeNS(am,"page-width")+";}",p.insertRule(f,p.cssRules.length),p.insertRule(g,p.cssRules.length))}}}else{d=ar(m,r,a).join(",");e="";if(s=ac.getDirectChild(a.element,ai,"text-properties")){var l=s,k=n="";f="";g=1;s=""+ax(l,ah);q=l.getAttributeNS(ai,"text-underline-style");"solid"===q&&(n+=" underline");q=l.getAttributeNS(ai,"text-line-through-style");"solid"===q&&(n+=" line-through");n.length&&(s=s+("text-decoration:"+n+";\n")+("text-decoration-line:"+n+";\n"),s+="-moz-text-decoration-line:"+n+";\n");q=l.getAttributeNS(ai,"text-line-through-type");switch(q){case"double":k+=" double";break;case"single":k+=" single"}k&&(s+="text-decoration-style:"+k+";\n",s+="-moz-text-decoration-style:"+k+";\n");if(n=l.getAttributeNS(ai,"font-name")||l.getAttributeNS(am,"font-family")){q=i[n],s+="font-family: "+(q||n)+";"}if(q=l.getAttributeNS(ai,"text-position")){n=ag.parseAttributeList(q),q=n[0],n=n[1],s+="vertical-align: "+q+"\n; ",n&&(g=parseFloat(n)/100)}if(l.hasAttributeNS(am,"font-size")||1!==g){for(l=l.parentNode;l;){if(q=(q=ac.getDirectChild(l,ai,"text-properties"))?o.parseFoFontSize(q.getAttributeNS(am,"font-size")):null){if("%"!==q.unit){f="font-size: "+q.value*g+q.unit+";";break}g*=q.value/100}l=ao(l)}f||(f="font-size: "+parseFloat(Z)*g+S.getUnits(Z)+";")}s+=f;e+=s}if(s=ac.getDirectChild(a.element,ai,"paragraph-properties")){f=s,s=""+ax(f,af),(g=ac.getDirectChild(f,ai,"background-image"))&&(l=g.getAttributeNS(ak,"href"))&&(s=s+("background-image: url('odfkit:"+l+"');")+ax(g,ad)),(f=f.getAttributeNS(am,"line-height"))&&"normal"!==f&&(f=o.parseFoLineHeight(f),s="%"!==f.unit?s+("line-height: "+f.value+f.unit+";"):s+("line-height: "+f.value/100+";")),e+=s}if(s=ac.getDirectChild(a.element,ai,"graphic-properties")){l=s,s=""+ax(l,aa),f=l.getAttributeNS(aj,"opacity"),g=l.getAttributeNS(aj,"fill"),l=l.getAttributeNS(aj,"fill-color"),"solid"===g||"hatch"===g?l&&"none"!==l?(f=isNaN(parseFloat(f))?1:parseFloat(f)/100,g=l.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,au),(l=(g=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(g))?{r:parseInt(g[1],16),g:parseInt(g[2],16),b:parseInt(g[3],16)}:null)&&(s+="background-color: rgba("+l.r+","+l.g+","+l.b+","+f+");")):s+="background: none;":"none"===g&&(s+="background: none;"),e+=s}if(s=ac.getDirectChild(a.element,ai,"drawing-page-properties")){f=s,g=""+ax(f,aa),"true"===f.getAttributeNS(aq,"background-visible")&&(g+="background: none;"),e+=g,ap(p,r,s,a)}if(s=ac.getDirectChild(a.element,ai,"table-cell-properties")){r=e,e=""+ax(s,Q),e=r+e}if(s=ac.getDirectChild(a.element,ai,"table-row-properties")){r=e,e=""+ax(s,V),e=r+e}if(s=ac.getDirectChild(a.element,ai,"table-column-properties")){r=e,e=""+ax(s,W),e=r+e}if(s=ac.getDirectChild(a.element,ai,"table-properties")){r=e,e=""+ax(s,O),s=s.getAttributeNS(at,"border-model"),"collapsing"===s?e+="border-collapse:collapse;":"separating"===s&&(e+="border-collapse:separate;"),e=r+e}0!==e.length&&p.insertRule(d+"{"+e+"}",p.cssRules.length)}for(var h in a.derivedStyles){a.derivedStyles.hasOwnProperty(h)&&al(p,m,h,a.derivedStyles[h])}}var aj=odf.Namespaces.drawns,am=odf.Namespaces.fons,an=odf.Namespaces.officens,ai=odf.Namespaces.stylens,av=odf.Namespaces.svgns,at=odf.Namespaces.tablens,ak=odf.Namespaces.xlinkns,aq=odf.Namespaces.presentationns,ac=core.DomUtils,ag=new odf.StyleParseUtils,ab={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},ae={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background","table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),list:["list-item"]},ah=[[am,"color","color"],[am,"background-color","background-color"],[am,"font-weight","font-weight"],[am,"font-style","font-style"]],ad=[[ai,"repeat","background-repeat"]],af=[[am,"background-color","background-color"],[am,"text-align","text-align"],[am,"text-indent","text-indent"],[am,"padding","padding"],[am,"padding-left","padding-left"],[am,"padding-right","padding-right"],[am,"padding-top","padding-top"],[am,"padding-bottom","padding-bottom"],[am,"border-left","border-left"],[am,"border-right","border-right"],[am,"border-top","border-top"],[am,"border-bottom","border-bottom"],[am,"margin","margin"],[am,"margin-left","margin-left"],[am,"margin-right","margin-right"],[am,"margin-top","margin-top"],[am,"margin-bottom","margin-bottom"],[am,"border","border"]],aa=[[am,"background-color","background-color"],[am,"min-height","min-height"],[aj,"stroke","border"],[av,"stroke-color","border-color"],[av,"stroke-width","border-width"],[am,"border","border"],[am,"border-left","border-left"],[am,"border-right","border-right"],[am,"border-top","border-top"],[am,"border-bottom","border-bottom"]],Q=[[am,"background-color","background-color"],[am,"border-left","border-left"],[am,"border-right","border-right"],[am,"border-top","border-top"],[am,"border-bottom","border-bottom"],[am,"border","border"]],W=[[ai,"column-width","width"]],V=[[ai,"row-height","height"],[am,"keep-together",null]],O=[[ai,"width","width"],[am,"margin-left","margin-left"],[am,"margin-right","margin-right"],[am,"margin-top","margin-top"],[am,"margin-bottom","margin-bottom"]],F=[[am,"background-color","background-color"],[am,"padding","padding"],[am,"padding-left","padding-left"],[am,"padding-right","padding-right"],[am,"padding-top","padding-top"],[am,"padding-bottom","padding-bottom"],[am,"border","border"],[am,"border-left","border-left"],[am,"border-right","border-right"],[am,"border-top","border-top"],[am,"border-bottom","border-bottom"],[am,"margin","margin"],[am,"margin-left","margin-left"],[am,"margin-right","margin-right"],[am,"margin-top","margin-top"],[am,"margin-bottom","margin-bottom"]],L=[[am,"page-width","width"],[am,"page-height","height"]],R={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,"stroke-width":!0},X={margin:!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"margin-bottom":!0},i={},o=odf.OdfUtils,M,j,Z,B=xmldom.XPath,S=new core.CSSUnits;this.style2css=function(u,t,s,q,r){function m(d,c){n="@namespace "+d+" url("+c+");";try{s.insertRule(n,s.cssRules.length)}catch(f){}}var n,l,k;for(j=t;s.cssRules.length;){s.deleteRule(s.cssRules.length-1)}odf.Namespaces.forEachPrefix(m);m("webodfhelper","urn:webodf:names:helper");i=q;M=u;Z=runtime.getWindow().getComputedStyle(document.body,null).getPropertyValue("font-size")||"12pt";for(k in ab){if(ab.hasOwnProperty(k)){for(l in u=r[k],u){u.hasOwnProperty(l)&&al(s,k,l,u[l])}}}}};(function(){function a(c,b){var e=this;this.getDistance=function(d){var g=e.x-d.x;d=e.y-d.y;return Math.sqrt(g*g+d*d)};this.getCenter=function(d){return new a((e.x+d.x)/2,(e.y+d.y)/2)};e.x=c;e.y=b}gui.ZoomHelper=function(){function Q(g,e,k,h){g=h?"translate3d("+g+"px, "+e+"px, 0) scale3d("+k+", "+k+", 1)":"translate("+g+"px, "+e+"px) scale("+k+")";T.style.WebkitTransform=g;T.style.MozTransform=g;T.style.msTransform=g;T.style.OTransform=g;T.style.transform=g}function X(b){b?Q(-M.x,-M.y,F,!0):(Q(0,0,F,!0),Q(0,0,F,!1))}function U(e){if(I&&J){var d=I.style.overflow,g=I.classList.contains("webodf-customScrollbars");e&&g||!e&&!g||(e?(I.classList.add("webodf-customScrollbars"),I.style.overflow="hidden",runtime.requestAnimationFrame(function(){I.style.overflow=d})):I.classList.remove("webodf-customScrollbars"))}}function W(){Q(-M.x,-M.y,F,!0);I.scrollLeft=0;I.scrollTop=0;G=A.style.overflow;A.style.overflow="visible";U(!1)}function R(){Q(0,0,F,!0);I.scrollLeft=M.x;I.scrollTop=M.y;A.style.overflow=G||"";U(!0)}function N(b){return new a(b.pageX-T.offsetLeft,b.pageY-T.offsetTop)}function L(b){S&&(M.x-=b.x-S.x,M.y-=b.y-S.y,M=new a(Math.min(Math.max(M.x,T.offsetLeft),(T.offsetLeft+T.offsetWidth)*F-I.clientWidth),Math.min(Math.max(M.y,T.offsetTop),(T.offsetTop+T.offsetHeight)*F-I.clientHeight)));S=b}function O(b){var g=b.touches.length,d=0<g?N(b.touches[0]):null;b=1<g?N(b.touches[1]):null;d&&b?(j=d.getDistance(b),i=F,S=d.getCenter(b),W(),o=f.PINCH):d&&(S=d,o=f.SCROLL)}function P(k){var h=k.touches.length,b=0<h?N(k.touches[0]):null,h=1<h?N(k.touches[1]):null;if(b&&h){if(k.preventDefault(),o===f.SCROLL){o=f.PINCH,W(),j=b.getDistance(h)}else{k=b.getCenter(h);b=b.getDistance(h)/j;L(k);var h=F,e=Math.min(B,T.offsetParent.clientWidth/T.offsetWidth);F=i*b;F=Math.min(Math.max(F,e),B);b=F/h;M.x+=(b-1)*(k.x+M.x);M.y+=(b-1)*(k.y+M.y);X(!0)}}else{b&&(o===f.PINCH?(o=f.SCROLL,R()):L(b))}}function K(){o===f.PINCH&&(E.emit(gui.ZoomHelper.signalZoomChanged,F),R(),X(!1));o=f.NONE}function V(){I&&(I.removeEventListener("touchstart",O,!1),I.removeEventListener("touchmove",P,!1),I.removeEventListener("touchend",K,!1))}var T,M,S,j,F,i,B=4,I,A,E=new core.EventNotifier([gui.ZoomHelper.signalZoomChanged]),f={NONE:0,SCROLL:1,PINCH:2},o=f.NONE,J=runtime.getWindow().hasOwnProperty("ontouchstart"),G="";this.subscribe=function(d,c){E.subscribe(d,c)};this.unsubscribe=function(d,c){E.unsubscribe(d,c)};this.getZoomLevel=function(){return F};this.setZoomLevel=function(c){T&&(F=c,X(!1),E.emit(gui.ZoomHelper.signalZoomChanged,F))};this.destroy=function(b){V();U(!1);b()};this.setZoomableElement=function(c){V();T=c;I=T.offsetParent;A=T.parentNode;X(!1);I&&(I.addEventListener("touchstart",O,!1),I.addEventListener("touchmove",P,!1),I.addEventListener("touchend",K,!1));U(!0)};i=F=1;M=new a(0,0)};gui.ZoomHelper.signalZoomChanged="zoomChanged"})();ops.Canvas=function(){};ops.Canvas.prototype.getZoomLevel=function(){};ops.Canvas.prototype.getElement=function(){};ops.Canvas.prototype.getSizer=function(){};ops.Canvas.prototype.getZoomHelper=function(){};(function(){function aa(){function e(a){f=!0;runtime.setTimeout(function(){try{a()}catch(b){runtime.log(String(b)+"\n"+b.stack)}f=!1;0<d.length&&e(d.pop())},10)}var d=[],f=!1;this.clearQueue=function(){d.length=0};this.addToQueue=function(a){if(0===d.length&&!f){return e(a)}d.push(a)}}function X(f){function d(){for(;0<h.cssRules.length;){h.deleteRule(0)}h.insertRule("#shadowContent draw|page {display:none;}",0);h.insertRule("office|presentation draw|page {display:none;}",1);h.insertRule("#shadowContent draw|page:nth-of-type("+g+") {display:block;}",2);h.insertRule("office|presentation draw|page:nth-of-type("+g+") {display:block;}",3)}var h=f.sheet,g=1;this.showFirstPage=function(){g=1;d()};this.showNextPage=function(){g+=1;d()};this.showPreviousPage=function(){1<g&&(g-=1,d())};this.showPage=function(b){0<b&&(g=b,d())};this.css=f;this.destroy=function(a){f.parentNode.removeChild(f);a()}}function af(b){for(;b.firstChild;){b.removeChild(b.firstChild)}}function ac(d){d=d.sheet;for(var c=d.cssRules;c.length;){d.deleteRule(c.length-1)}}function ae(h,f,n){var l=new odf.Style2CSS,m=new odf.ListStyleToCss;n=n.sheet;var k=(new odf.StyleTree(h.rootElement.styles,h.rootElement.automaticStyles)).getStyleTree();l.style2css(h.getDocumentType(),h.rootElement,n,f.getFontMap(),k);m.applyListStyles(n,k,h.rootElement.body)}function Y(d,c){(new odf.FontLoader).loadFonts(d,c.sheet)}function U(g,f,l){var h=null;g=g.rootElement.body.getElementsByTagNameNS(B,l+"-decl");l=f.getAttributeNS(B,"use-"+l+"-name");var k;if(l&&0<g.length){for(f=0;f<g.length;f+=1){if(k=g[f],k.getAttributeNS(B,"name")===l){h=k.textContent;break}}}return h}function S(a,l,h,k){var f=a.ownerDocument;l=j.getElementsByTagNameNS(a,l,h);for(a=0;a<l.length;a+=1){af(l[a]),k&&(h=l[a],h.appendChild(f.createTextNode(k)))}}function V(y,x,w){x.setAttributeNS("urn:webodf:names:helper","styleid",y);var u,v=x.getAttributeNS(Q,"anchor-type"),s=x.getAttributeNS(o,"x"),t=x.getAttributeNS(o,"y"),r=x.getAttributeNS(o,"width"),k=x.getAttributeNS(o,"height"),q=x.getAttributeNS(P,"min-height"),n=x.getAttributeNS(P,"min-width");if("as-char"===v){u="display: inline-block;"}else{if(v||s||t){u="position: absolute;"}else{if(r||k||q||n){u="display: block;"}}}s&&(u+="left: "+s+";");t&&(u+="top: "+t+";");r&&(u+="width: "+r+";");k&&(u+="height: "+k+";");q&&(u+="min-height: "+q+";");n&&(u+="min-width: "+n+";");u&&(u="draw|"+x.localName+'[webodfhelper|styleid="'+y+'"] {'+u+"}",w.insertRule(u,w.cssRules.length))}function W(b){for(b=b.firstChild;b;){if(b.namespaceURI===G&&"binary-data"===b.localName){return"data:image/png;base64,"+b.textContent.replace(/[\r\n\s]/g,"")}b=b.nextSibling}return""}function R(u,t,s,q){function r(a){a&&(a='draw|image[webodfhelper|styleid="'+u+'"] {'+("background-image: url("+a+");")+"}",q.insertRule(a,q.cssRules.length))}function m(b){r(b.url)}s.setAttributeNS("urn:webodf:names:helper","styleid",u);var n=s.getAttributeNS(O,"href"),l;if(n){try{l=t.getPart(n),l.onchange=m,l.load()}catch(k){runtime.log("slight problem: "+String(k))}}else{n=W(s),r(n)}}function ad(d){var c=d.ownerDocument;j.getElementsByTagNameNS(d,Q,"line-break").forEach(function(b){b.hasChildNodes()||b.appendChild(c.createElement("br"))})}function ab(d){var c=d.ownerDocument;j.getElementsByTagNameNS(d,Q,"s").forEach(function(b){for(var g,f;b.firstChild;){b.removeChild(b.firstChild)}b.appendChild(c.createTextNode(" "));f=parseInt(b.getAttributeNS(Q,"c"),10);if(1<f){for(b.removeAttributeNS(Q,"c"),g=1;g<f;g+=1){b.parentNode.insertBefore(b.cloneNode(!0),b)}}})}function T(b){j.getElementsByTagNameNS(b,Q,"tab").forEach(function(c){c.textContent="\t"})}function Z(w,v){function u(b,d){var c=n.documentElement.namespaceURI;"video/"===d.substr(0,6)?(t=n.createElementNS(c,"video"),t.setAttribute("controls","controls"),q=n.createElementNS(c,"source"),b&&q.setAttribute("src",b),q.setAttribute("type",d),t.appendChild(q),v.parentNode.appendChild(t)):v.innerHtml="Unrecognised Plugin"}function s(b){u(b.url,b.mimetype)}var t,q,r,n=v.ownerDocument,k;if(r=v.getAttributeNS(O,"href")){try{k=w.getPart(r),k.onchange=s,k.load()}catch(l){runtime.log("slight problem: "+String(l))}}else{runtime.log("using MP4 data fallback"),r=W(v),u(r,"video/mp4")}}function E(f){var d=f.getElementsByTagName("head")[0],h,g;h=f.styleSheets.length;for(g=d.firstElementChild;g&&("style"!==g.localName||!g.hasAttribute("webodfcss"));){g=g.nextElementSibling}if(g){return h=parseInt(g.getAttribute("webodfcss"),10),g.setAttribute("webodfcss",h+1),g}"string"===String(typeof webodf_css)?h=webodf_css:(g="webodf.css",runtime.currentDirectory&&(g=runtime.currentDirectory(),0<g.length&&"/"!==g.substr(-1)&&(g+="/"),g+="../webodf.css"),h=runtime.readFileSync(g,"utf-8"));g=f.createElementNS(d.namespaceURI,"style");g.setAttribute("media","screen, print, handheld, projection");g.setAttribute("type","text/css");g.setAttribute("webodfcss","1");g.appendChild(f.createTextNode(h));d.appendChild(g);return g}function M(d){var c=parseInt(d.getAttribute("webodfcss"),10);1===c?d.parentNode.removeChild(d):d.setAttribute("count",c-1)}function A(f){var d=f.getElementsByTagName("head")[0],h=f.createElementNS(d.namespaceURI,"style"),g="";h.setAttribute("type","text/css");h.setAttribute("media","screen, print, handheld, projection");odf.Namespaces.forEachPrefix(function(e,c){g+="@namespace "+e+" url("+c+");\n"});g+="@namespace webodfhelper url(urn:webodf:names:helper);\n";h.appendChild(f.createTextNode(g));d.appendChild(h);return h}var J=odf.Namespaces.drawns,P=odf.Namespaces.fons,G=odf.Namespaces.officens,L=odf.Namespaces.stylens,o=odf.Namespaces.svgns,F=odf.Namespaces.tablens,Q=odf.Namespaces.textns,O=odf.Namespaces.xlinkns,B=odf.Namespaces.presentationns,i=xmldom.XPath,j=core.DomUtils;odf.OdfCanvas=function(aj,H){function e(s,l,ao){function D(aq,ap,at,ar){b.addToQueue(function(){R(aq,ap,at,ar)})}var an,z;an=l.getElementsByTagNameNS(J,"image");for(l=0;l<an.length;l+=1){z=an.item(l),D("image"+String(l),s,z,ao)}}function x(s,l){function ao(aq,ap){b.addToQueue(function(){Z(aq,ap)})}var D,an,z;an=l.getElementsByTagNameNS(J,"plugin");for(D=0;D<an.length;D+=1){z=an.item(D),ao(s,z)}}function I(){var s;s=d.firstChild;var l=am.getZoomLevel();s&&(d.style.WebkitTransformOrigin="0% 0%",d.style.MozTransformOrigin="0% 0%",d.style.msTransformOrigin="0% 0%",d.style.OTransformOrigin="0% 0%",d.style.transformOrigin="0% 0%",al&&((s=al.getMinimumHeightForAnnotationPane())?d.style.minHeight=s:d.style.removeProperty("min-height")),aj.style.width=Math.round(l*d.offsetWidth)+"px",aj.style.height=Math.round(l*d.offsetHeight)+"px",aj.style.display="inline-block")}function h(av,at){var aq=u.sheet;af(aj);d=m.createElementNS(aj.namespaceURI,"div");d.style.display="inline-block";d.style.background="white";d.style.setProperty("float","left","important");d.appendChild(at);aj.appendChild(d);y=m.createElementNS(aj.namespaceURI,"div");y.id="annotationsPane";N=m.createElementNS(aj.namespaceURI,"div");N.id="shadowContent";N.style.position="absolute";N.style.top=0;N.style.left=0;av.getContentElement().appendChild(N);var ar=at.body,ap,ao=[],z;for(ap=ar.firstElementChild;ap&&ap!==ar;){if(ap.namespaceURI===J&&(ao[ao.length]=ap),ap.firstElementChild){ap=ap.firstElementChild}else{for(;ap&&ap!==ar&&!ap.nextElementSibling;){ap=ap.parentNode}ap&&ap.nextElementSibling&&(ap=ap.nextElementSibling)}}for(z=0;z<ao.length;z+=1){ap=ao[z],V("frame"+String(z),ap,aq)}ao=i.getODFElementsWithXPath(ar,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI);for(ap=0;ap<ao.length;ap+=1){ar=ao[ap],ar.setAttributeNS&&ar.setAttributeNS("urn:webodf:names:helper","containsparagraphanchor",!0)}ar=g;ap=N;var az,ay,ax,an,au=0,l;z=av.rootElement.ownerDocument;if((ao=at.body.firstElementChild)&&ao.namespaceURI===G&&("presentation"===ao.localName||"drawing"===ao.localName)){for(ao=ao.firstElementChild;ao;){if(az=(az=ao.getAttributeNS(J,"master-page-name"))?ar.getMasterPageElement(az):null){ay=ao.getAttributeNS("urn:webodf:names:helper","styleid");ax=z.createElementNS(J,"draw:page");l=az.firstElementChild;for(au=0;l;){"true"!==l.getAttributeNS(B,"placeholder")&&(an=l.cloneNode(!0),ax.appendChild(an)),l=l.nextElementSibling,au+=1}l=an=au=void 0;for(var aw=j.getElementsByTagNameNS(ax,J,"frame"),au=0;au<aw.length;au+=1){an=aw[au],(l=an.getAttributeNS(B,"class"))&&!/^(date-time|footer|header|page-number)$/.test(l)&&an.parentNode.removeChild(an)}an=j.getElementsByTagNameNS(ax,J,"*");for(au=0;au<an.length;au+=1){V(ay+"_"+au,an[au],aq)}ap.appendChild(ax);au=String(ap.getElementsByTagNameNS(J,"page").length);S(ax,Q,"page-number",au);S(ax,B,"header",U(av,ao,"header"));S(ax,B,"footer",U(av,ao,"footer"));V(ay,ax,aq);ax.setAttributeNS("urn:webodf:names:helper","page-style-name",ao.getAttributeNS(J,"style-name"));ax.setAttributeNS(J,"draw:master-page-name",az.getAttributeNS(L,"name"))}ao=ao.nextElementSibling}}ar=aj.namespaceURI;ao=j.getElementsByTagNameNS(at.body,F,"table-cell");for(ap=0;ap<ao.length;ap+=1){z=ao[ap],z.hasAttributeNS(F,"number-columns-spanned")&&z.setAttributeNS(ar,"colspan",z.getAttributeNS(F,"number-columns-spanned")),z.hasAttributeNS(F,"number-rows-spanned")&&z.setAttributeNS(ar,"rowspan",z.getAttributeNS(F,"number-rows-spanned"))}ad(at.body);ab(at.body);T(at.body);e(av,at.body,aq);x(av,at.body);d.insertBefore(N,d.firstChild);am.setZoomableElement(d)}function ak(l){f?(y.parentNode||d.appendChild(y),al&&al.forgetAnnotations(),al=new gui.AnnotationViewManager(p,l.body,y,n),j.getElementsByTagNameNS(l.body,G,"annotation").forEach(al.addAnnotation),al.rerenderAnnotations(),I()):y.parentNode&&(d.removeChild(y),al.forgetAnnotations(),I())}function r(z){function s(){ac(w);ac(t);ac(u);af(aj);aj.style.display="inline-block";var D=K.rootElement;aj.ownerDocument.importNode(D,!0);g.setOdfContainer(K);Y(K,w);ae(K,g,t);h(K,D);ak(D);z||b.addToQueue(function(){var ao=[K];if(ag.hasOwnProperty("statereadychange")){var an=ag.statereadychange,ap;for(ap=0;ap<an.length;ap+=1){an[ap].apply(null,ao)}}})}K.state===odf.OdfContainer.DONE?s():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),c=runtime.setTimeout(function l(){K.state===odf.OdfContainer.DONE?s():(runtime.log("will be back later..."),c=runtime.setTimeout(l,500))},100))}function C(l){b.clearQueue();aj.innerHTML="";aj.appendChild(aj.ownerDocument.createTextNode(runtime.tr("Loading")+l+"..."));aj.removeAttribute("style");K=new odf.OdfContainer(l,function(s){K=s;r(!1)})}runtime.assert(null!==aj&&void 0!==aj,"odf.OdfCanvas constructor needs DOM element");runtime.assert(null!==aj.ownerDocument&&void 0!==aj.ownerDocument,"odf.OdfCanvas constructor needs DOM");var p=this,m=aj.ownerDocument,K,g=new odf.Formatting,q,d=null,y=null,f=!1,n=!1,al=null,k,w,t,u,N,ag={},c,v,ah=!1,ai=!1,b=new aa,am=new gui.ZoomHelper,a=H||new gui.SingleScrollViewport(aj.parentNode);this.refreshCSS=function(){ah=!0;v.trigger()};this.refreshSize=function(){v.trigger()};this.odfContainer=function(){return K};this.setOdfContainer=function(s,l){K=s;r(!0===l)};this.load=this.load=C;this.save=function(l){K.save(l)};this.addListener=function(s,l){switch(s){case"click":var D=aj,z=s;D.addEventListener?D.addEventListener(z,l,!1):D.attachEvent?D.attachEvent("on"+z,l):D["on"+z]=l;break;default:D=ag.hasOwnProperty(s)?ag[s]:ag[s]=[],l&&-1===D.indexOf(l)&&D.push(l)}};this.getFormatting=function(){return g};this.getAnnotationViewManager=function(){return al};this.refreshAnnotations=function(){ak(K.rootElement)};this.rerenderAnnotations=function(){al&&(ai=!0,v.trigger())};this.getSizer=function(){return d};this.enableAnnotations=function(s,l){s!==f&&(f=s,n=l,K&&ak(K.rootElement))};this.addAnnotation=function(l){al&&(al.addAnnotation(l),I())};this.forgetAnnotations=function(){al&&(al.forgetAnnotations(),I())};this.getZoomHelper=function(){return am};this.setZoomLevel=function(l){am.setZoomLevel(l)};this.getZoomLevel=function(){return am.getZoomLevel()};this.fitToContainingElement=function(s,l){var D=am.getZoomLevel(),z=aj.offsetHeight/D,D=s/(aj.offsetWidth/D);l/z<D&&(D=l/z);am.setZoomLevel(D)};this.fitToWidth=function(s){var l=aj.offsetWidth/am.getZoomLevel();am.setZoomLevel(s/l)};this.fitSmart=function(s,l){var D,z;z=am.getZoomLevel();D=aj.offsetWidth/z;z=aj.offsetHeight/z;D=s/D;void 0!==l&&l/z<D&&(D=l/z);am.setZoomLevel(Math.min(1,D))};this.fitToHeight=function(s){var l=aj.offsetHeight/am.getZoomLevel();am.setZoomLevel(s/l)};this.showFirstPage=function(){q.showFirstPage()};this.showNextPage=function(){q.showNextPage()};this.showPreviousPage=function(){q.showPreviousPage()};this.showPage=function(l){q.showPage(l);I()};this.getElement=function(){return aj};this.getViewport=function(){return a};this.addCssForFrameWithImage=function(s){var l=s.getAttributeNS(J,"name"),z=s.firstElementChild;V(l,s,u.sheet);z&&R(l+"img",K,z,u.sheet)};this.destroy=function(s){var l=m.getElementsByTagName("head")[0],z=[q.destroy,v.destroy];runtime.clearTimeout(c);y&&y.parentNode&&y.parentNode.removeChild(y);am.destroy(function(){d&&(aj.removeChild(d),d=null)});M(k);l.removeChild(w);l.removeChild(t);l.removeChild(u);core.Async.destroyAll(z,s)};k=E(m);q=new X(A(m));w=A(m);t=A(m);u=A(m);v=core.Task.createRedrawTask(function(){ah&&(ae(K,g,t),ah=!1);ai&&(al&&al.rerenderAnnotations(),ai=!1);I()});am.subscribe(gui.ZoomHelper.signalZoomChanged,I)}})();odf.StepUtils=function(){this.getContentBounds=function(e){var c=e.container(),b,g;runtime.assert(e.isStep(),"Step iterator must be on a step");c.nodeType===Node.TEXT_NODE&&0<e.offset()?b=e.offset():(c=e.leftNode())&&c.nodeType===Node.TEXT_NODE&&(b=c.length);c&&(c.nodeType===Node.TEXT_NODE?(runtime.assert(0<b,"Empty text node found"),g={container:c,startOffset:b-1,endOffset:b}):g={container:c,startOffset:0,endOffset:c.childNodes.length});return g}};ops.MemberProperties=function(){};ops.Member=function(d,c){var b=new ops.MemberProperties;this.getMemberId=function(){return d};this.getProperties=function(){return b};this.setProperties=function(a){Object.keys(a).forEach(function(e){b[e]=a[e]})};this.removeProperties=function(a){Object.keys(a).forEach(function(e){"fullName"!==e&&"color"!==e&&"imageUrl"!==e&&b.hasOwnProperty(e)&&delete b[e]})};runtime.assert(Boolean(d),"No memberId was supplied!");c.fullName||(c.fullName=runtime.tr("Unknown Author"));c.color||(c.color="black");c.imageUrl||(c.imageUrl="avatar-joe.png");b=c};ops.Document=function(){};ops.Document.prototype.getMemberIds=function(){};ops.Document.prototype.removeCursor=function(a){};ops.Document.prototype.getDocumentElement=function(){};ops.Document.prototype.getRootNode=function(){};ops.Document.prototype.getDOMDocument=function(){};ops.Document.prototype.cloneDocumentElement=function(){};ops.Document.prototype.setDocumentElement=function(a){};ops.Document.prototype.subscribe=function(b,a){};ops.Document.prototype.unsubscribe=function(b,a){};ops.Document.prototype.getCanvas=function(){};ops.Document.prototype.createRootFilter=function(a){};ops.Document.prototype.createPositionIterator=function(a){};ops.Document.signalCursorAdded="cursor/added";ops.Document.signalCursorRemoved="cursor/removed";ops.Document.signalCursorMoved="cursor/moved";ops.Document.signalMemberAdded="member/added";ops.Document.signalMemberUpdated="member/updated";ops.Document.signalMemberRemoved="member/removed";ops.OdtCursor=function(j,g){var e=this,l={},c,i,m=new core.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){i.remove()};this.subscribe=function(f,d){m.subscribe(f,d)};this.unsubscribe=function(f,d){m.unsubscribe(f,d)};this.getMemberId=function(){return j};this.getNode=function(){return i.getNode()};this.getAnchorNode=function(){return i.getAnchorNode()};this.getSelectedRange=function(){return i.getSelectedRange()};this.setSelectedRange=function(a,f){i.setSelectedRange(a,f);m.emit(ops.OdtCursor.signalCursorUpdated,e)};this.hasForwardSelection=function(){return i.hasForwardSelection()};this.getDocument=function(){return g};this.getSelectionType=function(){return c};this.setSelectionType=function(b){l.hasOwnProperty(b)?c=b:runtime.log("Invalid selection type: "+b)};this.resetSelectionType=function(){e.setSelectionType(ops.OdtCursor.RangeSelection)};i=new core.Cursor(g.getDOMDocument(),j);l[ops.OdtCursor.RangeSelection]=!0;l[ops.OdtCursor.RegionSelection]=!0;e.resetSelectionType()};ops.OdtCursor.RangeSelection="Range";ops.OdtCursor.RegionSelection="Region";ops.OdtCursor.signalCursorUpdated="cursorUpdated";(function(){var a=0;ops.StepsCache=function(I,P,M){function O(e,d){var g=this;this.nodeId=e;this.steps=-1;this.node=d;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(b){b.setPositionBeforeElement(d);M(g.steps,b)}}function J(g,d,k){var h=this;this.nodeId=g;this.steps=d;this.node=k;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(b){b.setUnfilteredPosition(k,0);M(h.steps,b)}}function F(e,d){var g="["+e.nodeId;d&&(g+=" => "+d.nodeId);return g+"]"}function D(){for(var h=f,g,n,l,m=new core.LoopWatchDog(0,100000),k={};h;){m.check();(g=h.previousBookmark)?runtime.assert(g.nextBookmark===h,"Broken bookmark link to previous @"+F(g,h)):(runtime.assert(h===f,"Broken bookmark link @"+F(h)),runtime.assert(void 0===o||f===f||f.steps<=o,"Base point is damaged @"+F(h)));(n=h.nextBookmark)&&runtime.assert(n.previousBookmark===h,"Broken bookmark link to next @"+F(h,n));if(void 0===o||h===f||h.steps<=o){runtime.assert(A.containsNode(I,h.node),"Disconnected node is being reported as undamaged @"+F(h)),g&&(l=h.node.compareDocumentPosition(g.node),runtime.assert(0===l||0!==(l&j),"Bookmark order with previous does not reflect DOM order @"+F(g,h))),n&&A.containsNode(I,n.node)&&(l=h.node.compareDocumentPosition(n.node),runtime.assert(0===l||0!==(l&B),"Bookmark order with next does not reflect DOM order @"+F(h,n)))}h=h.nextBookmark}Object.keys(K).forEach(function(d){var c=K[d];(void 0===o||d<=o)&&runtime.assert(c.steps<=d,"Bookmark step of "+c.steps+" exceeds cached step lookup for "+d+" @"+F(c));runtime.assert(!1===k.hasOwnProperty(c.nodeId),"Bookmark "+F(c)+" appears twice in cached step lookup at steps "+k[c.nodeId]+" and "+d);k[c.nodeId]=d})}function G(d){var c="";d.nodeType===Node.ELEMENT_NODE&&(c=d.getAttributeNS(E,"nodeId")||"");return c}function H(d){var c=a.toString();d.setAttributeNS(E,"nodeId",c);a+=1;return c}function C(g){var l,h,k=new core.LoopWatchDog(0,10000);void 0!==o&&g>o&&(g=o);for(l=Math.floor(g/P)*P;!h&&0<=l;){h=K[l],l-=P}for(h=h||f;h.nextBookmark&&h.nextBookmark.steps<=g;){k.check(),h=h.nextBookmark}runtime.assert(-1===g||h.steps<=g,"Bookmark @"+F(h)+" at step "+h.steps+" exceeds requested step of "+g);return h}function N(b){b.previousBookmark&&(b.previousBookmark.nextBookmark=b.nextBookmark);b.nextBookmark&&(b.nextBookmark.previousBookmark=b.previousBookmark)}function L(e){for(var d,g=null;!g&&e&&e!==I;){(d=G(e))&&(g=i[d])&&g.node!==e&&(runtime.log("Cloned node detected. Creating new bookmark"),g=null,e.removeAttributeNS(E,"nodeId")),e=e.parentNode}return g}var E="urn:webodf:names:steps",K={},i={},A=core.DomUtils,f,o,B=Node.DOCUMENT_POSITION_FOLLOWING,j=Node.DOCUMENT_POSITION_PRECEDING,z;this.updateBookmark=function(l,m){var g,b=Math.ceil(l/P)*P,k,r,c;if(void 0!==o&&o<l){k=C(o);for(r=k.nextBookmark;r&&r.steps<=l;){g=r.nextBookmark,c=Math.ceil(r.steps/P)*P,K[c]===r&&delete K[c],A.containsNode(I,r.node)?r.steps=l+1:(N(r),delete i[r.nodeId]),r=g}o=l}else{k=C(l)}r=G(m)||H(m);g=i[r];g?g.node!==m&&(runtime.log("Cloned node detected. Creating new bookmark"),r=H(m),g=i[r]=new O(r,m)):g=i[r]=new O(r,m);r=g;r.steps!==l&&(g=Math.ceil(r.steps/P)*P,g!==b&&K[g]===r&&delete K[g],r.steps=l);if(k!==r&&k.nextBookmark!==r){if(k.steps===r.steps){for(;0!==(r.node.compareDocumentPosition(k.node)&B)&&k!==f;){k=k.previousBookmark}}k!==r&&k.nextBookmark!==r&&(N(r),g=k.nextBookmark,r.nextBookmark=k.nextBookmark,r.previousBookmark=k,k.nextBookmark=r,g&&(g.previousBookmark=r))}k=K[b];if(!k||r.steps>k.steps){K[b]=r}z()};this.setToClosestStep=function(e,d){var g;z();g=C(e);g.setIteratorPosition(d);return g.steps};this.setToClosestDomPoint=function(g,e,l){var k,h;z();if(g===I&&0===e){k=f}else{if(g===I&&e===I.childNodes.length){for(h in k=f,K){K.hasOwnProperty(h)&&(g=K[h],g.steps>k.steps&&(k=g))}}else{if(k=L(g.childNodes.item(e)||g),!k){for(l.setUnfilteredPosition(g,e);!k&&l.previousNode();){k=L(l.getCurrentNode())}}}}k=k||f;void 0!==o&&k.steps>o&&(k=C(o));k.setIteratorPosition(l);return k.steps};this.damageCacheAfterStep=function(b){0>b&&(b=-1);void 0===o?o=b:b<o&&(o=b);z()};(function(){var b=G(I)||H(I);f=new J(b,0,I);z=ops.StepsCache.ENABLE_CACHE_VERIFICATION?D:function(){}})()};ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1;ops.StepsCache.Bookmark=function(){};ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(b){}})();(function(){ops.OdtStepsTranslator=function(z,v,F,B){function D(f,d,h){var g=d.getCurrentNode();d.isBeforeNode()&&i.isParagraph(g)&&(h||(f+=1),u.updateBookmark(f,g))}function w(b,a){do{if(F.acceptPosition(a)===o){D(b,a,!0);break}D(b-1,a,!1)}while(a.nextPosition())}function s(){var b=z();b!==t&&(t&&runtime.log("Undo detected. Resetting steps cache"),t=b,u=new ops.StepsCache(t,B,w),A=v(t))}function j(a,d){if(!d||F.acceptPosition(a)===o){return !0}for(;a.previousPosition();){if(F.acceptPosition(a)===o){if(d(y,a.container(),a.unfilteredDomOffset())){return !0}break}}for(;a.nextPosition();){if(F.acceptPosition(a)===o){if(d(E,a.container(),a.unfilteredDomOffset())){return !0}break}}return !1}var t,u,i=odf.OdfUtils,C=core.DomUtils,A,o=core.PositionFilter.FilterResult.FILTER_ACCEPT,y=core.StepDirection.PREVIOUS,E=core.StepDirection.NEXT;this.convertStepsToDomPoint=function(e){var b,a;if(isNaN(e)){throw new TypeError("Requested steps is not numeric ("+e+")")}if(0>e){throw new RangeError("Requested steps is negative ("+e+")")}s();for(b=u.setToClosestStep(e,A);b<e&&A.nextPosition();){(a=F.acceptPosition(A)===o)&&(b+=1),D(b,A,a)}if(b!==e){throw new RangeError("Requested steps ("+e+") exceeds available steps ("+b+")")}return{node:A.container(),offset:A.unfilteredDomOffset()}};this.convertDomPointToSteps=function(e,b,c){var a;s();C.containsNode(t,e)||(b=0>C.comparePoints(t,0,e,b),e=t,b=b?0:t.childNodes.length);A.setUnfilteredPosition(e,b);j(A,c)||A.setUnfilteredPosition(e,b);c=A.container();b=A.unfilteredDomOffset();e=u.setToClosestDomPoint(c,b,A);if(0>C.comparePoints(A.container(),A.unfilteredDomOffset(),c,b)){return 0<e?e-1:e}for(;(A.container()!==c||A.unfilteredDomOffset()!==b)&&A.nextPosition();){(a=F.acceptPosition(A)===o)&&(e+=1),D(e,A,a)}return e+0};this.prime=function(){var b,a;s();for(b=u.setToClosestStep(0,A);A.nextPosition();){(a=F.acceptPosition(A)===o)&&(b+=1),D(b,A,a)}};this.handleStepsInserted=function(b){s();u.damageCacheAfterStep(b.position)};this.handleStepsRemoved=function(b){s();u.damageCacheAfterStep(b.position-1)};s()}})();ops.Operation=function(){};ops.Operation.prototype.init=function(a){};ops.Operation.prototype.execute=function(a){};ops.Operation.prototype.spec=function(){};ops.TextPositionFilter=function(){function j(f,d){for(;f&&d(f)!==i;){f=f.previousSibling}return f}function g(a,n,f,h){var o;if(n){if(e.isInlineRoot(n)&&e.isGroupingElement(f)){return m}h=e.lookLeftForCharacter(n);if(1===h||2===h&&(e.scanRightForAnyCharacter(f)||e.scanRightForAnyCharacter(e.nextNode(a)))){return i}}else{if(e.isGroupingElement(a)&&e.isInlineRoot(j(a.previousSibling,h))){return i}}h=null===n&&e.isParagraph(a);o=e.lookRightForCharacter(f);if(h){return o?i:e.scanRightForAnyCharacter(f)?m:i}if(!o){return m}n=n||e.previousNode(a);return e.scanLeftForAnyCharacter(n)?m:i}var e=odf.OdfUtils,l=Node.ELEMENT_NODE,c=Node.TEXT_NODE,i=core.PositionFilter.FilterResult.FILTER_ACCEPT,m=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(h){var a=h.container(),b=a.nodeType,d,n,k;if(b!==l&&b!==c){return m}if(b===c){b=h.unfilteredDomOffset();d=a.data;runtime.assert(b!==d.length,"Unexpected offset.");if(0<b){h=d[b-1];if(!e.isODFWhitespace(h)){return i}if(1<b){if(h=d[b-2],!e.isODFWhitespace(h)){k=i}else{if(!e.isODFWhitespace(d.substr(0,b))){return m}}}else{n=e.previousNode(a),e.scanLeftForNonSpace(n)&&(k=i)}if(k===i){return e.isTrailingWhitespace(a,b)?m:i}h=d[b];return e.isODFWhitespace(h)?m:e.scanLeftForAnyCharacter(e.previousNode(a))?m:i}n=h.leftNode();k=a;a=a.parentNode;k=g(a,n,k,h.getNodeFilter())}else{e.isGroupingElement(a)?(n=h.leftNode(),k=h.rightNode(),k=g(a,n,k,h.getNodeFilter())):k=m}return k}};ops.OdtDocument=function(Y){function V(b){return new core.PositionIterator(b,O,i,!1)}function ad(){var d=Y.odfContainer().getContentElement(),c=d&&d.localName;runtime.assert("text"===c,"Unsupported content element type '"+c+"' for OdtDocument");return d}function aa(){return ab.getDocumentElement().ownerDocument}function ac(b){for(;b&&!(b.namespaceURI===odf.Namespaces.officens&&"text"===b.localName||b.namespaceURI===odf.Namespaces.officens&&"annotation"===b.localName);){b=b.parentNode}return b}function W(b){this.acceptPosition=function(d){d=d.container();var a;a="string"===typeof b?B[b].getNode():b;return ac(d)===ac(a)?G:M}}function S(g,f,l,h){h=V(h);var k;1===l.length?k=l[0]:(k=new core.PositionFilterChain,l.forEach(k.addFilter));l=new core.StepIterator(k,h);l.setPosition(g,f);return l}function Q(a){var d=V(ad());a=j.convertStepsToDomPoint(a);d.setUnfilteredPosition(a.node,a.offset);return d}function T(b){return b===F}function U(g){var e,l=[],k,h=2;runtime.assert(g.isStep(),"positionIterator is not at a step");do{if(e=Z.getContentBounds(g)){if(e=e.container,R.isDowngradableSpaceElement(e)){for(k=e.lastChild;e.firstChild;){l.push(e.firstChild),e.parentNode.insertBefore(e.firstChild,e)}e.parentNode.removeChild(e);g.setPosition(k,k.nodeType===Node.TEXT_NODE?k.length:k.childNodes.length);g.roundToPreviousStep()}}h-=1}while(0<h&&g.nextStep());l.forEach(X.normalizeTextNodes)}function P(e,d,f){e=e.childNodes.item(d)||e;return(e=R.getParagraphElement(e))&&X.containsNode(f,e)?e:f}var ab=this,Z,R=odf.OdfUtils,X=core.DomUtils,B={},K={},o=new core.EventNotifier([ops.Document.signalMemberAdded,ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,ops.Document.signalCursorRemoved,ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,ops.OdtDocument.signalMetadataUpdated,ops.OdtDocument.signalAnnotationAdded]),G=core.PositionFilter.FilterResult.FILTER_ACCEPT,M=core.PositionFilter.FilterResult.FILTER_REJECT,F=core.StepDirection.NEXT,J,j,E,O=NodeFilter.SHOW_ALL,L=new gui.BlacklistNamespaceNodeFilter(["urn:webodf:names:cursor","urn:webodf:names:editinfo"]),A=new gui.OdfTextBodyNodeFilter,i=new core.NodeFilterChain([L,A]);this.createPositionIterator=V;this.getDocumentElement=function(){return Y.odfContainer().rootElement};this.cloneDocumentElement=function(){var d=ab.getDocumentElement(),c=Y.getAnnotationViewManager();c&&c.forgetAnnotations();d=d.cloneNode(!0);Y.refreshAnnotations();return d};this.setDocumentElement=function(d){var c=Y.odfContainer();c.setRootElement(d);Y.setOdfContainer(c,!0);Y.refreshCSS()};this.getDOMDocument=aa;this.getRootElement=ac;this.createStepIterator=S;this.getIteratorAtPosition=Q;this.convertCursorStepToDomPoint=function(b){return j.convertStepsToDomPoint(b)};this.convertDomPointToCursorStep=function(f,d,h){var g;h===F&&(g=T);return j.convertDomPointToSteps(f,d,g)};this.convertDomToCursorRange=function(d){var c;c=j.convertDomPointToSteps(d.anchorNode,d.anchorOffset);d=d.anchorNode===d.focusNode&&d.anchorOffset===d.focusOffset?c:j.convertDomPointToSteps(d.focusNode,d.focusOffset);return{position:c,length:d-c}};this.convertCursorToDomRange=function(f,d){var l=aa().createRange(),k,h;k=j.convertStepsToDomPoint(f);d?(h=j.convertStepsToDomPoint(f+d),0<d?(l.setStart(k.node,k.offset),l.setEnd(h.node,h.offset)):(l.setStart(h.node,h.offset),l.setEnd(k.node,k.offset))):l.setStart(k.node,k.offset);return l};this.upgradeWhitespacesAtPosition=function(k){var e=Q(k),e=new core.StepIterator(J,e),q,p=2;runtime.assert(e.isStep(),"positionIterator is not at a step (requested step: "+k+")");do{if(q=Z.getContentBounds(e)){if(k=q.container,q=q.startOffset,k.nodeType===Node.TEXT_NODE&&R.isSignificantWhitespace(k,q)){runtime.assert(" "===k.data[q],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");var m=k.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),n=k.parentNode,l=k;m.appendChild(k.ownerDocument.createTextNode(" "));1===k.length?n.replaceChild(m,k):(k.deleteData(q,1),0<q&&(q<k.length&&k.splitText(q),l=k.nextSibling),n.insertBefore(m,l));k=m;e.setPosition(k,k.childNodes.length);e.roundToPreviousStep()}}p-=1}while(0<p&&e.nextStep())};this.downgradeWhitespaces=U;this.downgradeWhitespacesAtPosition=function(b){b=Q(b);b=new core.StepIterator(J,b);U(b)};this.getTextNodeAtStep=function(d,c){var q=Q(d),l=q.container(),m,k=0,n=null;l.nodeType===Node.TEXT_NODE?(m=l,k=q.unfilteredDomOffset(),0<m.length&&(0<k&&(m=m.splitText(k)),m.parentNode.insertBefore(aa().createTextNode(""),m),m=m.previousSibling,k=0)):(m=aa().createTextNode(""),k=0,l.insertBefore(m,q.rightNode()));if(c){if(B[c]&&ab.getCursorPosition(c)===d){for(n=B[c].getNode();n.nextSibling&&"cursor"===n.nextSibling.localName;){n.parentNode.insertBefore(n.nextSibling,n)}0<m.length&&m.nextSibling!==n&&(m=aa().createTextNode(""),k=0);n.parentNode.insertBefore(m,n)}}else{for(;m.nextSibling&&"cursor"===m.nextSibling.localName;){m.parentNode.insertBefore(m.nextSibling,m)}}for(;m.previousSibling&&m.previousSibling.nodeType===Node.TEXT_NODE;){q=m.previousSibling,q.appendData(m.data),k=q.length,m=q,m.parentNode.removeChild(m.nextSibling)}for(;m.nextSibling&&m.nextSibling.nodeType===Node.TEXT_NODE;){q=m.nextSibling,m.appendData(q.data),m.parentNode.removeChild(q)}return{textNode:m,offset:k}};this.fixCursorPositions=function(){Object.keys(B).forEach(function(c){var r=B[c],s=ac(r.getNode()),m=ab.createRootFilter(s),n,k,q,b=!1;q=r.getSelectedRange();n=P(q.startContainer,q.startOffset,s);k=S(q.startContainer,q.startOffset,[J,m],n);q.collapsed?s=k:(n=P(q.endContainer,q.endOffset,s),s=S(q.endContainer,q.endOffset,[J,m],n));k.isStep()&&s.isStep()?k.container()!==s.container()||k.offset()!==s.offset()||q.collapsed&&r.getAnchorNode()===r.getNode()||(b=!0,q.setStart(k.container(),k.offset()),q.collapse(!0)):(b=!0,runtime.assert(k.roundToClosestStep(),"No walkable step found for cursor owned by "+c),q.setStart(k.container(),k.offset()),runtime.assert(s.roundToClosestStep(),"No walkable step found for cursor owned by "+c),q.setEnd(s.container(),s.offset()));b&&(r.setSelectedRange(q,r.hasForwardSelection()),ab.emit(ops.Document.signalCursorMoved,r))})};this.getCursorPosition=function(b){return(b=B[b])?j.convertDomPointToSteps(b.getNode(),0):0};this.getCursorSelection=function(e){e=B[e];var d=0,f=0;e&&(d=j.convertDomPointToSteps(e.getNode(),0),f=j.convertDomPointToSteps(e.getAnchorNode(),0));return{position:f,length:d-f}};this.getPositionFilter=function(){return J};this.getOdfCanvas=function(){return Y};this.getCanvas=function(){return Y};this.getRootNode=ad;this.addMember=function(b){runtime.assert(void 0===K[b.getMemberId()],"This member already exists");K[b.getMemberId()]=b};this.getMember=function(b){return K.hasOwnProperty(b)?K[b]:null};this.removeMember=function(b){delete K[b]};this.getCursor=function(b){return B[b]};this.getMemberIds=function(){var d=[],c;for(c in B){B.hasOwnProperty(c)&&d.push(B[c].getMemberId())}return d};this.addCursor=function(d){runtime.assert(Boolean(d),"OdtDocument::addCursor without cursor");var c=d.getMemberId(),f=ab.convertCursorToDomRange(0,0);runtime.assert("string"===typeof c,"OdtDocument::addCursor has cursor without memberid");runtime.assert(!B[c],"OdtDocument::addCursor is adding a duplicate cursor with memberid "+c);d.setSelectedRange(f,!0);B[c]=d};this.removeCursor=function(d){var c=B[d];return c?(c.removeFromDocument(),delete B[d],ab.emit(ops.Document.signalCursorRemoved,d),!0):!1};this.moveCursor=function(f,c,g,h){f=B[f];c=ab.convertCursorToDomRange(c,g);f&&(f.setSelectedRange(c,0<=g),f.setSelectionType(h||ops.OdtCursor.RangeSelection))};this.getFormatting=function(){return Y.getFormatting()};this.emit=function(d,c){o.emit(d,c)};this.subscribe=function(d,c){o.subscribe(d,c)};this.unsubscribe=function(d,c){o.unsubscribe(d,c)};this.createRootFilter=function(b){return new W(b)};this.close=function(b){b()};this.destroy=function(b){b()};J=new ops.TextPositionFilter;Z=new odf.StepUtils;j=new ops.OdtStepsTranslator(ad,V,J,500);o.subscribe(ops.OdtDocument.signalStepsInserted,j.handleStepsInserted);o.subscribe(ops.OdtDocument.signalStepsRemoved,j.handleStepsRemoved);o.subscribe(ops.OdtDocument.signalOperationEnd,function(f){var c=f.spec(),g=c.memberid,h=(new Date(c.timestamp)).toISOString(),c=Y.odfContainer();f.isEdit&&(g=ab.getMember(g).getProperties().fullName,c.setMetadata({"dc:creator":g,"dc:date":h},null),g={setProperties:{"dc:creator":g,"dc:date":h},removedProperties:[]},E||(g.setProperties["meta:editing-cycles"]=c.incrementEditingCycles(),c.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),E=f,ab.emit(ops.OdtDocument.signalMetadataUpdated,g))});o.subscribe(ops.OdtDocument.signalProcessingBatchEnd,core.Task.processTasks)};ops.OdtDocument.signalParagraphChanged="paragraph/changed";ops.OdtDocument.signalTableAdded="table/added";ops.OdtDocument.signalCommonStyleCreated="style/created";ops.OdtDocument.signalCommonStyleDeleted="style/deleted";ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified";ops.OdtDocument.signalOperationStart="operation/start";ops.OdtDocument.signalOperationEnd="operation/end";ops.OdtDocument.signalProcessingBatchStart="router/batchstart";ops.OdtDocument.signalProcessingBatchEnd="router/batchend";ops.OdtDocument.signalUndoStackChanged="undo/changed";ops.OdtDocument.signalStepsInserted="steps/inserted";ops.OdtDocument.signalStepsRemoved="steps/removed";ops.OdtDocument.signalMetadataUpdated="metadata/updated";ops.OdtDocument.signalAnnotationAdded="annotation/added";ops.OpAddAnnotation=function(){function j(k,h,o){var n=k.getTextNodeAtStep(o,g);n&&(k=n.textNode,o=k.parentNode,n.offset!==k.length&&k.splitText(n.offset),o.insertBefore(h,k.nextSibling),0===k.length&&o.removeChild(k))}var g,e,l,c,i,m;this.init=function(a){g=a.memberid;e=parseInt(a.timestamp,10);l=parseInt(a.position,10);c=parseInt(a.length,10)||0;i=a.name};this.isEdit=!0;this.group=void 0;this.execute=function(h){var a=h.getCursor(g),b,f;m=h.getDOMDocument();var o=new Date(e),n,k,d;n=m.createElementNS(odf.Namespaces.officens,"office:annotation");n.setAttributeNS(odf.Namespaces.officens,"office:name",i);b=m.createElementNS(odf.Namespaces.dcns,"dc:creator");b.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g);b.textContent=h.getMember(g).getProperties().fullName;f=m.createElementNS(odf.Namespaces.dcns,"dc:date");f.appendChild(m.createTextNode(o.toISOString()));o=m.createElementNS(odf.Namespaces.textns,"text:list");k=m.createElementNS(odf.Namespaces.textns,"text:list-item");d=m.createElementNS(odf.Namespaces.textns,"text:p");k.appendChild(d);o.appendChild(k);n.appendChild(b);n.appendChild(f);n.appendChild(o);c&&(b=m.createElementNS(odf.Namespaces.officens,"office:annotation-end"),b.setAttributeNS(odf.Namespaces.officens,"office:name",i),n.annotationEndElement=b,j(h,b,l+c));j(h,n,l);h.emit(ops.OdtDocument.signalStepsInserted,{position:l});a&&(b=m.createRange(),f=n.getElementsByTagNameNS(odf.Namespaces.textns,"p")[0],b.selectNodeContents(f),a.setSelectedRange(b,!1),a.setSelectionType(ops.OdtCursor.RangeSelection),h.emit(ops.Document.signalCursorMoved,a));h.getOdfCanvas().addAnnotation(n);h.fixCursorPositions();h.emit(ops.OdtDocument.signalAnnotationAdded,{memberId:g,annotation:n});return !0};this.spec=function(){return{optype:"AddAnnotation",memberid:g,timestamp:e,position:l,length:c,name:i}}};ops.OpAddCursor=function(){var b,a;this.init=function(c){b=c.memberid;a=c.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(c){var e=c.getCursor(b);if(e){return !1}e=new ops.OdtCursor(b,c);c.addCursor(e);c.emit(ops.Document.signalCursorAdded,e);return !0};this.spec=function(){return{optype:"AddCursor",memberid:b,timestamp:a}}};ops.OpAddMember=function(){var d,c,b;this.init=function(a){d=a.memberid;c=parseInt(a.timestamp,10);b=a.setProperties};this.isEdit=!1;this.group=void 0;this.execute=function(e){var a;if(e.getMember(d)){return !1}a=new ops.Member(d,b);e.addMember(a);e.emit(ops.Document.signalMemberAdded,a);return !0};this.spec=function(){return{optype:"AddMember",memberid:d,timestamp:c,setProperties:b}}};ops.OpAddStyle=function(){var j,g,e,l,c,i,m=odf.Namespaces.stylens;this.init=function(a){j=a.memberid;g=a.timestamp;e=a.styleName;l=a.styleFamily;c="true"===a.isAutomaticStyle||!0===a.isAutomaticStyle;i=a.setProperties};this.isEdit=!0;this.group=void 0;this.execute=function(h){var a=h.getOdfCanvas().odfContainer(),b=h.getFormatting(),d=h.getDOMDocument().createElementNS(m,"style:style");if(!d){return !1}i&&b.updateStyle(d,i);d.setAttributeNS(m,"style:family",l);d.setAttributeNS(m,"style:name",e);c?a.rootElement.automaticStyles.appendChild(d):a.rootElement.styles.appendChild(d);h.getOdfCanvas().refreshCSS();c||h.emit(ops.OdtDocument.signalCommonStyleCreated,{name:e,family:l});return !0};this.spec=function(){return{optype:"AddStyle",memberid:j,timestamp:g,styleName:e,styleFamily:l,isAutomaticStyle:c,setProperties:i}}};odf.ObjectNameGenerator=function(u,s){function z(e,d){var f={};this.generateName=function(){var b=d(),c=0,a;do{a=e+c,c+=1}while(f[a]||b[a]);f[a]=!0;return a}}function w(){var b={};[u.rootElement.automaticStyles,u.rootElement.styles].forEach(function(a){for(a=a.firstElementChild;a;){a.namespaceURI===y&&"style"===a.localName&&(b[a.getAttributeNS(y,"name")]=!0),a=a.nextElementSibling}});return b}var y=odf.Namespaces.stylens,t=odf.Namespaces.drawns,j=odf.Namespaces.xlinkns,i=(new core.Utils).hashString(s),o=null,p=null,g=null,x={},v={};this.generateStyleName=function(){null===o&&(o=new z("auto"+i+"_",function(){return w()}));return o.generateName()};this.generateFrameName=function(){var a,c,f;if(null===p){c=u.rootElement.body.getElementsByTagNameNS(t,"frame");for(a=0;a<c.length;a+=1){f=c.item(a),x[f.getAttributeNS(t,"name")]=!0}p=new z("fr"+i+"_",function(){return x})}return p.generateName()};this.generateImageName=function(){var a,f,e;if(null===g){e=u.rootElement.body.getElementsByTagNameNS(t,"image");for(a=0;a<e.length;a+=1){f=e.item(a),f=f.getAttributeNS(j,"href"),f=f.substring(9,f.lastIndexOf(".")),v[f]=!0}g=new z("img"+i+"_",function(){return v})}return g.generateName()}};odf.TextStyleApplicator=function(l,i,r){function o(f){function d(b,k){return"object"===typeof b&&"object"===typeof k?Object.keys(b).every(function(a){return d(b[a],k[a])}):b===k}var h={};this.isStyleApplied=function(a){a=i.getAppliedStylesForElement(a,h).styleProperties;return d(f,a)}}function p(a){var f={};this.applyStyleToContainer=function(q){var k;k=q.getAttributeNS(c,"style-name");var b=q.ownerDocument;k=k||"";if(!f.hasOwnProperty(k)){var d=k,m;m=k?i.createDerivedStyleObject(k,"text",a):a;b=b.createElementNS(g,"style:style");i.updateStyle(b,m);b.setAttributeNS(g,"style:name",l.generateStyleName());b.setAttributeNS(g,"style:family","text");b.setAttributeNS("urn:webodf:names:scope","scope","document-content");r.appendChild(b);f[d]=b}k=f[k].getAttributeNS(g,"name");q.setAttributeNS(c,"text:style-name",k)}}function j(m,k){var v=m.ownerDocument,t=m.parentNode,u,q,s,n=new core.LoopWatchDog(10000);q=[];q.push(m);for(s=m.nextSibling;s&&e.rangeContainsNode(k,s);){n.check(),q.push(s),s=s.nextSibling}"span"!==t.localName||t.namespaceURI!==c?(u=v.createElementNS(c,"text:span"),t.insertBefore(u,m),v=!1):(m.previousSibling&&!e.rangeContainsNode(k,t.firstChild)?(u=t.cloneNode(!1),t.parentNode.insertBefore(u,t.nextSibling)):u=t,v=!0);q.forEach(function(b){b.parentNode!==u&&u.appendChild(b)});if(s&&v){for(q=u.cloneNode(!1),u.parentNode.insertBefore(q,u.nextSibling);s;){n.check(),v=s.nextSibling,q.appendChild(s),s=v}}return u}var e=core.DomUtils,c=odf.Namespaces.textns,g=odf.Namespaces.stylens;this.applyStyle=function(d,k,u){var s={},q,h,t,b;runtime.assert(u&&u.hasOwnProperty("style:text-properties"),"applyStyle without any text properties");s["style:text-properties"]=u["style:text-properties"];t=new p(s);b=new o(s);d.forEach(function(f){q=b.isStyleApplied(f);!1===q&&(h=j(f,k),t.applyStyleToContainer(h))})}};ops.OpApplyDirectStyling=function(){function l(k,h,q){var r=k.getOdfCanvas().odfContainer(),p=j.splitBoundaries(h),n=o.getTextNodes(h,!1);(new odf.TextStyleApplicator(new odf.ObjectNameGenerator(r,g),k.getFormatting(),r.rootElement.automaticStyles)).applyStyle(n,h,q);p.forEach(j.normalizeTextNodes)}var g,e,m,c,i,o=odf.OdfUtils,j=core.DomUtils;this.init=function(a){g=a.memberid;e=a.timestamp;m=parseInt(a.position,10);c=parseInt(a.length,10);i=a.setProperties};this.isEdit=!0;this.group=void 0;this.execute=function(a){var b=a.convertCursorToDomRange(m,c),d=o.getParagraphElements(b);l(a,b,i);b.detach();a.getOdfCanvas().refreshCSS();a.fixCursorPositions();d.forEach(function(f){a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:f,memberId:g,timeStamp:e})});a.getOdfCanvas().rerenderAnnotations();return !0};this.spec=function(){return{optype:"ApplyDirectStyling",memberid:g,timestamp:e,position:m,length:c,setProperties:i}}};ops.OpApplyHyperlink=function(){function l(b){for(;b;){if(j.isHyperlink(b)){return !0}b=b.parentNode}return !1}var g,e,m,c,i,o=core.DomUtils,j=odf.OdfUtils;this.init=function(a){g=a.memberid;e=a.timestamp;m=a.position;c=a.length;i=a.hyperlink};this.isEdit=!0;this.group=void 0;this.execute=function(a){var b=a.getDOMDocument(),d=a.convertCursorToDomRange(m,c),k=o.splitBoundaries(d),h=[],f=j.getTextNodes(d,!1);if(0===f.length){return !1}f.forEach(function(p){var n=j.getParagraphElement(p);runtime.assert(!1===l(p),"The given range should not contain any link.");var r=i,q=b.createElementNS(odf.Namespaces.textns,"text:a");q.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple");q.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",r);p.parentNode.insertBefore(q,p);q.appendChild(p);-1===h.indexOf(n)&&h.push(n)});k.forEach(o.normalizeTextNodes);d.detach();a.fixCursorPositions();a.getOdfCanvas().refreshSize();a.getOdfCanvas().rerenderAnnotations();h.forEach(function(n){a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:n,memberId:g,timeStamp:e})});return !0};this.spec=function(){return{optype:"ApplyHyperlink",memberid:g,timestamp:e,position:m,length:c,hyperlink:i}}};ops.OpInsertImage=function(){var u,s,z,w,y,t,j,i,o=odf.Namespaces.drawns,p=odf.Namespaces.svgns,g=odf.Namespaces.textns,x=odf.Namespaces.xlinkns,v=odf.OdfUtils;this.init=function(a){u=a.memberid;s=a.timestamp;z=a.position;w=a.filename;y=a.frameWidth;t=a.frameHeight;j=a.frameStyleName;i=a.frameName};this.isEdit=!0;this.group=void 0;this.execute=function(f){var e=f.getOdfCanvas(),a=f.getTextNodeAtStep(z,u),c,h;if(!a){return !1}c=a.textNode;h=v.getParagraphElement(c);var a=a.offset!==c.length?c.splitText(a.offset):c.nextSibling,b=f.getDOMDocument(),d=b.createElementNS(o,"draw:image"),b=b.createElementNS(o,"draw:frame");d.setAttributeNS(x,"xlink:href",w);d.setAttributeNS(x,"xlink:type","simple");d.setAttributeNS(x,"xlink:show","embed");d.setAttributeNS(x,"xlink:actuate","onLoad");b.setAttributeNS(o,"draw:style-name",j);b.setAttributeNS(o,"draw:name",i);b.setAttributeNS(g,"text:anchor-type","as-char");b.setAttributeNS(p,"svg:width",y);b.setAttributeNS(p,"svg:height",t);b.appendChild(d);c.parentNode.insertBefore(b,a);f.emit(ops.OdtDocument.signalStepsInserted,{position:z});0===c.length&&c.parentNode.removeChild(c);e.addCssForFrameWithImage(b);e.refreshCSS();f.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:h,memberId:u,timeStamp:s});e.rerenderAnnotations();return !0};this.spec=function(){return{optype:"InsertImage",memberid:u,timestamp:s,filename:w,position:z,frameWidth:y,frameHeight:t,frameStyleName:j,frameName:i}}};ops.OpInsertTable=function(){function s(b,h){var d;if(1===j.length){d=j[0]}else{if(3===j.length){switch(b){case 0:d=j[0];break;case t-1:d=j[2];break;default:d=j[1]}}else{d=j[b]}}if(1===d.length){return d[0]}if(3===d.length){switch(h){case 0:return d[0];case u-1:return d[2];default:return d[1]}}return d[h]}var o,v,t,u,p,g,e,i,j,c=odf.OdfUtils;this.init=function(a){o=a.memberid;v=a.timestamp;p=a.position;t=a.initialRows;u=a.initialColumns;g=a.tableName;e=a.tableStyleName;i=a.tableColumnStyleName;j=a.tableCellStyleMatrix};this.isEdit=!0;this.group=void 0;this.execute=function(h){var f=h.getTextNodeAtStep(p),a=h.getRootNode();if(f){var d=h.getDOMDocument(),b=d.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),q=d.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column"),k,n,r,m;e&&b.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",e);g&&b.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",g);q.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:number-columns-repeated",u);i&&q.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",i);b.appendChild(q);for(r=0;r<t;r+=1){q=d.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row");for(m=0;m<u;m+=1){k=d.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(n=s(r,m))&&k.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",n),n=d.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:p"),k.appendChild(n),q.appendChild(k)}b.appendChild(q)}f=c.getParagraphElement(f.textNode);a.insertBefore(b,f.nextSibling);h.emit(ops.OdtDocument.signalStepsInserted,{position:p});h.getOdfCanvas().refreshSize();h.emit(ops.OdtDocument.signalTableAdded,{tableElement:b,memberId:o,timeStamp:v});h.getOdfCanvas().rerenderAnnotations();return !0}return !1};this.spec=function(){return{optype:"InsertTable",memberid:o,timestamp:v,position:p,initialRows:t,initialColumns:u,tableName:g,tableStyleName:e,tableColumnStyleName:i,tableCellStyleMatrix:j}}};ops.OpInsertText=function(){var j,g,e,l,c,i=odf.OdfUtils;this.init=function(a){j=a.memberid;g=a.timestamp;e=a.position;c=a.text;l="true"===a.moveCursor||!0===a.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(f){var b,h,k,a=null,u=f.getDOMDocument(),s,d=0,o,v=f.getCursor(j),w;f.upgradeWhitespacesAtPosition(e);if(b=f.getTextNodeAtStep(e)){h=b.textNode;a=h.nextSibling;k=h.parentNode;s=i.getParagraphElement(h);for(w=0;w<c.length;w+=1){if("\t"===c[w]||"\t"!==c[w]&&i.isODFWhitespace(c[w])&&(0===w||w===c.length-1||"\t"!==c[w-1]&&i.isODFWhitespace(c[w-1]))){0===d?(b.offset!==h.length&&(a=h.splitText(b.offset)),0<w&&h.appendData(c.substring(0,w))):d<w&&(d=c.substring(d,w),k.insertBefore(u.createTextNode(d),a)),d=w+1,"\t"===c[w]?(o=u.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab"),o.appendChild(u.createTextNode("\t"))):(" "!==c[w]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+c.charCodeAt(w)+")"),o=u.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s"),o.appendChild(u.createTextNode(" "))),k.insertBefore(o,a)}}0===d?h.insertData(b.offset,c):d<c.length&&(b=c.substring(d),k.insertBefore(u.createTextNode(b),a));k=h.parentNode;a=h.nextSibling;k.removeChild(h);k.insertBefore(h,a);0===h.length&&h.parentNode.removeChild(h);f.emit(ops.OdtDocument.signalStepsInserted,{position:e});v&&l&&(f.moveCursor(j,e+c.length,0),f.emit(ops.Document.signalCursorMoved,v));f.downgradeWhitespacesAtPosition(e);f.downgradeWhitespacesAtPosition(e+c.length);f.getOdfCanvas().refreshSize();f.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:s,memberId:j,timeStamp:g});f.getOdfCanvas().rerenderAnnotations();return !0}return !1};this.spec=function(){return{optype:"InsertText",memberid:j,timestamp:g,position:e,text:c,moveCursor:l}}};odf.CollapsingRules=function(h){function g(b){return i.isODFNode(b)||"br"===b.localName&&i.isLineBreak(b.parentNode)||b.nodeType===Node.TEXT_NODE&&i.isODFNode(b.parentNode)}function e(a){var b;a.nodeType===Node.TEXT_NODE?(b=a.parentNode,b.removeChild(a)):b=c.removeUnwantedNodes(a,g);return b&&!i.isParagraph(b)&&b!==h&&i.hasNoODFContent(b)?e(b):b}var i=odf.OdfUtils,c=core.DomUtils;this.mergeChildrenIntoParent=e};ops.OpMergeParagraph=function(){function u(b){return g.isGroupingElement(b)&&g.hasNoODFContent(b)}function s(b){if(b.nodeType===Node.TEXT_NODE){if(0===b.length){return runtime.log("WARN: Empty text node found during merge operation"),!0}if(g.isODFWhitespace(b.data)&&!1===g.isSignificantWhitespace(b,0)){return !0}b="#text"}else{b=(b.prefix?b.prefix+":":"")+b.localName}runtime.log("WARN: Unexpected text element found near paragraph boundary ["+b+"]");return !1}function z(b){b.collapsed||(x.splitBoundaries(b),b=g.getTextElements(b,!1,!0).filter(s),b.forEach(function(c){c.parentNode.removeChild(c)}))}function w(f,d,k){f=f.convertCursorStepToDomPoint(d);var h=g.getParagraphElement(f.node,f.offset);runtime.assert(Boolean(h),"Paragraph not found at step "+d);k&&k.setPosition(f.node,f.offset);return h}var y,t,j,i,o,p,g=odf.OdfUtils,x=core.DomUtils,v=odf.Namespaces.textns;this.init=function(b){y=b.memberid;t=b.timestamp;j=b.moveCursor;i=b.paragraphStyleName;o=parseInt(b.sourceStartPosition,10);p=parseInt(b.destinationStartPosition,10)};this.isEdit=!0;this.group=void 0;this.execute=function(h){var f,c,e=h.getCursor(y);f=h.getRootNode();var l=new odf.CollapsingRules(f),b=h.createStepIterator(f,0,[h.getPositionFilter()],f),d;runtime.assert(p<o,"Destination paragraph ("+p+") must be before source paragraph ("+o+")");c=w(h,p);f=w(h,o,b);b.previousStep();runtime.assert(x.containsNode(c,b.container()),"Destination paragraph must be adjacent to the source paragraph");d=c.ownerDocument.createRange();b.setPosition(c,c.childNodes.length);b.roundToPreviousStep();d.setStart(b.container(),b.offset());d.setEnd(c,c.childNodes.length);z(d);d=c.childNodes.length;var a=f.ownerDocument.createRange();b.setPosition(f,0);b.roundToNextStep();a.setStart(f,0);a.setEnd(b.container(),b.offset());z(a);for(a=f.firstChild;a;){"editinfo"===a.localName?f.removeChild(a):(c.appendChild(a),x.removeUnwantedNodes(a,u)),a=f.firstChild}runtime.assert(0===f.childNodes.length,"Source paragraph should be empty before it is removed");l.mergeChildrenIntoParent(f);h.emit(ops.OdtDocument.signalStepsRemoved,{position:o-1});b.setPosition(c,d);b.roundToClosestStep();b.previousStep()||b.roundToNextStep();h.downgradeWhitespaces(b);i?c.setAttributeNS(v,"text:style-name",i):c.removeAttributeNS(v,"style-name");e&&j&&(h.moveCursor(y,o-1,0),h.emit(ops.Document.signalCursorMoved,e));h.fixCursorPositions();h.getOdfCanvas().refreshSize();h.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:c,memberId:y,timeStamp:t});h.getOdfCanvas().rerenderAnnotations();return !0};this.spec=function(){return{optype:"MergeParagraph",memberid:y,timestamp:t,moveCursor:j,paragraphStyleName:i,sourceStartPosition:o,destinationStartPosition:p}}};ops.OpMoveCursor=function(){var h,g,e,i,c;this.init=function(a){h=a.memberid;g=a.timestamp;e=a.position;i=a.length||0;c=a.selectionType||ops.OdtCursor.RangeSelection};this.isEdit=!1;this.group=void 0;this.execute=function(b){var d=b.getCursor(h),a;if(!d){return !1}a=b.convertCursorToDomRange(e,i);d.setSelectedRange(a,0<=i);d.setSelectionType(c);b.emit(ops.Document.signalCursorMoved,d);return !0};this.spec=function(){return{optype:"MoveCursor",memberid:h,timestamp:g,position:e,length:i,selectionType:c}}};ops.OpRemoveAnnotation=function(){var h,g,e,i,c=core.DomUtils;this.init=function(a){h=a.memberid;g=a.timestamp;e=parseInt(a.position,10);i=parseInt(a.length,10)};this.isEdit=!0;this.group=void 0;this.execute=function(l){function j(d){a.parentNode.insertBefore(d,a)}for(var b=l.getIteratorAtPosition(e).container(),a;b.namespaceURI!==odf.Namespaces.officens||"annotation"!==b.localName;){b=b.parentNode}if(null===b){return !1}a=b;b=a.annotationEndElement;l.getOdfCanvas().forgetAnnotations();c.getElementsByTagNameNS(a,"urn:webodf:names:cursor","cursor").forEach(j);c.getElementsByTagNameNS(a,"urn:webodf:names:cursor","anchor").forEach(j);a.parentNode.removeChild(a);b&&b.parentNode.removeChild(b);l.emit(ops.OdtDocument.signalStepsRemoved,{position:0<e?e-1:e});l.fixCursorPositions();l.getOdfCanvas().refreshAnnotations();return !0};this.spec=function(){return{optype:"RemoveAnnotation",memberid:h,timestamp:g,position:e,length:i}}};ops.OpRemoveBlob=function(){var d,c,b;this.init=function(a){d=a.memberid;c=a.timestamp;b=a.filename};this.isEdit=!0;this.group=void 0;this.execute=function(a){a.getOdfCanvas().odfContainer().removeBlob(b);return !0};this.spec=function(){return{optype:"RemoveBlob",memberid:d,timestamp:c,filename:b}}};ops.OpRemoveCursor=function(){var b,a;this.init=function(c){b=c.memberid;a=c.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(c){return c.removeCursor(b)?!0:!1};this.spec=function(){return{optype:"RemoveCursor",memberid:b,timestamp:a}}};ops.OpRemoveHyperlink=function(){var j,g,e,l,c=core.DomUtils,i=odf.OdfUtils;this.init=function(a){j=a.memberid;g=a.timestamp;e=a.position;l=a.length};this.isEdit=!0;this.group=void 0;this.execute=function(d){var b=d.convertCursorToDomRange(e,l),a=i.getHyperlinkElements(b);runtime.assert(1===a.length,"The given range should only contain a single link.");a=c.mergeIntoParent(a[0]);b.detach();d.fixCursorPositions();d.getOdfCanvas().refreshSize();d.getOdfCanvas().rerenderAnnotations();d.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:i.getParagraphElement(a),memberId:j,timeStamp:g});return !0};this.spec=function(){return{optype:"RemoveHyperlink",memberid:j,timestamp:g,position:e,length:l}}};ops.OpRemoveMember=function(){var b,a;this.init=function(c){b=c.memberid;a=parseInt(c.timestamp,10)};this.isEdit=!1;this.group=void 0;this.execute=function(c){if(!c.getMember(b)){return !1}c.removeMember(b);c.emit(ops.Document.signalMemberRemoved,b);return !0};this.spec=function(){return{optype:"RemoveMember",memberid:b,timestamp:a}}};ops.OpRemoveStyle=function(){var e,c,b,g;this.init=function(a){e=a.memberid;c=a.timestamp;b=a.styleName;g=a.styleFamily};this.isEdit=!0;this.group=void 0;this.execute=function(a){var d=a.getFormatting().getStyleElement(b,g);if(!d){return !1}d.parentNode.removeChild(d);a.getOdfCanvas().refreshCSS();a.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:b,family:g});return !0};this.spec=function(){return{optype:"RemoveStyle",memberid:e,timestamp:c,styleName:b,styleFamily:g}}};ops.OpRemoveText=function(){var j,g,e,l,c=odf.OdfUtils,i=core.DomUtils;this.init=function(a){runtime.assert(0<=a.length,"OpRemoveText only supports positive lengths");j=a.memberid;g=a.timestamp;e=parseInt(a.position,10);l=parseInt(a.length,10)};this.isEdit=!0;this.group=void 0;this.execute=function(k){var f,a,b,d=k.getCursor(j),h=new odf.CollapsingRules(k.getRootNode());k.upgradeWhitespacesAtPosition(e);k.upgradeWhitespacesAtPosition(e+l);f=k.convertCursorToDomRange(e,l);i.splitBoundaries(f);a=c.getTextElements(f,!1,!0);b=c.getParagraphElement(f.startContainer,f.startOffset);runtime.assert(void 0!==b,"Attempting to remove text outside a paragraph element");f.detach();a.forEach(function(m){m.parentNode?(runtime.assert(i.containsNode(b,m),"RemoveText only supports removing elements within the same paragraph"),h.mergeChildrenIntoParent(m)):runtime.log("WARN: text element has already been removed from it's container")});k.emit(ops.OdtDocument.signalStepsRemoved,{position:e});k.downgradeWhitespacesAtPosition(e);k.fixCursorPositions();k.getOdfCanvas().refreshSize();k.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:b,memberId:j,timeStamp:g});d&&(d.resetSelectionType(),k.emit(ops.Document.signalCursorMoved,d));k.getOdfCanvas().rerenderAnnotations();return !0};this.spec=function(){return{optype:"RemoveText",memberid:j,timestamp:g,position:e,length:l}}};ops.OpSetBlob=function(){var h,g,e,i,c;this.init=function(a){h=a.memberid;g=a.timestamp;e=a.filename;i=a.mimetype;c=a.content};this.isEdit=!0;this.group=void 0;this.execute=function(a){a.getOdfCanvas().odfContainer().setBlob(e,i,c);return !0};this.spec=function(){return{optype:"SetBlob",memberid:h,timestamp:g,filename:e,mimetype:i,content:c}}};ops.OpSetParagraphStyle=function(){function j(m,k,p){var o=[m.getPositionFilter()],n=p.container();p=p.unfilteredDomOffset();return !1===m.createStepIterator(n,p,o,k).previousStep()}var g,e,l,c,i=odf.OdfUtils;this.init=function(a){g=a.memberid;e=a.timestamp;l=a.position;c=a.styleName};this.isEdit=!0;this.group=void 0;this.execute=function(d){var b,a;b=d.getIteratorAtPosition(l);return(a=i.getParagraphElement(b.container()))?(runtime.assert(j(d,a,b),"SetParagraphStyle position should be the first position in the paragraph"),c?a.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",c):a.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),d.getOdfCanvas().refreshSize(),d.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:a,timeStamp:e,memberId:g}),d.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"SetParagraphStyle",memberid:g,timestamp:e,position:l,styleName:c}}};ops.OpSplitParagraph=function(){var l,g,e,m,c,i,o=odf.OdfUtils,j=odf.Namespaces.textns;this.init=function(a){l=a.memberid;g=a.timestamp;m=a.position;e=a.sourceParagraphPosition;i=a.paragraphStyleName;c="true"===a.moveCursor||!0===a.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(q){var f,b,n,k,d,h,s,u=q.getCursor(l);q.upgradeWhitespacesAtPosition(m);f=q.getTextNodeAtStep(m);if(!f){return !1}b=o.getParagraphElement(f.textNode);if(!b){return !1}n=o.isListItem(b.parentNode)?b.parentNode:b;0===f.offset?(s=f.textNode.previousSibling,h=null):(s=f.textNode,h=f.offset>=f.textNode.length?null:f.textNode.splitText(f.offset));for(k=f.textNode;k!==n;){k=k.parentNode;d=k.cloneNode(!1);h&&d.appendChild(h);if(s){for(;s&&s.nextSibling;){d.appendChild(s.nextSibling)}}else{for(;k.firstChild;){d.appendChild(k.firstChild)}}k.parentNode.insertBefore(d,k.nextSibling);s=k;h=d}o.isListItem(h)&&(h=h.childNodes.item(0));i?h.setAttributeNS(j,"text:style-name",i):h.removeAttributeNS(j,"style-name");0===f.textNode.length&&f.textNode.parentNode.removeChild(f.textNode);q.emit(ops.OdtDocument.signalStepsInserted,{position:m});u&&c&&(q.moveCursor(l,m+1,0),q.emit(ops.Document.signalCursorMoved,u));q.fixCursorPositions();q.getOdfCanvas().refreshSize();q.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:b,memberId:l,timeStamp:g});q.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:h,memberId:l,timeStamp:g});q.getOdfCanvas().rerenderAnnotations();return !0};this.spec=function(){return{optype:"SplitParagraph",memberid:l,timestamp:g,position:m,sourceParagraphPosition:e,paragraphStyleName:i,moveCursor:c}}};ops.OpUpdateMember=function(){function h(f){var d="//dc:creator[@editinfo:memberid='"+g+"']";f=xmldom.XPath.getODFElementsWithXPath(f.getRootNode(),d,function(b){return"editinfo"===b?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(b)});for(d=0;d<f.length;d+=1){f[d].textContent=i.fullName}}var g,e,i,c;this.init=function(a){g=a.memberid;e=parseInt(a.timestamp,10);i=a.setProperties;c=a.removedProperties};this.isEdit=!1;this.group=void 0;this.execute=function(b){var d=b.getMember(g);if(!d){return !1}c&&d.removeProperties(c);i&&(d.setProperties(i),i.fullName&&h(b));b.emit(ops.Document.signalMemberUpdated,d);return !0};this.spec=function(){return{optype:"UpdateMember",memberid:g,timestamp:e,setProperties:i,removedProperties:c}}};ops.OpUpdateMetadata=function(){var e,c,b,g;this.init=function(a){e=a.memberid;c=parseInt(a.timestamp,10);b=a.setProperties;g=a.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(a){var d=a.getOdfCanvas().odfContainer(),h=null;g&&(h=g.attributes.split(","));d.setMetadata(b,h);a.emit(ops.OdtDocument.signalMetadataUpdated,{setProperties:null!==b?b:{},removedProperties:null!==h?h:[]});return !0};this.spec=function(){return{optype:"UpdateMetadata",memberid:e,timestamp:c,setProperties:b,removedProperties:g}}};ops.OpUpdateParagraphStyle=function(){function j(k,h){var o,n,p=h?h.split(","):[];for(o=0;o<p.length;o+=1){n=p[o].split(":"),k.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(n[0]),n[1])}}var g,e,l,c,i,m=odf.Namespaces.stylens;this.init=function(a){g=a.memberid;e=a.timestamp;l=a.styleName;c=a.setProperties;i=a.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(d){var f=d.getFormatting(),b,h,n;return(b=""!==l?f.getStyleElement(l,"paragraph"):f.getDefaultStyleElement("paragraph"))?(h=b.getElementsByTagNameNS(m,"paragraph-properties").item(0),n=b.getElementsByTagNameNS(m,"text-properties").item(0),c&&f.updateStyle(b,c),i&&(f=i["style:paragraph-properties"],h&&f&&(j(h,f.attributes),0===h.attributes.length&&b.removeChild(h)),f=i["style:text-properties"],n&&f&&(j(n,f.attributes),0===n.attributes.length&&b.removeChild(n)),j(b,i.attributes)),d.getOdfCanvas().refreshCSS(),d.emit(ops.OdtDocument.signalParagraphStyleModified,l),d.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"UpdateParagraphStyle",memberid:g,timestamp:e,styleName:l,setProperties:c,removedProperties:i}}};ops.OperationFactory=function(){function b(c){return function(e){return new c}}var a;this.register=function(c,e){a[c]=e};this.create=function(e){var f=null,c=a[e.optype];c&&(f=c(e),f.init(e));return f};a={AddMember:b(ops.OpAddMember),UpdateMember:b(ops.OpUpdateMember),RemoveMember:b(ops.OpRemoveMember),AddCursor:b(ops.OpAddCursor),ApplyDirectStyling:b(ops.OpApplyDirectStyling),SetBlob:b(ops.OpSetBlob),RemoveBlob:b(ops.OpRemoveBlob),InsertImage:b(ops.OpInsertImage),InsertTable:b(ops.OpInsertTable),InsertText:b(ops.OpInsertText),RemoveText:b(ops.OpRemoveText),MergeParagraph:b(ops.OpMergeParagraph),SplitParagraph:b(ops.OpSplitParagraph),SetParagraphStyle:b(ops.OpSetParagraphStyle),UpdateParagraphStyle:b(ops.OpUpdateParagraphStyle),AddStyle:b(ops.OpAddStyle),RemoveStyle:b(ops.OpRemoveStyle),MoveCursor:b(ops.OpMoveCursor),RemoveCursor:b(ops.OpRemoveCursor),AddAnnotation:b(ops.OpAddAnnotation),RemoveAnnotation:b(ops.OpRemoveAnnotation),UpdateMetadata:b(ops.OpUpdateMetadata),ApplyHyperlink:b(ops.OpApplyHyperlink),RemoveHyperlink:b(ops.OpRemoveHyperlink)}};ops.OperationRouter=function(){};ops.OperationRouter.prototype.setOperationFactory=function(a){};ops.OperationRouter.prototype.setPlaybackFunction=function(a){};ops.OperationRouter.prototype.push=function(a){};ops.OperationRouter.prototype.close=function(a){};ops.OperationRouter.prototype.subscribe=function(b,a){};ops.OperationRouter.prototype.unsubscribe=function(b,a){};ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){};ops.OperationRouter.prototype.hasSessionHostConnection=function(){};ops.OperationRouter.signalProcessingBatchStart="router/batchstart";ops.OperationRouter.signalProcessingBatchEnd="router/batchend";ops.TrivialOperationRouter=function(){var e=new core.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),c,b,g=0;this.setOperationFactory=function(d){c=d};this.setPlaybackFunction=function(a){b=a};this.push=function(a){g+=1;e.emit(ops.OperationRouter.signalProcessingBatchStart,{});a.forEach(function(d){d=d.spec();d.timestamp=Date.now();d=c.create(d);d.group="g"+g;b(d)});e.emit(ops.OperationRouter.signalProcessingBatchEnd,{})};this.close=function(d){d()};this.subscribe=function(f,h){e.subscribe(f,h)};this.unsubscribe=function(f,h){e.unsubscribe(f,h)};this.hasLocalUnsyncedOps=function(){return !1};this.hasSessionHostConnection=function(){return !0}};ops.Session=function(j){function g(b){c.emit(ops.OdtDocument.signalProcessingBatchStart,b)}function e(b){c.emit(ops.OdtDocument.signalProcessingBatchEnd,b)}var l=new ops.OperationFactory,c=new ops.OdtDocument(j),i=null;this.setOperationFactory=function(b){l=b;i&&i.setOperationFactory(l)};this.setOperationRouter=function(a){i&&(i.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,g),i.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,e));i=a;i.subscribe(ops.OperationRouter.signalProcessingBatchStart,g);i.subscribe(ops.OperationRouter.signalProcessingBatchEnd,e);a.setPlaybackFunction(function(b){c.emit(ops.OdtDocument.signalOperationStart,b);return b.execute(c)?(c.emit(ops.OdtDocument.signalOperationEnd,b),!0):!1});a.setOperationFactory(l)};this.getOperationFactory=function(){return l};this.getOdtDocument=function(){return c};this.enqueue=function(b){i.push(b)};this.close=function(b){i.close(function(a){a?b(a):c.close(b)})};this.destroy=function(b){c.destroy(b)};this.setOperationRouter(new ops.TrivialOperationRouter)};gui.AnnotationController=function(t,p,x){function u(){var a=g.getCursor(x),a=a&&a.getNode(),d=!1;a&&(d=!e.isWithinAnnotation(a,g.getRootNode()));d!==j&&(j=d,o.emit(gui.AnnotationController.annotatableChanged,j))}function w(a){a.getMemberId()===x&&u()}function s(a){a===x&&u()}function i(a){a.getMemberId()===x&&u()}var g=t.getOdtDocument(),j=!1,o=new core.EventNotifier([gui.AnnotationController.annotatableChanged]),e=odf.OdfUtils,v=core.StepDirection.NEXT;this.isAnnotatable=function(){return j};this.addAnnotation=function(){var a=new ops.OpAddAnnotation,h=g.getCursorSelection(x),f=h.length,h=h.position;j&&(h=0<=f?h:h+f,f=Math.abs(f),a.init({memberid:x,position:h,length:f,name:x+Date.now()}),t.enqueue([a]))};this.removeAnnotation=function(a){var f,c;f=g.getMember(x).getProperties().fullName;if(!0!==p.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)||f===e.getAnnotationCreator(a)){f=g.convertDomPointToCursorStep(a,0,v),c=g.convertDomPointToCursorStep(a,a.childNodes.length),a=new ops.OpRemoveAnnotation,a.init({memberid:x,position:f,length:c-f}),c=new ops.OpMoveCursor,c.init({memberid:x,position:0<f?f-1:f,length:0}),t.enqueue([a,c])}};this.subscribe=function(d,c){o.subscribe(d,c)};this.unsubscribe=function(d,c){o.unsubscribe(d,c)};this.destroy=function(b){g.unsubscribe(ops.Document.signalCursorAdded,w);g.unsubscribe(ops.Document.signalCursorRemoved,s);g.unsubscribe(ops.Document.signalCursorMoved,i);b()};p.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN);g.subscribe(ops.Document.signalCursorAdded,w);g.subscribe(ops.Document.signalCursorRemoved,s);g.subscribe(ops.Document.signalCursorMoved,i);u()};gui.AnnotationController.annotatableChanged="annotatable/changed";gui.Avatar=function(j,g){var e=this,l,c,i;this.setColor=function(b){c.style.borderColor=b};this.setImageUrl=function(a){e.isVisible()?c.src=a:i=a};this.isVisible=function(){return"block"===l.style.display};this.show=function(){i&&(c.src=i,i=void 0);l.style.display="block"};this.hide=function(){l.style.display="none"};this.markAsFocussed=function(b){b?l.classList.add("active"):l.classList.remove("active")};this.destroy=function(b){j.removeChild(l);b()};(function(){var b=j.ownerDocument;l=b.createElement("div");c=b.createElement("img");l.appendChild(c);l.style.display=g?"block":"none";l.className="handle";j.appendChild(l)})()};gui.StepInfo=function(){};gui.StepInfo.VisualDirection={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1};gui.StepInfo.prototype.container=function(){};gui.StepInfo.prototype.offset=function(){};gui.VisualStepScanner=function(){};gui.VisualStepScanner.prototype.process=function(d,c,b){};gui.GuiStepUtils=function(){function j(a){a=e.getContentBounds(a);var k,d=null;if(a){if(a.container.nodeType===Node.TEXT_NODE){k=a.container.ownerDocument.createRange(),k.setStart(a.container,a.startOffset),k.setEnd(a.container,a.endOffset),(d=0<k.getClientRects().length?k.getBoundingClientRect():null)&&" "===a.container.data.substring(a.startOffset,a.endOffset)&&1>=d.width&&(d=null),k.detach()}else{if(g.isCharacterElement(a.container)||g.isCharacterFrame(a.container)){d=l.getBoundingClientRect(a.container)}}}return d}var g=odf.OdfUtils,e=new odf.StepUtils,l=core.DomUtils,c=core.StepDirection.NEXT,i=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT,m=gui.StepInfo.VisualDirection.RIGHT_TO_LEFT;this.getContentRect=j;this.moveToFilteredStep=function(w,q,f){function h(k,d){d.process(z,n,u)&&(k=!0,!A&&d.token&&(A=d.token));return k}var r=q===c,o,b,n,u,A,s=w.snapshot();o=!1;var z;do{o=j(w),z={token:w.snapshot(),container:w.container,offset:w.offset,direction:q,visualDirection:q===c?i:m},b=w.nextStep()?j(w):null,w.restore(z.token),r?(n=o,u=b):(n=b,u=o),o=f.reduce(h,!1)}while(!o&&w.advanceStep(q));o||f.forEach(function(d){!A&&d.token&&(A=d.token)});w.restore(A||s);return Boolean(A)}};gui.Caret=function(U,R,Z,W){function Y(){L.style.opacity="0"===L.style.opacity?"1":"0";B.trigger()}function S(){T.selectNodeContents(N);return T.getBoundingClientRect()}function O(){Object.keys(K).forEach(function(b){I[b]=K[b]})}function M(){if(!1===K.isShown||U.getSelectionType()!==ops.OdtCursor.RangeSelection||!W&&!U.getSelectedRange().collapsed){K.visibility="hidden",L.style.visibility="hidden",B.cancel()}else{if(K.visibility="visible",L.style.visibility="visible",!1===K.isFocused){L.style.opacity="1",B.cancel()}else{if(F||I.visibility!==K.visibility){L.style.opacity="1",B.cancel()}B.trigger()}}if(A||i){var e;e=U.getNode();var d,f,k=G.getBoundingClientRect(o.getSizer()),c=!1,h=0;e.removeAttributeNS("urn:webodf:names:cursor","caret-sizer-active");if(0<e.getClientRects().length){f=S(),h=f.left-G.getBoundingClientRect(e).left,c=!0}else{if(E.setPosition(e,0),f=j.getContentRect(E),!f&&E.nextStep()&&(d=j.getContentRect(E))&&(f=d,c=!0),f||(e.setAttributeNS("urn:webodf:names:cursor","caret-sizer-active","true"),f=S(),c=!0),!f){for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+U.getMemberId());e;){if(0<e.getClientRects().length){f=G.getBoundingClientRect(e);c=!0;break}e=e.parentNode}}}f=G.translateRect(f,k,o.getZoomLevel());e={top:f.top,height:f.height,right:c?f.left:f.right,width:G.adaptRangeDifferenceToZoomLevel(h,o.getZoomLevel())};8>e.height&&(e={top:e.top-(8-e.height)/2,height:8,right:e.right});Q.style.height=e.height+"px";Q.style.top=e.top+"px";Q.style.left=e.right-e.width+"px";Q.style.width=e.width?e.width+"px":"";V&&(e=runtime.getWindow().getComputedStyle(U.getNode(),null),e.font?V.style.font=e.font:(V.style.fontStyle=e.fontStyle,V.style.fontVariant=e.fontVariant,V.style.fontWeight=e.fontWeight,V.style.fontSize=e.fontSize,V.style.lineHeight=e.lineHeight,V.style.fontFamily=e.fontFamily))}K.isShown&&i&&R.scrollIntoView(L.getBoundingClientRect());I.isFocused!==K.isFocused&&X.markAsFocussed(K.isFocused);O();A=i=F=!1}function P(b){Q.parentNode.removeChild(Q);N.parentNode.removeChild(N);b()}var Q,L,X,V,N,T,o=U.getDocument().getCanvas(),G=core.DomUtils,j=new gui.GuiStepUtils,E,J,B,F=!1,i=!1,A=!1,K={isFocused:!1,isShown:!0,visibility:"hidden"},I={isFocused:!K.isFocused,isShown:!K.isShown,visibility:"hidden"};this.handleUpdate=function(){A=!0;J.trigger()};this.refreshCursorBlinking=function(){F=!0;J.trigger()};this.setFocus=function(){K.isFocused=!0;J.trigger()};this.removeFocus=function(){K.isFocused=!1;J.trigger()};this.show=function(){K.isShown=!0;J.trigger()};this.hide=function(){K.isShown=!1;J.trigger()};this.setAvatarImageUrl=function(b){X.setImageUrl(b)};this.setColor=function(b){L.style.borderColor=b;X.setColor(b)};this.getCursor=function(){return U};this.getFocusElement=function(){return L};this.toggleHandleVisibility=function(){X.isVisible()?X.hide():X.show()};this.showHandle=function(){X.show()};this.hideHandle=function(){X.hide()};this.setOverlayElement=function(b){V=b;Q.appendChild(b);A=!0;J.trigger()};this.ensureVisible=function(){i=!0;J.trigger()};this.getBoundingClientRect=function(){return G.getBoundingClientRect(Q)};this.destroy=function(b){core.Async.destroyAll([J.destroy,B.destroy,X.destroy,P],b)};(function(){var b=U.getDocument(),c=[b.createRootFilter(U.getMemberId()),b.getPositionFilter()],a=b.getDOMDocument();T=a.createRange();N=a.createElement("span");N.className="webodf-caretSizer";N.textContent="|";U.getNode().appendChild(N);Q=a.createElement("div");Q.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",U.getMemberId());Q.className="webodf-caretOverlay";L=a.createElement("div");L.className="caret";Q.appendChild(L);X=new gui.Avatar(Q,Z);o.getSizer().appendChild(Q);E=b.createStepIterator(U.getNode(),0,c,b.getRootNode());J=core.Task.createRedrawTask(M);B=core.Task.createTimeoutTask(Y,500);J.triggerImmediate()})()};odf.TextSerializer=function(){function d(g){var a="",e=c.filter?c.filter.acceptNode(g):NodeFilter.FILTER_ACCEPT,i=g.nodeType,f;if((e===NodeFilter.FILTER_ACCEPT||e===NodeFilter.FILTER_SKIP)&&b.isTextContentContainingNode(g)){for(f=g.firstChild;f;){a+=d(f),f=f.nextSibling}}e===NodeFilter.FILTER_ACCEPT&&(i===Node.ELEMENT_NODE&&b.isParagraph(g)?a+="\n":i===Node.TEXT_NODE&&g.textContent&&(a+=g.textContent));return a}var c=this,b=odf.OdfUtils;this.filter=null;this.writeToString=function(e){if(!e){return""}e=d(e);"\n"===e[e.length-1]&&(e=e.substr(0,e.length-1));return e}};gui.MimeDataExporter=function(){var a;this.exportRangeToDataTransfer=function(f,e){var g;g=e.startContainer.ownerDocument.createElement("span");g.appendChild(e.cloneContents());g=a.writeToString(g);try{f.setData("text/plain",g)}catch(c){f.setData("Text",g)}};a=new odf.TextSerializer;a.filter=new odf.OdfNodeFilter};gui.Clipboard=function(a){this.setDataFromRange=function(f,e){var g,c=f.clipboardData;g=runtime.getWindow();!c&&g&&(c=g.clipboardData);c?(g=!0,a.exportRangeToDataTransfer(c,e),f.preventDefault()):g=!1;return g}};gui.SessionContext=function(e,c){var b=e.getOdtDocument(),g=odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var a=b.getCursor(c),d;if(!a){return !1}d=a&&a.getNode();a=b.getMember(c).getProperties().fullName;return(d=g.getParentAnnotation(d,b.getRootNode()))&&g.getAnnotationCreator(d)===a?!0:!1}};gui.StyleSummary=function(h){function g(f,l){var j=f+"|"+l,b;c.hasOwnProperty(j)||(b=[],h.forEach(function(a){a=(a=a.styleProperties[f])&&a[l];-1===b.indexOf(a)&&b.push(a)}),c[j]=b);return c[j]}function e(j,f,k){return function(){var a=g(j,f);return k.length>=a.length&&a.every(function(b){return -1!==k.indexOf(b)})}}function i(j,f){var k=g(j,f);return 1===k.length?k[0]:void 0}var c={};this.getPropertyValues=g;this.getCommonValue=i;this.isBold=e("style:text-properties","fo:font-weight",["bold"]);this.isItalic=e("style:text-properties","fo:font-style",["italic"]);this.hasUnderline=e("style:text-properties","style:text-underline-style",["solid"]);this.hasStrikeThrough=e("style:text-properties","style:text-line-through-style",["solid"]);this.fontSize=function(){var b=i("style:text-properties","fo:font-size");return b&&parseFloat(b)};this.fontName=function(){return i("style:text-properties","style:font-name")};this.isAlignedLeft=e("style:paragraph-properties","fo:text-align",["left","start"]);this.isAlignedCenter=e("style:paragraph-properties","fo:text-align",["center"]);this.isAlignedRight=e("style:paragraph-properties","fo:text-align",["right","end"]);this.isAlignedJustified=e("style:paragraph-properties","fo:text-align",["justify"]);this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName};this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,isAlignedJustified:this.isAlignedJustified}};gui.DirectFormattingController=function(aA,ax,aF,aC,aE,ay,au){function ar(){return j.value().styleSummary}function av(){return j.value().enabledFeatures}function aw(d){var c;d.collapsed?(c=d.startContainer,c.hasChildNodes()&&d.startOffset<c.childNodes.length&&(c=c.childNodes.item(d.startOffset)),d=[c]):d=ag.getTextElements(d,!0,!1);return d}function aq(){var a=S.getCursor(aC),l=a&&a.getSelectedRange(),k=[],k=[],d=!0,h={directTextStyling:!0,directParagraphStyling:!0};l&&(k=aw(l),0===k.length&&(k=[l.startContainer,l.endContainer],d=!1),k=S.getFormatting().getAppliedStyles(k));void 0!==k[0]&&ah&&(k[0].styleProperties=o.mergeObjects(k[0].styleProperties,ah));!0===ax.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(h.directTextStyling=h.directParagraphStyling=aF.isLocalCursorWithinOwnAnnotation());h.directTextStyling&&(h.directTextStyling=d&&void 0!==a&&a.getSelectionType()===ops.OdtCursor.RangeSelection);return{enabledFeatures:h,appliedStyles:k,styleSummary:new gui.StyleSummary(k)}}function aD(e,d){var f={};Object.keys(e).forEach(function(b){var c=e[b](),a=d[b]();c!==a&&(f[b]=a)});return f}function aB(){var h,c;c=ae.styleSummary;var m=j.value(),n=m.styleSummary,k=ae.enabledFeatures,l=m.enabledFeatures;h=aD(c.text,n.text);c=aD(c.paragraph,n.paragraph);k=!(l.directTextStyling===k.directTextStyling&&l.directParagraphStyling===k.directParagraphStyling);ae=m;k&&M.emit(gui.DirectFormattingController.enabledChanged,l);0<Object.keys(h).length&&M.emit(gui.DirectFormattingController.textStylingChanged,h);0<Object.keys(c).length&&M.emit(gui.DirectFormattingController.paragraphStylingChanged,c)}function at(){j.reset();aB()}function az(b){("string"===typeof b?b:b.getMemberId())===aC&&j.reset()}function ak(){j.reset()}function ao(d){var c=S.getCursor(aC);d=d.paragraphElement;c&&ag.getParagraphElement(c.getNode())===d&&j.reset()}function aj(d,c){c(!d());return !0}function am(e){if(av().directTextStyling){var d=S.getCursorSelection(aC),f={"style:text-properties":e};0!==d.length?(e=new ops.OpApplyDirectStyling,e.init({memberid:aC,position:d.position,length:d.length,setProperties:f}),aA.enqueue([e])):(ah=o.mergeObjects(ah||{},f),j.reset())}}function ap(e,d){var f={};f[e]=d;am(f)}function al(b){b=b.spec();ah&&b.memberid===aC&&"SplitParagraph"!==b.optype&&(ah=null,j.reset())}function an(b){ap("fo:font-weight",b?"bold":"normal")}function ai(b){ap("fo:font-style",b?"italic":"normal")}function X(b){ap("style:text-underline-style",b?"solid":"none")}function ad(b){ap("style:text-line-through-style",b?"solid":"none")}function ac(d){if(av().directParagraphStyling){var n=S.getCursor(aC).getSelectedRange(),n=ag.getParagraphElements(n),m=S.getFormatting(),k=[],f={},b;n.forEach(function(h){var e=S.convertDomPointToCursorStep(h,0,L),g=h.getAttributeNS(odf.Namespaces.textns,"style-name"),a;h=g?f.hasOwnProperty(g)?f[g]:void 0:b;h||(h=aE.generateStyleName(),g?(f[g]=h,a=m.createDerivedStyleObject(g,"paragraph",{})):(b=h,a={}),a=d(a),g=new ops.OpAddStyle,g.init({memberid:aC,styleName:h.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:a}),k.push(g));g=new ops.OpSetParagraphStyle;g.init({memberid:aC,styleName:h.toString(),position:e});k.push(g)});aA.enqueue(k)}}function W(b){ac(function(a){return o.mergeObjects(a,b)})}function O(b){W({"style:paragraph-properties":{"fo:text-align":b}})}function R(g,f){var l=S.getFormatting().getDefaultTabStopDistance(),h=f["style:paragraph-properties"],k;h&&(h=h["fo:margin-left"],k=ag.parseLength(h));return o.mergeObjects(f,{"style:paragraph-properties":{"fo:margin-left":k&&k.unit===l.unit?k.value+g*l.value+k.unit:g*l.value+l.unit}})}function Z(g,f){var l=aw(g),l=0===l.length?[g.startContainer]:l,l=S.getFormatting().getAppliedStyles(l),h=0<l.length?l[0].styleProperties:void 0,k=S.getFormatting().getAppliedStylesForElement(f).styleProperties;if(!h||"text"!==h["style:family"]||!h["style:text-properties"]){return !1}if(!k||!k["style:text-properties"]){return !0}h=h["style:text-properties"];k=k["style:text-properties"];return !Object.keys(h).every(function(b){return h[b]===k[b]})}function af(){}function i(){return !1}var F=this,S=aA.getOdtDocument(),o=new core.Utils,ag=odf.OdfUtils,M=new core.EventNotifier([gui.DirectFormattingController.enabledChanged,gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),ab=odf.Namespaces.textns,L=core.StepDirection.NEXT,ah=null,ae,j;this.enabledFeatures=av;this.formatTextSelection=am;this.createCursorStyleOp=function(f,d,l){var k=null,h=ah;l&&(h=(l=j.value().appliedStyles[0])&&l.styleProperties);h&&h["style:text-properties"]&&(k=new ops.OpApplyDirectStyling,k.init({memberid:aC,position:f,length:d,setProperties:{"style:text-properties":h["style:text-properties"]}}),ah=null,j.reset());return k};this.setBold=an;this.setItalic=ai;this.setHasUnderline=X;this.setHasStrikethrough=ad;this.setFontSize=function(b){ap("fo:font-size",b+"pt")};this.setFontName=function(b){ap("style:font-name",b)};this.getAppliedStyles=function(){return j.value().appliedStyles};this.toggleBold=aj.bind(F,function(){return ar().isBold()},an);this.toggleItalic=aj.bind(F,function(){return ar().isItalic()},ai);this.toggleUnderline=aj.bind(F,function(){return ar().hasUnderline()},X);this.toggleStrikethrough=aj.bind(F,function(){return ar().hasStrikeThrough()},ad);this.isBold=function(){return ar().isBold()};this.isItalic=function(){return ar().isItalic()};this.hasUnderline=function(){return ar().hasUnderline()};this.hasStrikeThrough=function(){return ar().hasStrikeThrough()};this.fontSize=function(){return ar().fontSize()};this.fontName=function(){return ar().fontName()};this.isAlignedLeft=function(){return ar().isAlignedLeft()};this.isAlignedCenter=function(){return ar().isAlignedCenter()};this.isAlignedRight=function(){return ar().isAlignedRight()};this.isAlignedJustified=function(){return ar().isAlignedJustified()};this.alignParagraphLeft=function(){O("left");return !0};this.alignParagraphCenter=function(){O("center");return !0};this.alignParagraphRight=function(){O("right");return !0};this.alignParagraphJustified=function(){O("justify");return !0};this.indent=function(){ac(R.bind(null,1));return !0};this.outdent=function(){ac(R.bind(null,-1));return !0};this.createParagraphStyleOps=function(d){if(!av().directParagraphStyling){return[]}var s=S.getCursor(aC),r=s.getSelectedRange(),m=[],n,k;s.hasForwardSelection()?(n=s.getAnchorNode(),k=s.getNode()):(n=s.getNode(),k=s.getAnchorNode());s=ag.getParagraphElement(k);runtime.assert(Boolean(s),"DirectFormattingController: Cursor outside paragraph");var b=s,q=[S.getPositionFilter(),S.createRootFilter(aC)];if(!1!==S.createStepIterator(r.endContainer,r.endOffset,q,b).nextStep()){return m}k!==n&&(s=ag.getParagraphElement(n));if(!ah&&!Z(r,s)){return m}r=(r=j.value().appliedStyles[0])&&r.styleProperties;if(!r){return m}if(s=s.getAttributeNS(ab,"style-name")){r={"style:text-properties":r["style:text-properties"]},r=S.getFormatting().createDerivedStyleObject(s,"paragraph",r)}n=aE.generateStyleName();s=new ops.OpAddStyle;s.init({memberid:aC,styleName:n,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:r});m.push(s);s=new ops.OpSetParagraphStyle;s.init({memberid:aC,styleName:n,position:d});m.push(s);return m};this.subscribe=function(d,c){M.subscribe(d,c)};this.unsubscribe=function(d,c){M.unsubscribe(d,c)};this.destroy=function(b){S.unsubscribe(ops.Document.signalCursorAdded,az);S.unsubscribe(ops.Document.signalCursorRemoved,az);S.unsubscribe(ops.Document.signalCursorMoved,az);S.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,ak);S.unsubscribe(ops.OdtDocument.signalParagraphChanged,ao);S.unsubscribe(ops.OdtDocument.signalOperationEnd,al);S.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,aB);ax.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,at);b()};(function(){S.subscribe(ops.Document.signalCursorAdded,az);S.subscribe(ops.Document.signalCursorRemoved,az);S.subscribe(ops.Document.signalCursorMoved,az);S.subscribe(ops.OdtDocument.signalParagraphStyleModified,ak);S.subscribe(ops.OdtDocument.signalParagraphChanged,ao);S.subscribe(ops.OdtDocument.signalOperationEnd,al);S.subscribe(ops.OdtDocument.signalProcessingBatchEnd,aB);ax.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,at);j=new core.LazyProperty(aq);ae=j.value();ay||(F.formatTextSelection=af,F.setBold=af,F.setItalic=af,F.setHasUnderline=af,F.setHasStrikethrough=af,F.setFontSize=af,F.setFontName=af,F.toggleBold=i,F.toggleItalic=i,F.toggleUnderline=i,F.toggleStrikethrough=i);au||(F.alignParagraphCenter=af,F.alignParagraphJustified=af,F.alignParagraphLeft=af,F.alignParagraphRight=af,F.createParagraphStyleOps=function(){return[]},F.indent=af,F.outdent=af)})()};gui.DirectFormattingController.enabledChanged="enabled/changed";gui.DirectFormattingController.textStylingChanged="textStyling/changed";gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed";gui.DirectFormattingController.SelectionInfo=function(){};gui.KeyboardHandler=function(){function e(f,h){h||(h=c.None);switch(f){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:h|=c.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:h|=c.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:h|=c.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:h|=c.Shift}return f+":"+h}var c=gui.KeyboardHandler.Modifier,b=null,g={};this.setDefault=function(a){b=a};this.bind=function(d,i,f,j){d=e(d,i);runtime.assert(j||!1===g.hasOwnProperty(d),"tried to overwrite the callback handler of key combo: "+d);g[d]=f};this.unbind=function(d,i){var f=e(d,i);delete g[f]};this.reset=function(){b=null;g={}};this.handleEvent=function(a){var d=a.keyCode,f=c.None;a.metaKey&&(f|=c.Meta);a.ctrlKey&&(f|=c.Ctrl);a.altKey&&(f|=c.Alt);a.shiftKey&&(f|=c.Shift);d=e(d,f);d=g[d];f=!1;d?f=d():null!==b&&(f=b(a));f&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}};gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12};gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224};gui.HyperlinkClickHandler=function(w,u,B){function y(){var b=w();runtime.assert(Boolean(b.classList),"Document container has no classList element");b.classList.remove("webodf-inactiveLinks")}function A(){var b=w();runtime.assert(Boolean(b.classList),"Document container has no classList element");b.classList.add("webodf-inactiveLinks")}function v(){z.removeEventListener("focus",A,!1);j.forEach(function(a){u.unbind(a.keyCode,a.modifier);B.unbind(a.keyCode,a.modifier)});j.length=0}function o(a){v();if(a!==i.None){z.addEventListener("focus",A,!1);switch(a){case i.Ctrl:j.push({keyCode:s.Ctrl,modifier:i.None});break;case i.Meta:j.push({keyCode:s.LeftMeta,modifier:i.None}),j.push({keyCode:s.RightMeta,modifier:i.None}),j.push({keyCode:s.MetaInMozilla,modifier:i.None})}j.forEach(function(b){u.bind(b.keyCode,b.modifier,y);B.bind(b.keyCode,b.modifier,A)})}}var i=gui.KeyboardHandler.Modifier,s=gui.KeyboardHandler.KeyCode,t=xmldom.XPath,g=odf.OdfUtils,z=runtime.getWindow(),x=i.None,j=[];runtime.assert(null!==z,"Expected to be run in an environment which has a global window, like a browser.");this.handleClick=function(e){var c=e.target||e.srcElement,k,f;e.ctrlKey?k=i.Ctrl:e.metaKey&&(k=i.Meta);if(x===i.None||x===k){e:{for(;null!==c;){if(g.isHyperlink(c)){break e}if(g.isParagraph(c)){break}c=c.parentNode}c=null}c&&(c=g.getHyperlinkTarget(c),""!==c&&("#"===c[0]?(c=c.substring(1),k=w(),f=t.getODFElementsWithXPath(k,"//text:bookmark-start[@text:name='"+c+"']",odf.Namespaces.lookupNamespaceURI),0===f.length&&(f=t.getODFElementsWithXPath(k,"//text:bookmark[@text:name='"+c+"']",odf.Namespaces.lookupNamespaceURI)),0<f.length&&f[0].scrollIntoView(!0)):/^\s*(javascript|data):/.test(c)?runtime.log("WARN:","potentially malicious URL ignored"):z.open(c),e.preventDefault?e.preventDefault():e.returnValue=!1))}};this.setModifier=function(b){x!==b&&(runtime.assert(b===i.None||b===i.Ctrl||b===i.Meta,"Unsupported KeyboardHandler.Modifier value: "+b),x=b,x!==i.None?A():y(),o(x))};this.getModifier=function(){return x};this.destroy=function(b){A();v();b()}};gui.EventManager=function(Y){function V(k){function h(b,t,r){var s,f=!1;s="on"+t;b.attachEvent&&(b.attachEvent(s,r),f=!0);!f&&b.addEventListener&&(b.addEventListener(t,r,!1),f=!0);f&&!F[t]||!b.hasOwnProperty(s)||(b[s]=r)}function q(f,c,g){var r="on"+c;f.detachEvent&&f.detachEvent(r,g);f.removeEventListener&&f.removeEventListener(c,g,!1);f[r]===g&&(f[r]=null)}function n(a){if(-1===l.indexOf(a)){l.push(a);if(p.filters.every(function(b){return b(a)})){try{m.emit(k,a)}catch(d){runtime.log("Error occurred while processing "+k+":\n"+d.message+"\n"+d.stack)}}runtime.setTimeout(function(){l.splice(l.indexOf(a),1)},0)}}var p=this,l=[],m=new core.EventNotifier([k]);this.filters=[];this.subscribe=function(a){m.subscribe(k,a)};this.unsubscribe=function(a){m.unsubscribe(k,a)};this.destroy=function(){q(M,k,n);q(O,k,n);q(L,k,n)};J[k]&&h(M,k,n);h(O,k,n);h(L,k,n)}function ad(h,f,n){function l(a){n(a,m,function(c){c.type=h;k.emit(h,c)})}var m={},k=new core.EventNotifier([h]);this.subscribe=function(a){k.subscribe(h,a)};this.unsubscribe=function(a){k.unsubscribe(h,a)};this.destroy=function(){f.forEach(function(b){A.unsubscribe(b,l)})};(function(){f.forEach(function(b){A.subscribe(b,l)})})()}function aa(b){runtime.clearTimeout(b);delete i[b]}function ac(e,d){var f=runtime.setTimeout(function(){e();aa(f)},d);i[f]=!0;return f}function W(b,n,m){var k=b.touches.length,l=b.touches[0],d=n.timer;"touchmove"===b.type||"touchend"===b.type?d&&aa(d):"touchstart"===b.type&&(1!==k?runtime.clearTimeout(d):d=ac(function(){m({clientX:l.clientX,clientY:l.clientY,pageX:l.pageX,pageY:l.pageY,target:b.target||b.srcElement||null,detail:1})},400));n.timer=d}function S(h,f,n){var l=h.touches[0],m=h.target||h.srcElement||null,k=f.target;1!==h.touches.length||"touchend"===h.type?k=null:"touchstart"===h.type&&"webodf-draggable"===m.getAttribute("class")?k=m:"touchmove"===h.type&&k&&(h.preventDefault(),h.stopPropagation(),n({clientX:l.clientX,clientY:l.clientY,pageX:l.pageX,pageY:l.pageY,target:k,detail:1}));f.target=k}function Q(g,f,l){var h=g.target||g.srcElement||null,k=f.dragging;"drag"===g.type?k=!0:"touchend"===g.type&&k&&(k=!1,g=g.changedTouches[0],l({clientX:g.clientX,clientY:g.clientY,pageX:g.pageX,pageY:g.pageY,target:h,detail:1}));f.dragging=k}function T(){L.classList.add("webodf-touchEnabled");A.unsubscribe("touchstart",T)}function U(e){var d=e.scrollX,f=e.scrollY;this.restore=function(){e.scrollX===d&&e.scrollY===f||e.scrollTo(d,f)}}function P(e){var d=e.scrollTop,f=e.scrollLeft;this.restore=function(){if(e.scrollTop!==d||e.scrollLeft!==f){e.scrollTop=d,e.scrollLeft=f}}}function ab(e,d){var f=E[e]||j[e]||null;!f&&d&&(f=E[e]=new V(e));return f}function Z(d,c){ab(d,!0).subscribe(c)}function R(d,c){var f=ab(d,!1);f&&f.unsubscribe(c)}function X(){return Y.getDOMDocument().activeElement===O}function B(){X()&&O.blur();O.setAttribute("disabled","true")}function K(){O.removeAttribute("disabled")}function o(d){for(var c=[];d;){(d.scrollWidth>d.clientWidth||d.scrollHeight>d.clientHeight)&&c.push(new P(d)),d=d.parentNode}c.push(new U(M));return c}function G(){var b;X()||(b=o(O),K(),O.focus(),b.forEach(function(c){c.restore()}))}var M=runtime.getWindow(),F={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},J={mousedown:!0,mouseup:!0,focus:!0},j={},E={},O,L=Y.getCanvas().getElement(),A=this,i={};this.addFilter=function(d,c){ab(d,!0).filters.push(c)};this.removeFilter=function(f,c){var g=ab(f,!0),h=g.filters.indexOf(c);-1!==h&&g.filters.splice(h,1)};this.subscribe=Z;this.unsubscribe=R;this.hasFocus=X;this.focus=G;this.getEventTrap=function(){return O};this.setEditing=function(d){var c=X();c&&O.blur();d?O.removeAttribute("readOnly"):O.setAttribute("readOnly","true");c&&G()};this.destroy=function(b){R("touchstart",T);Object.keys(i).forEach(function(c){aa(parseInt(c,10))});i.length=0;Object.keys(j).forEach(function(c){j[c].destroy()});j={};R("mousedown",B);R("mouseup",K);R("contextmenu",K);Object.keys(E).forEach(function(c){E[c].destroy()});E={};O.parentNode.removeChild(O);b()};(function(){var a=Y.getOdfCanvas().getSizer(),d=a.ownerDocument;runtime.assert(Boolean(M),"EventManager requires a window object to operate correctly");O=d.createElement("textarea");O.id="eventTrap";O.setAttribute("tabindex","-1");O.setAttribute("readOnly","true");O.setAttribute("rows","1");a.appendChild(O);Z("mousedown",B);Z("mouseup",K);Z("contextmenu",K);j.longpress=new ad("longpress",["touchstart","touchmove","touchend"],W);j.drag=new ad("drag",["touchstart","touchmove","touchend"],S);j.dragstop=new ad("dragstop",["drag","touchend"],Q);Z("touchstart",T)})()};gui.IOSSafariSupport=function(e){function c(){b.innerHeight!==b.outerHeight&&(g.style.display="none",runtime.requestAnimationFrame(function(){g.style.display="block"}))}var b=runtime.getWindow(),g=e.getEventTrap();this.destroy=function(d){e.unsubscribe("focus",c);g.removeAttribute("autocapitalize");g.style.WebkitTransform="";d()};e.subscribe("focus",c);g.setAttribute("autocapitalize","off");g.style.WebkitTransform="translateX(-10000px)"};gui.HyperlinkController=function(p,j,t,r){function s(){var a=!0;!0===j.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(a=t.isLocalCursorWithinOwnAnnotation());a!==i&&(i=a,g.emit(gui.HyperlinkController.enabledChanged,i))}function o(b){b.getMemberId()===r&&s()}var e=odf.OdfUtils,c=p.getOdtDocument(),g=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),i=!1;this.isEnabled=function(){return i};this.subscribe=function(f,d){g.subscribe(f,d)};this.unsubscribe=function(f,d){g.unsubscribe(f,d)};this.addHyperlink=function(f,d){if(i){var m=c.getCursorSelection(r),k=new ops.OpApplyHyperlink,l=[];if(0===m.length||d){d=d||f,k=new ops.OpInsertText,k.init({memberid:r,position:m.position,text:d}),m.length=d.length,l.push(k)}k=new ops.OpApplyHyperlink;k.init({memberid:r,position:m.position,length:m.length,hyperlink:f});l.push(k);p.enqueue(l)}};this.removeHyperlinks=function(){if(i){var l=c.createPositionIterator(c.getRootNode()),f=c.getCursor(r).getSelectedRange(),v=e.getHyperlinkElements(f),q=f.collapsed&&1===v.length,u=c.getDOMDocument().createRange(),n=[],d,w;0!==v.length&&(v.forEach(function(b){u.selectNodeContents(b);d=c.convertDomToCursorRange({anchorNode:u.startContainer,anchorOffset:u.startOffset,focusNode:u.endContainer,focusOffset:u.endOffset});w=new ops.OpRemoveHyperlink;w.init({memberid:r,position:d.position,length:d.length});n.push(w)}),q||(q=v[0],-1===f.comparePoint(q,0)&&(u.setStart(q,0),u.setEnd(f.startContainer,f.startOffset),d=c.convertDomToCursorRange({anchorNode:u.startContainer,anchorOffset:u.startOffset,focusNode:u.endContainer,focusOffset:u.endOffset}),0<d.length&&(w=new ops.OpApplyHyperlink,w.init({memberid:r,position:d.position,length:d.length,hyperlink:e.getHyperlinkTarget(q)}),n.push(w))),v=v[v.length-1],l.moveToEndOfNode(v),l=l.unfilteredDomOffset(),1===f.comparePoint(v,l)&&(u.setStart(f.endContainer,f.endOffset),u.setEnd(v,l),d=c.convertDomToCursorRange({anchorNode:u.startContainer,anchorOffset:u.startOffset,focusNode:u.endContainer,focusOffset:u.endOffset}),0<d.length&&(w=new ops.OpApplyHyperlink,w.init({memberid:r,position:d.position,length:d.length,hyperlink:e.getHyperlinkTarget(v)}),n.push(w)))),p.enqueue(n),u.detach())}};this.destroy=function(b){c.unsubscribe(ops.Document.signalCursorMoved,o);j.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,s);b()};c.subscribe(ops.Document.signalCursorMoved,o);j.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,s);s()};gui.HyperlinkController.enabledChanged="enabled/changed";gui.ImageController=function(w,u,B,y,A){function v(){var a=!0;!0===u.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(a=B.isLocalCursorWithinOwnAnnotation());a!==j&&(j=a,x.emit(gui.ImageController.enabledChanged,j))}function o(b){b.getMemberId()===y&&v()}var i={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},s=odf.Namespaces.textns,t=w.getOdtDocument(),g=odf.OdfUtils,z=t.getFormatting(),x=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),j=!1;this.isEnabled=function(){return j};this.subscribe=function(d,c){x.subscribe(d,c)};this.unsubscribe=function(d,c){x.unsubscribe(d,c)};this.insertImage=function(c,p,m,d){if(j){runtime.assert(0<m&&0<d,"Both width and height of the image should be greater than 0px.");d={width:m,height:d};if(m=g.getParagraphElement(t.getCursor(y).getNode()).getAttributeNS(s,"style-name")){m=z.getContentSize(m,"paragraph");var q=1,l=1;d.width>m.width&&(q=m.width/d.width);d.height>m.height&&(l=m.height/d.height);m=Math.min(q,l);d={width:d.width*m,height:d.height*m}}m=d.width+"px";d=d.height+"px";var b=t.getOdfCanvas().odfContainer().rootElement.styles,q=c.toLowerCase(),l=i.hasOwnProperty(q)?i[q]:null,f,q=[];runtime.assert(null!==l,"Image type is not supported: "+c);l="Pictures/"+A.generateImageName()+l;f=new ops.OpSetBlob;f.init({memberid:y,filename:l,mimetype:c,content:p});q.push(f);z.getStyleElement("Graphics","graphic",[b])||(c=new ops.OpAddStyle,c.init({memberid:y,styleName:"Graphics",styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph","svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),q.push(c));c=A.generateStyleName();p=new ops.OpAddStyle;p.init({memberid:y,styleName:c,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline","style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}});q.push(p);f=new ops.OpInsertImage;f.init({memberid:y,position:t.getCursorPosition(y),filename:l,frameWidth:m,frameHeight:d,frameStyleName:c,frameName:A.generateFrameName()});q.push(f);w.enqueue(q)}};this.destroy=function(b){t.unsubscribe(ops.Document.signalCursorMoved,o);u.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,v);b()};t.subscribe(ops.Document.signalCursorMoved,o);u.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,v);v()};gui.ImageController.enabledChanged="enabled/changed";gui.ImageSelector=function(j){function g(){var b=j.getSizer(),d=c.createElement("div");d.id="imageSelector";d.style.borderWidth="1px";b.appendChild(d);l.forEach(function(f){var h=c.createElement("div");h.className=f;d.appendChild(h)});return d}var e=odf.Namespaces.svgns,l="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),c=j.getElement().ownerDocument,i=!1;this.select=function(k){var h,a,b=c.getElementById("imageSelector");b||(b=g());i=!0;h=b.parentNode;a=k.getBoundingClientRect();var f=h.getBoundingClientRect(),n=j.getZoomLevel();h=(a.left-f.left)/n-1;a=(a.top-f.top)/n-1;b.style.display="block";b.style.left=h+"px";b.style.top=a+"px";b.style.width=k.getAttributeNS(e,"width");b.style.height=k.getAttributeNS(e,"height")};this.clearSelection=function(){var b;i&&(b=c.getElementById("imageSelector"))&&(b.style.display="none");i=!1};this.isSelectorElement=function(b){var f=c.getElementById("imageSelector");return f?b===f||b.parentNode===f:!1}};(function(){function a(i){function e(b){k=b.which&&String.fromCharCode(b.which)===g;g=void 0;return !1===k}function j(){k=!1}function c(b){g=b.data;k=!1}var g,k=!1;this.destroy=function(b){i.unsubscribe("textInput",j);i.unsubscribe("compositionend",c);i.removeFilter("keypress",e);b()};i.subscribe("textInput",j);i.subscribe("compositionend",c);i.addFilter("keypress",e)}gui.InputMethodEditor=function(O,V){function S(b){R&&(b?R.getNode().setAttributeNS(T,"composing","true"):(R.getNode().removeAttributeNS(T,"composing"),j.textContent=""))}function U(){i&&(i=!1,S(!1),F.emit(gui.InputMethodEditor.signalCompositionEnd,{data:B}),B="")}function P(){G||(G=!0,U(),R&&R.getSelectedRange().collapsed?K.value="":K.value=D.writeToString(R.getSelectedRange().cloneContents()),K.setSelectionRange(0,K.value.length),G=!1)}function L(){V.hasFocus()&&E.trigger()}function J(){A=void 0;E.cancel();S(!0);i||F.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function M(b){b=A=b.data;i=!0;B+=b;E.trigger()}function N(b){b.data!==A&&(b=b.data,i=!0,B+=b,E.trigger());A=void 0}function I(){j.textContent=K.value}var T="urn:webodf:names:cursor",R=null,K=V.getEventTrap(),Q=K.ownerDocument,j,E,i=!1,B="",F=new core.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),A,D,f=[],o,G=!1;this.subscribe=F.subscribe;this.unsubscribe=F.unsubscribe;this.registerCursor=function(c){c.getMemberId()===O&&(R=c,R.getNode().appendChild(j),c.subscribe(ops.OdtCursor.signalCursorUpdated,L),V.subscribe("input",I),V.subscribe("compositionupdate",I))};this.removeCursor=function(c){R&&c===O&&(R.getNode().removeChild(j),R.unsubscribe(ops.OdtCursor.signalCursorUpdated,L),V.unsubscribe("input",I),V.unsubscribe("compositionupdate",I),R=null)};this.destroy=function(b){V.unsubscribe("compositionstart",J);V.unsubscribe("compositionend",M);V.unsubscribe("textInput",N);V.unsubscribe("keypress",U);V.unsubscribe("focus",P);core.Async.destroyAll(o,b)};(function(){D=new odf.TextSerializer;D.filter=new odf.OdfNodeFilter;V.subscribe("compositionstart",J);V.subscribe("compositionend",M);V.subscribe("textInput",N);V.subscribe("keypress",U);V.subscribe("focus",P);f.push(new a(V));o=f.map(function(b){return b.destroy});j=Q.createElement("span");j.setAttribute("id","composer");E=core.Task.createTimeoutTask(P,1);o.push(E.destroy)})()};gui.InputMethodEditor.signalCompositionStart="input/compositionstart";gui.InputMethodEditor.signalCompositionEnd="input/compositionend"})();gui.MetadataController=function(j,g){function e(b){i.emit(gui.MetadataController.signalMetadataChanged,b)}function l(f){var d=-1===m.indexOf(f);d||runtime.log("Setting "+f+" is restricted.");return d}var c=j.getOdtDocument(),i=new core.EventNotifier([gui.MetadataController.signalMetadataChanged]),m=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(f,d){var k={},p="",o;f&&Object.keys(f).filter(l).forEach(function(a){k[a]=f[a]});d&&(p=d.filter(l).join(","));if(0<p.length||0<Object.keys(k).length){o=new ops.OpUpdateMetadata,o.init({memberid:g,setProperties:k,removedProperties:0<p.length?{attributes:p}:null}),j.enqueue([o])}};this.getMetadata=function(b){var f;runtime.assert("string"===typeof b,"Property must be a string");f=b.split(":");runtime.assert(2===f.length,"Property must be a namespace-prefixed string");b=odf.Namespaces.lookupNamespaceURI(f[0]);runtime.assert(Boolean(b),"Prefix must be for an ODF namespace.");return c.getOdfCanvas().odfContainer().getMetadata(b,f[1])};this.subscribe=function(f,d){i.subscribe(f,d)};this.unsubscribe=function(f,d){i.unsubscribe(f,d)};this.destroy=function(a){c.unsubscribe(ops.OdtDocument.signalMetadataUpdated,e);a()};c.subscribe(ops.OdtDocument.signalMetadataUpdated,e)};gui.MetadataController.signalMetadataChanged="metadata/changed";gui.PasteController=function(s,o,v,t){function u(){e=!0===o.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?v.isLocalCursorWithinOwnAnnotation():!0}function p(b){b.getMemberId()===t&&u()}var g=s.getOdtDocument(),e=!1,i=odf.Namespaces.textns,j=core.StepDirection.NEXT,c=odf.OdfUtils;this.isEnabled=function(){return e};this.paste=function(f){if(e){var d=g.getCursorPosition(t),n=g.getCursor(t).getNode(),n=c.getParagraphElement(n),q=n.getAttributeNS(i,"style-name")||"",l=d,m=[],r=g.convertDomPointToCursorStep(n,0,j);f.replace(/\r/g,"").split("\n").forEach(function(k){var h=new ops.OpInsertText,w=new ops.OpSplitParagraph;h.init({memberid:t,position:l,text:k,moveCursor:!0});m.push(h);l+=k.length;w.init({memberid:t,position:l,paragraphStyleName:q,sourceParagraphPosition:r,moveCursor:!0});m.push(w);r=l+=1});m.pop();s.enqueue(m)}};this.destroy=function(b){g.unsubscribe(ops.Document.signalCursorMoved,p);o.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,u);b()};g.subscribe(ops.Document.signalCursorMoved,p);o.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,u);u()};gui.ClosestXOffsetScanner=function(j){function g(b){return null!==b&&void 0!==c?Math.abs(b-j)>c:!1}function e(b){null!==b&&!1===g(b)&&(c=Math.abs(b-j))}var l=this,c,i=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT;this.token=void 0;this.process=function(d,n,a){var h,k;d.visualDirection===i?(h=n&&n.right,k=a&&a.left):(h=n&&n.left,k=a&&a.right);if(g(h)||g(k)){return !0}if(n||a){e(h),e(k),l.token=d.token}return !1}};gui.LineBoundaryScanner=function(){var b=this,a=null;this.token=void 0;this.process=function(e,i,c){var f;if(f=c){if(a){var j=a;f=Math.min(j.bottom-j.top,c.bottom-c.top);var g=Math.max(j.top,c.top),j=Math.min(j.bottom,c.bottom)-g;f=0.4>=(0<f?j/f:0)}else{f=!1}}!i||c&&!f||(b.token=e.token);if(f){return !0}a=(e=a)&&i?{left:Math.min(e.left,i.left),right:Math.max(e.right,i.right),top:Math.min(e.top,i.top),bottom:Math.min(e.bottom,i.bottom)}:e||i;return !1}};gui.ParagraphBoundaryScanner=function(){var e=this,c=!1,b,g=odf.OdfUtils;this.token=void 0;this.process=function(a){var d=g.getParagraphElement(a.container());c||(b=d,c=!0);if(b!==d){return !0}e.token=a.token;return !1}};odf.WordBoundaryFilter=function(w,u){function B(k,f,p){for(var m=null,n=w.getRootNode(),l;k!==n&&null!==k&&null===m;){l=0>f?k.previousSibling:k.nextSibling,p(l)===NodeFilter.FILTER_ACCEPT&&(m=l),k=k.parentNode}return m}function y(b,f){var d;return null===b?j.NO_NEIGHBOUR:o.isCharacterElement(b)?j.SPACE_CHAR:b.nodeType===A||o.isTextSpan(b)||o.isHyperlink(b)?(d=b.textContent.charAt(f()),s.test(d)?j.SPACE_CHAR:i.test(d)?j.PUNCTUATION_CHAR:j.WORD_CHAR):j.OTHER}var A=Node.TEXT_NODE,v=Node.ELEMENT_NODE,o=odf.OdfUtils,i=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,s=/\s/,t=core.PositionFilter.FilterResult.FILTER_ACCEPT,g=core.PositionFilter.FilterResult.FILTER_REJECT,z=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,x=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,j={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(c){var h=c.container(),k=c.leftNode(),a=c.rightNode(),e=c.unfilteredDomOffset,d=function(){return c.unfilteredDomOffset()-1};h.nodeType===v&&(null===a&&(a=B(h,1,c.getNodeFilter())),null===k&&(k=B(h,-1,c.getNodeFilter())));h!==a&&(e=function(){return 0});h!==k&&null!==k&&(d=function(){return k.textContent.length-1});h=y(k,d);a=y(a,e);return h===j.WORD_CHAR&&a===j.WORD_CHAR||h===j.PUNCTUATION_CHAR&&a===j.PUNCTUATION_CHAR||u===z&&h!==j.NO_NEIGHBOUR&&a===j.SPACE_CHAR||u===x&&h===j.SPACE_CHAR&&a!==j.NO_NEIGHBOUR?g:t}};odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2};gui.SelectionController=function(aa,X){function af(d){var c=d.spec();if(d.isEdit||c.memberid===X){F=void 0,Q.cancel()}}function ac(){var b=M.getCursor(X).getNode();return M.createStepIterator(b,0,[P,L],M.getRootElement(b))}function ae(g,f,l){l=new odf.WordBoundaryFilter(M,l);var h=M.getRootElement(g)||M.getRootNode(),k=M.createRootFilter(h);return M.createStepIterator(g,f,[P,k,l],h)}function Y(d,c){return c?{anchorNode:d.startContainer,anchorOffset:d.startOffset,focusNode:d.endContainer,focusOffset:d.endOffset}:{anchorNode:d.endContainer,anchorOffset:d.endOffset,focusNode:d.startContainer,focusOffset:d.startOffset}}function U(f,d,h){var g=new ops.OpMoveCursor;g.init({memberid:X,position:f,length:d||0,selectionType:h});return g}function S(f,d,h){var g;g=M.getCursor(X);g=Y(g.getSelectedRange(),g.hasForwardSelection());g.focusNode=f;g.focusOffset=d;h||(g.anchorNode=g.focusNode,g.anchorOffset=g.focusOffset);f=M.convertDomToCursorRange(g);aa.enqueue([U(f.position,f.length)])}function V(b){var d;d=ae(b.startContainer,b.startOffset,O);d.roundToPreviousStep()&&b.setStart(d.container(),d.offset());d=ae(b.endContainer,b.endOffset,B);d.roundToNextStep()&&b.setEnd(d.container(),d.offset())}function W(e){var d=J.getParagraphElements(e),f=d[0],d=d[d.length-1];f&&e.setStart(f,0);d&&(J.isParagraph(e.endContainer)&&0===e.endOffset?e.setEndBefore(d):e.setEnd(d,d.childNodes.length))}function R(h,g,n,l){var m,k;l?(m=n.startContainer,k=n.startOffset):(m=n.endContainer,k=n.endOffset);A.containsNode(h,m)||(k=0>A.comparePoints(h,0,m,k)?0:h.childNodes.length,m=h);h=M.createStepIterator(m,k,g,J.getParagraphElement(m)||h);h.roundToClosestStep()||runtime.assert(!1,"No step found in requested range");l?n.setStart(h.container(),h.offset()):n.setEnd(h.container(),h.offset())}function ad(e,d){var f=ac();f.advanceStep(e)&&S(f.container(),f.offset(),d)}function ab(g,d){var l,k=F,h=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];void 0===k&&o&&(k=o());isNaN(k)||(l=ac(),G.moveToFilteredStep(l,g,h)&&l.advanceStep(g)&&(h=[new gui.ClosestXOffsetScanner(k),new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner],G.moveToFilteredStep(l,g,h)&&(S(l.container(),l.offset(),d),F=k,Q.restart())))}function T(f,d){var h=ac(),g=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];G.moveToFilteredStep(h,f,g)&&S(h.container(),h.offset(),d)}function Z(b,f){var d=M.getCursor(X),d=Y(d.getSelectedRange(),d.hasForwardSelection()),d=ae(d.focusNode,d.focusOffset,O);d.advanceStep(b)&&S(d.container(),d.offset(),f)}function E(g,f,l){var h=!1,k=M.getCursor(X),k=Y(k.getSelectedRange(),k.hasForwardSelection()),h=M.getRootElement(k.focusNode);runtime.assert(Boolean(h),"SelectionController: Cursor outside root");k=M.createStepIterator(k.focusNode,k.focusOffset,[P,L],h);k.roundToClosestStep();k.advanceStep(g)&&(l=l(k.container()))&&(g===i?(k.setPosition(l,0),h=k.roundToNextStep()):(k.setPosition(l,l.childNodes.length),h=k.roundToPreviousStep()),h&&S(k.container(),k.offset(),f))}var M=aa.getOdtDocument(),A=core.DomUtils,J=odf.OdfUtils,P=M.getPositionFilter(),G=new gui.GuiStepUtils,L=M.createRootFilter(X),o=null,F,Q,O=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,B=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,i=core.StepDirection.PREVIOUS,j=core.StepDirection.NEXT;this.selectionToRange=function(e){var d=0<=A.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),f=e.focusNode.ownerDocument.createRange();d?(f.setStart(e.anchorNode,e.anchorOffset),f.setEnd(e.focusNode,e.focusOffset)):(f.setStart(e.focusNode,e.focusOffset),f.setEnd(e.anchorNode,e.anchorOffset));return{range:f,hasForwardSelection:d}};this.rangeToSelection=Y;this.selectImage=function(f){var d=M.getRootElement(f),h=M.createRootFilter(d),d=M.createStepIterator(f,0,[h,M.getPositionFilter()],d),g;d.roundToPreviousStep()||runtime.assert(!1,"No walkable position before frame");h=d.container();g=d.offset();d.setPosition(f,f.childNodes.length);d.roundToNextStep()||runtime.assert(!1,"No walkable position after frame");f=M.convertDomToCursorRange({anchorNode:h,anchorOffset:g,focusNode:d.container(),focusOffset:d.offset()});f=U(f.position,f.length,ops.OdtCursor.RegionSelection);aa.enqueue([f])};this.expandToWordBoundaries=V;this.expandToParagraphBoundaries=W;this.selectRange=function(h,f,n){var l=M.getOdfCanvas().getElement(),m,k=[P];m=A.containsNode(l,h.startContainer);l=A.containsNode(l,h.endContainer);if(m||l){if(m&&l&&(2===n?V(h):3<=n&&W(h)),(n=f?M.getRootElement(h.startContainer):M.getRootElement(h.endContainer))||(n=M.getRootNode()),k.push(M.createRootFilter(n)),R(n,k,h,!0),R(n,k,h,!1),h=Y(h,f),f=M.convertDomToCursorRange(h),h=M.getCursorSelection(X),f.position!==h.position||f.length!==h.length){h=U(f.position,f.length,ops.OdtCursor.RangeSelection),aa.enqueue([h])}}};this.moveCursorToLeft=function(){ad(i,!1);return !0};this.moveCursorToRight=function(){ad(j,!1);return !0};this.extendSelectionToLeft=function(){ad(i,!0);return !0};this.extendSelectionToRight=function(){ad(j,!0);return !0};this.setCaretXPositionLocator=function(b){o=b};this.moveCursorUp=function(){ab(i,!1);return !0};this.moveCursorDown=function(){ab(j,!1);return !0};this.extendSelectionUp=function(){ab(i,!0);return !0};this.extendSelectionDown=function(){ab(j,!0);return !0};this.moveCursorBeforeWord=function(){Z(i,!1);return !0};this.moveCursorPastWord=function(){Z(j,!1);return !0};this.extendSelectionBeforeWord=function(){Z(i,!0);return !0};this.extendSelectionPastWord=function(){Z(j,!0);return !0};this.moveCursorToLineStart=function(){T(i,!1);return !0};this.moveCursorToLineEnd=function(){T(j,!1);return !0};this.extendSelectionToLineStart=function(){T(i,!0);return !0};this.extendSelectionToLineEnd=function(){T(j,!0);return !0};this.extendSelectionToParagraphStart=function(){E(i,!0,J.getParagraphElement);return !0};this.extendSelectionToParagraphEnd=function(){E(j,!0,J.getParagraphElement);return !0};this.moveCursorToParagraphStart=function(){E(i,!1,J.getParagraphElement);return !0};this.moveCursorToParagraphEnd=function(){E(j,!1,J.getParagraphElement);return !0};this.moveCursorToDocumentStart=function(){E(i,!1,M.getRootElement);return !0};this.moveCursorToDocumentEnd=function(){E(j,!1,M.getRootElement);return !0};this.extendSelectionToDocumentStart=function(){E(i,!0,M.getRootElement);return !0};this.extendSelectionToDocumentEnd=function(){E(j,!0,M.getRootElement);return !0};this.extendSelectionToEntireDocument=function(){var f=M.getCursor(X),f=M.getRootElement(f.getNode()),d,h,g;runtime.assert(Boolean(f),"SelectionController: Cursor outside root");g=M.createStepIterator(f,0,[P,L],f);g.roundToClosestStep();d=g.container();h=g.offset();g.setPosition(f,f.childNodes.length);g.roundToClosestStep();f=M.convertDomToCursorRange({anchorNode:d,anchorOffset:h,focusNode:g.container(),focusOffset:g.offset()});aa.enqueue([U(f.position,f.length)]);return !0};this.destroy=function(a){M.unsubscribe(ops.OdtDocument.signalOperationStart,af);core.Async.destroyAll([Q.destroy],a)};(function(){Q=core.Task.createTimeoutTask(function(){F=void 0},2000);M.subscribe(ops.OdtDocument.signalOperationStart,af)})()};gui.TextController=function(E,B,J,G,I,C){function w(){j=!0===B.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?J.isLocalCursorWithinOwnAnnotation():!0}function u(b){b.getMemberId()===G&&w()}function z(f,e,h){var g=[F.getPositionFilter()];h&&g.push(F.createRootFilter(f.startContainer));h=F.createStepIterator(f.startContainer,f.startOffset,g,e);h.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range start");e=F.convertDomPointToCursorStep(h.container(),h.offset());f.collapsed?f=e:(h.setPosition(f.endContainer,f.endOffset),h.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range end"),f=F.convertDomPointToCursorStep(h.container(),h.offset()));return{position:e,length:f-e}}function A(k){var d,q,p,n=v.getParagraphElements(k),m=k.cloneRange(),g=[];d=n[0];1<n.length&&(v.hasNoODFContent(d)&&(d=n[n.length-1]),q=d.getAttributeNS(odf.Namespaces.textns,"style-name")||"");n.forEach(function(a,e){var c,h;m.setStart(a,0);m.collapse(!0);c=z(m,a,!1).position;0<e&&(h=new ops.OpMergeParagraph,h.init({memberid:G,paragraphStyleName:q,destinationStartPosition:p,sourceStartPosition:c,moveCursor:1===e}),g.unshift(h));p=c;m.selectNodeContents(a);if(c=D.rangeIntersection(m,k)){c=z(c,a,!0),0<c.length&&(h=new ops.OpRemoveText,h.init({memberid:G,position:c.position,length:c.length}),g.unshift(h))}});return g}function s(b){0>b.length&&(b.position+=b.length,b.length=-b.length);return b}function H(e){if(!j){return !1}var d,n=F.getCursor(G).getSelectedRange().cloneRange(),m=s(F.getCursorSelection(G)),l;if(0===m.length){m=void 0;d=F.getCursor(G).getNode();l=F.getRootElement(d);var f=[F.getPositionFilter(),F.createRootFilter(l)];l=F.createStepIterator(d,0,f,l);l.roundToClosestStep()&&(e?l.nextStep():l.previousStep())&&(m=s(F.convertDomToCursorRange({anchorNode:d,anchorOffset:0,focusNode:l.container(),focusOffset:l.offset()})),e?(n.setStart(d,0),n.setEnd(l.container(),l.offset())):(n.setStart(l.container(),l.offset()),n.setEnd(d,0)))}m&&E.enqueue(A(n));return void 0!==m}var F=E.getOdtDocument(),v=odf.OdfUtils,D=core.DomUtils,j=!1,o=odf.Namespaces.textns,i=core.StepDirection.NEXT;this.isEnabled=function(){return j};this.enqueueParagraphSplittingOps=function(){if(!j){return !1}var e=F.getCursor(G),d=e.getSelectedRange(),l=s(F.getCursorSelection(G)),h=[],e=v.getParagraphElement(e.getNode()),f=e.getAttributeNS(o,"style-name")||"";0<l.length&&(h=h.concat(A(d)));d=new ops.OpSplitParagraph;d.init({memberid:G,position:l.position,paragraphStyleName:f,sourceParagraphPosition:F.convertDomPointToCursorStep(e,0,i),moveCursor:!0});h.push(d);C&&(l=C(l.position+1),h=h.concat(l));E.enqueue(h);return !0};this.removeTextByBackspaceKey=function(){return H(!1)};this.removeTextByDeleteKey=function(){return H(!0)};this.removeCurrentSelection=function(){if(!j){return !1}var b=F.getCursor(G).getSelectedRange();E.enqueue(A(b));return !0};this.insertText=function(b){if(j){var l=F.getCursor(G).getSelectedRange(),f=s(F.getCursorSelection(G)),e=[],d=!1;0<f.length&&(e=e.concat(A(l)),d=!0);l=new ops.OpInsertText;l.init({memberid:G,position:f.position,text:b,moveCursor:!0});e.push(l);I&&(b=I(f.position,b.length,d))&&e.push(b);E.enqueue(e)}};this.destroy=function(b){F.unsubscribe(ops.Document.signalCursorMoved,u);B.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,w);b()};F.subscribe(ops.Document.signalCursorMoved,u);B.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,w);w()};gui.UndoManager=function(){};gui.UndoManager.prototype.subscribe=function(b,a){};gui.UndoManager.prototype.unsubscribe=function(b,a){};gui.UndoManager.prototype.setDocument=function(a){};gui.UndoManager.prototype.setInitialState=function(){};gui.UndoManager.prototype.initialize=function(){};gui.UndoManager.prototype.purgeInitialState=function(){};gui.UndoManager.prototype.setPlaybackFunction=function(a){};gui.UndoManager.prototype.hasUndoStates=function(){};gui.UndoManager.prototype.hasRedoStates=function(){};gui.UndoManager.prototype.moveForward=function(a){};gui.UndoManager.prototype.moveBackward=function(a){};gui.UndoManager.prototype.onOperationExecuted=function(a){};gui.UndoManager.prototype.isDocumentModified=function(){};gui.UndoManager.prototype.setDocumentModified=function(a){};gui.UndoManager.signalUndoStackChanged="undoStackChanged";gui.UndoManager.signalUndoStateCreated="undoStateCreated";gui.UndoManager.signalUndoStateModified="undoStateModified";gui.UndoManager.signalDocumentModifiedChanged="documentModifiedChanged";gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1};(function(){var a=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(a7,bf,bc,be){function a8(b){return b.target||b.srcElement||null}function a4(g,d){var k=au.getDOMDocument(),h=null;k.caretRangeFromPoint?(k=k.caretRangeFromPoint(g,d),h={container:k.startContainer,offset:k.startOffset}):k.caretPositionFromPoint&&(k=k.caretPositionFromPoint(g,d))&&k.offsetNode&&(h={container:k.offsetNode,offset:k.offset});return h}function a2(d){var e=au.getCursor(bf).getSelectedRange();e.collapsed?d.preventDefault():aL.setDataFromRange(d,e)?aN.removeCurrentSelection():runtime.log("Cut operation failed")}function a5(){return !1!==au.getCursor(bf).getSelectedRange().collapsed}function a6(d){var e=au.getCursor(bf).getSelectedRange();e.collapsed?d.preventDefault():aL.setDataFromRange(d,e)||runtime.log("Copy operation failed")}function a1(d){var c;ai.clipboardData&&ai.clipboardData.getData?c=ai.clipboardData.getData("Text"):d.clipboardData&&d.clipboardData.getData&&(c=d.clipboardData.getData("text/plain"));c&&(aN.removeCurrentSelection(),aG.paste(c));d.preventDefault?d.preventDefault():d.returnValue=!1}function bd(){return !1}function bb(b){if(ak){ak.onOperationExecuted(b)}}function a3(b){au.emit(ops.OdtDocument.signalUndoStackChanged,b)}function a9(){var b;return ak?(b=aq.hasFocus(),ak.moveBackward(1),b&&aq.focus(),!0):!1}function aS(){var b;return ak?(b=aq.hasFocus(),ak.moveForward(1),b&&aq.focus(),!0):!1}function aY(d){var h=au.getCursor(bf).getSelectedRange(),g=a8(d).getAttribute("end");h&&g&&(d=a4(d.clientX,d.clientY))&&(aO.setUnfilteredPosition(d.container,d.offset),al.acceptPosition(aO)===a&&(h=h.cloneRange(),"left"===g?h.setStart(aO.container(),aO.unfilteredDomOffset()):h.setEnd(aO.container(),aO.unfilteredDomOffset()),bc.setSelectedRange(h,"right"===g),au.emit(ops.Document.signalCursorMoved,bc)))}function aQ(){ad.selectRange(bc.getSelectedRange(),bc.hasForwardSelection(),1)}function aV(){var d=ai.getSelection(),c=0<d.rangeCount&&ad.selectionToRange(d);j&&c&&(ac=!0,o.clearSelection(),aO.setUnfilteredPosition(d.focusNode,d.focusOffset),al.acceptPosition(aO)===a&&(2===ae?ad.expandToWordBoundaries(c.range):3<=ae&&ad.expandToParagraphBoundaries(c.range),bc.setSelectedRange(c.range,c.hasForwardSelection),au.emit(ops.Document.signalCursorMoved,bc)))}function aZ(d){var h=a8(d),g=au.getCursor(bf);if(j=null!==h&&an.containsNode(au.getOdfCanvas().getElement(),h)){ac=!1,h=au.getRootElement(h)||au.getRootNode(),al=au.createRootFilter(h),ae=0===d.button?d.detail:0,g&&d.shiftKey?ai.getSelection().collapse(g.getAnchorNode(),0):(d=ai.getSelection(),h=g.getSelectedRange(),d.extend?g.hasForwardSelection()?(d.collapse(h.startContainer,h.startOffset),d.extend(h.endContainer,h.endOffset)):(d.collapse(h.endContainer,h.endOffset),d.extend(h.startContainer,h.startOffset)):(d.removeAllRanges(),d.addRange(h.cloneRange()))),1<ae&&aV()}}function aT(e){var d=au.getRootElement(e),g=au.createRootFilter(d),d=au.createStepIterator(e,0,[g,au.getPositionFilter()],d);d.setPosition(e,e.childNodes.length);return d.roundToNextStep()?{container:d.container(),offset:d.offset()}:null}function aW(h){var g;g=(g=ai.getSelection())?{anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}:null;var m=ai.getSelection().isCollapsed,k,l;g.anchorNode||g.focusNode||!(k=a4(h.clientX,h.clientY))||(g.anchorNode=k.container,g.anchorOffset=k.offset,g.focusNode=g.anchorNode,g.focusOffset=g.anchorOffset);if(az.isImage(g.focusNode)&&0===g.focusOffset&&az.isCharacterFrame(g.focusNode.parentNode)){if(l=g.focusNode.parentNode,k=l.getBoundingClientRect(),h.clientX>k.left&&(k=aT(l))){g.focusNode=k.container,g.focusOffset=k.offset,m&&(g.anchorNode=g.focusNode,g.anchorOffset=g.focusOffset)}}else{az.isImage(g.focusNode.firstChild)&&1===g.focusOffset&&az.isCharacterFrame(g.focusNode)&&(k=aT(g.focusNode))&&(g.anchorNode=g.focusNode=k.container,g.anchorOffset=g.focusOffset=k.offset)}g.anchorNode&&g.focusNode&&(g=ad.selectionToRange(g),ad.selectRange(g.range,g.hasForwardSelection,0===h.button?h.detail:0));aq.focus()}function aP(d){var c;if(c=a4(d.clientX,d.clientY)){d=c.container,c=c.offset,d={anchorNode:d,anchorOffset:c,focusNode:d,focusOffset:c},d=ad.selectionToRange(d),ad.selectRange(d.range,d.hasForwardSelection,2),aq.focus()}}function aw(g){var d=a8(g),l,k,h;aR.processRequests();j&&(az.isImage(d)&&az.isCharacterFrame(d.parentNode)&&ai.getSelection().isCollapsed?(ad.selectImage(d.parentNode),aq.focus()):o.isSelectorElement(d)?aq.focus():ac?(d=bc.getSelectedRange(),k=d.collapsed,az.isImage(d.endContainer)&&0===d.endOffset&&az.isCharacterFrame(d.endContainer.parentNode)&&(h=d.endContainer.parentNode,h=aT(h))&&(d.setEnd(h.container,h.offset),k&&d.collapse(!1)),ad.selectRange(d,bc.hasForwardSelection(),0===g.button?g.detail:0),aq.focus()):aj?aW(g):(l=an.cloneEvent(g),aF=runtime.setTimeout(function(){aW(l)},0)),ae=0,ac=j=!1)}function aB(d){var e=au.getCursor(bf).getSelectedRange();e.collapsed||am.exportRangeToDataTransfer(d.dataTransfer,e)}function aA(){j&&aq.focus();ae=0;ac=j=!1}function av(b){aw(b)}function ap(e){var d=a8(e),g=null;"annotationRemoveButton"===d.className?(runtime.assert(f,"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),g=d.parentNode.getElementsByTagNameNS(odf.Namespaces.officens,"annotation").item(0),i.removeAnnotation(g),aq.focus()):"webodf-draggable"!==d.getAttribute("class")&&aw(e)}function at(b){(b=b.data)&&(-1===b.indexOf("\n")?aN.insertText(b):aG.paste(b))}function ax(b){return function(){b();return !0}}function aD(c){return function(b){return au.getCursor(bf).getSelectionType()===ops.OdtCursor.RangeSelection?c(b):!0}}function ab(b){aq.unsubscribe("keydown",aC.handleEvent);aq.unsubscribe("keypress",af.handleEvent);aq.unsubscribe("keyup",bg.handleEvent);aq.unsubscribe("copy",a6);aq.unsubscribe("mousedown",aZ);aq.unsubscribe("mousemove",aR.trigger);aq.unsubscribe("mouseup",ap);aq.unsubscribe("contextmenu",av);aq.unsubscribe("dragstart",aB);aq.unsubscribe("dragend",aA);aq.unsubscribe("click",aU.handleClick);aq.unsubscribe("longpress",aP);aq.unsubscribe("drag",aY);aq.unsubscribe("dragstop",aQ);au.unsubscribe(ops.OdtDocument.signalOperationEnd,aI.trigger);au.unsubscribe(ops.Document.signalCursorAdded,aH.registerCursor);au.unsubscribe(ops.Document.signalCursorRemoved,aH.removeCursor);au.unsubscribe(ops.OdtDocument.signalOperationEnd,bb);b()}var ai=runtime.getWindow(),au=a7.getOdtDocument(),ah=new gui.SessionConstraints,aE=new gui.SessionContext(a7,bf),an=core.DomUtils,az=odf.OdfUtils,am=new gui.MimeDataExporter,aL=new gui.Clipboard(am),aC=new gui.KeyboardHandler,af=new gui.KeyboardHandler,bg=new gui.KeyboardHandler,j=!1,ay=new odf.ObjectNameGenerator(au.getOdfCanvas().odfContainer(),bf),ac=!1,al=null,aF,ak=null,aq=new gui.EventManager(au),f=be.annotationsEnabled,i=new gui.AnnotationController(a7,ah,bf),aM=new gui.DirectFormattingController(a7,ah,aE,bf,ay,be.directTextStylingEnabled,be.directParagraphStylingEnabled),aN=new gui.TextController(a7,ah,aE,bf,aM.createCursorStyleOp,aM.createParagraphStyleOps),aJ=new gui.ImageController(a7,ah,aE,bf,ay),o=new gui.ImageSelector(au.getOdfCanvas()),aO=au.createPositionIterator(au.getRootNode()),aR,aI,aG=new gui.PasteController(a7,ah,aE,bf),aH=new gui.InputMethodEditor(bf,aq),ae=0,aU=new gui.HyperlinkClickHandler(au.getOdfCanvas().getElement,aC,bg),aK=new gui.HyperlinkController(a7,ah,aE,bf),ad=new gui.SelectionController(a7,bf),a0=new gui.MetadataController(a7,bf),ar=gui.KeyboardHandler.Modifier,ao=gui.KeyboardHandler.KeyCode,ag=-1!==ai.navigator.appVersion.toLowerCase().indexOf("mac"),aj=-1!==["iPad","iPod","iPhone"].indexOf(ai.navigator.platform),aX;runtime.assert(null!==ai,"Expected to be run in an environment which has a global window, like a browser.");this.undo=a9;this.redo=aS;this.insertLocalCursor=function(){runtime.assert(void 0===a7.getOdtDocument().getCursor(bf),"Inserting local cursor a second time.");var c=new ops.OpAddCursor;c.init({memberid:bf});a7.enqueue([c]);aq.focus()};this.removeLocalCursor=function(){runtime.assert(void 0!==a7.getOdtDocument().getCursor(bf),"Removing local cursor without inserting before.");var c=new ops.OpRemoveCursor;c.init({memberid:bf});a7.enqueue([c])};this.startEditing=function(){aH.subscribe(gui.InputMethodEditor.signalCompositionStart,aN.removeCurrentSelection);aH.subscribe(gui.InputMethodEditor.signalCompositionEnd,at);aq.subscribe("beforecut",a5);aq.subscribe("cut",a2);aq.subscribe("beforepaste",bd);aq.subscribe("paste",a1);ak&&ak.initialize();aq.setEditing(!0);aU.setModifier(ag?ar.Meta:ar.Ctrl);aC.bind(ao.Backspace,ar.None,ax(aN.removeTextByBackspaceKey),!0);aC.bind(ao.Delete,ar.None,aN.removeTextByDeleteKey);aC.bind(ao.Tab,ar.None,aD(function(){aN.insertText("\t");return !0}));ag?(aC.bind(ao.Clear,ar.None,aN.removeCurrentSelection),aC.bind(ao.B,ar.Meta,aD(aM.toggleBold)),aC.bind(ao.I,ar.Meta,aD(aM.toggleItalic)),aC.bind(ao.U,ar.Meta,aD(aM.toggleUnderline)),aC.bind(ao.L,ar.MetaShift,aD(aM.alignParagraphLeft)),aC.bind(ao.E,ar.MetaShift,aD(aM.alignParagraphCenter)),aC.bind(ao.R,ar.MetaShift,aD(aM.alignParagraphRight)),aC.bind(ao.J,ar.MetaShift,aD(aM.alignParagraphJustified)),f&&aC.bind(ao.C,ar.MetaShift,i.addAnnotation),aC.bind(ao.Z,ar.Meta,a9),aC.bind(ao.Z,ar.MetaShift,aS)):(aC.bind(ao.B,ar.Ctrl,aD(aM.toggleBold)),aC.bind(ao.I,ar.Ctrl,aD(aM.toggleItalic)),aC.bind(ao.U,ar.Ctrl,aD(aM.toggleUnderline)),aC.bind(ao.L,ar.CtrlShift,aD(aM.alignParagraphLeft)),aC.bind(ao.E,ar.CtrlShift,aD(aM.alignParagraphCenter)),aC.bind(ao.R,ar.CtrlShift,aD(aM.alignParagraphRight)),aC.bind(ao.J,ar.CtrlShift,aD(aM.alignParagraphJustified)),f&&aC.bind(ao.C,ar.CtrlAlt,i.addAnnotation),aC.bind(ao.Z,ar.Ctrl,a9),aC.bind(ao.Z,ar.CtrlShift,aS));af.setDefault(aD(function(d){var c;c=null===d.which||void 0===d.which?String.fromCharCode(d.keyCode):0!==d.which&&0!==d.charCode?String.fromCharCode(d.which):null;return !c||d.altKey||d.ctrlKey||d.metaKey?!1:(aN.insertText(c),!0)}));af.bind(ao.Enter,ar.None,aD(aN.enqueueParagraphSplittingOps))};this.endEditing=function(){aH.unsubscribe(gui.InputMethodEditor.signalCompositionStart,aN.removeCurrentSelection);aH.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,at);aq.unsubscribe("cut",a2);aq.unsubscribe("beforecut",a5);aq.unsubscribe("paste",a1);aq.unsubscribe("beforepaste",bd);aq.setEditing(!1);aU.setModifier(ar.None);aC.bind(ao.Backspace,ar.None,function(){return !0},!0);aC.unbind(ao.Delete,ar.None);aC.unbind(ao.Tab,ar.None);ag?(aC.unbind(ao.Clear,ar.None),aC.unbind(ao.B,ar.Meta),aC.unbind(ao.I,ar.Meta),aC.unbind(ao.U,ar.Meta),aC.unbind(ao.L,ar.MetaShift),aC.unbind(ao.E,ar.MetaShift),aC.unbind(ao.R,ar.MetaShift),aC.unbind(ao.J,ar.MetaShift),f&&aC.unbind(ao.C,ar.MetaShift),aC.unbind(ao.Z,ar.Meta),aC.unbind(ao.Z,ar.MetaShift)):(aC.unbind(ao.B,ar.Ctrl),aC.unbind(ao.I,ar.Ctrl),aC.unbind(ao.U,ar.Ctrl),aC.unbind(ao.L,ar.CtrlShift),aC.unbind(ao.E,ar.CtrlShift),aC.unbind(ao.R,ar.CtrlShift),aC.unbind(ao.J,ar.CtrlShift),f&&aC.unbind(ao.C,ar.CtrlAlt),aC.unbind(ao.Z,ar.Ctrl),aC.unbind(ao.Z,ar.CtrlShift));af.setDefault(null);af.unbind(ao.Enter,ar.None)};this.getInputMemberId=function(){return bf};this.getSession=function(){return a7};this.getSessionConstraints=function(){return ah};this.setUndoManager=function(b){ak&&ak.unsubscribe(gui.UndoManager.signalUndoStackChanged,a3);if(ak=b){ak.setDocument(au),ak.setPlaybackFunction(a7.enqueue),ak.subscribe(gui.UndoManager.signalUndoStackChanged,a3)}};this.getUndoManager=function(){return ak};this.getMetadataController=function(){return a0};this.getAnnotationController=function(){return i};this.getDirectFormattingController=function(){return aM};this.getHyperlinkClickHandler=function(){return aU};this.getHyperlinkController=function(){return aK};this.getImageController=function(){return aJ};this.getSelectionController=function(){return ad};this.getTextController=function(){return aN};this.getEventManager=function(){return aq};this.getKeyboardHandlers=function(){return{keydown:aC,keypress:af}};this.destroy=function(d){var c=[aR.destroy,aI.destroy,aM.destroy,aH.destroy,aq.destroy,aU.destroy,aK.destroy,a0.destroy,ad.destroy,aN.destroy,ab];aX&&c.unshift(aX.destroy);runtime.clearTimeout(aF);core.Async.destroyAll(c,d)};aR=core.Task.createRedrawTask(aV);aI=core.Task.createRedrawTask(function(){var c=au.getCursor(bf);if(c&&c.getSelectionType()===ops.OdtCursor.RegionSelection&&(c=az.getImageElements(c.getSelectedRange())[0])){o.select(c.parentNode);return}o.clearSelection()});aC.bind(ao.Left,ar.None,aD(ad.moveCursorToLeft));aC.bind(ao.Right,ar.None,aD(ad.moveCursorToRight));aC.bind(ao.Up,ar.None,aD(ad.moveCursorUp));aC.bind(ao.Down,ar.None,aD(ad.moveCursorDown));aC.bind(ao.Left,ar.Shift,aD(ad.extendSelectionToLeft));aC.bind(ao.Right,ar.Shift,aD(ad.extendSelectionToRight));aC.bind(ao.Up,ar.Shift,aD(ad.extendSelectionUp));aC.bind(ao.Down,ar.Shift,aD(ad.extendSelectionDown));aC.bind(ao.Home,ar.None,aD(ad.moveCursorToLineStart));aC.bind(ao.End,ar.None,aD(ad.moveCursorToLineEnd));aC.bind(ao.Home,ar.Ctrl,aD(ad.moveCursorToDocumentStart));aC.bind(ao.End,ar.Ctrl,aD(ad.moveCursorToDocumentEnd));aC.bind(ao.Home,ar.Shift,aD(ad.extendSelectionToLineStart));aC.bind(ao.End,ar.Shift,aD(ad.extendSelectionToLineEnd));aC.bind(ao.Up,ar.CtrlShift,aD(ad.extendSelectionToParagraphStart));aC.bind(ao.Down,ar.CtrlShift,aD(ad.extendSelectionToParagraphEnd));aC.bind(ao.Home,ar.CtrlShift,aD(ad.extendSelectionToDocumentStart));aC.bind(ao.End,ar.CtrlShift,aD(ad.extendSelectionToDocumentEnd));ag?(aC.bind(ao.Left,ar.Alt,aD(ad.moveCursorBeforeWord)),aC.bind(ao.Right,ar.Alt,aD(ad.moveCursorPastWord)),aC.bind(ao.Left,ar.Meta,aD(ad.moveCursorToLineStart)),aC.bind(ao.Right,ar.Meta,aD(ad.moveCursorToLineEnd)),aC.bind(ao.Home,ar.Meta,aD(ad.moveCursorToDocumentStart)),aC.bind(ao.End,ar.Meta,aD(ad.moveCursorToDocumentEnd)),aC.bind(ao.Left,ar.AltShift,aD(ad.extendSelectionBeforeWord)),aC.bind(ao.Right,ar.AltShift,aD(ad.extendSelectionPastWord)),aC.bind(ao.Left,ar.MetaShift,aD(ad.extendSelectionToLineStart)),aC.bind(ao.Right,ar.MetaShift,aD(ad.extendSelectionToLineEnd)),aC.bind(ao.Up,ar.AltShift,aD(ad.extendSelectionToParagraphStart)),aC.bind(ao.Down,ar.AltShift,aD(ad.extendSelectionToParagraphEnd)),aC.bind(ao.Up,ar.MetaShift,aD(ad.extendSelectionToDocumentStart)),aC.bind(ao.Down,ar.MetaShift,aD(ad.extendSelectionToDocumentEnd)),aC.bind(ao.A,ar.Meta,aD(ad.extendSelectionToEntireDocument))):(aC.bind(ao.Left,ar.Ctrl,aD(ad.moveCursorBeforeWord)),aC.bind(ao.Right,ar.Ctrl,aD(ad.moveCursorPastWord)),aC.bind(ao.Left,ar.CtrlShift,aD(ad.extendSelectionBeforeWord)),aC.bind(ao.Right,ar.CtrlShift,aD(ad.extendSelectionPastWord)),aC.bind(ao.A,ar.Ctrl,aD(ad.extendSelectionToEntireDocument)));aj&&(aX=new gui.IOSSafariSupport(aq));aq.subscribe("keydown",aC.handleEvent);aq.subscribe("keypress",af.handleEvent);aq.subscribe("keyup",bg.handleEvent);aq.subscribe("copy",a6);aq.subscribe("mousedown",aZ);aq.subscribe("mousemove",aR.trigger);aq.subscribe("mouseup",ap);aq.subscribe("contextmenu",av);aq.subscribe("dragstart",aB);aq.subscribe("dragend",aA);aq.subscribe("click",aU.handleClick);aq.subscribe("longpress",aP);aq.subscribe("drag",aY);aq.subscribe("dragstop",aQ);au.subscribe(ops.OdtDocument.signalOperationEnd,aI.trigger);au.subscribe(ops.Document.signalCursorAdded,aH.registerCursor);au.subscribe(ops.Document.signalCursorRemoved,aH.removeCursor);au.subscribe(ops.OdtDocument.signalOperationEnd,bb)}})();gui.CaretManager=function(l,i){function r(b){return j.hasOwnProperty(b)?j[b]:null}function o(){return Object.keys(j).map(function(b){return j[b]})}function p(f){var d=j[f];d&&(delete j[f],f===l.getInputMemberId()?(c.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,d.ensureVisible),c.unsubscribe(ops.Document.signalCursorMoved,d.refreshCursorBlinking),g.unsubscribe("compositionupdate",d.handleUpdate),g.unsubscribe("compositionend",d.handleUpdate),g.unsubscribe("focus",d.setFocus),g.unsubscribe("blur",d.removeFocus),e.removeEventListener("focus",d.show,!1),e.removeEventListener("blur",d.hide,!1)):c.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,d.handleUpdate),d.destroy(function(){}))}var j={},e=runtime.getWindow(),c=l.getSession().getOdtDocument(),g=l.getEventManager();this.registerCursor=function(f,d,k){var h=f.getMemberId();f=new gui.Caret(f,i,d,k);j[h]=f;h===l.getInputMemberId()?(runtime.log("Starting to track input on new cursor of "+h),c.subscribe(ops.OdtDocument.signalProcessingBatchEnd,f.ensureVisible),c.subscribe(ops.Document.signalCursorMoved,f.refreshCursorBlinking),g.subscribe("compositionupdate",f.handleUpdate),g.subscribe("compositionend",f.handleUpdate),g.subscribe("focus",f.setFocus),g.subscribe("blur",f.removeFocus),e.addEventListener("focus",f.show,!1),e.addEventListener("blur",f.hide,!1),f.setOverlayElement(g.getEventTrap())):c.subscribe(ops.OdtDocument.signalProcessingBatchEnd,f.handleUpdate);return f};this.getCaret=r;this.getCarets=o;this.destroy=function(b){var d=o().map(function(f){return f.destroy});l.getSelectionController().setCaretXPositionLocator(null);c.unsubscribe(ops.Document.signalCursorRemoved,p);j={};core.Async.destroyAll(d,b)};l.getSelectionController().setCaretXPositionLocator(function(){var a=r(l.getInputMemberId()),f;a&&(f=a.getBoundingClientRect());return f?f.right:void 0});c.subscribe(ops.Document.signalCursorRemoved,p)};gui.EditInfoHandle=function(h){var g=[],e,i=h.ownerDocument,c=i.documentElement.namespaceURI;this.setEdits=function(j){g=j;var k,d,a,b;e.innerHTML="";for(j=0;j<g.length;j+=1){k=i.createElementNS(c,"div"),k.className="editInfo",d=i.createElementNS(c,"span"),d.className="editInfoColor",d.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g[j].memberid),a=i.createElementNS(c,"span"),a.className="editInfoAuthor",a.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g[j].memberid),b=i.createElementNS(c,"span"),b.className="editInfoTime",b.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g[j].memberid),b.innerHTML=g[j].time,k.appendChild(d),k.appendChild(a),k.appendChild(b),e.appendChild(k)}};this.show=function(){e.style.display="block"};this.hide=function(){e.style.display="none"};this.destroy=function(a){h.removeChild(e);a()};e=i.createElementNS(c,"div");e.setAttribute("class","editInfoHandle");e.style.display="none";h.appendChild(e)};ops.EditInfo=function(h,g){function e(){var b=[],f;for(f in c){c.hasOwnProperty(f)&&b.push({memberid:f,time:c[f].time})}b.sort(function(j,d){return j.time-d.time});return b}var i,c={};this.getNode=function(){return i};this.getOdtDocument=function(){return g};this.getEdits=function(){return c};this.getSortedEdits=function(){return e()};this.addEdit=function(b,f){c[b]={time:f}};this.clearEdits=function(){c={}};this.destroy=function(b){h.parentNode&&h.removeChild(i);b()};i=g.getDOMDocument().createElementNS("urn:webodf:names:editinfo","editinfo");h.insertBefore(i,h.firstChild)};gui.EditInfoMarker=function(p,j){function t(f,d){return runtime.setTimeout(function(){e.style.opacity=f},d)}var r=this,s,o,e,c,g,i;this.addEdit=function(a,f){var d=Date.now()-f;p.addEdit(a,f);o.setEdits(p.getSortedEdits());e.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",a);runtime.clearTimeout(g);runtime.clearTimeout(i);10000>d?(c=t(1,0),g=t(0.5,10000-d),i=t(0.2,20000-d)):10000<=d&&20000>d?(c=t(0.5,0),i=t(0.2,20000-d)):c=t(0.2,0)};this.getEdits=function(){return p.getEdits()};this.clearEdits=function(){p.clearEdits();o.setEdits([]);e.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&e.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")};this.getEditInfo=function(){return p};this.show=function(){e.style.display="block"};this.hide=function(){r.hideHandle();e.style.display="none"};this.showHandle=function(){o.show()};this.hideHandle=function(){o.hide()};this.destroy=function(b){runtime.clearTimeout(c);runtime.clearTimeout(g);runtime.clearTimeout(i);s.removeChild(e);o.destroy(function(a){a?b(a):p.destroy(b)})};(function(){var b=p.getOdtDocument().getDOMDocument();e=b.createElementNS(b.documentElement.namespaceURI,"div");e.setAttribute("class","editInfoMarker");e.onmouseover=function(){r.showHandle()};e.onmouseout=function(){r.hideHandle()};s=p.getNode();s.appendChild(e);o=new gui.EditInfoHandle(s);j||r.hide()})()};gui.HyperlinkTooltipView=function(l,g){var e=core.DomUtils,m=odf.OdfUtils,c=runtime.getWindow(),i,o,j;runtime.assert(null!==c,"Expected to be run in an environment which has a global window, like a browser.");this.showTooltip=function(a){var b=a.target||a.srcElement,d=l.getSizer(),k=l.getZoomLevel(),h;e:{for(;b;){if(m.isHyperlink(b)){break e}if(m.isParagraph(b)||m.isInlineRoot(b)){break}b=b.parentNode}b=null}if(b){e.containsNode(d,j)||d.appendChild(j);h=o;var f;switch(g()){case gui.KeyboardHandler.Modifier.Ctrl:f=runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:f=runtime.tr("\u2318-click to follow link");break;default:f=""}h.textContent=f;i.textContent=m.getHyperlinkTarget(b);j.style.display="block";h=c.innerWidth-j.offsetWidth-15;b=a.clientX>h?h:a.clientX+15;h=c.innerHeight-j.offsetHeight-10;a=a.clientY>h?h:a.clientY+10;d=d.getBoundingClientRect();b=(b-d.left)/k;a=(a-d.top)/k;j.style.left=b+"px";j.style.top=a+"px"}};this.hideTooltip=function(){j.style.display="none"};this.destroy=function(b){j.parentNode&&j.parentNode.removeChild(j);b()};(function(){var b=l.getElement().ownerDocument;i=b.createElement("span");o=b.createElement("span");i.className="webodf-hyperlinkTooltipLink";o.className="webodf-hyperlinkTooltipText";j=b.createElement("div");j.className="webodf-hyperlinkTooltip";j.appendChild(i);j.appendChild(o);l.getElement().appendChild(j)})()};gui.OdfFieldView=function(e){function c(){var f=odf.OdfSchema.getFields().map(function(d){return d.replace(":","|")}),h=f.join(",\n")+"\n{ background-color: #D0D0D0; }\n",f=f.map(function(d){return d+":empty::after"}).join(",\n")+"\n{ content:' '; white-space: pre; }\n";return h+"\n"+f}var b,g=e.getElement().ownerDocument;this.showFieldHighlight=function(){b.appendChild(g.createTextNode(c()))};this.hideFieldHighlight=function(){for(var a=b.sheet,f=a.cssRules;f.length;){a.deleteRule(f.length-1)}};this.destroy=function(a){b.parentNode&&b.parentNode.removeChild(b);a()};b=function(){var d=g.getElementsByTagName("head").item(0),i=g.createElement("style"),h="";i.type="text/css";i.media="screen, print, handheld, projection";odf.Namespaces.forEachPrefix(function(j,f){h+="@namespace "+j+" url("+f+");\n"});i.appendChild(g.createTextNode(h));d.appendChild(i);return i}()};gui.ShadowCursor=function(d){var c=d.getDOMDocument().createRange(),b=!0;this.removeFromDocument=function(){};this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId};this.getSelectedRange=function(){return c};this.setSelectedRange=function(e,a){c=e;b=!1!==a};this.hasForwardSelection=function(){return b};this.getDocument=function(){return d};this.getSelectionType=function(){return ops.OdtCursor.RangeSelection};c.setStart(d.getRootNode(),0)};gui.ShadowCursor.ShadowCursorMemberId="";gui.SelectionView=function(a){};gui.SelectionView.prototype.rerender=function(){};gui.SelectionView.prototype.show=function(){};gui.SelectionView.prototype.hide=function(){};gui.SelectionView.prototype.destroy=function(a){};gui.SelectionViewManager=function(d){function c(){return Object.keys(b).map(function(a){return b[a]})}var b={};this.getSelectionView=function(a){return b.hasOwnProperty(a)?b[a]:null};this.getSelectionViews=c;this.removeSelectionView=function(a){b.hasOwnProperty(a)&&(b[a].destroy(function(){}),delete b[a])};this.hideSelectionView=function(a){b.hasOwnProperty(a)&&b[a].hide()};this.showSelectionView=function(a){b.hasOwnProperty(a)&&b[a].show()};this.rerenderSelectionViews=function(){Object.keys(b).forEach(function(a){b[a].rerender()})};this.registerCursor=function(g,a){var f=g.getMemberId(),e=new d(g);a?e.show():e.hide();return b[f]=e};this.destroy=function(g){function e(a,f){f?g(f):a<h.length?h[a].destroy(function(i){e(a+1,i)}):g()}var h=c();e(0,void 0)}};gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0};(function(){gui.SessionView=function(Y,V,ad,aa,ac,W){function S(b){b.memberId===V&&E.getViewport().scrollIntoView(b.annotation.getBoundingClientRect())}function Q(){var d=document.getElementsByTagName("head").item(0),c=document.createElement("style");c.type="text/css";c.media="screen, print, handheld, projection";d.appendChild(c);return c}function T(f,d,h){function g(a,l,k){l=a+'[editinfo|memberid="'+f+'"]'+k+l;f:{var e=G.firstChild;for(a=a+'[editinfo|memberid="'+f+'"]'+k+"{";e;){if(e.nodeType===Node.TEXT_NODE&&0===e.data.indexOf(a)){a=e;break f}e=e.nextSibling}a=null}a?a.data=l:G.appendChild(document.createTextNode(l))}g("div.editInfoMarker","{ background-color: "+h+"; }","");g("span.editInfoColor","{ background-color: "+h+"; }","");g("span.editInfoAuthor",'{ content: "'+d+'"; }',":before");g("dc|creator","{ background-color: "+h+"; }","");g(".webodf-selectionOverlay","{ fill: "+h+"; stroke: "+h+";}","");f===V&&(g(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"),f=gui.ShadowCursor.ShadowCursorMemberId,g(".webodf-selectionOverlay","{ fill: "+h+"; stroke: "+h+";}",""),g(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"))}function U(e){var d,f;for(f in J){J.hasOwnProperty(f)&&(d=J[f],e?d.show():d.hide())}}function P(b){ac.getCarets().forEach(function(a){b?a.showHandle():a.hideHandle()})}function ab(d){var c=d.getMemberId();d=d.getProperties();T(c,d.fullName,d.color)}function Z(f){var a=f.getMemberId(),b=ad.getOdtDocument().getMember(a).getProperties();ac.registerCursor(f,A,i);W.registerCursor(f,!0);if(f=ac.getCaret(a)){f.setAvatarImageUrl(b.imageUrl),f.setColor(b.color)}runtime.log("+++ View here +++ eagerly created an Caret for '"+a+"'! +++")}function R(b){b=b.getMemberId();var h=W.getSelectionView(V),f=W.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),g=ac.getCaret(V);b===V?(f.hide(),h&&h.show(),g&&g.show()):b===gui.ShadowCursor.ShadowCursorMemberId&&(f.show(),h&&h.hide(),g&&g.hide())}function X(b){W.removeSelectionView(b)}function B(a){var n=a.paragraphElement,l=a.memberId;a=a.timeStamp;var m,k="",h=n.getElementsByTagNameNS(F,"editinfo").item(0);h?(k=h.getAttributeNS(F,"id"),m=J[k]):(k=Math.random().toString(),m=new ops.EditInfo(n,ad.getOdtDocument()),m=new gui.EditInfoMarker(m,L),h=n.getElementsByTagNameNS(F,"editinfo").item(0),h.setAttributeNS(F,"id",k),J[k]=m);m.addEdit(l,new Date(a));O.trigger()}function K(){var a;""!==M.innerHTML&&(M.innerHTML="");!0===aa.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(a=ad.getOdtDocument().getMember(V))&&(a=a.getProperties().fullName,M.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+a+"']) .annotationRemoveButton { display: none; }")))}function o(d){var c=Object.keys(J).map(function(b){return J[b]});j.unsubscribe(ops.Document.signalMemberAdded,ab);j.unsubscribe(ops.Document.signalMemberUpdated,ab);j.unsubscribe(ops.Document.signalCursorAdded,Z);j.unsubscribe(ops.Document.signalCursorRemoved,X);j.unsubscribe(ops.OdtDocument.signalParagraphChanged,B);j.unsubscribe(ops.Document.signalCursorMoved,R);j.unsubscribe(ops.OdtDocument.signalParagraphChanged,W.rerenderSelectionViews);j.unsubscribe(ops.OdtDocument.signalTableAdded,W.rerenderSelectionViews);j.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,W.rerenderSelectionViews);aa.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,K);j.unsubscribe(ops.Document.signalMemberAdded,K);j.unsubscribe(ops.Document.signalMemberUpdated,K);G.parentNode.removeChild(G);M.parentNode.removeChild(M);(function e(b,a){a?d(a):b<c.length?c[b].destroy(function(f){e(b+1,f)}):d()})(0,void 0)}var G,M,F="urn:webodf:names:editinfo",J={},j,E,O,L=void 0!==Y.editInfoMarkersInitiallyVisible?Boolean(Y.editInfoMarkersInitiallyVisible):!0,A=void 0!==Y.caretAvatarsInitiallyVisible?Boolean(Y.caretAvatarsInitiallyVisible):!0,i=void 0!==Y.caretBlinksOnRangeSelect?Boolean(Y.caretBlinksOnRangeSelect):!0;this.showEditInfoMarkers=function(){L||(L=!0,U(L))};this.hideEditInfoMarkers=function(){L&&(L=!1,U(L))};this.showCaretAvatars=function(){A||(A=!0,P(A))};this.hideCaretAvatars=function(){A&&(A=!1,P(A))};this.getSession=function(){return ad};this.getCaret=function(b){return ac.getCaret(b)};this.destroy=function(d){var c=[O.destroy,o];j.unsubscribe(ops.OdtDocument.signalAnnotationAdded,S);core.Async.destroyAll(c,d)};j=ad.getOdtDocument();E=j.getOdfCanvas();j.subscribe(ops.OdtDocument.signalAnnotationAdded,S);j.subscribe(ops.Document.signalMemberAdded,ab);j.subscribe(ops.Document.signalMemberUpdated,ab);j.subscribe(ops.Document.signalCursorAdded,Z);j.subscribe(ops.Document.signalCursorRemoved,X);j.subscribe(ops.OdtDocument.signalParagraphChanged,B);j.subscribe(ops.Document.signalCursorMoved,R);j.subscribe(ops.OdtDocument.signalParagraphChanged,W.rerenderSelectionViews);j.subscribe(ops.OdtDocument.signalTableAdded,W.rerenderSelectionViews);j.subscribe(ops.OdtDocument.signalParagraphStyleModified,W.rerenderSelectionViews);aa.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,K);j.subscribe(ops.Document.signalMemberAdded,K);j.subscribe(ops.Document.signalMemberUpdated,K);G=Q();G.appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);"));G.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);"));M=Q();K();O=core.Task.createRedrawTask(function(){var b=E.getAnnotationViewManager();b&&(b.rehighlightAnnotations(),j.fixCursorPositions())})}})();gui.SvgSelectionView=function(Y){function V(){var b=Z.getRootNode();R!==b&&(R=b,X=Z.getCanvas().getSizer(),X.appendChild(K),K.setAttribute("class","webodf-selectionOverlay"),G.setAttribute("class","webodf-draggable"),M.setAttribute("class","webodf-draggable"),G.setAttribute("end","left"),M.setAttribute("end","right"),G.setAttribute("r",8),M.setAttribute("r",8),K.appendChild(o),K.appendChild(G),K.appendChild(M))}function ad(b){b=b.getBoundingClientRect();return Boolean(b&&0!==b.height)}function aa(a){var s=F.getTextElements(a,!0,!1),q=a.cloneRange(),r=a.cloneRange();a=a.cloneRange();if(!s.length){return null}var p;ad:{p=0;var n=s[p],m=q.startContainer===n?q.startOffset:0,l=m;q.setStart(n,m);for(q.setEnd(n,l);!ad(q);){if(n.nodeType===Node.ELEMENT_NODE&&l<n.childNodes.length){l=n.childNodes.length}else{if(n.nodeType===Node.TEXT_NODE&&l<n.length){l+=1}else{if(s[p]){n=s[p],p+=1,m=l=0}else{p=!1;break ad}}}q.setStart(n,m);q.setEnd(n,l)}p=!0}if(!p){return null}ad:{p=s.length-1;n=s[p];l=m=r.endContainer===n?r.endOffset:n.nodeType===Node.TEXT_NODE?n.length:n.childNodes.length;r.setStart(n,m);for(r.setEnd(n,l);!ad(r);){if(n.nodeType===Node.ELEMENT_NODE&&0<m){m=0}else{if(n.nodeType===Node.TEXT_NODE&&0<m){m-=1}else{if(s[p]){n=s[p],p-=1,m=l=n.length||n.childNodes.length}else{s=!1;break ad}}}r.setStart(n,m);r.setEnd(n,l)}s=!0}if(!s){return null}a.setStart(q.startContainer,q.startOffset);a.setEnd(r.endContainer,r.endOffset);return{firstRange:q,lastRange:r,fillerRange:a}}function ac(e,d){var f={};f.top=Math.min(e.top,d.top);f.left=Math.min(e.left,d.left);f.right=Math.max(e.right,d.right);f.bottom=Math.max(e.bottom,d.bottom);f.width=f.right-f.left;f.height=f.bottom-f.top;return f}function W(b,d){d&&0<d.width&&0<d.height&&(b=b?ac(b,d):d);return b}function S(ae){function N(b){O.setUnfilteredPosition(b,0);return ag.acceptNode(b)===L&&ah.acceptPosition(O)===L?L:A}function I(b){var c=null;N(b)===L&&(c=J.getBoundingClientRect(b));return c}var H=ae.commonAncestorContainer,D=ae.startContainer,C=ae.endContainer,z=ae.startOffset,u=ae.endOffset,y,w,x=null,h,e=B.createRange(),ah,ag=new odf.OdfNodeFilter,af;if(D===H||C===H){return e=ae.cloneRange(),x=e.getBoundingClientRect(),e.detach(),x}for(ae=D;ae.parentNode!==H;){ae=ae.parentNode}for(w=C;w.parentNode!==H;){w=w.parentNode}ah=Z.createRootFilter(D);for(H=ae.nextSibling;H&&H!==w;){h=I(H),x=W(x,h),H=H.nextSibling}if(F.isParagraph(ae)){x=W(x,J.getBoundingClientRect(ae))}else{if(ae.nodeType===Node.TEXT_NODE){H=ae,e.setStart(H,z),e.setEnd(H,H===w?u:H.length),h=e.getBoundingClientRect(),x=W(x,h)}else{for(af=B.createTreeWalker(ae,NodeFilter.SHOW_TEXT,N,!1),H=af.currentNode=D;H&&H!==C;){e.setStart(H,z),e.setEnd(H,H.length),h=e.getBoundingClientRect(),x=W(x,h),y=H,z=0,H=af.nextNode()}}}y||(y=D);if(F.isParagraph(w)){x=W(x,J.getBoundingClientRect(w))}else{if(w.nodeType===Node.TEXT_NODE){H=w,e.setStart(H,H===ae?z:0),e.setEnd(H,u),h=e.getBoundingClientRect(),x=W(x,h)}else{for(af=B.createTreeWalker(w,NodeFilter.SHOW_TEXT,N,!1),H=af.currentNode=C;H&&H!==y;){if(e.setStart(H,0),e.setEnd(H,u),h=e.getBoundingClientRect(),x=W(x,h),H=af.previousNode()){u=H.length}}}}return x}function Q(f,d){var h=f.getBoundingClientRect(),g={width:0};g.top=h.top;g.bottom=h.bottom;g.height=h.height;g.left=g.right=d?h.right:h.left;return g}function T(){var u=Y.getSelectedRange(),s;if(s=E&&Y.getSelectionType()===ops.OdtCursor.RangeSelection&&!u.collapsed){V();var q=J.getBoundingClientRect(X),n=j.getZoomLevel(),u=aa(u),f,k,g,b,t,v;if(u){s=u.firstRange;f=u.lastRange;k=u.fillerRange;g=J.translateRect(Q(s,!1),q,n);t=J.translateRect(Q(f,!0),q,n);b=(b=S(k))?J.translateRect(b,q,n):ac(g,t);v=b.left;b=g.left+Math.max(0,b.width-(g.left-b.left));q=Math.min(g.top,t.top);n=t.top+t.height;v=[{x:g.left,y:q+g.height},{x:g.left,y:q},{x:b,y:q},{x:b,y:n-t.height},{x:t.right,y:n-t.height},{x:t.right,y:n},{x:v,y:n},{x:v,y:q+g.height},{x:g.left,y:q+g.height}];b="";var d;for(d=0;d<v.length;d+=1){b+=v[d].x+","+v[d].y+" "}o.setAttribute("points",b);G.setAttribute("cx",g.left);G.setAttribute("cy",q+g.height/2);M.setAttribute("cx",t.right);M.setAttribute("cy",n-t.height/2);s.detach();f.detach();k.detach()}s=Boolean(u)}K.style.display=s?"block":"none"}function U(b){E&&b===Y&&i.trigger()}function P(b){b=8/b;G.setAttribute("r",b);M.setAttribute("r",b)}function ab(b){X.removeChild(K);X.classList.remove("webodf-virtualSelections");Y.getDocument().unsubscribe(ops.Document.signalCursorMoved,U);j.unsubscribe(gui.ZoomHelper.signalZoomChanged,P);b()}var Z=Y.getDocument(),R,X,B=Z.getDOMDocument(),K=B.createElementNS("http://www.w3.org/2000/svg","svg"),o=B.createElementNS("http://www.w3.org/2000/svg","polygon"),G=B.createElementNS("http://www.w3.org/2000/svg","circle"),M=B.createElementNS("http://www.w3.org/2000/svg","circle"),F=odf.OdfUtils,J=core.DomUtils,j=Z.getCanvas().getZoomHelper(),E=!0,O=Y.getDocument().createPositionIterator(Z.getRootNode()),L=NodeFilter.FILTER_ACCEPT,A=NodeFilter.FILTER_REJECT,i;this.rerender=function(){E&&i.trigger()};this.show=function(){E=!0;i.trigger()};this.hide=function(){E=!1;i.trigger()};this.destroy=function(b){core.Async.destroyAll([i.destroy,ab],b)};(function(){var b=Y.getMemberId();i=core.Task.createRedrawTask(T);V();K.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",b);X.classList.add("webodf-virtualSelections");Y.getDocument().subscribe(ops.Document.signalCursorMoved,U);j.subscribe(gui.ZoomHelper.signalZoomChanged,P);P(j.getZoomLevel())})()};gui.UndoStateRules=function(){function e(h,j){var i=h.length;this.previous=function(){for(i-=1;0<=i;i-=1){if(j(h[i])){return h[i]}}return null}}function c(f){f=f.spec();var h;f.hasOwnProperty("position")&&(h=f.position);return h}function b(d){return d.isEdit}function g(h,j,i){if(!i){return i=c(h)-c(j),0===i||1===Math.abs(i)}h=c(h);j=c(j);i=c(i);return h-j===j-i}this.isEditOperation=b;this.isPartOfOperationSet=function(s,n){var j=void 0!==s.group,d;if(!s.isEdit||0===n.length){return !0}d=n[n.length-1];if(j&&s.group===d.group){return !0}b:switch(s.spec().optype){case"RemoveText":case"InsertText":d=!0;break b;default:d=!1}if(d&&n.some(b)){if(j){var f;j=s.spec().optype;d=new e(n,b);var i=d.previous(),a=null,p,o;runtime.assert(Boolean(i),"No edit operations found in state");o=i.group;runtime.assert(void 0!==o,"Operation has no group");for(p=1;i&&i.group===o;){if(j===i.spec().optype){f=i;break}i=d.previous()}if(f){for(i=d.previous();i;){if(i.group!==o){if(2===p){break}o=i.group;p+=1}if(j===i.spec().optype){a=i;break}i=d.previous()}f=g(s,f,a)}else{f=!1}return f}f=s.spec().optype;j=new e(n,b);d=j.previous();runtime.assert(Boolean(d),"No edit operations found in state");f=f===d.spec().optype?g(s,d,j.previous()):!1;return f}return !1}};(function(){function d(f,e){this.mainId=void 0!==f?f:-1;this.subId=void 0!==e?e:-1}function c(n,e,i){function g(k,h){return k+(n.isEditOperation(h)?1:0)}var j,a,f;this.addOperation=function(h){n.isEditOperation(h)&&(f+=1);a.push(h)};this.isNextStateId=function(h){return h.mainId===j&&h.subId===f};this.getNextStateId=function(){return new d(j,f)};this.getOperations=function(){return a};j=b+=1;a=e||[];f=e&&i?e.reduce(g,0):0}var b=0;gui.TrivialUndoManager=function(W){function V(){return !0!==E.isNextStateId(A)}function R(e){e=e.getOperations();0<e.length&&(j=!0,B(e),j=!1)}function O(){K.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:N.hasUndoStates(),redoAvailable:N.hasRedoStates()})}function M(e){var g=V();e!==g&&K.emit(gui.UndoManager.signalDocumentModifiedChanged,g)}function P(){E!==i&&E!==f[f.length-1]&&f.push(E)}function Q(g){var e=g.previousSibling||g.nextSibling;g.parentNode.removeChild(g);k.normalizeTextNodes(e)}function L(e){return Object.keys(e).map(function(a){return e[a]})}function U(l){function h(e){var s=e.spec();if(q[s.memberid]){switch(s.optype){case"AddCursor":r[s.memberid]||(r[s.memberid]=e,delete q[s.memberid],n-=1);break;case"MoveCursor":p[s.memberid]||(p[s.memberid]=e)}}}var r={},p={},q={},n,m;m=l.pop();J.getMemberIds().forEach(function(e){q[e]=!0});for(n=Object.keys(q).length;m&&0<n;){m=m.getOperations(),m.reverse(),m.forEach(h),m=l.pop()}return new c(G,L(r).concat(L(p)))}function T(){var g=V(),h=F=J.cloneDocumentElement();k.getElementsByTagNameNS(h,S,"cursor").forEach(Q);k.getElementsByTagNameNS(h,S,"anchor").forEach(Q);P();E=i=U([i].concat(f));f.length=0;o.length=0;g||(A=E.getNextStateId());O();M(g)}var N=this,S="urn:webodf:names:cursor",k=core.DomUtils,F,i,B,J,A,E,f=[],o=[],K=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.UndoManager.signalDocumentModifiedChanged,gui.TrivialUndoManager.signalDocumentRootReplaced]),G=W||new gui.UndoStateRules,j=!1;this.subscribe=function(g,e){K.subscribe(g,e)};this.unsubscribe=function(g,e){K.unsubscribe(g,e)};this.isDocumentModified=V;this.setDocumentModified=function(e){V()!==e&&(A=e?new d:E.getNextStateId(),K.emit(gui.UndoManager.signalDocumentModifiedChanged,e))};this.hasUndoStates=function(){return 0<f.length};this.hasRedoStates=function(){return 0<o.length};this.setDocument=function(e){J=e};this.purgeInitialState=function(){var e=V();f.length=0;o.length=0;E=i=new c(G);A=E.getNextStateId();F=null;O();M(e)};this.setInitialState=T;this.initialize=function(){F||T()};this.setPlaybackFunction=function(e){B=e};this.onOperationExecuted=function(e){if(!j){var g=V();G.isEditOperation(e)&&(E===i||0<o.length)||!G.isPartOfOperationSet(e,E.getOperations())?(o.length=0,P(),E=new c(G,[e],!0),f.push(E),K.emit(gui.UndoManager.signalUndoStateCreated,{operations:E.getOperations()}),O()):(E.addOperation(e),K.emit(gui.UndoManager.signalUndoStateModified,{operations:E.getOperations()}));M(g)}};this.moveForward=function(g){for(var m=0,h=V(),l;g&&o.length;){l=o.pop(),f.push(l),R(l),g-=1,m+=1}m&&(E=f[f.length-1],O(),M(h));return m};this.moveBackward=function(g){for(var l=0,h=V();g&&f.length;){o.push(f.pop()),g-=1,l+=1}l&&(J.getMemberIds().forEach(function(e){J.removeCursor(e)}),J.setDocumentElement(F.cloneNode(!0)),K.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),R(i),f.forEach(R),E=f[f.length-1]||i,O(),M(h));return l};E=i=new c(G);A=E.getNextStateId()};gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced"})();odf.GraphicProperties=function(j,g,e){var l=this,c=odf.Namespaces.stylens,i=odf.Namespaces.svgns;this.verticalPos=function(){return l.data.value("verticalPos")};this.verticalRel=function(){return l.data.value("verticalRel")};this.horizontalPos=function(){return l.data.value("horizontalPos")};this.horizontalRel=function(){return l.data.value("horizontalRel")};this.strokeWidth=function(){return l.data.value("strokeWidth")};l.data=new odf.LazyStyleProperties(void 0===e?void 0:e.data,{verticalPos:function(){var b=j.getAttributeNS(c,"vertical-pos");return""===b?void 0:b},verticalRel:function(){var b=j.getAttributeNS(c,"vertical-rel");return""===b?void 0:b},horizontalPos:function(){var b=j.getAttributeNS(c,"horizontal-pos");return""===b?void 0:b},horizontalRel:function(){var b=j.getAttributeNS(c,"horizontal-rel");return""===b?void 0:b},strokeWidth:function(){var b=j.getAttributeNS(i,"stroke-width");return g.parseLength(b)}})};odf.ComputedGraphicProperties=function(){var a;this.setGraphicProperties=function(b){a=b};this.verticalPos=function(){return a&&a.verticalPos()||"from-top"};this.verticalRel=function(){return a&&a.verticalRel()||"page"};this.horizontalPos=function(){return a&&a.horizontalPos()||"from-left"};this.horizontalRel=function(){return a&&a.horizontalRel()||"page"}};odf.PageLayoutProperties=function(h,g,e){var i=this,c=odf.Namespaces.fons;this.pageHeight=function(){return i.data.value("pageHeight")||1123};this.pageWidth=function(){return i.data.value("pageWidth")||794};i.data=new odf.LazyStyleProperties(void 0===e?void 0:e.data,{pageHeight:function(){var b;h&&(b=h.getAttributeNS(c,"page-height"),b=g.parseLength(b));return b},pageWidth:function(){var b;h&&(b=h.getAttributeNS(c,"page-width"),b=g.parseLength(b));return b}})};odf.PageLayout=function(e,c,b){var g=null;e&&(g=c.getPropertiesElement("page-layout-properties",e));this.pageLayout=new odf.PageLayoutProperties(g,c,b&&b.pageLayout)};odf.PageLayoutCache=function(){};odf.PageLayoutCache.prototype.getPageLayout=function(a){};odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){};odf.ParagraphProperties=function(h,g,e){var i=this,c=odf.Namespaces.fons;this.marginTop=function(){return i.data.value("marginTop")};i.data=new odf.LazyStyleProperties(void 0===e?void 0:e.data,{marginTop:function(){var a=h.getAttributeNS(c,"margin-top");return g.parsePositiveLengthOrPercent(a,"marginTop",e&&e.data)}})};odf.ComputedParagraphProperties=function(){var b={},a=[];this.setStyleChain=function(c){a=c;b={}};this.marginTop=function(){var c,e;if(b.hasOwnProperty("marginTop")){c=b.marginTop}else{for(e=0;void 0===c&&e<a.length;e+=1){c=a[e].marginTop()}b.marginTop=c}return c||0}};odf.TextProperties=function(h,g,e){var i=this,c=odf.Namespaces.fons;this.fontSize=function(){return i.data.value("fontSize")};i.data=new odf.LazyStyleProperties(void 0===e?void 0:e.data,{fontSize:function(){var a=h.getAttributeNS(c,"font-size");return g.parsePositiveLengthOrPercent(a,"fontSize",e&&e.data)}})};odf.ComputedTextProperties=function(){var b={},a=[];this.setStyleChain=function(c){a=c;b={}};this.fontSize=function(){var c,e;if(b.hasOwnProperty("fontSize")){c=b.fontSize}else{for(e=0;void 0===c&&e<a.length;e+=1){c=a[e].fontSize()}b.fontSize=c}return c||12}};odf.MasterPage=function(d,c){var b;d?(b=d.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=c.getPageLayout(b)):this.pageLayout=c.getDefaultPageLayout()};odf.MasterPageCache=function(){};odf.MasterPageCache.prototype.getMasterPage=function(a){};odf.StylePileEntry=function(e,c,b,g){this.masterPage=function(){var a=e.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),f=null;a&&(f=b.getMasterPage(a));return f};(function(d){var f=e.getAttributeNS(odf.Namespaces.stylens,"family"),i=null;if("graphic"===f||"chart"===f){d.graphic=void 0===g?void 0:g.graphic,i=c.getPropertiesElement("graphic-properties",e,i),null!==i&&(d.graphic=new odf.GraphicProperties(i,c,d.graphic))}if("paragraph"===f||"table-cell"===f||"graphic"===f||"presentation"===f||"chart"===f){d.paragraph=void 0===g?void 0:g.paragraph,i=c.getPropertiesElement("paragraph-properties",e,i),null!==i&&(d.paragraph=new odf.ParagraphProperties(i,c,d.paragraph))}if("text"===f||"paragraph"===f||"table-cell"===f||"graphic"===f||"presentation"===f||"chart"===f){d.text=void 0===g?void 0:g.text,i=c.getPropertiesElement("text-properties",e,i),null!==i&&(d.text=new odf.TextProperties(i,c,d.text))}})(this)};odf.StylePile=function(p,j){function t(f,d){var l,k;f.hasAttributeNS(r,"parent-style-name")&&(k=f.getAttributeNS(r,"parent-style-name"),-1===d.indexOf(k)&&(l=i(k,d)));return new odf.StylePileEntry(f,p,j,l)}var r=odf.Namespaces.stylens,s={},o={},e,c={},g={},i;i=function(h,k){var b=c[h],a;!b&&(a=s[h])&&(k.push(h),b=t(a,k),c[h]=b);return b};this.getStyle=function(h){var k=g[h]||c[h],b,a=[];k||(b=o[h],b||(b=s[h])&&a.push(h),b&&(k=t(b,a)));return k};this.addCommonStyle=function(b){var d;b.hasAttributeNS(r,"name")&&(d=b.getAttributeNS(r,"name"),s.hasOwnProperty(d)||(s[d]=b))};this.addAutomaticStyle=function(f){var d;f.hasAttributeNS(r,"name")&&(d=f.getAttributeNS(r,"name"),o.hasOwnProperty(d)||(o[d]=f))};this.setDefaultStyle=function(a){void 0===e&&(e=t(a,[]))};this.getDefaultStyle=function(){return e}};odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties;this.graphic=new odf.ComputedGraphicProperties};odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties};odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties};odf.StyleCache=function(Q){function N(g,f,l,h){f=l.getAttributeNS(f,"class-names");var k;if(f){for(f=f.split(" "),k=0;k<f.length;k+=1){if(l=f[k]){h.push(g),h.push(l)}}}}function V(e,d){var f=E.getStyleName("paragraph",e);void 0!==f&&(d.push("paragraph"),d.push(f));e.namespaceURI!==P||"h"!==e.localName&&"p"!==e.localName||N("paragraph",P,e,d);return d}function S(l,k,s){var q=[],r,p,n,m;for(r=0;r<l.length;r+=2){n=l[r],m=l[r+1],n=I[n],m=n.getStyle(m),void 0!==m&&(m=m[k],void 0!==m&&m!==p&&(q.push(m),p=m))}n=I[s];if(m=n.getDefaultStyle()){m=m[k],void 0!==m&&m!==p&&q.push(m)}return q}function U(g,b){var f=E.getStyleName("text",g),a=g.parentNode;void 0!==f&&(b.push("text"),b.push(f));"span"===g.localName&&g.namespaceURI===P&&N("text",P,g,b);if(!a||a===Q){return b}a.namespaceURI!==P||"p"!==a.localName&&"h"!==a.localName?U(a,b):V(a,b);return b}function O(b){b=b.getAttributeNS(o,"family");return I[b]}var K=this,I,L,M,G,T,R,J,P=odf.Namespaces.textns,o=odf.Namespaces.stylens,E=new odf.StyleInfo,j=new odf.StyleParseUtils,C,F,B,D,i,A;this.getComputedGraphicStyle=function(e){var d=[];e=E.getStyleName("graphic",e);void 0!==e&&(d.push("graphic"),d.push(e));e=d.join("/");var f=G[e];runtime.assert(0===d.length%2,"Invalid style chain.");void 0===f&&(f=new odf.ComputedGraphicStyle,f.graphic.setGraphicProperties(S(d,"graphic","graphic")[0]),f.text.setStyleChain(S(d,"text","graphic")),f.paragraph.setStyleChain(S(d,"paragraph","graphic")),G[e]=f);return f};this.getComputedParagraphStyle=function(a){a=V(a,[]);var f=a.join("/"),d=M[f];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===d&&(d=new odf.ComputedParagraphStyle,d.text.setStyleChain(S(a,"text","paragraph")),d.paragraph.setStyleChain(S(a,"paragraph","paragraph")),M[f]=d);return d};this.getComputedTextStyle=function(b){b=U(b,[]);var f=b.join("/"),d=L[f];runtime.assert(0===b.length%2,"Invalid style chain.");void 0===d&&(d=new odf.ComputedTextStyle,d.text.setStyleChain(S(b,"text","text")),L[f]=d);return d};this.getPageLayout=function(d){var c=A[d];c||((c=i[d])?(c=new odf.PageLayout(c,j,D),A[d]=c):c=D);return c};this.getDefaultPageLayout=function(){return D};this.getMasterPage=function(d){var c=F[d];void 0===c&&((c=C[d])?(c=new odf.MasterPage(c,K),F[d]=c):c=null);return c};this.getDefaultMasterPage=function(){return B};this.update=function(){var e,c,h=null,f=null;L={};M={};G={};C={};F={};A={};i={};T=new odf.StylePile(j,K);R=new odf.StylePile(j,K);J=new odf.StylePile(j,K);I={text:T,paragraph:R,graphic:J};for(e=Q.styles.firstElementChild;e;){e.namespaceURI===o&&((c=O(e))?"style"===e.localName?c.addCommonStyle(e):"default-style"===e.localName&&c.setDefaultStyle(e):"default-page-layout"===e.localName&&(h=e)),e=e.nextElementSibling}D=new odf.PageLayout(h,j);for(e=Q.automaticStyles.firstElementChild;e;){e.namespaceURI===o&&((c=O(e))&&"style"===e.localName?c.addAutomaticStyle(e):"page-layout"===e.localName&&(i[e.getAttributeNS(o,"name")]=e)),e=e.nextElementSibling}for(e=Q.masterStyles.firstElementChild;e;){e.namespaceURI===o&&"master-page"===e.localName&&(f=f||e,c=e,h=c.getAttributeNS(o,"name"),0<h.length&&!C.hasOwnProperty(h)&&(C[h]=c)),e=e.nextElementSibling}B=new odf.MasterPage(f,K)}};ops.OperationTransformMatrix=function(){function s(b){b.position+=b.length;b.length*=-1}function o(f){var d=0>f.length;d&&s(f);return d}function v(k,h){function m(a){k[a]===h&&l.push(a)}var l=[];k&&["style:parent-style-name","style:next-style-name"].forEach(m);return l}function t(h,f){function k(a){h[a]===f&&delete h[a]}h&&["style:parent-style-name","style:next-style-name"].forEach(k)}function u(b){var d={};Object.keys(b).forEach(function(a){d[a]="object"===typeof b[a]?u(b[a]):b[a]});return d}function p(C,B,A,z){var y,x=!1,w=!1,r,q=[];z&&z.attributes&&(q=z.attributes.split(","));C&&(A||0<q.length)&&Object.keys(C).forEach(function(a){var h=C[a],d;"object"!==typeof h&&(A&&(d=A[a]),void 0!==d?(delete C[a],w=!0,d===h&&(delete A[a],x=!0)):-1!==q.indexOf(a)&&(delete C[a],w=!0))});if(B&&B.attributes&&(A||0<q.length)){r=B.attributes.split(",");for(z=0;z<r.length;z+=1){if(y=r[z],A&&void 0!==A[y]||q&&-1!==q.indexOf(y)){r.splice(z,1),z-=1,w=!0}}0<r.length?B.attributes=r.join(","):delete B.attributes}return{majorChanged:x,minorChanged:w}}function g(f){for(var d in f){if(f.hasOwnProperty(d)){return !0}}return !1}function e(f){for(var d in f){if(f.hasOwnProperty(d)&&("attributes"!==d||0<f.attributes.length)){return !0}}return !1}function i(B,A,z,y,x){var q=B?B[x]:null,n=A?A[x]:null,h=z?z[x]:null,D=y?y[x]:null,C;C=p(q,n,h,D);q&&!g(q)&&delete B[x];n&&!e(n)&&delete A[x];h&&!g(h)&&delete z[x];D&&!e(D)&&delete y[x];return C}function j(f,d){return{opSpecsA:[f],opSpecsB:[d]}}var c;c={AddCursor:{AddCursor:j,AddMember:j,AddStyle:j,ApplyDirectStyling:j,InsertText:j,MergeParagraph:j,MoveCursor:j,RemoveCursor:j,RemoveMember:j,RemoveStyle:j,RemoveText:j,SetParagraphStyle:j,SplitParagraph:j,UpdateMember:j,UpdateMetadata:j,UpdateParagraphStyle:j},AddMember:{AddStyle:j,ApplyDirectStyling:j,InsertText:j,MergeParagraph:j,MoveCursor:j,RemoveCursor:j,RemoveStyle:j,RemoveText:j,SetParagraphStyle:j,SplitParagraph:j,UpdateMetadata:j,UpdateParagraphStyle:j},AddStyle:{AddStyle:j,ApplyDirectStyling:j,InsertText:j,MergeParagraph:j,MoveCursor:j,RemoveCursor:j,RemoveMember:j,RemoveStyle:function(a,m){var l,k=[a],d=[m];a.styleFamily===m.styleFamily&&(l=v(a.setProperties,m.styleName),0<l.length&&(l={optype:"UpdateParagraphStyle",memberid:m.memberid,timestamp:m.timestamp,styleName:a.styleName,removedProperties:{attributes:l.join(",")}},d.unshift(l)),t(a.setProperties,m.styleName));return{opSpecsA:k,opSpecsB:d}},RemoveText:j,SetParagraphStyle:j,SplitParagraph:j,UpdateMember:j,UpdateMetadata:j,UpdateParagraphStyle:j},ApplyDirectStyling:{ApplyDirectStyling:function(C,A,B){var z,y,x,n,m,b,D,E;n=[C];x=[A];if(!(C.position+C.length<=A.position||C.position>=A.position+A.length)){z=B?C:A;y=B?A:C;if(C.position!==A.position||C.length!==A.length){b=u(z),D=u(y)}A=i(y.setProperties,null,z.setProperties,null,"style:text-properties");if(A.majorChanged||A.minorChanged){x=[],C=[],n=z.position+z.length,m=y.position+y.length,y.position<z.position?A.minorChanged&&(E=u(D),E.length=z.position-y.position,C.push(E),y.position=z.position,y.length=m-y.position):z.position<y.position&&A.majorChanged&&(E=u(b),E.length=y.position-z.position,x.push(E),z.position=y.position,z.length=n-z.position),m>n?A.minorChanged&&(b=D,b.position=n,b.length=m-n,C.push(b),y.length=n-y.position):n>m&&A.majorChanged&&(b.position=m,b.length=n-m,x.push(b),z.length=m-z.position),z.setProperties&&g(z.setProperties)&&x.push(z),y.setProperties&&g(y.setProperties)&&C.push(y),B?(n=x,x=C):n=C}}return{opSpecsA:n,opSpecsB:x}},InsertText:function(f,d){d.position<=f.position?f.position+=d.text.length:d.position<=f.position+f.length&&(f.length+=d.text.length);return{opSpecsA:[f],opSpecsB:[d]}},MergeParagraph:function(k,h){var m=k.position,l=k.position+k.length;m>=h.sourceStartPosition&&(m-=1);l>=h.sourceStartPosition&&(l-=1);k.position=m;k.length=l-m;return{opSpecsA:[k],opSpecsB:[h]}},MoveCursor:j,RemoveCursor:j,RemoveMember:j,RemoveStyle:j,RemoveText:function(m,l){var w=m.position+m.length,r=l.position+l.length,q=[m],n=[l];r<=m.position?m.position-=l.length:l.position<w&&(m.position<l.position?m.length=r<w?m.length-l.length:l.position-m.position:(m.position=l.position,r<w?m.length=w-r:q=[]));return{opSpecsA:q,opSpecsB:n}},SetParagraphStyle:j,SplitParagraph:function(f,d){d.position<f.position?f.position+=1:d.position<f.position+f.length&&(f.length+=1);return{opSpecsA:[f],opSpecsB:[d]}},UpdateMember:j,UpdateMetadata:j,UpdateParagraphStyle:j},InsertText:{InsertText:function(h,f,k){h.position<f.position?f.position+=h.text.length:h.position>f.position?h.position+=f.text.length:k?f.position+=h.text.length:h.position+=f.text.length;return{opSpecsA:[h],opSpecsB:[f]}},MergeParagraph:function(f,d){f.position>=d.sourceStartPosition?f.position-=1:(f.position<d.sourceStartPosition&&(d.sourceStartPosition+=f.text.length),f.position<d.destinationStartPosition&&(d.destinationStartPosition+=f.text.length));return{opSpecsA:[f],opSpecsB:[d]}},MoveCursor:function(h,f){var k=o(f);h.position<f.position?f.position+=h.text.length:h.position<f.position+f.length&&(f.length+=h.text.length);k&&s(f);return{opSpecsA:[h],opSpecsB:[f]}},RemoveCursor:j,RemoveMember:j,RemoveStyle:j,RemoveText:function(l,k){var q;q=k.position+k.length;var n=[l],m=[k];q<=l.position?l.position-=k.length:l.position<=k.position?k.position+=l.text.length:(k.length=l.position-k.position,q={optype:"RemoveText",memberid:k.memberid,timestamp:k.timestamp,position:l.position+l.text.length,length:q-l.position},m.unshift(q),l.position=k.position);return{opSpecsA:n,opSpecsB:m}},SetParagraphStyle:function(f,d){d.position>f.position&&(d.position+=f.text.length);return{opSpecsA:[f],opSpecsB:[d]}},SplitParagraph:function(f,d){f.position<d.sourceParagraphPosition&&(d.sourceParagraphPosition+=f.text.length);f.position<=d.position?d.position+=f.text.length:f.position+=1;return{opSpecsA:[f],opSpecsB:[d]}},UpdateMember:j,UpdateMetadata:j,UpdateParagraphStyle:j},MergeParagraph:{MergeParagraph:function(m,l,w){var r=[m],q=[l],n;m.destinationStartPosition===l.destinationStartPosition?(r=[],q=[],m.moveCursor&&(n={optype:"MoveCursor",memberid:m.memberid,timestamp:m.timestamp,position:m.sourceStartPosition-1},r.push(n)),l.moveCursor&&(n={optype:"MoveCursor",memberid:l.memberid,timestamp:l.timestamp,position:l.sourceStartPosition-1},q.push(n)),m=w?m:l,m={optype:"SetParagraphStyle",memberid:m.memberid,timestamp:m.timestamp,position:m.destinationStartPosition,styleName:m.paragraphStyleName},w?r.push(m):q.push(m)):l.sourceStartPosition===m.destinationStartPosition?(m.destinationStartPosition=l.destinationStartPosition,m.sourceStartPosition-=1,m.paragraphStyleName=l.paragraphStyleName):m.sourceStartPosition===l.destinationStartPosition?(l.destinationStartPosition=m.destinationStartPosition,l.sourceStartPosition-=1,l.paragraphStyleName=m.paragraphStyleName):m.destinationStartPosition<l.destinationStartPosition?(l.destinationStartPosition-=1,l.sourceStartPosition-=1):(m.destinationStartPosition-=1,m.sourceStartPosition-=1);return{opSpecsA:r,opSpecsB:q}},MoveCursor:function(l,k){var q=k.position,n=k.position+k.length,m=Math.min(q,n),q=Math.max(q,n);m>=l.sourceStartPosition&&(m-=1);q>=l.sourceStartPosition&&(q-=1);0<=k.length?(k.position=m,k.length=q-m):(k.position=q,k.length=m-q);return{opSpecsA:[l],opSpecsB:[k]}},RemoveCursor:j,RemoveMember:j,RemoveStyle:j,RemoveText:function(f,d){d.position>=f.sourceStartPosition?d.position-=1:(d.position<f.destinationStartPosition&&(f.destinationStartPosition-=d.length),d.position<f.sourceStartPosition&&(f.sourceStartPosition-=d.length));return{opSpecsA:[f],opSpecsB:[d]}},SetParagraphStyle:function(k,h){var m=[k],l=[h];if(h.position>k.sourceStartPosition){h.position-=1}else{if(h.position===k.destinationStartPosition||h.position===k.sourceStartPosition){h.position=k.destinationStartPosition,k.paragraphStyleName=h.styleName}}return{opSpecsA:m,opSpecsB:l}},SplitParagraph:function(l,k){var q,n=[l],m=[k];k.position<l.destinationStartPosition?(l.destinationStartPosition+=1,l.sourceStartPosition+=1):k.position>=l.destinationStartPosition&&k.position<l.sourceStartPosition?(k.paragraphStyleName=l.paragraphStyleName,q={optype:"SetParagraphStyle",memberid:l.memberid,timestamp:l.timestamp,position:l.destinationStartPosition,styleName:l.paragraphStyleName},n.push(q),k.position===l.sourceStartPosition-1&&l.moveCursor&&(q={optype:"MoveCursor",memberid:l.memberid,timestamp:l.timestamp,position:k.position,length:0},n.push(q)),l.destinationStartPosition=k.position+1,l.sourceStartPosition+=1):k.position>=l.sourceStartPosition&&(k.position-=1,k.sourceParagraphPosition-=1);return{opSpecsA:n,opSpecsB:m}},UpdateMember:j,UpdateMetadata:j,UpdateParagraphStyle:j},MoveCursor:{MoveCursor:j,RemoveCursor:function(f,d){return{opSpecsA:f.memberid===d.memberid?[]:[f],opSpecsB:[d]}},RemoveMember:j,RemoveStyle:j,RemoveText:function(k,f){var n=o(k),m=k.position+k.length,l=f.position+f.length;l<=k.position?k.position-=f.length:f.position<m&&(k.position<f.position?k.length=l<m?k.length-f.length:f.position-k.position:(k.position=f.position,k.length=l<m?m-l:0));n&&s(k);return{opSpecsA:[k],opSpecsB:[f]}},SetParagraphStyle:j,SplitParagraph:function(h,f){var k=o(h);f.position<h.position?h.position+=1:f.position<h.position+h.length&&(h.length+=1);k&&s(h);return{opSpecsA:[h],opSpecsB:[f]}},UpdateMember:j,UpdateMetadata:j,UpdateParagraphStyle:j},RemoveCursor:{RemoveCursor:function(h,f){var k=h.memberid===f.memberid;return{opSpecsA:k?[]:[h],opSpecsB:k?[]:[f]}},RemoveMember:j,RemoveStyle:j,RemoveText:j,SetParagraphStyle:j,SplitParagraph:j,UpdateMember:j,UpdateMetadata:j,UpdateParagraphStyle:j},RemoveMember:{RemoveStyle:j,RemoveText:j,SetParagraphStyle:j,SplitParagraph:j,UpdateMetadata:j,UpdateParagraphStyle:j},RemoveStyle:{RemoveStyle:function(h,f){var k=h.styleName===f.styleName&&h.styleFamily===f.styleFamily;return{opSpecsA:k?[]:[h],opSpecsB:k?[]:[f]}},RemoveText:j,SetParagraphStyle:function(l,k){var q,n=[l],m=[k];"paragraph"===l.styleFamily&&l.styleName===k.styleName&&(q={optype:"SetParagraphStyle",memberid:l.memberid,timestamp:l.timestamp,position:k.position,styleName:""},n.unshift(q),k.styleName="");return{opSpecsA:n,opSpecsB:m}},SplitParagraph:j,UpdateMember:j,UpdateMetadata:j,UpdateParagraphStyle:function(a,m){var l,k=[a],d=[m];"paragraph"===a.styleFamily&&(l=v(m.setProperties,a.styleName),0<l.length&&(l={optype:"UpdateParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,styleName:m.styleName,removedProperties:{attributes:l.join(",")}},k.unshift(l)),a.styleName===m.styleName?d=[]:t(m.setProperties,a.styleName));return{opSpecsA:k,opSpecsB:d}}},RemoveText:{RemoveText:function(m,l){var w=m.position+m.length,r=l.position+l.length,q=[m],n=[l];r<=m.position?m.position-=l.length:w<=l.position?l.position-=m.length:l.position<w&&(m.position<l.position?(m.length=r<w?m.length-l.length:l.position-m.position,w<r?(l.position=m.position,l.length=r-w):n=[]):(w<r?l.length-=m.length:l.position<m.position?l.length=m.position-l.position:n=[],r<w?(m.position=l.position,m.length=w-r):q=[]));return{opSpecsA:q,opSpecsB:n}},SetParagraphStyle:function(f,d){f.position<d.position&&(d.position-=f.length);return{opSpecsA:[f],opSpecsB:[d]}},SplitParagraph:function(l,k){var q=l.position+l.length,n=[l],m=[k];k.position<=l.position?l.position+=1:k.position<q&&(l.length=k.position-l.position,q={optype:"RemoveText",memberid:l.memberid,timestamp:l.timestamp,position:k.position+1,length:q-k.position},n.unshift(q));l.position+l.length<=k.position?k.position-=l.length:l.position<k.position&&(k.position=l.position);l.position+l.length<k.sourceParagraphPosition&&(k.sourceParagraphPosition-=l.length);return{opSpecsA:n,opSpecsB:m}},UpdateMember:j,UpdateMetadata:j,UpdateParagraphStyle:j},SetParagraphStyle:{SetParagraphStyle:function(h,f,k){h.position===f.position&&(k?f.styleName=h.styleName:h.styleName=f.styleName);return{opSpecsA:[h],opSpecsB:[f]}},SplitParagraph:function(b,n){var m=[b],l=[n],k;b.position>n.position?b.position+=1:b.position===n.sourceParagraphPosition&&(n.paragraphStyleName=b.styleName,k=u(b),k.position=n.position+1,m.push(k));return{opSpecsA:m,opSpecsB:l}},UpdateMember:j,UpdateMetadata:j,UpdateParagraphStyle:j},SplitParagraph:{SplitParagraph:function(l,k,q){var n,m;l.position<k.position?n=!0:k.position<l.position?m=!0:l.position===k.position&&(q?n=!0:m=!0);n?(k.position+=1,k.sourceParagraphPosition=l.position<k.sourceParagraphPosition?k.sourceParagraphPosition+1:l.position+1):m&&(l.position+=1,l.sourceParagraphPosition=k.position<k.sourceParagraphPosition?l.sourceParagraphPosition+1:k.position+1);return{opSpecsA:[l],opSpecsB:[k]}},UpdateMember:j,UpdateMetadata:j,UpdateParagraphStyle:j},UpdateMember:{UpdateMetadata:j,UpdateParagraphStyle:j},UpdateMetadata:{UpdateMetadata:function(n,h,w){var r,q=[n],m=[h];r=w?n:h;n=w?h:n;p(n.setProperties||null,n.removedProperties||null,r.setProperties||null,r.removedProperties||null);r.setProperties&&g(r.setProperties)||r.removedProperties&&e(r.removedProperties)||(w?q=[]:m=[]);n.setProperties&&g(n.setProperties)||n.removedProperties&&e(n.removedProperties)||(w?m=[]:q=[]);return{opSpecsA:q,opSpecsB:m}},UpdateParagraphStyle:j},UpdateParagraphStyle:{UpdateParagraphStyle:function(n,h,w){var r,q=[n],m=[h];n.styleName===h.styleName&&(r=w?n:h,n=w?h:n,i(n.setProperties,n.removedProperties,r.setProperties,r.removedProperties,"style:paragraph-properties"),i(n.setProperties,n.removedProperties,r.setProperties,r.removedProperties,"style:text-properties"),p(n.setProperties||null,n.removedProperties||null,r.setProperties||null,r.removedProperties||null),r.setProperties&&g(r.setProperties)||r.removedProperties&&e(r.removedProperties)||(w?q=[]:m=[]),n.setProperties&&g(n.setProperties)||n.removedProperties&&e(n.removedProperties)||(w?m=[]:q=[]));return{opSpecsA:q,opSpecsB:m}}}};this.passUnchanged=j;this.extendTransformations=function(b){Object.keys(b).forEach(function(a){var m=b[a],l,k=c.hasOwnProperty(a);runtime.log((k?"Extending":"Adding")+" map for optypeA: "+a);k||(c[a]={});l=c[a];Object.keys(m).forEach(function(d){var f=l.hasOwnProperty(d);runtime.assert(a<=d,"Wrong order:"+a+", "+d);runtime.log("  "+(f?"Overwriting":"Adding")+" entry for optypeB: "+d);l[d]=m[d]})})};this.transformOpspecVsOpspec=function(k,h){var m=k.optype<=h.optype,l;runtime.log("Crosstransforming:");runtime.log(runtime.toJson(k));runtime.log(runtime.toJson(h));m||(l=k,k=h,h=l);(l=(l=c[k.optype])&&l[h.optype])?(l=l(k,h,!m),m||null===l||(l={opSpecsA:l.opSpecsB,opSpecsB:l.opSpecsA})):l=null;runtime.log("result:");l?(runtime.log(runtime.toJson(l.opSpecsA)),runtime.log(runtime.toJson(l.opSpecsB))):runtime.log("null");return l}};ops.OperationTransformer=function(){function b(e,i){for(var c,f,j=[],g=[];0<e.length&&i;){c=e.shift();c=a.transformOpspecVsOpspec(c,i);if(!c){return null}j=j.concat(c.opSpecsA);if(0===c.opSpecsB.length){j=j.concat(e);i=null;break}for(;1<c.opSpecsB.length;){f=b(e,c.opSpecsB.shift());if(!f){return null}g=g.concat(f.opSpecsB);e=f.opSpecsA}i=c.opSpecsB.pop()}i&&g.push(i);return{opSpecsA:j,opSpecsB:g}}var a=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return a};this.transform=function(e,g){for(var c,f=[];0<g.length;){c=b(e,g.shift());if(!c){return null}e=c.opSpecsA;f=f.concat(c.opSpecsB)}return{opSpecsA:e,opSpecsB:f}}};var webodf_css='@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);@namespace webodfhelper url(urn:webodf:names:helper);@namespace cursor url(urn:webodf:names:cursor);@namespace editinfo url(urn:webodf:names:editinfo);@namespace annotation url(urn:webodf:names:annotation);@namespace dc url(http://purl.org/dc/elements/1.1/);@namespace svgns url(http://www.w3.org/2000/svg);office|document > *, office|document-content > * {display: none;}office|body, office|document {display: inline-block;position: relative;}text|p, text|h {display: block;padding: 0;margin: 0;line-height: normal;position: relative;}text|p::after, text|h::after {content: "\\200B";white-space: pre;}*[webodfhelper|containsparagraphanchor] {position: relative;}text|s {white-space: pre;}text|tab {display: inline;white-space: pre;}text|tracked-changes {display: none;}office|binary-data {display: none;}office|text {display: block;text-align: left;overflow: visible;word-wrap: break-word;}office|text::selection {background: transparent;}.webodf-virtualSelections *::selection {background: transparent;}.webodf-virtualSelections *::-moz-selection {background: transparent;}office|text * draw|text-box {display: block;border: 1px solid #d3d3d3;}office|text draw|frame {z-index: 1;}office|spreadsheet {display: block;border-collapse: collapse;empty-cells: show;font-family: sans-serif;font-size: 10pt;text-align: left;page-break-inside: avoid;overflow: hidden;}office|presentation {display: inline-block;text-align: left;}#shadowContent {display: inline-block;text-align: left;}draw|page {display: block;position: relative;overflow: hidden;}presentation|notes, presentation|footer-decl, presentation|date-time-decl {display: none;}@media print {draw|page {border: 1pt solid black;page-break-inside: avoid;}presentation|notes {}}office|spreadsheet text|p {border: 0px;padding: 1px;margin: 0px;}office|spreadsheet table|table {margin: 3px;}office|spreadsheet table|table:after {}office|spreadsheet table|table-row {counter-increment: row;}office|spreadsheet table|table-row:before {width: 3em;background: #cccccc;border: 1px solid black;text-align: center;content: counter(row);display: table-cell;}office|spreadsheet table|table-cell {border: 1px solid #cccccc;}table|table {display: table;}draw|frame table|table {width: 100%;height: 100%;background: white;}table|table-header-rows {display: table-header-group;}table|table-row {display: table-row;}table|table-column {display: table-column;}table|table-cell {width: 0.889in;display: table-cell;word-break: break-all;}draw|frame {display: block;}draw|image {display: block;width: 100%;height: 100%;top: 0px;left: 0px;background-repeat: no-repeat;background-size: 100% 100%;-moz-background-size: 100% 100%;}draw|frame > draw|image:nth-of-type(n+2) {display: none;}text|list:before {display: none;content:"";}text|list {display: block;}text|list-item {display: block;}text|number {display:none;}text|a {color: blue;text-decoration: underline;cursor: pointer;}.webodf-inactiveLinks text|a {cursor: text;}text|note-citation {vertical-align: super;font-size: smaller;}text|note-body {display: none;}text|note:hover text|note-citation {background: #dddddd;}text|note:hover text|note-body {display: block;left:1em;max-width: 80%;position: absolute;background: #ffffaa;}text|bibliography-source {display: none;}svg|title, svg|desc {display: none;}video {width: 100%;height: 100%}cursor|anchor {display: none;}cursor|cursor {display: none;}.webodf-caretOverlay {position: absolute;top: 5%;height: 1em;z-index: 10;padding-left: 1px;pointer-events: none;}.webodf-caretOverlay .caret {position: absolute;border-left: 2px solid black;top: 0;bottom: 0;right: 0;}.webodf-caretOverlay .handle {position: absolute;margin-top: 5px;padding-top: 3px;margin-left: auto;margin-right: auto;width: 64px;height: 68px;border-radius: 5px;opacity: 0.3;text-align: center;background-color: black;box-shadow: 0px 0px 5px rgb(90, 90, 90);border: 1px solid black;top: -85px;right: -32px;}.webodf-caretOverlay .handle > img {box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;background-color: rgb(200, 200, 200);border-radius: 5px;border: 2px solid;height: 60px;width: 60px;display: block;margin: auto;}.webodf-caretOverlay .handle.active {opacity: 0.8;}.webodf-caretOverlay .handle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 43%;}.webodf-caretSizer {display: inline-block;width: 0;visibility: hidden;}#eventTrap {display: block;position: absolute;bottom: 0;left: 0;outline: none;opacity: 0;color: rgba(255, 255, 255, 0);pointer-events: none;white-space: pre;overflow: hidden;}cursor|cursor > #composer {text-decoration: underline;}cursor|cursor[cursor|caret-sizer-active="true"],cursor|cursor[cursor|composing="true"] {display: inline;}editinfo|editinfo {display: inline-block;}.editInfoMarker {position: absolute;width: 10px;height: 100%;left: -20px;opacity: 0.8;top: 0;border-radius: 5px;background-color: transparent;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);}.editInfoMarker:hover {box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);}.editInfoHandle {position: absolute;background-color: black;padding: 5px;border-radius: 5px;opacity: 0.8;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);bottom: 100%;margin-bottom: 10px;z-index: 3;left: -25px;}.editInfoHandle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 5px;}.editInfo {font-family: sans-serif;font-weight: normal;font-style: normal;text-decoration: none;color: white;width: 100%;height: 12pt;}.editInfoColor {float: left;width: 10pt;height: 10pt;border: 1px solid white;}.editInfoAuthor {float: left;margin-left: 5pt;font-size: 10pt;text-align: left;height: 12pt;line-height: 12pt;}.editInfoTime {float: right;margin-left: 30pt;font-size: 8pt;font-style: italic;color: yellow;height: 12pt;line-height: 12pt;}.annotationWrapper {display: inline;position: relative;}.annotationRemoveButton:before {content: "\u00d7";color: white;padding: 5px;line-height: 1em;}.annotationRemoveButton {width: 20px;height: 20px;border-radius: 10px;background-color: black;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);position: absolute;top: -10px;left: -10px;z-index: 3;text-align: center;font-family: sans-serif;font-style: normal;font-weight: normal;text-decoration: none;font-size: 15px;}.annotationRemoveButton:hover {cursor: pointer;box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);}.annotationNote {width: 4cm;position: absolute;display: inline;z-index: 10;top: 0;}.annotationNote > office|annotation {display: block;text-align: left;}.annotationConnector {position: absolute;display: inline;top: 0;z-index: 2;border-top: 1px dashed brown;}.annotationConnector.angular {-moz-transform-origin: left top;-webkit-transform-origin: left top;-ms-transform-origin: left top;transform-origin: left top;}.annotationConnector.horizontal {left: 0;}.annotationConnector.horizontal:before {content: "";display: inline;position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: brown transparent transparent transparent;top: -1px;left: -5px;}office|annotation {width: 100%;height: 100%;display: none;background: rgb(198, 238, 184);background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);box-shadow: 0 3px 4px -3px #ccc;}office|annotation > dc|creator {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;color: white;background-color: brown;padding: 4px;}office|annotation > dc|date {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;border: 4px solid transparent;color: black;}office|annotation > text|list {display: block;padding: 5px;}office|annotation text|p {font-size: 10pt;color: black;font-weight: normal;font-style: normal;text-decoration: none;font-family: sans-serif;}#annotationsPane {background-color: #EAEAEA;width: 4cm;height: 100%;display: none;position: absolute;outline: 1px solid #ccc;}.webodf-annotationHighlight {background-color: yellow;position: relative;}.webodf-selectionOverlay {position: absolute;pointer-events: none;top: 0;left: 0;top: 0;left: 0;width: 100%;height: 100%;z-index: 15;}.webodf-selectionOverlay > polygon {fill-opacity: 0.3;stroke-opacity: 0.8;stroke-width: 1;fill-rule: evenodd;}.webodf-selectionOverlay > .webodf-draggable {fill-opacity: 0.8;stroke-opacity: 0;stroke-width: 8;pointer-events: all;display: none;-moz-transform-origin: center center;-webkit-transform-origin: center center;-ms-transform-origin: center center;transform-origin: center center;}#imageSelector {display: none;position: absolute;border-style: solid;border-color: black;}#imageSelector > div {width: 5px;height: 5px;display: block;position: absolute;border: 1px solid black;background-color: #ffffff;}#imageSelector > .topLeft {top: -4px;left: -4px;}#imageSelector > .topRight {top: -4px;right: -4px;}#imageSelector > .bottomRight {right: -4px;bottom: -4px;}#imageSelector > .bottomLeft {bottom: -4px;left: -4px;}#imageSelector > .topMiddle {top: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .rightMiddle {top: 50%;right: -4px;margin-top: -2.5px;}#imageSelector > .bottomMiddle {bottom: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .leftMiddle {top: 50%;left: -4px;margin-top: -2.5px;}div.webodf-customScrollbars::-webkit-scrollbar{width: 8px;height: 8px;background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-track{background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-thumb{background-color: #444;border-radius: 4px;}.webodf-hyperlinkTooltip {display: none;color: white;background-color: black;border-radius: 5px;box-shadow: 2px 2px 5px gray;padding: 3px;position: absolute;max-width: 210px;text-align: left;word-break: break-all;z-index: 16;}.webodf-hyperlinkTooltipText {display: block;font-weight: bold;}';