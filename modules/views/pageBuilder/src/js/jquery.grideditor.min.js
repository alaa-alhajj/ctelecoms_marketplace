
(function(a){a.fn.gridEditor=function(d){var c=this;var b=c.data("grideditor");if(arguments[0]=="getHtml"){if(b){b.deinit();var e=c.html();b.init();return e}else{return c.html()}}c.each(function(z,l){l=a(l);if(l.children().length&&!l.find("div.row").length){var m=l.children();var r=a('<div class="row"><div class="col-md-12"/></div>').appendTo(l);r.find(".col-md-12").append(m)}var J=a.extend({new_row_layouts:[[12],[6,6],[4,4,4],[3,3,3,3],[2,2,2,2,2,2],[2,8,2],[4,8],[8,4]],row_classes:[{label:"Example class",cssClass:"example-class"}],col_classes:[{label:"Example class",cssClass:"example-class"}],col_tools:[],row_tools:[],custom_filter:"",content_types:["tinymce"],valid_col_sizes:[1,2,3,4,5,6,7,8,9,10,11,12],source_textarea:""},d);var k,u,q,N;var o=["col-md-","col-sm-","col-xs-"];var f=0;var x=12;C();G();function C(){k=l.addClass("ge-canvas");if(J.source_textarea){var Q=a(J.source_textarea);Q.addClass("ge-html-output");N=Q;if(Q.val()){c.html(Q.val())}}if(typeof N==="undefined"||!N.length){N=a('<textarea class="ge-html-output"/>').insertBefore(k)}u=a('<div class="ge-mainControls" />').insertBefore(N);var U=a('<div class="ge-wrapper ge-top" />').appendTo(u);q=a('<div class="ge-addRowGroup btn-group" />').appendTo(U);a.each(J.new_row_layouts,function(W,Z){var X=a('<a class="btn btn-xs btn-primary" />').attr("title","Add row "+Z.join("-")).on("click",function(){var aa=i().appendTo(k);Z.forEach(function(ab){I(ab).appendTo(aa)});G()}).appendTo(q);X.append('<span class="glyphicon glyphicon-plus-sign"/>');var V=Z.join(" - ");var Y='<div class="row ge-row-icon">';Z.forEach(function(aa){Y+='<div class="column col-xs-'+aa+'"/>'});Y+="</div>";X.append(Y)});var P=a('<div class="dropdown pull-right ge-layout-mode"><button type="button" class="btn btn-xs btn-primary dropdown-toggle" data-toggle="dropdown"><span>Desktop</span></button><ul class="dropdown-menu" role="menu"><li><a data-width="auto" title="Desktop"><span>Desktop</span></a></li><li><a title="Tablet"><span>Tablet</span></li><li><a title="Phone"><span>Phone</span></a></li></ul></div>').on("click","a",function(){var V=a(this);E(V.closest("li").index());var W=P.find("button");W.find("span").remove();W.append(V.find("span").clone())}).appendTo(U);var T=a('<div class="btn-group pull-right"/>').appendTo(U);var R=a('<button title="Edit Source Code" type="button" class="btn btn-xs btn-primary gm-edit-mode"><span class="glyphicon glyphicon-chevron-left"></span><span class="glyphicon glyphicon-chevron-right"></span></button>').on("click",function(){if(R.hasClass("active")){k.empty().html(N.val()).show();G();N.hide()}else{p();N.height(0.8*a(window).height()).val(k.html()).show();k.hide()}R.toggleClass("active btn-danger")}).appendTo(T);var O=a('<button title="Preview" type="button" class="btn btn-xs btn-primary gm-preview"><span class="glyphicon glyphicon-eye-open"></span></button>').on("mouseenter",function(){k.removeClass("ge-editing")}).on("click",function(){O.toggleClass("active btn-danger").trigger("mouseleave")}).on("mouseleave",function(){if(!O.hasClass("active")){k.addClass("ge-editing")}}).appendTo(T);var S=a(window);S.on("scroll",function(V){if(S.scrollTop()>u.offset().top&&S.scrollTop()<k.offset().top+k.height()){if(U.hasClass("ge-top")){U.css({left:U.offset().left,width:U.outerWidth(),}).removeClass("ge-top").addClass("ge-fixed")}}else{if(U.hasClass("ge-fixed")){U.css({left:"",width:""}).removeClass("ge-fixed").addClass("ge-top")}}});k.on("click",".ge-content",function(W){var V=D(a(this).data("ge-content-type"));if(V){V.init(J,a(this))}})}function M(){p();G()}function G(){g(true);k.addClass("ge-editing");B();F();j();h();L();E(f)}function p(){k.removeClass("ge-editing");var O=k.find(".ge-content").each(function(){var P=a(this);D(P.data("ge-content-type")).deinit(J,P)});k.find(".ge-tools-drawer").remove();A();g()}function j(){k.find(".row").each(function(){var Q=a(this);if(Q.find("> .ge-tools-drawer").length){return}var P=a('<div class="ge-tools-drawer" />').prependTo(Q);w(P,"Move","ge-move","glyphicon-move");w(P,"Settings","","glyphicon-cog",function(){O.toggle()});J.row_tools.forEach(function(R){w(P,R.title||"",R.className||"",R.iconClass||"glyphicon-wrench",R.on)});w(P,"Remove row","","glyphicon-trash",function(){Q.slideUp(function(){Q.remove()})});w(P,"Add column","ge-add-column","glyphicon-plus-sign",function(){Q.append(I(3));G()});var O=t(Q,J.row_classes).appendTo(P)})}function h(){k.find(".column").each(function(){var O=a(this);if(O.find("> .ge-tools-drawer").length){return}var Q=a('<div class="ge-tools-drawer" />').prependTo(O);w(Q,"Move","ge-move","glyphicon-move");w(Q,"Make column narrower\n(hold shift for min)","ge-decrease-col-width","glyphicon-minus",function(V){var U=J.valid_col_sizes;var T=o[f];var S=U.indexOf(v(O,T));var R=U[y(S-1,0,U.length-1)];if(V.shiftKey){R=U[0]}H(O,T,Math.max(R,1))});w(Q,"Make column wider\n(hold shift for max)","ge-increase-col-width","glyphicon-plus",function(W){var V=J.valid_col_sizes;var T=o[f];var S=V.indexOf(v(O,T));var U=y(S+1,0,V.length-1);var R=V[U];if(W.shiftKey){R=V[V.length-1]}H(O,T,Math.min(R,x))});w(Q,"Settings","","glyphicon-cog",function(){P.toggle()});J.col_tools.forEach(function(R){w(Q,R.title||"",R.className||"",R.iconClass||"glyphicon-wrench",R.on)});w(Q,"Remove col","","glyphicon-trash",function(){O.animate({opacity:"hide",width:"hide",height:"hide"},400,function(){O.remove()})});w(Q,"Add Image","ge-add-image","glyphicon-picture",function(){G()});w(Q,"Add row","ge-add-row","glyphicon-plus-sign",function(){var R=i();O.append(R);R.append(I(6)).append(I(6));G()});var P=t(O,J.col_classes).appendTo(Q)})}function w(R,T,Q,O,S){var P=a('<a title="'+T+'" class="'+Q+'"><span class="glyphicon '+O+'"></span></a>').appendTo(R);if(typeof S=="function"){P.on("click",S)}if(typeof S=="object"){a.each(S,function(U,V){P.on(U,V)})}}function t(O,P){var R=a('<div class="ge-details" />');a('<input class="ge-id" />').attr("placeholder","id").val(O.attr("id")).attr("title","Set a unique identifier").appendTo(R);var Q=a('<div class="btn-group" />').appendTo(R);P.forEach(function(S){var T=a('<a class="btn btn-xs btn-default" />').html(S.label).attr("title",S.title?S.title:'Toggle "'+S.label+'" styling').toggleClass("active btn-primary",O.hasClass(S.cssClass)).on("click",function(){T.toggleClass("active btn-primary");O.toggleClass(S.cssClass,T.hasClass("active"))}).appendTo(Q)});return R}function B(){k.find('.column, div[class*="col-"]').each(function(){var O=a(this);var Q=2;var R=n(O);if(R.length){Q=R[0].size}var P=O.attr("class");o.forEach(function(S){if(P.indexOf(S)==-1){O.addClass(S+Q)}});O.addClass("column")})}function v(O,R){var Q=n(O);for(var P=0;P<Q.length;P++){if(Q[P].colClass==R){return Q[P].size}}if(Q.length){return Q[0].size}return null}function n(P){var O=[];o.forEach(function(R){var Q=new RegExp(R+"(\\d+)","i");if(Q.test(P.attr("class"))){O.push({colClass:R,size:parseInt(Q.exec(P.attr("class"))[1])})}});return O}function H(O,R,P){var Q=new RegExp("("+R+"(\\d+))","i");var S=Q.exec(O.attr("class"));if(S&&parseInt(S[2])!==P){O.switchClass(S[1],R+P,50)}else{O.addClass(R+P)}}function L(){k.find(".row").sortable({items:"> .column",connectWith:".ge-canvas .row",handle:"> .ge-tools-drawer .ge-move",start:O,helper:"clone",});k.add(k.find(".column")).sortable({items:"> .row, > .ge-content",connectsWith:".ge-canvas, .ge-canvas .column",handle:"> .ge-tools-drawer .ge-move",start:O,helper:"clone",});function O(Q,P){P.placeholder.css({height:P.item.outerHeight()});P.helper.hide()}}function A(){k.add(k.find(".column")).add(k.find(".row")).sortable("destroy")}function i(){return a('<div class="row" />')}function I(O){return a("<div/>").addClass(o.map(function(P){return P+=O}).join(" ")).append(K().html(D(J.content_types[0]).initialContent))}function g(O){if(J.custom_filter.length){a.each(J.custom_filter,function(P,Q){if(typeof Q=="string"){Q=window[Q]}Q(k,O)})}}function F(){k.find(".column").each(function(){var O=a(this);var P=a();O.children().each(function(){var Q=a(this);if(Q.is(".row, .ge-tools-drawer, .ge-content")){s(P)}else{P=P.add(Q)}});s(P)})}function s(P){if(P.length){var O=K().insertAfter(P.last());P.appendTo(O);P=a()}}function K(){return a("<div/>").addClass("ge-content ge-content-type-"+J.content_types[0]).attr("data-ge-content-type",J.content_types[0])}function E(P){f=P;var O=["ge-layout-desktop","ge-layout-tablet","ge-layout-phone"];O.forEach(function(Q,R){k.toggleClass(Q,R==P)})}function D(O){return a.fn.gridEditor.RTEs[O]}function y(P,Q,O){return Math.min(O,Math.max(Q,P))}l.data("grideditor",{init:G,deinit:p,})});return c};a.fn.gridEditor.RTEs={}})(jQuery);